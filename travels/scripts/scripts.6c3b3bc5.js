!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.mapboxgl=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){var c={};for(var d in a){var e=a[d].paintVertexArray;if(0!==e.length){var f=e.serialize(b),g=e.constructor.serialize();c[d]={array:f,type:g}}}return c}var e=a("./program_configuration"),f=function(a,b){this.vertexOffset=a,this.primitiveOffset=b,this.vertexLength=0,this.primitiveLength=0},g=function(a,b,c){var d=this;this.globalProperties={zoom:c};var f=a.layoutVertexArrayType;this.layoutVertexArray=new f;var g=a.elementArrayType;g&&(this.elementArray=new g);var h=a.elementArrayType2;h&&(this.elementArray2=new h),this.layerData={};for(var i=0,j=b;i<j.length;i+=1){var k=j[i],l=e.createDynamic(a.paintAttributes||[],k,c);d.layerData[k.id]={layer:k,programConfiguration:l,paintVertexArray:new l.PaintVertexArray}}this.segments=[],this.segments2=[]};g.prototype.prepareSegment=function(a){var b=this.segments[this.segments.length-1];return(!b||b.vertexLength+a>g.MAX_VERTEX_ARRAY_LENGTH)&&(b=new f(this.layoutVertexArray.length,this.elementArray.length),this.segments.push(b)),b},g.prototype.prepareSegment2=function(a){var b=this.segments2[this.segments2.length-1];return(!b||b.vertexLength+a>g.MAX_VERTEX_ARRAY_LENGTH)&&(b=new f(this.layoutVertexArray.length,this.elementArray2.length),this.segments2.push(b)),b},g.prototype.populatePaintArrays=function(a){var b=this;for(var c in this.layerData){var d=b.layerData[c];0!==d.paintVertexArray.bytesPerElement&&d.programConfiguration.populatePaintArray(d.layer,d.paintVertexArray,b.layoutVertexArray.length,b.globalProperties,a)}},g.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},g.prototype.serialize=function(a){return{layoutVertexArray:this.layoutVertexArray.serialize(a),elementArray:this.elementArray&&this.elementArray.serialize(a),elementArray2:this.elementArray2&&this.elementArray2.serialize(a),paintVertexArrays:d(this.layerData,a),segments:this.segments,segments2:this.segments2}},g.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,b.exports=g},{"./program_configuration":15}],2:[function(a,b,c){"use strict";var d=a("./array_group"),e=a("./buffer_group"),f=a("../util/util"),g=function(a,b){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.index=a.index,a.arrays?this.buffers=new e(b,a.layers,a.zoom,a.arrays):this.arrays=new d(b,a.layers,a.zoom)};g.prototype.populate=function(a,b){for(var c=this,d=0,e=a;d<e.length;d+=1){var f=e[d];c.layers[0].filter(f)&&(c.addFeature(f),b.featureIndex.insert(f,c.index))}},g.prototype.isEmpty=function(){return this.arrays.isEmpty()},g.prototype.serialize=function(a){return{zoom:this.zoom,layerIds:this.layers.map(function(a){return a.id}),arrays:this.arrays.serialize(a)}},g.prototype.destroy=function(){this.buffers&&(this.buffers.destroy(),this.buffers=null)},b.exports=g,g.deserialize=function(a,b){if(b){for(var c={},d=0,e=a;d<e.length;d+=1){var g=e[d],h=g.layerIds.map(function(a){return b.getLayer(a)}).filter(Boolean);if(0!==h.length)for(var i=h[0].createBucket(f.extend({layers:h},g)),j=0,k=h;j<k.length;j+=1){var l=k[j];c[l.id]=i}}return c}}},{"../util/util":127,"./array_group":1,"./buffer_group":9}],3:[function(a,b,c){"use strict";function d(a,b,c,d,e){a.emplaceBack(2*b+(d+1)/2,2*c+(e+1)/2)}var e=a("../bucket"),f=a("../vertex_array_type"),g=a("../element_array_type"),h=a("../load_geometry"),i=a("../extent"),j={layoutVertexArrayType:f([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:g(),paintAttributes:[{property:"circle-color",type:"Uint8"},{property:"circle-radius",type:"Uint16",multiplier:10},{property:"circle-blur",type:"Uint16",multiplier:10},{property:"circle-opacity",type:"Uint8",multiplier:255},{property:"circle-stroke-color",type:"Uint8"},{property:"circle-stroke-width",type:"Uint16",multiplier:10},{property:"circle-stroke-opacity",type:"Uint8",multiplier:255}]},k=function(a){function b(b){a.call(this,b,j)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.addFeature=function(a){for(var b=this.arrays,c=0,e=h(a);c<e.length;c+=1)for(var f=e[c],g=0,j=f;g<j.length;g+=1){var k=j[g],l=k.x,m=k.y;if(!(0>l||l>=i||0>m||m>=i)){var n=b.prepareSegment(4),o=n.vertexLength;d(b.layoutVertexArray,l,m,-1,-1),d(b.layoutVertexArray,l,m,1,-1),d(b.layoutVertexArray,l,m,1,1),d(b.layoutVertexArray,l,m,-1,1),b.elementArray.emplaceBack(o,o+1,o+2),b.elementArray.emplaceBack(o,o+3,o+2),n.vertexLength+=4,n.primitiveLength+=2}}b.populatePaintArrays(a.properties)},b}(e);b.exports=k},{"../bucket":2,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17}],4:[function(a,b,c){"use strict";var d=a("../bucket"),e=a("../vertex_array_type"),f=a("../element_array_type"),g=a("../load_geometry"),h=a("earcut"),i=a("../../util/classify_rings"),j=500,k={layoutVertexArrayType:e([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:f(3),elementArrayType2:f(2),paintAttributes:[{property:"fill-color",type:"Uint8"},{property:"fill-outline-color",type:"Uint8"},{property:"fill-opacity",type:"Uint8",multiplier:255}]},l=function(a){function b(b){a.call(this,b,k)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.addFeature=function(a){for(var b=this.arrays,c=0,d=i(g(a),j);c<d.length;c+=1){for(var e=d[c],f=0,k=0,l=e;k<l.length;k+=1){var m=l[k];f+=m.length}for(var n=b.prepareSegment(f),o=n.vertexLength,p=[],q=[],r=0,s=e;r<s.length;r+=1){var t=s[r];if(0!==t.length){t!==e[0]&&q.push(p.length/2);var u=b.prepareSegment2(t.length),v=u.vertexLength;b.layoutVertexArray.emplaceBack(t[0].x,t[0].y),b.elementArray2.emplaceBack(v+t.length-1,v),p.push(t[0].x),p.push(t[0].y);for(var w=1;w<t.length;w++)b.layoutVertexArray.emplaceBack(t[w].x,t[w].y),b.elementArray2.emplaceBack(v+w-1,v+w),p.push(t[w].x),p.push(t[w].y);u.vertexLength+=t.length,u.primitiveLength+=t.length}}for(var x=h(p,q),y=0;y<x.length;y+=3)b.elementArray.emplaceBack(o+x[y],o+x[y+1],o+x[y+2]);n.vertexLength+=f,n.primitiveLength+=x.length/3}b.populatePaintArrays(a.properties)},b}(d);b.exports=l},{"../../util/classify_rings":111,"../bucket":2,"../element_array_type":10,"../load_geometry":13,"../vertex_array_type":17,earcut:133}],5:[function(a,b,c){"use strict";function d(a,b,c,d,e,f,g,h){a.emplaceBack(b,c,2*Math.floor(d*o)+g,e*o*2,f*o*2,Math.round(h))}function e(a,b){return a.x===b.x&&(a.x<0||a.x>j)||a.y===b.y&&(a.y<0||a.y>j)}var f=a("../bucket"),g=a("../vertex_array_type"),h=a("../element_array_type"),i=a("../load_geometry"),j=a("../extent"),k=a("earcut"),l=a("../../util/classify_rings"),m=500,n={layoutVertexArrayType:g([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}]),elementArrayType:h(3),paintAttributes:[{property:"fill-extrusion-base",type:"Uint16"},{property:"fill-extrusion-height",type:"Uint16"},{property:"fill-extrusion-color",type:"Uint8"}]},o=Math.pow(2,13),p=function(a){function b(b){a.call(this,b,n)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.addFeature=function(a){for(var b=this.arrays,c=0,f=l(i(a),m);c<f.length;c+=1){for(var g=f[c],h=0,j=0,n=g;j<n.length;j+=1){var o=n[j];h+=o.length}for(var p=b.prepareSegment(5*h),q=[],r=[],s=[],t=0,u=g;t<u.length;t+=1){var v=u[t];if(0!==v.length){v!==g[0]&&r.push(q.length/2);for(var w=0,x=0;x<v.length;x++){var y=v[x];if(d(b.layoutVertexArray,y.x,y.y,0,0,1,1,0),s.push(p.vertexLength++),x>=1){var z=v[x-1];if(!e(y,z)){var A=y.sub(z)._perp()._unit();d(b.layoutVertexArray,y.x,y.y,A.x,A.y,0,0,w),d(b.layoutVertexArray,y.x,y.y,A.x,A.y,0,1,w),w+=z.dist(y),d(b.layoutVertexArray,z.x,z.y,A.x,A.y,0,0,w),d(b.layoutVertexArray,z.x,z.y,A.x,A.y,0,1,w);var B=p.vertexLength;b.elementArray.emplaceBack(B,B+1,B+2),b.elementArray.emplaceBack(B+1,B+2,B+3),p.vertexLength+=4,p.primitiveLength+=2}}q.push(y.x),q.push(y.y)}}}for(var C=k(q,r),D=0;D<C.length;D+=3)b.elementArray.emplaceBack(s[C[D]],s[C[D+1]],s[C[D+2]]);p.primitiveLength+=C.length/3}b.populatePaintArrays(a.properties)},b}(f);b.exports=p},{"../../util/classify_rings":111,"../bucket":2,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17,earcut:133}],6:[function(a,b,c){"use strict";function d(a,b,c,d,e,f,g){a.emplaceBack(b.x<<1|d,b.y<<1|e,Math.round(j*c.x)+128,Math.round(j*c.y)+128,(0===f?0:0>f?-1:1)+1|(g*n&63)<<2,g*n>>6)}var e=a("../bucket"),f=a("../vertex_array_type"),g=a("../element_array_type"),h=a("../load_geometry"),i=a("../extent"),j=63,k=Math.cos(37.5*(Math.PI/180)),l=15,m=15,n=.5,o=Math.pow(2,m-1)/n,p={layoutVertexArrayType:f([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}]),paintAttributes:[{property:"line-color",type:"Uint8"},{property:"line-blur",multiplier:10,type:"Uint8"},{property:"line-opacity",multiplier:10,type:"Uint8"},{property:"line-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"line-offset",multiplier:1,type:"Int8"}],elementArrayType:g()},q=function(a){function b(b){a.call(this,b,p)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.addFeature=function(a){for(var b=this,c=this.layers[0].layout,d=c["line-join"],e=c["line-cap"],f=c["line-miter-limit"],g=c["line-round-limit"],i=0,j=h(a,m);i<j.length;i+=1){var k=j[i];b.addLine(k,a.properties,d,e,f,g)}},b.prototype.addLine=function(a,b,c,d,e,f){for(var g=this,h=a.length;h>2&&a[h-1].equals(a[h-2]);)h--;if(!(a.length<2)){"bevel"===c&&(e=1.05);var j=l*(i/(512*this.overscaling)),m=a[0],n=a[h-1],o=m.equals(n),p=this.arrays,q=p.prepareSegment(10*h);if(2!==h||!o){this.distance=0;var r,s,t,u,v,w,x,y=d,z=o?"butt":d,A=!0;this.e1=this.e2=this.e3=-1,o&&(r=a[h-2],v=m.sub(r)._unit()._perp());for(var B=0;h>B;B++)if(t=o&&B===h-1?a[1]:a[B+1],!t||!a[B].equals(t)){v&&(u=v),r&&(s=r),r=a[B],v=t?t.sub(r)._unit()._perp():u,u=u||v;var C=u.add(v)._unit(),D=C.x*v.x+C.y*v.y,E=1/D,F=k>D&&s&&t;if(F&&B>0){var G=r.dist(s);if(G>2*j){var H=r.sub(r.sub(s)._mult(j/G)._round());g.distance+=H.dist(s),g.addCurrentVertex(H,g.distance,u.mult(1),0,0,!1,q),s=H}}var I=s&&t,J=I?c:t?y:z;if(I&&"round"===J&&(f>E?J="miter":2>=E&&(J="fakeround")),"miter"===J&&E>e&&(J="bevel"),"bevel"===J&&(E>2&&(J="flipbevel"),e>E&&(J="miter")),s&&(g.distance+=r.dist(s)),"miter"===J)C._mult(E),g.addCurrentVertex(r,g.distance,C,0,0,!1,q);else if("flipbevel"===J){if(E>100)C=v.clone();else{var K=u.x*v.y-u.y*v.x>0?-1:1,L=E*u.add(v).mag()/u.sub(v).mag();C._perp()._mult(L*K)}g.addCurrentVertex(r,g.distance,C,0,0,!1,q),g.addCurrentVertex(r,g.distance,C.mult(-1),0,0,!1,q)}else if("bevel"===J||"fakeround"===J){var M=u.x*v.y-u.y*v.x>0,N=-Math.sqrt(E*E-1);if(M?(x=0,w=N):(w=0,x=N),A||g.addCurrentVertex(r,g.distance,u,w,x,!1,q),"fakeround"===J){for(var O,P=Math.floor(8*(.5-(D-.5))),Q=0;P>Q;Q++)O=v.mult((Q+1)/(P+1))._add(u)._unit(),g.addPieSliceVertex(r,g.distance,O,M,q);g.addPieSliceVertex(r,g.distance,C,M,q);for(var R=P-1;R>=0;R--)O=u.mult((R+1)/(P+1))._add(v)._unit(),g.addPieSliceVertex(r,g.distance,O,M,q)}t&&g.addCurrentVertex(r,g.distance,v,-w,-x,!1,q)}else"butt"===J?(A||g.addCurrentVertex(r,g.distance,u,0,0,!1,q),t&&g.addCurrentVertex(r,g.distance,v,0,0,!1,q)):"square"===J?(A||(g.addCurrentVertex(r,g.distance,u,1,1,!1,q),g.e1=g.e2=-1),t&&g.addCurrentVertex(r,g.distance,v,-1,-1,!1,q)):"round"===J&&(A||(g.addCurrentVertex(r,g.distance,u,0,0,!1,q),g.addCurrentVertex(r,g.distance,u,1,1,!0,q),g.e1=g.e2=-1),t&&(g.addCurrentVertex(r,g.distance,v,-1,-1,!0,q),g.addCurrentVertex(r,g.distance,v,0,0,!1,q)));if(F&&h-1>B){var S=r.dist(t);if(S>2*j){var T=r.add(t.sub(r)._mult(j/S)._round());g.distance+=T.dist(r),g.addCurrentVertex(T,g.distance,v.mult(1),0,0,!1,q),r=T}}A=!1}p.populatePaintArrays(b)}}},b.prototype.addCurrentVertex=function(a,b,c,e,f,g,h){var i,j=g?1:0,k=this.arrays,l=k.layoutVertexArray,m=k.elementArray;i=c.clone(),e&&i._sub(c.perp()._mult(e)),d(l,a,i,j,0,e,b),this.e3=h.vertexLength++,this.e1>=0&&this.e2>=0&&(m.emplaceBack(this.e1,this.e2,this.e3),h.primitiveLength++),this.e1=this.e2,this.e2=this.e3,i=c.mult(-1),f&&i._sub(c.perp()._mult(f)),d(l,a,i,j,1,-f,b),this.e3=h.vertexLength++,this.e1>=0&&this.e2>=0&&(m.emplaceBack(this.e1,this.e2,this.e3),h.primitiveLength++),this.e1=this.e2,this.e2=this.e3,b>o/2&&(this.distance=0,this.addCurrentVertex(a,this.distance,c,e,f,g,h))},b.prototype.addPieSliceVertex=function(a,b,c,e,f){var g=e?1:0;c=c.mult(e?-1:1);var h=this.arrays,i=h.layoutVertexArray,j=h.elementArray;d(i,a,c,0,g,0,b),this.e3=f.vertexLength++,this.e1>=0&&this.e2>=0&&(j.emplaceBack(this.e1,this.e2,this.e3),f.primitiveLength++),e?this.e2=this.e3:this.e1=this.e3},b}(e);b.exports=q},{"../bucket":2,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17}],7:[function(a,b,c){"use strict";function d(a,b,c,d,e,f,g,h,i,j,k){a.emplaceBack(b,c,Math.round(64*d),Math.round(64*e),f/4,g/4,10*(j||0),k,10*(h||0),10*Math.min(i||25,25))}function e(a,b,c,d,e){return a.emplaceBack(b.x,b.y,Math.round(c.x),Math.round(c.y),10*d,10*e)}var f=a("point-geometry"),g=a("../array_group"),h=a("../buffer_group"),i=a("../vertex_array_type"),j=a("../element_array_type"),k=a("../extent"),l=a("../../symbol/anchor"),m=a("../../symbol/get_anchors"),n=a("../../util/token"),o=a("../../symbol/quads"),p=a("../../symbol/shaping"),q=a("../../symbol/resolve_text"),r=a("../../symbol/mergelines"),s=a("../../symbol/clip_line"),t=a("../../util/util"),u=a("../../util/script_detection"),v=a("../load_geometry"),w=a("../../symbol/collision_feature"),x=a("../../util/find_pole_of_inaccessibility"),y=a("../../util/classify_rings"),z=a("vector-tile").VectorTileFeature,A=p.shapeText,B=p.shapeIcon,C=p.WritingMode,D=o.getGlyphQuads,E=o.getIconQuads,F=j(),G=i([{name:"a_pos",components:2,type:"Int16"},{name:"a_offset",components:2,type:"Int16"},{name:"a_texture_pos",components:2,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"}]),H={glyph:{layoutVertexArrayType:G,elementArrayType:F},icon:{layoutVertexArrayType:G,elementArrayType:F},collisionBox:{layoutVertexArrayType:i([{name:"a_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}]),elementArrayType:j(2)}},I=function(a){var b=this;if(this.collisionBoxArray=a.collisionBoxArray,this.symbolQuadsArray=a.symbolQuadsArray,this.symbolInstancesArray=a.symbolInstancesArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.index=a.index,this.sdfIcons=a.sdfIcons,this.iconsNeedLinear=a.iconsNeedLinear,this.adjustedTextSize=a.adjustedTextSize,this.adjustedIconSize=a.adjustedIconSize,this.fontstack=a.fontstack,a.arrays){this.buffers={};for(var c in a.arrays)a.arrays[c]&&(b.buffers[c]=new h(H[c],a.layers,a.zoom,a.arrays[c]))}};I.prototype.populate=function(a,b){var c=this,d=this.layers[0].layout,e=d["text-field"],f=d["text-font"],g=d["icon-image"],h=e&&f,i=g;if(this.features=[],h||i){for(var j=b.iconDependencies,k=b.glyphDependencies,l=k[f]=k[f]||{},m=0;m<a.length;m++){var o=a[m];if(c.layers[0].filter(o)){var p;h&&(p=q(o,d));var s;if(i&&(s=n(o.properties,g)),(p||s)&&(c.features.push({text:p,icon:s,index:m,sourceLayerIndex:o.sourceLayerIndex,geometry:v(o),properties:o.properties,type:z.types[o.type]}),s&&(j[s]=!0),p))for(var t=0;t<p.length;t++)l[p.charCodeAt(t)]=!0}}"line"===d["symbol-placement"]&&(this.features=r(this.features))}},I.prototype.isEmpty=function(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()},I.prototype.serialize=function(a){return{zoom:this.zoom,layerIds:this.layers.map(function(a){return a.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,adjustedTextSize:this.adjustedTextSize,adjustedIconSize:this.adjustedIconSize,fontstack:this.fontstack,arrays:t.mapObject(this.arrays,function(b){return b.isEmpty()?null:b.serialize(a)})}},I.prototype.destroy=function(){this.buffers&&(this.buffers.icon&&this.buffers.icon.destroy(),this.buffers.glyph&&this.buffers.glyph.destroy(),this.buffers.collisionBox&&this.buffers.collisionBox.destroy(),this.buffers=null)},I.prototype.createArrays=function(){var a=this;this.arrays=t.mapObject(H,function(b){return new g(b,a.layers,a.zoom)})},I.prototype.prepare=function(a,b){var c=this;this.createArrays(),this.adjustedTextMaxSize=this.layers[0].getLayoutValue("text-size",{zoom:18}),this.adjustedTextSize=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1}),this.adjustedIconMaxSize=this.layers[0].getLayoutValue("icon-size",{zoom:18}),this.adjustedIconSize=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1});var d=512*this.overscaling;this.tilePixelRatio=k/d,this.compareText={},this.iconsNeedLinear=!1,this.symbolInstancesStartIndex=this.symbolInstancesArray.length;var e=this.layers[0].layout,f=.5,g=.5;switch(e["text-anchor"]){case"right":case"top-right":case"bottom-right":f=1;break;case"left":case"top-left":case"bottom-left":f=0}switch(e["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0}for(var h="right"===e["text-justify"]?1:"left"===e["text-justify"]?0:.5,i=24,j=e["text-line-height"]*i,l="line"!==e["symbol-placement"]?e["text-max-width"]*i:0,m=e["text-letter-spacing"]*i,n=[e["text-offset"][0]*i,e["text-offset"][1]*i],o=this.fontstack=e["text-font"].join(","),p="map"===e["text-rotation-alignment"]&&"line"===e["symbol-placement"],q=0,r=this.features;q<r.length;q+=1){var s,v=r[q];if(v.text){var w=u.allowsVerticalWritingMode(v.text);s={},s[C.horizontal]=A(v.text,a[o],l,j,f,g,h,m,n,i,C.horizontal),s[C.vertical]=w&&p&&A(v.text,a[o],l,j,f,g,h,m,n,i,C.vertical)}else s={};var x;if(v.icon){var y=b[v.icon],z=c.layers[0].getLayoutValue("icon-offset",{zoom:c.zoom},v.properties);x=B(y,z),y&&(void 0===c.sdfIcons?c.sdfIcons=y.sdf:c.sdfIcons!==y.sdf&&t.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),1!==y.pixelRatio?c.iconsNeedLinear=!0:0===e["icon-rotate"]&&c.layers[0].isLayoutValueFeatureConstant("icon-rotate")||(c.iconsNeedLinear=!0))}(s[C.horizontal]||x)&&c.addFeature(v,s,x)}this.symbolInstancesEndIndex=this.symbolInstancesArray.length},I.prototype.addFeature=function(a,b,c){var d=this,e=this.layers[0].layout,f=24,g=this.adjustedTextSize/f,h=void 0!==this.adjustedTextMaxSize?this.adjustedTextMaxSize:this.adjustedTextSize,i=this.tilePixelRatio*g,j=this.tilePixelRatio*h/f,n=this.tilePixelRatio*this.adjustedIconSize,o=this.tilePixelRatio*e["symbol-spacing"],p=e["symbol-avoid-edges"],q=e["text-padding"]*this.tilePixelRatio,r=e["icon-padding"]*this.tilePixelRatio,t=e["text-max-angle"]/180*Math.PI,u="map"===e["text-rotation-alignment"]&&"line"===e["symbol-placement"],v="map"===e["icon-rotation-alignment"]&&"line"===e["symbol-placement"],w=e["text-allow-overlap"]||e["icon-allow-overlap"]||e["text-ignore-placement"]||e["icon-ignore-placement"],z=e["symbol-placement"],A=o/2,B=function(e,f){var g=!(f.x<0||f.x>k||f.y<0||f.y>k);if(!p||g){var h=g||w;d.addSymbolInstance(f,e,b,c,d.layers[0],h,d.symbolInstancesArray.length,d.collisionBoxArray,a.index,a.sourceLayerIndex,d.index,i,q,u,n,r,v,{zoom:d.zoom},a.properties)}};if("line"===z)for(var D=0,E=s(a.geometry,0,0,k,k);D<E.length;D+=1)for(var F=E[D],G=m(F,o,t,b[C.vertical]||b[C.horizontal],c,f,j,d.overscaling,k),H=0,I=G;H<I.length;H+=1){var J=I[H],K=b[C.horizontal];K&&d.anchorIsTooClose(K.text,A,J)||B(F,J)}else if("Polygon"===a.type)for(var L=0,M=y(a.geometry,0);L<M.length;L+=1){var N=M[L],O=x(N,16);B(N[0],new l(O.x,O.y,0))}else if("LineString"===a.type)for(var P=0,Q=a.geometry;P<Q.length;P+=1){var R=Q[P];B(R,new l(R[0].x,R[0].y,0))}else if("Point"===a.type)for(var S=0,T=a.geometry;S<T.length;S+=1)for(var U=T[S],V=0,W=U;V<W.length;V+=1){var X=W[V];B([X],new l(X.x,X.y,0))}},I.prototype.anchorIsTooClose=function(a,b,c){var d=this.compareText;if(a in d){for(var e=d[a],f=e.length-1;f>=0;f--)if(c.dist(e[f])<b)return!0}else d[a]=[];return d[a].push(c),!1},I.prototype.place=function(a,b){var c=this;this.createArrays();var d=this.layers[0].layout,e=a.maxScale,f="map"===d["text-rotation-alignment"]&&"line"===d["symbol-placement"],g="map"===d["icon-rotation-alignment"]&&"line"===d["symbol-placement"],h=d["text-allow-overlap"]||d["icon-allow-overlap"]||d["text-ignore-placement"]||d["icon-ignore-placement"];if(h){var i=this.symbolInstancesArray.toArray(this.symbolInstancesStartIndex,this.symbolInstancesEndIndex),j=a.angle,k=Math.sin(j),l=Math.cos(j);this.sortedSymbolInstances=i.sort(function(a,b){var c=k*a.anchorPointX+l*a.anchorPointY|0,d=k*b.anchorPointX+l*b.anchorPointY|0;return c-d||b.index-a.index})}for(var m=this.symbolInstancesStartIndex;m<this.symbolInstancesEndIndex;m++){var n=c.sortedSymbolInstances?c.sortedSymbolInstances[m-c.symbolInstancesStartIndex]:c.symbolInstancesArray.get(m),o={boxStartIndex:n.textBoxStartIndex,boxEndIndex:n.textBoxEndIndex},p={boxStartIndex:n.iconBoxStartIndex,boxEndIndex:n.iconBoxEndIndex},q=!(n.textBoxStartIndex===n.textBoxEndIndex),r=!(n.iconBoxStartIndex===n.iconBoxEndIndex),s=d["text-optional"]||!q,t=d["icon-optional"]||!r,u=q?a.placeCollisionFeature(o,d["text-allow-overlap"],d["symbol-avoid-edges"]):a.minScale,v=r?a.placeCollisionFeature(p,d["icon-allow-overlap"],d["symbol-avoid-edges"]):a.minScale;s||t?!t&&u?u=Math.max(v,u):!s&&v&&(v=Math.max(v,u)):v=u=Math.max(v,u),q&&(a.insertCollisionFeature(o,u,d["text-ignore-placement"]),e>=u&&c.addSymbols(c.arrays.glyph,n.glyphQuadStartIndex,n.glyphQuadEndIndex,u,d["text-keep-upright"],f,a.angle,n.writingModes)),r&&(a.insertCollisionFeature(p,v,d["icon-ignore-placement"]),e>=v&&c.addSymbols(c.arrays.icon,n.iconQuadStartIndex,n.iconQuadEndIndex,v,d["icon-keep-upright"],g,a.angle))}b&&this.addToDebugBuffers(a)},I.prototype.addSymbols=function(a,b,c,e,f,g,h,i){for(var j=this,k=a.elementArray,l=a.layoutVertexArray,m=this.zoom,n=Math.max(Math.log(e)/Math.LN2+m,0),o=b;c>o;o++){var p=j.symbolQuadsArray.get(o).SymbolQuad,q=(p.anchorAngle+h+Math.PI)%(2*Math.PI);if(i&C.vertical){if(g&&p.writingMode===C.vertical){if(f&&g&&q<=5*Math.PI/4||q>7*Math.PI/4)continue}else if(f&&g&&q<=3*Math.PI/4||q>5*Math.PI/4)continue}else if(f&&g&&(q<=Math.PI/2||q>3*Math.PI/2))continue;var r=p.tl,s=p.tr,t=p.bl,u=p.br,v=p.tex,w=p.anchorPoint,x=Math.max(m+Math.log(p.minScale)/Math.LN2,n),y=Math.min(m+Math.log(p.maxScale)/Math.LN2,25);if(!(x>=y)){x===n&&(x=0);var z=Math.round(p.glyphAngle/(2*Math.PI)*256),A=a.prepareSegment(4),B=A.vertexLength;d(l,w.x,w.y,r.x,r.y,v.x,v.y,x,y,n,z),d(l,w.x,w.y,s.x,s.y,v.x+v.w,v.y,x,y,n,z),d(l,w.x,w.y,t.x,t.y,v.x,v.y+v.h,x,y,n,z),d(l,w.x,w.y,u.x,u.y,v.x+v.w,v.y+v.h,x,y,n,z),k.emplaceBack(B,B+1,B+2),k.emplaceBack(B+1,B+2,B+3),A.vertexLength+=4,A.primitiveLength+=2}}},I.prototype.addToDebugBuffers=function(a){for(var b=this,c=this.arrays.collisionBox,d=c.layoutVertexArray,g=c.elementArray,h=-a.angle,i=a.yStretch,j=this.symbolInstancesStartIndex;j<this.symbolInstancesEndIndex;j++){var k=b.symbolInstancesArray.get(j);k.textCollisionFeature={boxStartIndex:k.textBoxStartIndex,boxEndIndex:k.textBoxEndIndex},k.iconCollisionFeature={boxStartIndex:k.iconBoxStartIndex,boxEndIndex:k.iconBoxEndIndex};for(var l=0;2>l;l++){var m=k[0===l?"textCollisionFeature":"iconCollisionFeature"];if(m)for(var n=m.boxStartIndex;n<m.boxEndIndex;n++){var o=b.collisionBoxArray.get(n),p=o.anchorPoint,q=new f(o.x1,o.y1*i)._rotate(h),r=new f(o.x2,o.y1*i)._rotate(h),s=new f(o.x1,o.y2*i)._rotate(h),t=new f(o.x2,o.y2*i)._rotate(h),u=Math.max(0,Math.min(25,b.zoom+Math.log(o.maxScale)/Math.LN2)),v=Math.max(0,Math.min(25,b.zoom+Math.log(o.placementScale)/Math.LN2)),w=c.prepareSegment(4),x=w.vertexLength;e(d,p,q,u,v),e(d,p,r,u,v),e(d,p,t,u,v),e(d,p,s,u,v),g.emplaceBack(x,x+1),g.emplaceBack(x+1,x+2),g.emplaceBack(x+2,x+3),g.emplaceBack(x+3,x),w.vertexLength+=4,w.primitiveLength+=4}}}},I.prototype.addSymbolInstance=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var u,v,x,y=this,z=[];for(var A in c){var B=parseInt(A,10);c[B]&&(z=z.concat(f?D(a,c[B],l,b,e,n,B):[]),u=new w(h,b,a,i,j,k,c[B],l,m,n,!1))}var F=this.symbolQuadsArray.length;if(z&&z.length)for(var G=0;G<z.length;G++)y.addSymbolQuad(z[G]);var H=this.symbolQuadsArray.length,J=u?u.boxStartIndex:this.collisionBoxArray.length,K=u?u.boxEndIndex:this.collisionBoxArray.length;d&&(x=f?E(a,d,o,b,e,q,c[C.horizontal],r,s):[],v=new w(h,b,a,i,j,k,d,o,p,q,!0));var L=this.symbolQuadsArray.length;x&&1===x.length&&this.addSymbolQuad(x[0]);var M=this.symbolQuadsArray.length,N=v?v.boxStartIndex:this.collisionBoxArray.length,O=v?v.boxEndIndex:this.collisionBoxArray.length;M>I.MAX_QUADS&&t.warnOnce("Too many symbols being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),H>I.MAX_QUADS&&t.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");var P=(c[C.vertical]?C.vertical:0)|(c[C.horizontal]?C.horizontal:0);return this.symbolInstancesArray.emplaceBack(J,K,N,O,F,H,L,M,a.x,a.y,g,P)},I.prototype.addSymbolQuad=function(a){return this.symbolQuadsArray.emplaceBack(a.anchorPoint.x,a.anchorPoint.y,a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y,a.tex.h,a.tex.w,a.tex.x,a.tex.y,a.anchorAngle,a.glyphAngle,a.maxScale,a.minScale,a.writingMode)},I.MAX_QUADS=65535,b.exports=I},{"../../symbol/anchor":73,"../../symbol/clip_line":75,"../../symbol/collision_feature":77,"../../symbol/get_anchors":79,"../../symbol/mergelines":82,"../../symbol/quads":83,"../../symbol/resolve_text":84,"../../symbol/shaping":85,"../../util/classify_rings":111,"../../util/find_pole_of_inaccessibility":117,"../../util/script_detection":124,"../../util/token":126,"../../util/util":127,"../array_group":1,"../buffer_group":9,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17,"point-geometry":194,"vector-tile":204}],8:[function(a,b,c){"use strict";var d={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT"},e=function(a,b,c){this.arrayBuffer=a.arrayBuffer,this.length=a.length,this.attributes=b.members,this.itemSize=b.bytesPerElement,this.type=c,this.arrayType=b};e.fromStructArray=function(a,b){return new e(a.serialize(),a.constructor.serialize(),b)},e.prototype.bind=function(a){var b=a[this.type];this.buffer?a.bindBuffer(b,this.buffer):(this.gl=a,this.buffer=a.createBuffer(),a.bindBuffer(b,this.buffer),a.bufferData(b,this.arrayBuffer,a.STATIC_DRAW),this.arrayBuffer=null)},e.prototype.setVertexAttribPointers=function(a,b,c){for(var e=this,f=0;f<this.attributes.length;f++){var g=e.attributes[f],h=b[g.name];void 0!==h&&a.vertexAttribPointer(h,g.components,a[d[g.type]],!1,e.arrayType.bytesPerElement,g.offset+(e.arrayType.bytesPerElement*c||0))}},e.prototype.destroy=function(){this.buffer&&this.gl.deleteBuffer(this.buffer)},e.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"},b.exports=e},{}],9:[function(a,b,c){"use strict";var d=a("../util/util"),e=a("./buffer"),f=a("./program_configuration"),g=a("../render/vertex_array_object"),h=function(a,b,c,h){var i=this;this.layoutVertexBuffer=new e(h.layoutVertexArray,a.layoutVertexArrayType.serialize(),e.BufferType.VERTEX),h.elementArray&&(this.elementBuffer=new e(h.elementArray,a.elementArrayType.serialize(),e.BufferType.ELEMENT)),h.elementArray2&&(this.elementBuffer2=new e(h.elementArray2,a.elementArrayType2.serialize(),e.BufferType.ELEMENT)),this.layerData={};for(var j=0,k=b;j<k.length;j+=1){var l=k[j],m=h.paintVertexArrays&&h.paintVertexArrays[l.id],n=f.createDynamic(a.paintAttributes||[],l,c),o=m?new e(m.array,m.type,e.BufferType.VERTEX):null;i.layerData[l.id]={programConfiguration:n,paintVertexBuffer:o}}this.segments=h.segments,this.segments2=h.segments2;for(var p=0,q=[this.segments,this.segments2];p<q.length;p+=1)for(var r=q[p],s=0,t=r||[];s<t.length;s+=1){var u=t[s];u.vaos=d.mapObject(i.layerData,function(){return new g})}};h.prototype.destroy=function(){var a=this;this.layoutVertexBuffer.destroy(),this.elementBuffer&&this.elementBuffer.destroy(),this.elementBuffer2&&this.elementBuffer2.destroy();for(var b in this.layerData){var c=a.layerData[b].paintVertexBuffer;c&&c.destroy()}for(var d=0,e=[this.segments,this.segments2];d<e.length;d+=1)for(var f=e[d],g=0,h=f||[];g<h.length;g+=1){var i=h[g];for(var j in i.vaos)i.vaos[j].destroy()}},b.exports=h},{"../render/vertex_array_object":39,"../util/util":127,"./buffer":8,"./program_configuration":15}],10:[function(a,b,c){"use strict";function d(a){return e({members:[{type:"Uint16",name:"vertices",components:a||3}]})}var e=a("../util/struct_array");b.exports=d},{"../util/struct_array":125}],11:[function(a,b,c){"use strict";b.exports=8192},{}],12:[function(a,b,c){"use strict";function d(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function e(a,b){return b-a}function f(a){return a["line-gap-width"]>0?a["line-gap-width"]+2*a["line-width"]:a["line-width"]}function g(a,b,c,d,e){if(!b[0]&&!b[1])return a;b=i.convert(b),"viewport"===c&&b._rotate(-d);for(var f=[],g=0;g<a.length;g++){for(var h=a[g],j=[],k=0;k<h.length;k++)j.push(h[k].sub(b._mult(e)));f.push(j)}return f}function h(a,b){for(var c=[],d=new i(0,0),e=0;e<a.length;e++){for(var f=a[e],g=[],h=0;h<f.length;h++){var j=f[h-1],k=f[h],l=f[h+1],m=0===h?d:k.sub(j)._unit()._perp(),n=h===f.length-1?d:l.sub(k)._unit()._perp(),o=m._add(n)._unit(),p=o.x*n.x+o.y*n.y;o._mult(1/p),g.push(o._mult(b)._add(k))}c.push(g)}return c}var i=a("point-geometry"),j=a("./load_geometry"),k=a("./extent"),l=a("feature-filter"),m=a("../util/struct_array"),n=a("grid-index"),o=a("../util/dictionary_coder"),p=a("vector-tile"),q=a("pbf"),r=a("../util/vectortile_to_geojson"),s=a("../util/util").arraysIntersect,t=a("../util/intersection_tests"),u=t.multiPolygonIntersectsBufferedMultiPoint,v=t.multiPolygonIntersectsMultiPolygon,w=t.multiPolygonIntersectsBufferedMultiLine,x=m({members:[{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]}),y=function(a,b,c){if(a.grid){var d=a,e=b;a=d.coord,b=d.overscaling,this.grid=new n(d.grid),this.featureIndexArray=new x(d.featureIndexArray),this.rawTileData=e,this.bucketLayerIDs=d.bucketLayerIDs}else this.grid=new n(k,16,0),this.featureIndexArray=new x;this.coord=a,this.overscaling=b,this.x=a.x,this.y=a.y,this.z=a.z-Math.log(b)/Math.LN2,this.setCollisionTile(c)};y.prototype.insert=function(a,b){var c=this,d=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a.index,a.sourceLayerIndex,b);for(var e=j(a),f=0;f<e.length;f++){for(var g=e[f],h=[1/0,1/0,-(1/0),-(1/0)],i=0;i<g.length;i++){var k=g[i];h[0]=Math.min(h[0],k.x),h[1]=Math.min(h[1],k.y),h[2]=Math.max(h[2],k.x),h[3]=Math.max(h[3],k.y)}c.grid.insert(d,h[0],h[1],h[2],h[3])}},y.prototype.setCollisionTile=function(a){this.collisionTile=a},y.prototype.serialize=function(a){var b=this.grid.toArrayBuffer();return a&&a.push(b),{coord:this.coord,overscaling:this.overscaling,grid:b,featureIndexArray:this.featureIndexArray.serialize(a),bucketLayerIDs:this.bucketLayerIDs}},y.prototype.query=function(a,b){this.vtLayers||(this.vtLayers=new p.VectorTile(new q(this.rawTileData)).layers,this.sourceLayerCoder=new o(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));var c={},g=a.params||{},h=k/a.tileSize/a.scale,j=l(g.filter),m=0;for(var n in b){var r=b[n],s=r.paint,t=0;"line"===r.type?t=f(s)/2+Math.abs(s["line-offset"])+d(s["line-translate"]):"fill"===r.type?t=d(s["fill-translate"]):"fill-extrusion"===r.type?t=d(s["fill-extrusion-translate"]):"circle"===r.type&&(t=s["circle-radius"]+d(s["circle-translate"])),
m=Math.max(m,t*h)}for(var u=a.queryGeometry.map(function(a){return a.map(function(a){return new i(a.x,a.y)})}),v=1/0,w=1/0,x=-(1/0),y=-(1/0),z=0;z<u.length;z++)for(var A=u[z],B=0;B<A.length;B++){var C=A[B];v=Math.min(v,C.x),w=Math.min(w,C.y),x=Math.max(x,C.x),y=Math.max(y,C.y)}var D=this.grid.query(v-m,w-m,x+m,y+m);D.sort(e),this.filterMatching(c,D,this.featureIndexArray,u,j,g.layers,b,a.bearing,h);var E=this.collisionTile.queryRenderedSymbols(u,a.scale);return E.sort(),this.filterMatching(c,E,this.collisionTile.collisionBoxArray,u,j,g.layers,b,a.bearing,h),c},y.prototype.filterMatching=function(a,b,c,d,e,i,k,l,m){for(var n,o=this,p=0;p<b.length;p++){var q=b[p];if(q!==n){n=q;var t=c.get(q),x=o.bucketLayerIDs[t.bucketIndex];if(!i||s(i,x)){var y=o.sourceLayerCoder.decode(t.sourceLayerIndex),z=o.vtLayers[y],A=z.feature(t.featureIndex);if(e(A))for(var B=null,C=0;C<x.length;C++){var D=x[C];if(!(i&&i.indexOf(D)<0)){var E=k[D];if(E){var F;if("symbol"!==E.type){B||(B=j(A));var G=E.paint;if("line"===E.type){F=g(d,G["line-translate"],G["line-translate-anchor"],l,m);var H=f(G)/2*m;if(G["line-offset"]&&(B=h(B,G["line-offset"]*m)),!w(F,B,H))continue}else if("fill"===E.type||"fill-extrusion"===E.type){var I=E.type;if(F=g(d,G[I+"-translate"],G[I+"-translate-anchor"],l,m),!v(F,B))continue}else if("circle"===E.type){F=g(d,G["circle-translate"],G["circle-translate-anchor"],l,m);var J=G["circle-radius"]*m;if(!u(F,B,J))continue}}var K=new r(A,o.z,o.x,o.y);K.layer=E.serialize();var L=a[D];void 0===L&&(L=a[D]=[]),L.push(K)}}}}}}},b.exports=y},{"../util/dictionary_coder":113,"../util/intersection_tests":120,"../util/struct_array":125,"../util/util":127,"../util/vectortile_to_geojson":128,"./extent":11,"./load_geometry":13,"feature-filter":135,"grid-index":146,pbf:193,"point-geometry":194,"vector-tile":204}],13:[function(a,b,c){"use strict";function d(a){return{min:-1*Math.pow(2,a-1),max:Math.pow(2,a-1)-1}}var e=a("../util/util"),f=a("./extent"),g={15:d(15),16:d(16)};b.exports=function(a,b){for(var c=g[b||16],d=f/a.extent,h=a.loadGeometry(),i=0;i<h.length;i++)for(var j=h[i],k=0;k<j.length;k++){var l=j[k];l.x=Math.round(l.x*d),l.y=Math.round(l.y*d),(l.x<c.min||l.x>c.max||l.y<c.min||l.y>c.max)&&e.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return h}},{"../util/util":127,"./extent":11}],14:[function(a,b,c){"use strict";var d=a("../util/struct_array"),e=d({members:[{name:"a_pos",type:"Int16",components:2}]});b.exports=e},{"../util/struct_array":125}],15:[function(a,b,c){"use strict";function d(a,b,c,d){if(!a.zoomStops)return b.getPaintValue(a.property,c,d);var e=a.zoomStops.map(function(e){return b.getPaintValue(a.property,g.extend({},c,{zoom:e}),d)});return 1===e.length?e[0]:e}function e(a,b){var c=a.property.replace(b.type+"-","").replace(/-/g,"_"),d="color"===b._paintSpecifications[a.property].type;return g.extend({name:"a_"+c,components:d?4:1,multiplier:d?255:1},a)}var f=a("./vertex_array_type"),g=a("../util/util"),h=function(){this.attributes=[],this.uniforms=[],this.interpolationUniforms=[],this.pragmas={vertex:{},fragment:{}},this.cacheKey=""};h.createDynamic=function(a,b,c){for(var d=new h,g=0,i=a;g<i.length;g+=1){var j=i[g],k=e(j,b),l=k.name.slice(2);b.isPaintValueFeatureConstant(k.property)?d.addZoomAttribute(l,k):b.isPaintValueZoomConstant(k.property)?d.addPropertyAttribute(l,k):d.addZoomAndPropertyAttribute(l,k,b,c)}return d.PaintVertexArray=f(d.attributes),d},h.createStatic=function(a){for(var b=new h,c=0,d=a;c<d.length;c+=1){var e=d[c];b.addUniform(e,"u_"+e)}return b},h.prototype.addUniform=function(a,b){var c=this.getPragmas(a);c.define.push("uniform {precision} {type} "+b+";"),c.initialize.push("{precision} {type} "+a+" = "+b+";"),this.cacheKey+="/u_"+a},h.prototype.addZoomAttribute=function(a,b){this.uniforms.push(b),this.addUniform(a,b.name)},h.prototype.addPropertyAttribute=function(a,b){var c=this.getPragmas(a);this.attributes.push(b),c.define.push("varying {precision} {type} "+a+";"),c.vertex.define.push("attribute {precision} {type} "+b.name+";"),c.vertex.initialize.push(a+" = "+b.name+" / "+b.multiplier+".0;"),this.cacheKey+="/a_"+a},h.prototype.addZoomAndPropertyAttribute=function(a,b,c,d){var e=this,f=this.getPragmas(a);f.define.push("varying {precision} {type} "+a+";");for(var h=0,i=c.getPaintValueStopZoomLevels(b.property);h<i.length&&i[h]<d;)h++;var j=Math.max(0,Math.min(i.length-4,h-2)),k="u_"+a+"_t";f.vertex.define.push("uniform lowp float "+k+";"),this.interpolationUniforms.push({name:k,property:b.property,stopOffset:j});for(var l=[],m=0;4>m;m++)l.push(i[Math.min(j+m,i.length-1)]);var n=[];if(1===b.components)this.attributes.push(g.extend({},b,{components:4,zoomStops:l})),f.vertex.define.push("attribute {precision} vec4 "+b.name+";"),n.push(b.name);else for(var o=0;4>o;o++){var p=b.name+o;n.push(p),e.attributes.push(g.extend({},b,{name:p,zoomStops:[l[o]]})),f.vertex.define.push("attribute {precision} {type} "+p+";")}f.vertex.initialize.push(a+" = evaluate_zoom_function_"+b.components+"(            "+n.join(", ")+", "+k+") / "+b.multiplier+".0;"),this.cacheKey+="/z_"+a},h.prototype.getPragmas=function(a){return this.pragmas[a]||(this.pragmas[a]={define:[],initialize:[]},this.pragmas[a].fragment={define:[],initialize:[]},this.pragmas[a].vertex={define:[],initialize:[]}),this.pragmas[a]},h.prototype.applyPragmas=function(a,b){var c=this;return a.replace(/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,function(a,d,e,f,g){return c.pragmas[g][d].concat(c.pragmas[g][b][d]).join("\n").replace(/{type}/g,f).replace(/{precision}/g,e)})},h.prototype.populatePaintArray=function(a,b,c,e,f){var g=b.length;b.resize(c);for(var h=0,i=this.attributes;h<i.length;h+=1)for(var j=i[h],k=d(j,a,e,f),l=g;c>l;l++){var m=b.get(l);if(4===j.components)for(var n=0;4>n;n++)m[j.name+n]=k[n]*j.multiplier;else m[j.name]=k*j.multiplier}},h.prototype.setUniforms=function(a,b,c,d){for(var e=0,f=this.uniforms;e<f.length;e+=1){var g=f[e],h=c.getPaintValue(g.property,d);4===g.components?a.uniform4fv(b[g.name],h):a.uniform1f(b[g.name],h)}for(var i=0,j=this.interpolationUniforms;i<j.length;i+=1){var k=j[i],l=c.getPaintInterpolationT(k.property,d);a.uniform1f(b[k.name],Math.max(0,Math.min(4,l-k.stopOffset)))}},b.exports=h},{"../util/util":127,"./vertex_array_type":17}],16:[function(a,b,c){"use strict";var d=a("../util/struct_array"),e=d({members:[{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]});b.exports=e},{"../util/struct_array":125}],17:[function(a,b,c){"use strict";function d(a){return e({members:a,alignment:4})}var e=a("../util/struct_array");b.exports=d},{"../util/struct_array":125}],18:[function(a,b,c){"use strict";var d=function(a,b,c){this.column=a,this.row=b,this.zoom=c};d.prototype.clone=function(){return new d(this.column,this.row,this.zoom)},d.prototype.zoomTo=function(a){return this.clone()._zoomTo(a)},d.prototype.sub=function(a){return this.clone()._sub(a)},d.prototype._zoomTo=function(a){var b=Math.pow(2,a-this.zoom);return this.column*=b,this.row*=b,this.zoom=a,this},d.prototype._sub=function(a){return a=a.zoomTo(this.zoom),this.column-=a.column,this.row-=a.row,this},b.exports=d},{}],19:[function(a,b,c){"use strict";var d=a("../util/util").wrap,e=function(a,b){if(isNaN(a)||isNaN(b))throw new Error("Invalid LngLat object: ("+a+", "+b+")");if(this.lng=+a,this.lat=+b,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};e.prototype.wrap=function(){return new e(d(this.lng,-180,180),this.lat)},e.prototype.toArray=function(){return[this.lng,this.lat]},e.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},e.convert=function(a){if(a instanceof e)return a;if(a&&a.hasOwnProperty("lng")&&a.hasOwnProperty("lat"))return new e(a.lng,a.lat);if(Array.isArray(a)&&2===a.length)return new e(a[0],a[1]);throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},b.exports=e},{"../util/util":127}],20:[function(a,b,c){"use strict";var d=a("./lng_lat"),e=function(a,b){a&&(b?this.setSouthWest(a).setNorthEast(b):4===a.length?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};e.prototype.setNorthEast=function(a){return this._ne=d.convert(a),this},e.prototype.setSouthWest=function(a){return this._sw=d.convert(a),this},e.prototype.extend=function(a){var b,c,f=this._sw,g=this._ne;if(a instanceof d)b=a,c=a;else{if(!(a instanceof e))return Array.isArray(a)?a.every(Array.isArray)?this.extend(e.convert(a)):this.extend(d.convert(a)):this;if(b=a._sw,c=a._ne,!b||!c)return this}return f||g?(f.lng=Math.min(b.lng,f.lng),f.lat=Math.min(b.lat,f.lat),g.lng=Math.max(c.lng,g.lng),g.lat=Math.max(c.lat,g.lat)):(this._sw=new d(b.lng,b.lat),this._ne=new d(c.lng,c.lat)),this},e.prototype.getCenter=function(){return new d((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},e.prototype.getSouthWest=function(){return this._sw},e.prototype.getNorthEast=function(){return this._ne},e.prototype.getNorthWest=function(){return new d(this.getWest(),this.getNorth())},e.prototype.getSouthEast=function(){return new d(this.getEast(),this.getSouth())},e.prototype.getWest=function(){return this._sw.lng},e.prototype.getSouth=function(){return this._sw.lat},e.prototype.getEast=function(){return this._ne.lng},e.prototype.getNorth=function(){return this._ne.lat},e.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},e.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},e.convert=function(a){return!a||a instanceof e?a:new e(a)},b.exports=e},{"./lng_lat":19}],21:[function(a,b,c){"use strict";var d=a("./lng_lat"),e=a("point-geometry"),f=a("./coordinate"),g=a("../util/util"),h=a("../util/interpolate"),i=a("../source/tile_coord"),j=a("../data/extent"),k=a("@mapbox/gl-matrix"),l=k.vec4,m=k.mat4,n=k.mat2,o=function(a,b){this.tileSize=512,this._minZoom=a||0,this._maxZoom=b||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new d(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0},p={minZoom:{},maxZoom:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};p.minZoom.get=function(){return this._minZoom},p.minZoom.set=function(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))},p.maxZoom.get=function(){return this._maxZoom},p.maxZoom.set=function(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))},p.worldSize.get=function(){return this.tileSize*this.scale},p.centerPoint.get=function(){return this.size._div(2)},p.size.get=function(){return new e(this.width,this.height)},p.bearing.get=function(){return-this.angle/Math.PI*180},p.bearing.set=function(a){var b=-g.wrap(a,-180,180)*Math.PI/180;this.angle!==b&&(this._unmodified=!1,this.angle=b,this._calcMatrices(),this.rotationMatrix=n.create(),n.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},p.pitch.get=function(){return this._pitch/Math.PI*180},p.pitch.set=function(a){var b=g.clamp(a,0,60)/180*Math.PI;this._pitch!==b&&(this._unmodified=!1,this._pitch=b,this._calcMatrices())},p.fov.get=function(){return this._fov/Math.PI*180},p.fov.set=function(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())},p.zoom.get=function(){return this._zoom},p.zoom.set=function(a){var b=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==b&&(this._unmodified=!1,this._zoom=b,this.scale=this.zoomScale(b),this.tileZoom=Math.floor(b),this.zoomFraction=b-this.tileZoom,this._constrain(),this._calcMatrices())},p.center.get=function(){return this._center},p.center.set=function(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())},o.prototype.coveringZoomLevel=function(a){return(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize))},o.prototype.coveringTiles=function(a){var b=this.coveringZoomLevel(a),c=b;if(b<a.minzoom)return[];b>a.maxzoom&&(b=a.maxzoom);var d=this.pointCoordinate(this.centerPoint,b),f=new e(d.column-.5,d.row-.5),g=[this.pointCoordinate(new e(0,0),b),this.pointCoordinate(new e(this.width,0),b),this.pointCoordinate(new e(this.width,this.height),b),this.pointCoordinate(new e(0,this.height),b)];return i.cover(b,g,a.reparseOverscaled?c:b).sort(function(a,b){return f.dist(a)-f.dist(b)})},o.prototype.resize=function(a,b){this.width=a,this.height=b,this.pixelsToGLUnits=[2/a,-2/b],this._constrain(),this._calcMatrices()},p.unmodified.get=function(){return this._unmodified},o.prototype.zoomScale=function(a){return Math.pow(2,a)},o.prototype.scaleZoom=function(a){return Math.log(a)/Math.LN2},o.prototype.project=function(a){return new e(this.lngX(a.lng),this.latY(a.lat))},o.prototype.unproject=function(a){return new d(this.xLng(a.x),this.yLat(a.y))},p.x.get=function(){return this.lngX(this.center.lng)},p.y.get=function(){return this.latY(this.center.lat)},p.point.get=function(){return new e(this.x,this.y)},o.prototype.lngX=function(a){return(180+a)*this.worldSize/360},o.prototype.latY=function(a){var b=180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360));return(180-b)*this.worldSize/360},o.prototype.xLng=function(a){return 360*a/this.worldSize-180},o.prototype.yLat=function(a){var b=180-360*a/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(b*Math.PI/180))-90},o.prototype.setLocationAtPoint=function(a,b){var c=this.pointCoordinate(b)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(a)._sub(c))},o.prototype.locationPoint=function(a){return this.coordinatePoint(this.locationCoordinate(a))},o.prototype.pointLocation=function(a){return this.coordinateLocation(this.pointCoordinate(a))},o.prototype.locationCoordinate=function(a){return new f(this.lngX(a.lng)/this.tileSize,this.latY(a.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},o.prototype.coordinateLocation=function(a){var b=a.zoomTo(this.zoom);return new d(this.xLng(b.column*this.tileSize),this.yLat(b.row*this.tileSize))},o.prototype.pointCoordinate=function(a,b){void 0===b&&(b=this.tileZoom);var c=0,d=[a.x,a.y,0,1],e=[a.x,a.y,1,1];l.transformMat4(d,d,this.pixelMatrixInverse),l.transformMat4(e,e,this.pixelMatrixInverse);var g=d[3],i=e[3],j=d[0]/g,k=e[0]/i,m=d[1]/g,n=e[1]/i,o=d[2]/g,p=e[2]/i,q=o===p?0:(c-o)/(p-o);return new f(h(j,k,q)/this.tileSize,h(m,n,q)/this.tileSize,this.zoom)._zoomTo(b)},o.prototype.coordinatePoint=function(a){var b=a.zoomTo(this.zoom),c=[b.column*this.tileSize,b.row*this.tileSize,0,1];return l.transformMat4(c,c,this.pixelMatrix),new e(c[0]/c[3],c[1]/c[3])},o.prototype.calculatePosMatrix=function(a,b){var c=a.toCoordinate(b),d=this.worldSize/this.zoomScale(c.zoom),e=m.identity(new Float64Array(16));return m.translate(e,e,[c.column*d,c.row*d,0]),m.scale(e,e,[d/j,d/j,1]),m.multiply(e,this.projMatrix,e),new Float32Array(e)},o.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var a,b,c,d,f,g,h,i,j=this.size,k=this._unmodified;this.latRange&&(a=this.latY(this.latRange[1]),b=this.latY(this.latRange[0]),f=b-a<j.y?j.y/(b-a):0),this.lngRange&&(c=this.lngX(this.lngRange[0]),d=this.lngX(this.lngRange[1]),g=d-c<j.x?j.x/(d-c):0);var l=Math.max(g||0,f||0);if(l)return this.center=this.unproject(new e(g?(d+c)/2:this.x,f?(b+a)/2:this.y)),this.zoom+=this.scaleZoom(l),this._unmodified=k,void(this._constraining=!1);if(this.latRange){var m=this.y,n=j.y/2;a>m-n&&(i=a+n),m+n>b&&(i=b-n)}if(this.lngRange){var o=this.x,p=j.x/2;c>o-p&&(h=c+p),o+p>d&&(h=d-p)}void 0===h&&void 0===i||(this.center=this.unproject(new e(void 0!==h?h:this.x,void 0!==i?i:this.y))),this._unmodified=k,this._constraining=!1}},o.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var a=this._fov/2,b=Math.PI/2+this._pitch,c=Math.sin(a)*this.cameraToCenterDistance/Math.sin(Math.PI-b-a),d=Math.cos(Math.PI/2-this._pitch)*c+this.cameraToCenterDistance,e=1.01*d,f=new Float64Array(16);m.perspective(f,this._fov,this.width/this.height,1,e),m.scale(f,f,[1,-1,1]),m.translate(f,f,[0,0,-this.cameraToCenterDistance]),m.rotateX(f,f,this._pitch),m.rotateZ(f,f,this.angle),m.translate(f,f,[-this.x,-this.y,0]);var g=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));if(m.scale(f,f,[1,1,g,1]),this.projMatrix=f,f=m.create(),m.scale(f,f,[this.width/2,-this.height/2,1]),m.translate(f,f,[1,-1,0]),this.pixelMatrix=m.multiply(new Float64Array(16),f,this.projMatrix),f=m.invert(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f}},Object.defineProperties(o.prototype,p),b.exports=o},{"../data/extent":11,"../source/tile_coord":51,"../util/interpolate":119,"../util/util":127,"./coordinate":18,"./lng_lat":19,"@mapbox/gl-matrix":131,"point-geometry":194}],22:[function(a,b,c){"use strict";var d,e=a("./util/worker_pool");b.exports=function(){return d||(d=new e),d}},{"./util/worker_pool":130}],23:[function(a,b,c){"use strict";var d={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};b.exports=function(a,b,c,e){e=e||1;var f,g,h,i,j,k,l,m,n=[];for(f=0,g=a.length;g>f;f++)if(j=d[a[f]]){for(m=null,h=0,i=j[1].length;i>h;h+=2)-1===j[1][h]&&-1===j[1][h+1]?m=null:(k=b+j[1][h]*e,l=c-j[1][h+1]*e,m&&n.push(m.x,m.y,k,l),m={x:k,y:l});b+=j[0]*e}return n}},{}],24:[function(a,b,c){"use strict";var d=a("./util/browser"),e=b.exports={};e.version=a("../package.json").version,e.workerCount=Math.max(Math.floor(d.hardwareConcurrency/2),1),e.Map=a("./ui/map"),e.NavigationControl=a("./ui/control/navigation_control"),e.GeolocateControl=a("./ui/control/geolocate_control"),e.AttributionControl=a("./ui/control/attribution_control"),e.ScaleControl=a("./ui/control/scale_control"),e.Popup=a("./ui/popup"),e.Marker=a("./ui/marker"),e.Style=a("./style/style"),e.LngLat=a("./geo/lng_lat"),e.LngLatBounds=a("./geo/lng_lat_bounds"),e.Point=a("point-geometry"),e.Evented=a("./util/evented"),e.util=a("./util/util"),e.supported=a("./util/browser").supported;var f=a("./util/ajax");e.util.getJSON=f.getJSON,e.util.getArrayBuffer=f.getArrayBuffer;var g=a("./util/config");e.config=g,Object.defineProperty(e,"accessToken",{get:function(){return g.ACCESS_TOKEN},set:function(a){g.ACCESS_TOKEN=a}})},{"../package.json":214,"./geo/lng_lat":19,"./geo/lng_lat_bounds":20,"./style/style":61,"./ui/control/attribution_control":91,"./ui/control/geolocate_control":92,"./ui/control/navigation_control":93,"./ui/control/scale_control":94,"./ui/map":103,"./ui/marker":104,"./ui/popup":105,"./util/ajax":107,"./util/browser":108,"./util/config":112,"./util/evented":116,"./util/util":127,"point-geometry":194}],25:[function(a,b,c){"use strict";function d(a,b,c){var d=a.gl,f=a.transform,g=f.tileSize,h=c.paint["background-color"],i=c.paint["background-pattern"],j=c.paint["background-opacity"],k=!i&&1===h[3]&&1===j;if(a.isOpaquePass===k){d.disable(d.STENCIL_TEST),a.setDepthSublayer(0);var l;i?(l=a.useProgram("fillPattern",a.basicFillProgramConfiguration),e.prepare(i,a,l),a.tileExtentPatternVAO.bind(d,l,a.tileExtentBuffer)):(l=a.useProgram("fill",a.basicFillProgramConfiguration),d.uniform4fv(l.u_color,h),a.tileExtentVAO.bind(d,l,a.tileExtentBuffer)),d.uniform1f(l.u_opacity,j);for(var m=f.coveringTiles({tileSize:g}),n=0,o=m;n<o.length;n+=1){var p=o[n];i&&e.setTile({coord:p,tileSize:g},a,l),d.uniformMatrix4fv(l.u_matrix,!1,a.transform.calculatePosMatrix(p)),d.drawArrays(d.TRIANGLE_STRIP,0,a.tileExtentBuffer.length)}}}var e=a("./pattern");b.exports=d},{"./pattern":37}],26:[function(a,b,c){"use strict";function d(a,b,c,d){if(!a.isOpaquePass){var f=a.gl;a.setDepthSublayer(0),a.depthMask(!1),f.disable(f.STENCIL_TEST);for(var g=0;g<d.length;g++){var h=d[g],i=b.getTile(h),j=i.getBucket(c);if(j){var k=j.buffers,l=k.layerData[c.id],m=l.programConfiguration,n=a.useProgram("circle",m);m.setUniforms(f,n,c,{zoom:a.transform.zoom}),"map"===c.paint["circle-pitch-scale"]?(f.uniform1i(n.u_scale_with_map,!0),f.uniform2f(n.u_extrude_scale,a.transform.pixelsToGLUnits[0]*a.transform.cameraToCenterDistance,a.transform.pixelsToGLUnits[1]*a.transform.cameraToCenterDistance)):(f.uniform1i(n.u_scale_with_map,!1),f.uniform2fv(n.u_extrude_scale,a.transform.pixelsToGLUnits)),f.uniform1f(n.u_devicepixelratio,e.devicePixelRatio),f.uniformMatrix4fv(n.u_matrix,!1,a.translatePosMatrix(h.posMatrix,i,c.paint["circle-translate"],c.paint["circle-translate-anchor"]));for(var o=0,p=k.segments;o<p.length;o+=1){var q=p[o];q.vaos[c.id].bind(f,n,k.layoutVertexBuffer,k.elementBuffer,l.paintVertexBuffer,q.vertexOffset),f.drawElements(f.TRIANGLES,3*q.primitiveLength,f.UNSIGNED_SHORT,3*q.primitiveOffset*2)}}}}}var e=a("../util/browser");b.exports=d},{"../util/browser":108}],27:[function(a,b,c){"use strict";function d(a,b,c,d){var e=a.gl;e.enable(e.STENCIL_TEST);for(var f=a.useProgram("collisionBox"),g=0;g<d.length;g++){var h=d[g],i=b.getTile(h),j=i.getBucket(c);if(j){var k=j.buffers.collisionBox;if(k){e.uniformMatrix4fv(f.u_matrix,!1,h.posMatrix),a.enableTileClippingMask(h),a.lineWidth(1),e.uniform1f(f.u_scale,Math.pow(2,a.transform.zoom-i.coord.z)),e.uniform1f(f.u_zoom,10*a.transform.zoom),e.uniform1f(f.u_maxzoom,10*(i.coord.z+1));for(var l=0,m=k.segments;l<m.length;l+=1){var n=m[l];n.vaos[c.id].bind(e,f,k.layoutVertexBuffer,k.elementBuffer,null,n.vertexOffset),e.drawElements(e.LINES,2*n.primitiveLength,e.UNSIGNED_SHORT,2*n.primitiveOffset*2)}}}}}b.exports=d},{}],28:[function(a,b,c){"use strict";function d(a,b,c){for(var d=0;d<c.length;d++)e(a,b,c[d])}function e(a,b,c){var d=a.gl;d.disable(d.STENCIL_TEST),a.lineWidth(1*g.devicePixelRatio);var e=c.posMatrix,m=a.useProgram("debug");d.uniformMatrix4fv(m.u_matrix,!1,e),d.uniform4f(m.u_color,1,0,0,1),a.debugVAO.bind(d,m,a.debugBuffer),d.drawArrays(d.LINE_STRIP,0,a.debugBuffer.length);for(var n=f(c.toString(),50,200,5),o=new l,p=0;p<n.length;p+=2)o.emplaceBack(n[p],n[p+1]);var q=j.fromStructArray(o,j.BufferType.VERTEX),r=new k;r.bind(d,m,q),d.uniform4f(m.u_color,1,1,1,1);for(var s=b.getTile(c).tileSize,t=i/(Math.pow(2,a.transform.zoom-c.z)*s),u=[[-1,-1],[-1,1],[1,-1],[1,1]],v=0;v<u.length;v++){var w=u[v];d.uniformMatrix4fv(m.u_matrix,!1,h.translate([],e,[t*w[0],t*w[1],0])),d.drawArrays(d.LINES,0,q.length)}d.uniform4f(m.u_color,0,0,0,1),d.uniformMatrix4fv(m.u_matrix,!1,e),d.drawArrays(d.LINES,0,q.length)}var f=a("../lib/debugtext"),g=a("../util/browser"),h=a("@mapbox/gl-matrix").mat4,i=a("../data/extent"),j=a("../data/buffer"),k=a("./vertex_array_object"),l=a("../data/pos_array");b.exports=d},{"../data/buffer":8,"../data/extent":11,"../data/pos_array":14,"../lib/debugtext":23,"../util/browser":108,"./vertex_array_object":39,"@mapbox/gl-matrix":131}],29:[function(a,b,c){"use strict";function d(a,b,c,d){var h=a.gl;h.enable(h.STENCIL_TEST);var i=!c.paint["fill-pattern"]&&c.isPaintValueFeatureConstant("fill-color")&&c.isPaintValueFeatureConstant("fill-opacity")&&1===c.paint["fill-color"][3]&&1===c.paint["fill-opacity"];a.isOpaquePass===i&&(a.setDepthSublayer(1),e(a,b,c,d,f)),!a.isOpaquePass&&c.paint["fill-antialias"]&&(a.lineWidth(2),a.depthMask(!1),a.setDepthSublayer(c.getPaintProperty("fill-outline-color")?2:0),e(a,b,c,d,g))}function e(a,b,c,d,e){for(var f=!0,g=0,h=d;g<h.length;g+=1){var i=h[g],j=b.getTile(i),k=j.getBucket(c);k&&(a.enableTileClippingMask(i),e(a,b,c,j,i,k.buffers,f),f=!1)}}function f(a,b,c,d,e,f,g){for(var i=a.gl,j=f.layerData[c.id],k=h("fill",c.paint["fill-pattern"],a,j,c,d,e,g),l=0,m=f.segments;l<m.length;l+=1){var n=m[l];n.vaos[c.id].bind(i,k,f.layoutVertexBuffer,f.elementBuffer,j.paintVertexBuffer,n.vertexOffset),i.drawElements(i.TRIANGLES,3*n.primitiveLength,i.UNSIGNED_SHORT,3*n.primitiveOffset*2)}}function g(a,b,c,d,e,f,g){var i=a.gl,j=f.layerData[c.id],k=c.paint["fill-pattern"]&&!c.getPaintProperty("fill-outline-color"),l=h("fillOutline",k,a,j,c,d,e,g);i.uniform2f(l.u_world,i.drawingBufferWidth,i.drawingBufferHeight);for(var m=0,n=f.segments2;m<n.length;m+=1){var o=n[m];o.vaos[c.id].bind(i,l,f.layoutVertexBuffer,f.elementBuffer2,j.paintVertexBuffer,o.vertexOffset),i.drawElements(i.LINES,2*o.primitiveLength,i.UNSIGNED_SHORT,2*o.primitiveOffset*2)}}function h(a,b,c,d,e,f,g,h){var j,k=c.currentProgram;return b?(j=c.useProgram(a+"Pattern",d.programConfiguration),(h||j!==k)&&(d.programConfiguration.setUniforms(c.gl,j,e,{zoom:c.transform.zoom}),i.prepare(e.paint["fill-pattern"],c,j)),i.setTile(f,c,j)):(j=c.useProgram(a,d.programConfiguration),(h||j!==k)&&d.programConfiguration.setUniforms(c.gl,j,e,{zoom:c.transform.zoom})),c.gl.uniformMatrix4fv(j.u_matrix,!1,c.translatePosMatrix(g.posMatrix,f,e.paint["fill-translate"],e.paint["fill-translate-anchor"])),j}var i=a("./pattern");b.exports=d},{"./pattern":37}],30:[function(a,b,c){"use strict";function d(a,b,c,d){if(0!==c.paint["fill-extrusion-opacity"]){var g=a.gl;g.disable(g.STENCIL_TEST),
g.enable(g.DEPTH_TEST),a.depthMask(!0);var h=new e(g,a,c);h.bindFramebuffer(),g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);for(var i=0;i<d.length;i++)f(a,b,c,d[i]);h.unbindFramebuffer(),h.renderToMap()}}function e(a,b,c){this.gl=a,this.width=b.width,this.height=b.height,this.painter=b,this.layer=c,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}function f(a,b,c,d){if(!a.isOpaquePass){var e=b.getTile(d),f=e.getBucket(c);if(f){var h=f.buffers,i=a.gl,j=c.paint["fill-extrusion-pattern"],k=h.layerData[c.id],m=k.programConfiguration,n=a.useProgram(j?"fillExtrusionPattern":"fillExtrusion",m);m.setUniforms(i,n,c,{zoom:a.transform.zoom}),j&&(l.prepare(j,a,n),l.setTile(e,a,n),i.uniform1f(n.u_height_factor,-Math.pow(2,d.z)/e.tileSize/8)),a.gl.uniformMatrix4fv(n.u_matrix,!1,a.translatePosMatrix(d.posMatrix,e,c.paint["fill-extrusion-translate"],c.paint["fill-extrusion-translate-anchor"])),g(n,a);for(var o=0,p=h.segments;o<p.length;o+=1){var q=p[o];q.vaos[c.id].bind(i,n,h.layoutVertexBuffer,h.elementBuffer,k.paintVertexBuffer,q.vertexOffset),i.drawElements(i.TRIANGLES,3*q.primitiveLength,i.UNSIGNED_SHORT,3*q.primitiveOffset*2)}}}}function g(a,b){var c=b.gl,d=b.style.light,e=d.calculated.position,f=[e.x,e.y,e.z],g=m.create();"viewport"===d.calculated.anchor&&m.fromRotation(g,-b.transform.angle),o.transformMat3(f,f,g),c.uniform3fv(a.u_lightpos,f),c.uniform1f(a.u_lightintensity,d.calculated.intensity),c.uniform3fv(a.u_lightcolor,d.calculated.color.slice(0,3))}var h=a("@mapbox/gl-matrix"),i=a("../data/buffer"),j=a("./vertex_array_object"),k=a("../data/pos_array"),l=a("./pattern"),m=h.mat3,n=h.mat4,o=h.vec3;b.exports=d,e.prototype.bindFramebuffer=function(){var a=this.gl;if(this.texture=this.painter.getViewportTexture(this.width,this.height),a.activeTexture(a.TEXTURE1),this.texture?a.bindTexture(a.TEXTURE_2D,this.texture):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,null),this.texture.width=this.width,this.texture.height=this.height),this.fbos)this.fbo=this.fbos.pop(),a.bindFramebuffer(a.FRAMEBUFFER,this.fbo),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);else{this.fbo=a.createFramebuffer();var b=a.createRenderbuffer(),c=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,b),a.bindRenderbuffer(a.RENDERBUFFER,c),a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,this.width,this.height),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,this.fbo),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,b),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,c),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0)}},e.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer(),this.fbos?this.fbos.push(this.fbo):(this.painter.preFbos[this.width]||(this.painter.preFbos[this.width]={}),this.painter.preFbos[this.width][this.height]=[this.fbo]),this.painter.saveViewportTexture(this.texture)},e.prototype.renderToMap=function(){var a=this.gl,b=this.painter,c=b.useProgram("extrusionTexture");a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.texture),a.uniform1f(c.u_opacity,this.layer.paint["fill-extrusion-opacity"]),a.uniform1i(c.u_texture,1),a.uniformMatrix4fv(c.u_matrix,!1,n.ortho(n.create(),0,b.width,b.height,0,0,1)),a.disable(a.DEPTH_TEST),a.uniform1i(c.u_xdim,b.width),a.uniform1i(c.u_ydim,b.height);var d=new k;d.emplaceBack(0,0),d.emplaceBack(b.width,0),d.emplaceBack(0,b.height),d.emplaceBack(b.width,b.height);var e=i.fromStructArray(d,i.BufferType.VERTEX),f=new j;f.bind(a,c,e),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.enable(a.DEPTH_TEST)}},{"../data/buffer":8,"../data/pos_array":14,"./pattern":37,"./vertex_array_object":39,"@mapbox/gl-matrix":131}],31:[function(a,b,c){"use strict";function d(a,b,c,d,g,h,i,j,k){var l,m,n,o,p=b.gl,q=g.paint["line-dasharray"],r=g.paint["line-pattern"];if(j||k){var s=1/f(c,1,b.transform.tileZoom);if(q){l=b.lineAtlas.getDash(q.from,"round"===g.layout["line-cap"]),m=b.lineAtlas.getDash(q.to,"round"===g.layout["line-cap"]);var t=l.width*q.fromScale,u=m.width*q.toScale;p.uniform2f(a.u_patternscale_a,s/t,-l.height/2),p.uniform2f(a.u_patternscale_b,s/u,-m.height/2),p.uniform1f(a.u_sdfgamma,b.lineAtlas.width/(256*Math.min(t,u)*e.devicePixelRatio)/2)}else if(r){if(n=b.spriteAtlas.getPosition(r.from,!0),o=b.spriteAtlas.getPosition(r.to,!0),!n||!o)return;p.uniform2f(a.u_pattern_size_a,n.size[0]*r.fromScale/s,o.size[1]),p.uniform2f(a.u_pattern_size_b,o.size[0]*r.toScale/s,o.size[1])}p.uniform2f(a.u_gl_units_to_pixels,1/b.transform.pixelsToGLUnits[0],1/b.transform.pixelsToGLUnits[1])}j&&(q?(p.uniform1i(a.u_image,0),p.activeTexture(p.TEXTURE0),b.lineAtlas.bind(p),p.uniform1f(a.u_tex_y_a,l.y),p.uniform1f(a.u_tex_y_b,m.y),p.uniform1f(a.u_mix,q.t)):r&&(p.uniform1i(a.u_image,0),p.activeTexture(p.TEXTURE0),b.spriteAtlas.bind(p,!0),p.uniform2fv(a.u_pattern_tl_a,n.tl),p.uniform2fv(a.u_pattern_br_a,n.br),p.uniform2fv(a.u_pattern_tl_b,o.tl),p.uniform2fv(a.u_pattern_br_b,o.br),p.uniform1f(a.u_fade,r.t)),p.uniform1f(a.u_width,g.paint["line-width"])),b.enableTileClippingMask(h);var v=b.translatePosMatrix(h.posMatrix,c,g.paint["line-translate"],g.paint["line-translate-anchor"]);p.uniformMatrix4fv(a.u_matrix,!1,v),p.uniform1f(a.u_ratio,1/f(c,1,b.transform.zoom));for(var w=0,x=d.segments;w<x.length;w+=1){var y=x[w];y.vaos[g.id].bind(p,a,d.layoutVertexBuffer,d.elementBuffer,i.paintVertexBuffer,y.vertexOffset),p.drawElements(p.TRIANGLES,3*y.primitiveLength,p.UNSIGNED_SHORT,3*y.primitiveOffset*2)}}var e=a("../util/browser"),f=a("../source/pixels_to_tile_units");b.exports=function(a,b,c,e){if(!a.isOpaquePass){a.setDepthSublayer(0),a.depthMask(!1);var f=a.gl;if(f.enable(f.STENCIL_TEST),!(c.paint["line-width"]<=0))for(var g,h=c.paint["line-dasharray"]?"lineSDF":c.paint["line-pattern"]?"linePattern":"line",i=!0,j=0,k=e;j<k.length;j+=1){var l=k[j],m=b.getTile(l),n=m.getBucket(c);if(n){var o=n.buffers.layerData[c.id],p=a.currentProgram,q=a.useProgram(h,o.programConfiguration),r=i||q!==p,s=g!==m.coord.z;r&&o.programConfiguration.setUniforms(a.gl,q,c,{zoom:a.transform.zoom}),d(q,a,m,n.buffers,c,l,o,r,s),g=m.coord.z,i=!1}}}}},{"../source/pixels_to_tile_units":45,"../util/browser":108}],32:[function(a,b,c){"use strict";function d(a,b,c,d){if(!a.isOpaquePass){var f=a.gl;f.enable(f.DEPTH_TEST),a.depthMask(!0),f.depthFunc(f.LESS);for(var g=d.length&&d[0].z,h=0;h<d.length;h++){var i=d[h];a.setDepthSublayer(i.z-g),e(a,b,c,i)}f.depthFunc(f.LEQUAL)}}function e(a,b,c,d){var e=a.gl;e.disable(e.STENCIL_TEST);var j=b.getTile(d),k=a.transform.calculatePosMatrix(d,b.getSource().maxzoom);j.registerFadeDuration(a.style.animationLoop,c.paint["raster-fade-duration"]);var l=a.useProgram("raster");e.uniformMatrix4fv(l.u_matrix,!1,k),e.uniform1f(l.u_brightness_low,c.paint["raster-brightness-min"]),e.uniform1f(l.u_brightness_high,c.paint["raster-brightness-max"]),e.uniform1f(l.u_saturation_factor,h(c.paint["raster-saturation"])),e.uniform1f(l.u_contrast_factor,g(c.paint["raster-contrast"])),e.uniform3fv(l.u_spin_weights,f(c.paint["raster-hue-rotate"]));var m,n,o=j.sourceCache&&j.sourceCache.findLoadedParent(d,0,{}),p=i(j,o,c,a.transform);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,j.texture),e.activeTexture(e.TEXTURE1),o?(e.bindTexture(e.TEXTURE_2D,o.texture),m=Math.pow(2,o.coord.z-j.coord.z),n=[j.coord.x*m%1,j.coord.y*m%1]):e.bindTexture(e.TEXTURE_2D,j.texture),e.uniform2fv(l.u_tl_parent,n||[0,0]),e.uniform1f(l.u_scale_parent,m||1),e.uniform1f(l.u_buffer_scale,1),e.uniform1f(l.u_fade_t,p.mix),e.uniform1f(l.u_opacity,p.opacity*c.paint["raster-opacity"]),e.uniform1i(l.u_image0,0),e.uniform1i(l.u_image1,1);var q=j.boundsBuffer||a.rasterBoundsBuffer,r=j.boundsVAO||a.rasterBoundsVAO;r.bind(e,l,q),e.drawArrays(e.TRIANGLE_STRIP,0,q.length)}function f(a){a*=Math.PI/180;var b=Math.sin(a),c=Math.cos(a);return[(2*c+1)/3,(-Math.sqrt(3)*b-c+1)/3,(Math.sqrt(3)*b-c+1)/3]}function g(a){return a>0?1/(1-a):1+a}function h(a){return a>0?1-1/(1.001-a):-a}function i(a,b,c,d){var e=c.paint["raster-fade-duration"];if(a.sourceCache&&e>0){var f=Date.now(),g=(f-a.timeAdded)/e,h=b?(f-b.timeAdded)/e:-1,i=a.sourceCache.getSource(),k=d.coveringZoomLevel({tileSize:i.tileSize,roundZoom:i.roundZoom}),l=!b||Math.abs(b.coord.z-k)>Math.abs(a.coord.z-k),m=j.clamp(l?g:1-h,0,1);return b?{opacity:1,mix:1-m}:{opacity:m,mix:0}}return{opacity:1,mix:0}}var j=a("../util/util");b.exports=d},{"../util/util":127}],33:[function(a,b,c){"use strict";function d(a,b,c,d){if(!a.isOpaquePass){var f=!(c.layout["text-allow-overlap"]||c.layout["icon-allow-overlap"]||c.layout["text-ignore-placement"]||c.layout["icon-ignore-placement"]),g=a.gl;f?g.disable(g.STENCIL_TEST):g.enable(g.STENCIL_TEST),a.setDepthSublayer(0),a.depthMask(!1),e(a,b,c,d,!1,c.paint["icon-translate"],c.paint["icon-translate-anchor"],c.layout["icon-rotation-alignment"],c.layout["icon-rotation-alignment"],c.layout["icon-size"],c.paint["icon-halo-width"],c.paint["icon-halo-color"],c.paint["icon-halo-blur"],c.paint["icon-opacity"],c.paint["icon-color"]),e(a,b,c,d,!0,c.paint["text-translate"],c.paint["text-translate-anchor"],c.layout["text-rotation-alignment"],c.layout["text-pitch-alignment"],c.layout["text-size"],c.paint["text-halo-width"],c.paint["text-halo-color"],c.paint["text-halo-blur"],c.paint["text-opacity"],c.paint["text-color"]),b.map.showCollisionBoxes&&j(a,b,c,d)}}function e(a,b,c,d,e,h,i,j,k,l,m,n,o,p,q){if(e||!a.style.sprite||a.style.sprite.loaded()){var r=a.gl,s="map"===j,t="map"===k,u=t;u?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST);for(var v,w=0,x=d;w<x.length;w+=1){var y=x[w],z=b.getTile(y),A=z.getBucket(c);if(A){var B=e?A.buffers.glyph:A.buffers.icon;if(B&&B.segments.length){var C=e||A.sdfIcons;v||(v=a.useProgram(C?"symbolSDF":"symbolIcon"),f(v,a,e,C,s,t,A.fontstack,l,A.iconsNeedLinear,e?A.adjustedTextSize:A.adjustedIconSize,p)),a.enableTileClippingMask(y),r.uniformMatrix4fv(v.u_matrix,!1,a.translatePosMatrix(y.posMatrix,z,h,i)),g(v,a,c,z,B,e,C,t,l,m,n,o,q)}}}u||r.enable(r.DEPTH_TEST)}}function f(a,b,c,d,e,f,g,h,j,k,l){var m=b.gl,n=b.transform;if(m.uniform1i(a.u_rotate_with_map,e),m.uniform1i(a.u_pitch_with_map,f),m.activeTexture(m.TEXTURE0),m.uniform1i(a.u_texture,0),c){var o=g&&b.glyphSource.getGlyphAtlas(g);if(!o)return;o.updateTexture(m),m.uniform2f(a.u_texsize,o.width/4,o.height/4)}else{var p=b.options.rotating||b.options.zooming,q=1!==h||i.devicePixelRatio!==b.spriteAtlas.pixelRatio||j,r=f||n.pitch;b.spriteAtlas.bind(m,d||p||q||r),m.uniform2f(a.u_texsize,b.spriteAtlas.width/4,b.spriteAtlas.height/4)}m.activeTexture(m.TEXTURE1),b.frameHistory.bind(m),m.uniform1i(a.u_fadetexture,1);var s=Math.log(h/k)/Math.LN2||0;m.uniform1f(a.u_zoom,10*(n.zoom-s)),m.uniform1f(a.u_pitch,n.pitch/360*2*Math.PI),m.uniform1f(a.u_bearing,n.bearing/360*2*Math.PI),m.uniform1f(a.u_aspect_ratio,n.width/n.height),m.uniform1f(a.u_opacity,l)}function g(a,b,c,d,e,f,g,i,j,p,q,r,s){var t=b.gl,u=b.transform,v=j/(f?24:1);if(i){var w=k(d,v,u.zoom);t.uniform2f(a.u_extrude_scale,w,w)}else{var x=u.cameraToCenterDistance*v;t.uniform2f(a.u_extrude_scale,u.pixelsToGLUnits[0]*x,u.pixelsToGLUnits[1]*x)}if(g){var y=v*(i?Math.cos(u._pitch):1)*u.cameraToCenterDistance;p&&(t.uniform1f(a.u_gamma,(r*m/l+o)/y),t.uniform4fv(a.u_color,q),t.uniform1f(a.u_buffer,(n-p/v)/l),h(e,c,t,a)),t.uniform1f(a.u_gamma,o/y),t.uniform4fv(a.u_color,s),t.uniform1f(a.u_buffer,.75)}h(e,c,t,a)}function h(a,b,c,d){for(var e=0,f=a.segments;e<f.length;e+=1){var g=f[e];g.vaos[b.id].bind(c,d,a.layoutVertexBuffer,a.elementBuffer,null,g.vertexOffset),c.drawElements(c.TRIANGLES,3*g.primitiveLength,c.UNSIGNED_SHORT,3*g.primitiveOffset*2)}}var i=a("../util/browser"),j=a("./draw_collision_debug"),k=a("../source/pixels_to_tile_units");b.exports=d;var l=8,m=1.19,n=6,o=.105/i.devicePixelRatio},{"../source/pixels_to_tile_units":45,"../util/browser":108,"./draw_collision_debug":27}],34:[function(a,b,c){"use strict";var d=function(){this.changeTimes=new Float64Array(256),this.changeOpacities=new Uint8Array(256),this.opacities=new Uint8ClampedArray(256),this.array=new Uint8Array(this.opacities.buffer),this.previousZoom=0,this.firstFrame=!0};d.prototype.record=function(a,b,c){var d=this;this.firstFrame&&(a=0,this.firstFrame=!1),b=Math.floor(10*b);var e;if(b<this.previousZoom)for(e=b+1;e<=this.previousZoom;e++)d.changeTimes[e]=a,d.changeOpacities[e]=d.opacities[e];else for(e=b;e>this.previousZoom;e--)d.changeTimes[e]=a,d.changeOpacities[e]=d.opacities[e];for(e=0;256>e;e++){var f=a-d.changeTimes[e],g=255*(c?f/c:1);b>=e?d.opacities[e]=d.changeOpacities[e]+g:d.opacities[e]=d.changeOpacities[e]-g}this.changed=!0,this.previousZoom=b},d.prototype.bind=function(a){this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.changed&&(a.texSubImage2D(a.TEXTURE_2D,0,0,0,256,1,a.ALPHA,a.UNSIGNED_BYTE,this.array),this.changed=!1)):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,256,1,0,a.ALPHA,a.UNSIGNED_BYTE,this.array))},b.exports=d},{}],35:[function(a,b,c){"use strict";var d=a("../util/util"),e=function(a,b){this.width=a,this.height=b,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};e.prototype.setSprite=function(a){this.sprite=a},e.prototype.getDash=function(a,b){var c=a.join(",")+b;return this.positions[c]||(this.positions[c]=this.addDash(a,b)),this.positions[c]},e.prototype.addDash=function(a,b){var c=this,e=b?7:0,f=2*e+1,g=128;if(this.nextRow+f>this.height)return d.warnOnce("LineAtlas out of space"),null;for(var h=0,i=0;i<a.length;i++)h+=a[i];for(var j=this.width/h,k=j/2,l=a.length%2===1,m=-e;e>=m;m++)for(var n=c.nextRow+e+m,o=c.width*n,p=l?-a[a.length-1]:0,q=a[0],r=1,s=0;s<this.width;s++){for(;s/j>q;)p=q,q+=a[r],l&&r===a.length-1&&(q+=a[0]),r++;var t,u=Math.abs(s-p*j),v=Math.abs(s-q*j),w=Math.min(u,v),x=r%2===1;if(b){var y=e?m/e*(k+1):0;if(x){var z=k-Math.abs(y);t=Math.sqrt(w*w+z*z)}else t=k-Math.sqrt(w*w+y*y)}else t=(x?1:-1)*w;c.data[3+4*(o+s)]=Math.max(0,Math.min(255,t+g))}var A={y:(this.nextRow+e+.5)/this.height,height:2*e/this.height,width:h};return this.nextRow+=f,this.dirty=!0,A},e.prototype.bind=function(a){this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.RGBA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,this.data))},b.exports=e},{"../util/util":127}],36:[function(a,b,c){"use strict";var d=a("../util/browser"),e=a("@mapbox/gl-matrix").mat4,f=a("./frame_history"),g=a("../source/source_cache"),h=a("../data/extent"),i=a("../source/pixels_to_tile_units"),j=a("../util/util"),k=a("../data/buffer"),l=a("./vertex_array_object"),m=a("../data/raster_bounds_array"),n=a("../data/pos_array"),o=a("../data/program_configuration"),p=a("./shaders"),q={symbol:a("./draw_symbol"),circle:a("./draw_circle"),line:a("./draw_line"),fill:a("./draw_fill"),"fill-extrusion":a("./draw_fill_extrusion"),raster:a("./draw_raster"),background:a("./draw_background"),debug:a("./draw_debug")},r=function(a,b){this.gl=a,this.transform=b,this.reusableTextures={},this.preFbos={},this.frameHistory=new f,this.setup(),this.numSublayers=g.maxUnderzooming+g.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.lineWidthRange=a.getParameter(a.ALIASED_LINE_WIDTH_RANGE),this.basicFillProgramConfiguration=o.createStatic(["color","opacity"]),this.emptyProgramConfiguration=new o};r.prototype.resize=function(a,b){var c=this.gl;this.width=a*d.devicePixelRatio,this.height=b*d.devicePixelRatio,c.viewport(0,0,this.width,this.height)},r.prototype.setup=function(){var a=this.gl;a.verbose=!0,a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.enable(a.STENCIL_TEST),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),this._depthMask=!1,a.depthMask(!1);var b=new n;b.emplaceBack(0,0),b.emplaceBack(h,0),b.emplaceBack(0,h),b.emplaceBack(h,h),this.tileExtentBuffer=k.fromStructArray(b,k.BufferType.VERTEX),this.tileExtentVAO=new l,this.tileExtentPatternVAO=new l;var c=new n;c.emplaceBack(0,0),c.emplaceBack(h,0),c.emplaceBack(h,h),c.emplaceBack(0,h),c.emplaceBack(0,0),this.debugBuffer=k.fromStructArray(c,k.BufferType.VERTEX),this.debugVAO=new l;var d=new m;d.emplaceBack(0,0,0,0),d.emplaceBack(h,0,32767,0),d.emplaceBack(0,h,0,32767),d.emplaceBack(h,h,32767,32767),this.rasterBoundsBuffer=k.fromStructArray(d,k.BufferType.VERTEX),this.rasterBoundsVAO=new l},r.prototype.clearColor=function(){var a=this.gl;a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT)},r.prototype.clearStencil=function(){var a=this.gl;a.clearStencil(0),a.stencilMask(255),a.clear(a.STENCIL_BUFFER_BIT)},r.prototype.clearDepth=function(){var a=this.gl;a.clearDepth(1),this.depthMask(!0),a.clear(a.DEPTH_BUFFER_BIT)},r.prototype._renderTileClippingMasks=function(a){var b=this,c=this.gl;c.colorMask(!1,!1,!1,!1),this.depthMask(!1),c.disable(c.DEPTH_TEST),c.enable(c.STENCIL_TEST),c.stencilMask(248),c.stencilOp(c.KEEP,c.KEEP,c.REPLACE);var d=1;this._tileClippingMaskIDs={};for(var e=0,f=a;e<f.length;e+=1){var g=f[e],h=b._tileClippingMaskIDs[g.id]=d++<<3;c.stencilFunc(c.ALWAYS,h,248);var i=b.useProgram("fill",b.basicFillProgramConfiguration);c.uniformMatrix4fv(i.u_matrix,!1,g.posMatrix),b.tileExtentVAO.bind(c,i,b.tileExtentBuffer),c.drawArrays(c.TRIANGLE_STRIP,0,b.tileExtentBuffer.length)}c.stencilMask(0),c.colorMask(!0,!0,!0,!0),this.depthMask(!0),c.enable(c.DEPTH_TEST)},r.prototype.enableTileClippingMask=function(a){var b=this.gl;b.stencilFunc(b.EQUAL,this._tileClippingMaskIDs[a.id],248)},r.prototype.prepareBuffers=function(){},r.prototype.bindDefaultFramebuffer=function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)},r.prototype.render=function(a,b){if(this.style=a,this.options=b,this.lineAtlas=a.lineAtlas,this.spriteAtlas=a.spriteAtlas,this.spriteAtlas.setSprite(a.sprite),this.glyphSource=a.glyphSource,this.frameHistory.record(Date.now(),this.transform.zoom,a.getTransition().duration),this.prepareBuffers(),this.clearColor(),this.clearDepth(),this.showOverdrawInspector(b.showOverdrawInspector),this.depthRange=(a._order.length+2)*this.numSublayers*this.depthEpsilon,this.isOpaquePass=!0,this.renderPass(),this.isOpaquePass=!1,this.renderPass(),this.options.showTileBoundaries){var c=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];c&&q.debug(this,c,c.getVisibleCoordinates())}},r.prototype.renderPass=function(){var a,b,c=this,d=this.style._order;this.currentLayer=this.isOpaquePass?d.length-1:0,this.isOpaquePass?this._showOverdrawInspector||this.gl.disable(this.gl.BLEND):this.gl.enable(this.gl.BLEND);for(var e=0;e<d.length;e++){var f=c.style._layers[d[c.currentLayer]];f.source!==(a&&a.id)&&(a=c.style.sourceCaches[f.source],b=[],a&&(a.prepare&&a.prepare(),c.clearStencil(),b=a.getVisibleCoordinates(),a.getSource().isTileClipped&&c._renderTileClippingMasks(b)),c.isOpaquePass||b.reverse()),c.renderLayer(c,a,f,b),c.currentLayer+=c.isOpaquePass?-1:1}},r.prototype.depthMask=function(a){a!==this._depthMask&&(this._depthMask=a,this.gl.depthMask(a))},r.prototype.renderLayer=function(a,b,c,d){c.isHidden(this.transform.zoom)||("background"===c.type||d.length)&&(this.id=c.id,q[c.type](a,b,c,d))},r.prototype.setDepthSublayer=function(a){var b=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon,c=b-1+this.depthRange;this.gl.depthRange(c,b)},r.prototype.translatePosMatrix=function(a,b,c,d){if(!c[0]&&!c[1])return a;if("viewport"===d){var f=Math.sin(-this.transform.angle),g=Math.cos(-this.transform.angle);c=[c[0]*g-c[1]*f,c[0]*f+c[1]*g]}var h=[i(b,c[0],this.transform.zoom),i(b,c[1],this.transform.zoom),0],j=new Float32Array(16);return e.translate(j,a,h),j},r.prototype.saveTileTexture=function(a){var b=this.reusableTextures[a.size];b?b.push(a):this.reusableTextures[a.size]=[a]},r.prototype.saveViewportTexture=function(a){this.reusableTextures.viewport||(this.reusableTextures.viewport={}),this.reusableTextures.viewport.texture=a},r.prototype.getTileTexture=function(a,b){var c=this.reusableTextures[a];if(c){var d=c[b||a];return d&&d.length>0?d.pop():null}},r.prototype.getViewportTexture=function(a,b){if(this.reusableTextures.viewport){var c=this.reusableTextures.viewport.texture;return c.width===a&&c.height===b?c:(this.gl.deleteTexture(c),void(this.reusableTextures.viewport.texture=null))}},r.prototype.lineWidth=function(a){this.gl.lineWidth(j.clamp(a,this.lineWidthRange[0],this.lineWidthRange[1]))},r.prototype.showOverdrawInspector=function(a){if(a||this._showOverdrawInspector){this._showOverdrawInspector=a;var b=this.gl;if(a){b.blendFunc(b.CONSTANT_COLOR,b.ONE);var c=8,d=1/c;b.blendColor(d,d,d,0),b.clearColor(0,0,0,1),b.clear(b.COLOR_BUFFER_BIT)}else b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA)}},r.prototype.createProgram=function(a,b){var c=this.gl,e=c.createProgram(),f=p[a],g="#define MAPBOX_GL_JS\n#define DEVICE_PIXEL_RATIO "+d.devicePixelRatio.toFixed(1)+"\n";this._showOverdrawInspector&&(g+="#define OVERDRAW_INSPECTOR;\n");var h=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(h,b.applyPragmas(g+p.prelude.fragmentSource+f.fragmentSource,"fragment")),c.compileShader(h),c.attachShader(e,h);var i=c.createShader(c.VERTEX_SHADER);c.shaderSource(i,b.applyPragmas(g+p.prelude.vertexSource+f.vertexSource,"vertex")),c.compileShader(i),c.attachShader(e,i),c.linkProgram(e);for(var j=c.getProgramParameter(e,c.ACTIVE_ATTRIBUTES),k={program:e,numAttributes:j},l=0;j>l;l++){var m=c.getActiveAttrib(e,l);k[m.name]=c.getAttribLocation(e,m.name)}for(var n=c.getProgramParameter(e,c.ACTIVE_UNIFORMS),o=0;n>o;o++){var q=c.getActiveUniform(e,o);k[q.name]=c.getUniformLocation(e,q.name)}return k},r.prototype._createProgramCached=function(a,b){this.cache=this.cache||{};var c=""+a+(b.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=this.createProgram(a,b)),this.cache[c]},r.prototype.useProgram=function(a,b){var c=this.gl,d=this._createProgramCached(a,b||this.emptyProgramConfiguration);return this.currentProgram!==d&&(c.useProgram(d.program),this.currentProgram=d),d},b.exports=r},{"../data/buffer":8,"../data/extent":11,"../data/pos_array":14,"../data/program_configuration":15,"../data/raster_bounds_array":16,"../source/pixels_to_tile_units":45,"../source/source_cache":49,"../util/browser":108,"../util/util":127,"./draw_background":25,"./draw_circle":26,"./draw_debug":28,"./draw_fill":29,"./draw_fill_extrusion":30,"./draw_line":31,"./draw_raster":32,"./draw_symbol":33,"./frame_history":34,"./shaders":38,"./vertex_array_object":39,"@mapbox/gl-matrix":131}],37:[function(a,b,c){"use strict";var d=a("../source/pixels_to_tile_units");c.prepare=function(a,b,c){var d=b.gl,e=b.spriteAtlas.getPosition(a.from,!0),f=b.spriteAtlas.getPosition(a.to,!0);e&&f&&(d.uniform1i(c.u_image,0),d.uniform2fv(c.u_pattern_tl_a,e.tl),d.uniform2fv(c.u_pattern_br_a,e.br),d.uniform2fv(c.u_pattern_tl_b,f.tl),d.uniform2fv(c.u_pattern_br_b,f.br),d.uniform1f(c.u_mix,a.t),d.uniform2fv(c.u_pattern_size_a,e.size),d.uniform2fv(c.u_pattern_size_b,f.size),d.uniform1f(c.u_scale_a,a.fromScale),d.uniform1f(c.u_scale_b,a.toScale),d.activeTexture(d.TEXTURE0),b.spriteAtlas.bind(d,!0))},c.setTile=function(a,b,c){var e=b.gl;e.uniform1f(c.u_tile_units_to_pixels,1/d(a,1,b.transform.tileZoom));var f=Math.pow(2,a.coord.z),g=a.tileSize*Math.pow(2,b.transform.tileZoom)/f,h=g*(a.coord.x+a.coord.w*f),i=g*a.coord.y;e.uniform2f(c.u_pixel_coord_upper,h>>16,i>>16),e.uniform2f(c.u_pixel_coord_lower,65535&h,65535&i)}},{"../source/pixels_to_tile_units":45}],38:[function(a,b,c){"use strict";a("path");b.exports={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nfloat evaluate_zoom_function_1(const vec4 values, const float t) {\n    if (t < 1.0) {\n        return mix(values[0], values[1], t);\n    } else if (t < 2.0) {\n        return mix(values[1], values[2], t - 1.0);\n    } else {\n        return mix(values[2], values[3], t - 2.0);\n    }\n}\nvec4 evaluate_zoom_function_4(const vec4 value0, const vec4 value1, const vec4 value2, const vec4 value3, const float t) {\n    if (t < 1.0) {\n        return mix(value0, value1, t);\n    } else if (t < 2.0) {\n        return mix(value1, value2, t - 1.0);\n    } else {\n        return mix(value2, value3, t - 2.0);\n    }\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},circle:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    float extrude_length = length(v_extrude);\n    float antialiased_blur = -max(blur, v_antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform vec2 u_extrude_scale;\n\nattribute vec2 a_pos;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main(void) {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    v_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    vec2 extrude = v_extrude * (radius + stroke_width) * u_extrude_scale;\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    gl_Position = u_matrix * vec4(floor(a_pos * 0.5), 0, 1);\n\n    if (u_scale_with_map) {\n        gl_Position.xy += extrude;\n    } else {\n        gl_Position.xy += extrude * gl_Position.w;\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    v_antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n}\n"},collisionBox:{fragmentSource:"uniform float u_zoom;\nuniform float u_maxzoom;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0) * alpha;\n\n    if (v_placement_zoom > u_zoom) {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n    }\n\n    if (u_zoom >= v_max_zoom) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) * alpha * 0.25;\n    }\n\n    if (v_placement_zoom >= u_maxzoom) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0) * alpha * 0.2;\n    }\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_data;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos + a_extrude / u_scale, 0.0, 1.0);\n\n    v_max_zoom = a_data.x;\n    v_placement_zoom = a_data.y;\n}\n"},debug:{fragmentSource:"uniform lowp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, step(32767.0, a_pos.x), 1);\n}\n"},fill:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"
},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    gl_FragColor = v_color;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform lowp vec4 u_outline_color;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n#ifdef OUTLINE\n    color = u_outline_color;\n#endif\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_pos) * u_opacity;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform int u_xdim;\nuniform int u_ydim;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos.x = a_pos.x / float(u_xdim);\n    v_pos.y = 1.0 - a_pos.y / float(u_ydim);\n}\n"},line:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a, u_pattern_br_a, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b, u_pattern_br_b, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float gapwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma, 0.5 + u_sdfgamma, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\nuniform mediump float u_width;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n \n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos0 = (((a_texture_pos / 32767.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp float u_opacity;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * u_opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n    if (u_rotate_with_map) {\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    } else {\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},symbolSDF:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp vec4 u_color;\nuniform lowp float u_opacity;\nuniform lowp float u_buffer;\nuniform lowp float u_gamma;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    lowp float dist = texture2D(u_texture, v_tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, v_fade_tex).a;\n    lowp float gamma = u_gamma * v_gamma_scale;\n    lowp float alpha = smoothstep(u_buffer - gamma, u_buffer + gamma, dist) * fade_alpha;\n\n    gl_FragColor = u_color * (alpha * u_opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform bool u_pitch_with_map;\nuniform mediump float u_pitch;\nuniform mediump float u_bearing;\nuniform mediump float u_aspect_ratio;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    // pitch-alignment: map\n    // rotation-alignment: map | viewport\n    if (u_pitch_with_map) {\n        lowp float angle = u_rotate_with_map ? (a_data[1] / 256.0 * 2.0 * PI) : u_bearing;\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, asin, -1.0 * asin, acos);\n        vec2 offset = RotationMatrix * a_offset;\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: map\n    } else if (u_rotate_with_map) {\n        // foreshortening factor to apply on pitched maps\n        // as a label goes from horizontal <=> vertical in angle\n        // it goes from 0% foreshortening to up to around 70% foreshortening\n        lowp float pitchfactor = 1.0 - cos(u_pitch * sin(u_pitch * 0.75));\n\n        lowp float lineangle = a_data[1] / 256.0 * 2.0 * PI;\n\n        // use the lineangle to position points a,b along the line\n        // project the points and calculate the label angle in projected space\n        // this calculation allows labels to be rendered unskewed on pitched maps\n        vec4 a = u_matrix * vec4(a_pos, 0, 1);\n        vec4 b = u_matrix * vec4(a_pos + vec2(cos(lineangle),sin(lineangle)), 0, 1);\n        lowp float angle = atan((b[1]/b[3] - a[1]/a[3])/u_aspect_ratio, b[0]/b[3] - a[0]/a[3]);\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, -1.0 * asin, asin, acos);\n\n        vec2 offset = RotationMatrix * (vec2((1.0-pitchfactor)+(pitchfactor*cos(angle*2.0)), 1.0) * a_offset);\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: viewport\n    } else {\n        vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_gamma_scale = gl_Position.w;\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"}}},{path:191}],39:[function(a,b,c){
"use strict";var d=function(){this.boundProgram=null,this.boundVertexBuffer=null,this.boundVertexBuffer2=null,this.boundElementBuffer=null,this.boundVertexOffset=null,this.vao=null};d.prototype.bind=function(a,b,c,d,e,f){void 0===a.extVertexArrayObject&&(a.extVertexArrayObject=a.getExtension("OES_vertex_array_object"));var g=!this.vao||this.boundProgram!==b||this.boundVertexBuffer!==c||this.boundVertexBuffer2!==e||this.boundElementBuffer!==d||this.boundVertexOffset!==f;!a.extVertexArrayObject||g?(this.freshBind(a,b,c,d,e,f),this.gl=a):a.extVertexArrayObject.bindVertexArrayOES(this.vao)},d.prototype.freshBind=function(a,b,c,d,e,f){var g,h=b.numAttributes;if(a.extVertexArrayObject)this.vao&&this.destroy(),this.vao=a.extVertexArrayObject.createVertexArrayOES(),a.extVertexArrayObject.bindVertexArrayOES(this.vao),g=0,this.boundProgram=b,this.boundVertexBuffer=c,this.boundVertexBuffer2=e,this.boundElementBuffer=d,this.boundVertexOffset=f;else{g=a.currentNumAttributes||0;for(var i=h;g>i;i++)a.disableVertexAttribArray(i)}for(var j=g;h>j;j++)a.enableVertexAttribArray(j);c.bind(a),c.setVertexAttribPointers(a,b,f),e&&(e.bind(a),e.setVertexAttribPointers(a,b,f)),d&&d.bind(a),a.currentNumAttributes=h},d.prototype.destroy=function(){this.vao&&(this.gl.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)},b.exports=d},{}],40:[function(a,b,c){"use strict";function d(a){var b=g.document.createElement("a");return b.href=a,b.href}var e=a("../util/evented"),f=a("../util/util"),g=a("../util/window"),h=a("../data/extent"),i=function(a){function b(b,c,d,e){a.call(this),c=c||{},this.id=b,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this.dispatcher=d,this.setEventedParent(e),this._data=c.data,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type);var g=h/this.tileSize;this.workerOptions=f.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*g,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*g,extent:h,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:Math.min(c.clusterMaxZoom,this.maxzoom-1)||this.maxzoom-1,extent:h,radius:(c.clusterRadius||50)*g,log:!1}},c.workerOptions)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.load=function(){var a=this;this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(b){return b?void a.fire("error",{error:b}):(a.fire("data",{dataType:"source"}),void a.fire("source.load"))})},b.prototype.onAdd=function(a){this.load(),this.map=a},b.prototype.setData=function(a){var b=this;return this._data=a,this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(a){return a?b.fire("error",{error:a}):void b.fire("data",{dataType:"source"})}),this},b.prototype._updateWorkerData=function(a){var b=this,c=f.extend({},this.workerOptions),e=this._data;"string"==typeof e?c.url=d(e):c.data=JSON.stringify(e),this.workerID=this.dispatcher.send(this.type+".loadData",c,function(c){b._loaded=!0,a(c)})},b.prototype.loadTile=function(a,b){var c=this,d=a.coord.z>this.maxzoom?Math.pow(2,a.coord.z-this.maxzoom):1,e={type:this.type,uid:a.uid,coord:a.coord,zoom:a.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,overscaling:d,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};a.workerID=this.dispatcher.send("loadTile",e,function(d,e){return a.unloadVectorData(),a.aborted?void 0:d?b(d):(a.loadVectorData(e,c.map.painter),a.redoWhenDone&&(a.redoWhenDone=!1,a.redoPlacement(c)),b(null))},this.workerID)},b.prototype.abortTile=function(a){a.aborted=!0},b.prototype.unloadTile=function(a){a.unloadVectorData(),this.dispatcher.send("removeTile",{uid:a.uid,type:this.type,source:this.id},function(){},a.workerID)},b.prototype.onRemove=function(){this.dispatcher.broadcast("removeSource",{type:this.type,source:this.id},function(){})},b.prototype.serialize=function(){return{type:this.type,data:this._data}},b}(e);b.exports=i},{"../data/extent":11,"../util/evented":116,"../util/util":127,"../util/window":110}],41:[function(a,b,c){"use strict";var d=a("../util/ajax"),e=a("geojson-rewind"),f=a("./geojson_wrapper"),g=a("vt-pbf"),h=a("supercluster"),i=a("geojson-vt"),j=a("./vector_tile_worker_source"),k=function(a){function b(b,c,d){a.call(this,b,c),d&&(this.loadGeoJSON=d),this._geoJSONIndexes={}}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.loadVectorData=function(a,b){var c=a.source,d=a.coord;if(!this._geoJSONIndexes[c])return b(null,null);var e=this._geoJSONIndexes[c].getTile(Math.min(d.z,a.maxZoom),d.x,d.y);if(!e)return b(null,null);var h=new f(e.features);h.name="_geojsonTileLayer";var i=g({layers:{_geojsonTileLayer:h}});0===i.byteOffset&&i.byteLength===i.buffer.byteLength||(i=new Uint8Array(i)),h.rawData=i.buffer,b(null,h)},b.prototype.loadData=function(a,b){var c=function(c,d){var f=this;return c?b(c):"object"!=typeof d?b(new Error("Input data is not a valid GeoJSON object.")):(e(d,!0),void this._indexData(d,a,function(c,d){return c?b(c):(f._geoJSONIndexes[a.source]=d,void b(null))}))}.bind(this);this.loadGeoJSON(a,c)},b.prototype.loadGeoJSON=function(a,b){if(a.url)d.getJSON(a.url,b);else{if("string"!=typeof a.data)return b(new Error("Input data is not a valid GeoJSON object."));try{return b(null,JSON.parse(a.data))}catch(a){return b(new Error("Input data is not a valid GeoJSON object."))}}},b.prototype.removeSource=function(a){this._geoJSONIndexes[a.source]&&delete this._geoJSONIndexes[a.source]},b.prototype._indexData=function(a,b,c){try{b.cluster?c(null,h(b.superclusterOptions).load(a.features)):c(null,i(a,b.geojsonVtOptions))}catch(a){return c(a)}},b}(j);b.exports=k},{"../util/ajax":107,"./geojson_wrapper":42,"./vector_tile_worker_source":53,"geojson-rewind":137,"geojson-vt":141,supercluster:198,"vt-pbf":208}],42:[function(a,b,c){"use strict";var d=a("point-geometry"),e=a("vector-tile").VectorTileFeature,f=a("../data/extent"),g=function(a){var b=this;if(this.type=a.type,1===a.type){this.rawGeometry=[];for(var c=0;c<a.geometry.length;c++)b.rawGeometry.push([a.geometry[c]])}else this.rawGeometry=a.geometry;this.properties=a.tags,this.extent=f};g.prototype.loadGeometry=function(){var a=this,b=this.rawGeometry;this.geometry=[];for(var c=0;c<b.length;c++){for(var e=b[c],f=[],g=0;g<e.length;g++)f.push(new d(e[g][0],e[g][1]));a.geometry.push(f)}return this.geometry},g.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var a=this.geometry,b=1/0,c=-(1/0),d=1/0,e=-(1/0),f=0;f<a.length;f++)for(var g=a[f],h=0;h<g.length;h++){var i=g[h];b=Math.min(b,i.x),c=Math.max(c,i.x),d=Math.min(d,i.y),e=Math.max(e,i.y)}return[b,d,c,e]},g.prototype.toGeoJSON=function(){e.prototype.toGeoJSON.call(this)};var h=function(a){this.features=a,this.length=a.length,this.extent=f};h.prototype.feature=function(a){return new g(this.features[a])},b.exports=h},{"../data/extent":11,"point-geometry":194,"vector-tile":204}],43:[function(a,b,c){"use strict";var d=a("../util/util"),e=a("../util/window"),f=a("./tile_coord"),g=a("../geo/lng_lat"),h=a("point-geometry"),i=a("../util/evented"),j=a("../util/ajax"),k=a("../data/extent"),l=a("../data/raster_bounds_array"),m=a("../data/buffer"),n=a("../render/vertex_array_object"),o=function(a){function b(b,c,d,e){a.call(this),this.id=b,this.dispatcher=d,this.coordinates=c.coordinates,this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.setEventedParent(e),this.options=c}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.load=function(){var a=this;this.fire("dataloading",{dataType:"source"}),this.url=this.options.url,j.getImage(this.options.url,function(b,c){return b?a.fire("error",{error:b}):(a.image=c,void a._finishLoading())})},b.prototype._finishLoading=function(){this.fire("source.load"),this.map&&this.setCoordinates(this.coordinates)},b.prototype.onAdd=function(a){this.load(),this.map=a,this.image&&this.setCoordinates(this.coordinates)},b.prototype.setCoordinates=function(a){this.coordinates=a;var b=this.map,c=a.map(function(a){return b.transform.locationCoordinate(g.convert(a)).zoomTo(0)}),e=this.centerCoord=d.getCoordinatesCenter(c);return e.column=Math.round(e.column),e.row=Math.round(e.row),this.minzoom=this.maxzoom=e.zoom,this.coord=new f(e.zoom,e.column,e.row),this._tileCoords=c.map(function(a){var b=a.zoomTo(e.zoom);return new h(Math.round((b.column-e.column)*k),Math.round((b.row-e.row)*k))}),this.fire("data",{dataType:"source"}),this},b.prototype._setTile=function(a){this.tile=a;var b=32767,c=new l;c.emplaceBack(this._tileCoords[0].x,this._tileCoords[0].y,0,0),c.emplaceBack(this._tileCoords[1].x,this._tileCoords[1].y,b,0),c.emplaceBack(this._tileCoords[3].x,this._tileCoords[3].y,0,b),c.emplaceBack(this._tileCoords[2].x,this._tileCoords[2].y,b,b),this.tile.buckets={},this.tile.boundsBuffer=m.fromStructArray(c,m.BufferType.VERTEX),this.tile.boundsVAO=new n},b.prototype.prepare=function(){this.tile&&this.image&&this._prepareImage(this.map.painter.gl,this.image)},b.prototype._prepareImage=function(a,b){"loaded"!==this.tile.state?(this.tile.state="loaded",this.tile.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.tile.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b)):b instanceof e.HTMLVideoElement&&(a.bindTexture(a.TEXTURE_2D,this.tile.texture),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,b))},b.prototype.loadTile=function(a,b){this.coord&&this.coord.toString()===a.coord.toString()?(this._setTile(a),b(null)):(a.state="errored",b(null))},b.prototype.serialize=function(){return{type:"image",urls:this.url,coordinates:this.coordinates}},b}(i);b.exports=o},{"../data/buffer":8,"../data/extent":11,"../data/raster_bounds_array":16,"../geo/lng_lat":19,"../render/vertex_array_object":39,"../util/ajax":107,"../util/evented":116,"../util/util":127,"../util/window":110,"./tile_coord":51,"point-geometry":194}],44:[function(a,b,c){"use strict";var d=a("../util/util"),e=a("../util/ajax"),f=a("../util/browser"),g=a("../util/mapbox").normalizeSourceURL;b.exports=function(a,b){var c=function(a,c){if(a)return b(a);var e=d.pick(c,["tiles","minzoom","maxzoom","attribution"]);c.vector_layers&&(e.vectorLayers=c.vector_layers,e.vectorLayerIds=e.vectorLayers.map(function(a){return a.id})),b(null,e)};a.url?e.getJSON(g(a.url),c):f.frame(c.bind(null,null,a))}},{"../util/ajax":107,"../util/browser":108,"../util/mapbox":123,"../util/util":127}],45:[function(a,b,c){"use strict";var d=a("../data/extent");b.exports=function(a,b,c){return b*(d/(a.tileSize*Math.pow(2,c-a.coord.z)))}},{"../data/extent":11}],46:[function(a,b,c){"use strict";function d(a,b){var c=a.coord,d=b.coord;return c.z-d.z||c.y-d.y||c.w-d.w||c.x-d.x}function e(a){for(var b=a[0]||{},c=1;c<a.length;c++){var d=a[c];for(var e in d){var f=d[e],g=b[e];if(void 0===g)g=b[e]=f;else for(var h=0;h<f.length;h++)g.push(f[h])}}return b}var f=a("./tile_coord");c.rendered=function(a,b,c,f,g,h){var i=a.tilesIn(c);i.sort(d);for(var j=[],k=0;k<i.length;k++){var l=i[k];l.tile.featureIndex&&j.push(l.tile.featureIndex.query({queryGeometry:l.queryGeometry,scale:l.scale,tileSize:l.tile.tileSize,bearing:h,params:f},b))}return e(j)},c.source=function(a,b){for(var c=a.getRenderableIds().map(function(b){return a.getTileByID(b)}),d=[],e={},g=0;g<c.length;g++){var h=c[g],i=new f(Math.min(h.sourceMaxZoom,h.coord.z),h.coord.x,h.coord.y,0).id;e[i]||(e[i]=!0,h.querySourceFeatures(d,b))}return d}},{"./tile_coord":51}],47:[function(a,b,c){"use strict";var d=a("../util/util"),e=a("../util/ajax"),f=a("../util/evented"),g=a("./load_tilejson"),h=a("../util/mapbox").normalizeTileURL,i=function(a){function b(b,c,e,f){a.call(this),this.id=b,this.dispatcher=e,this.setEventedParent(f),this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this.options=c,d.extend(this,d.pick(c,["url","scheme","tileSize"]))}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.load=function(){var a=this;this.fire("dataloading",{dataType:"source"}),g(this.options,function(b,c){return b?a.fire("error",b):(d.extend(a,c),a.fire("data",{dataType:"source"}),void a.fire("source.load"))})},b.prototype.onAdd=function(a){this.load(),this.map=a},b.prototype.serialize=function(){return{type:"raster",url:this.url,tileSize:this.tileSize,tiles:this.tiles}},b.prototype.loadTile=function(a,b){function c(c,d){if(delete a.request,a.aborted)return this.state="unloaded",b(null);if(c)return this.state="errored",b(c);var e=this.map.painter.gl;a.texture=this.map.painter.getTileTexture(d.width),a.texture?(e.bindTexture(e.TEXTURE_2D,a.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,d)):(a.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,a.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,d),a.texture.size=d.width),e.generateMipmap(e.TEXTURE_2D),a.state="loaded",b(null)}var d=h(a.coord.url(this.tiles,null,this.scheme),this.url,this.tileSize);a.request=e.getImage(d,c.bind(this))},b.prototype.abortTile=function(a){a.request&&(a.request.abort(),delete a.request)},b.prototype.unloadTile=function(a){a.texture&&this.map.painter.saveTileTexture(a.texture)},b}(f);b.exports=i},{"../util/ajax":107,"../util/evented":116,"../util/mapbox":123,"../util/util":127,"./load_tilejson":44}],48:[function(a,b,c){"use strict";var d=a("../util/util"),e={vector:a("../source/vector_tile_source"),raster:a("../source/raster_tile_source"),geojson:a("../source/geojson_source"),video:a("../source/video_source"),image:a("../source/image_source")};c.create=function(a,b,c,f){if(b=new e[b.type](a,b,c,f),b.id!==a)throw new Error("Expected Source id to be "+a+" instead of "+b.id);return d.bindAll(["load","abort","unload","serialize","prepare"],b),b},c.getType=function(a){return e[a]},c.setType=function(a,b){e[a]=b}},{"../source/geojson_source":40,"../source/image_source":43,"../source/raster_tile_source":47,"../source/vector_tile_source":52,"../source/video_source":54,"../util/util":127}],49:[function(a,b,c){"use strict";function d(a,b,c){var d=c.zoomTo(Math.min(a.z,b));return{x:(d.column-(a.x+a.w*Math.pow(2,a.z)))*m,y:(d.row-a.y)*m}}function e(a,b){return a%32-b%32}var f=a("./source"),g=a("./tile"),h=a("../util/evented"),i=a("./tile_coord"),j=a("../util/lru_cache"),k=a("../geo/coordinate"),l=a("../util/util"),m=a("../data/extent"),n=function(a){function b(b,c,d){a.call(this),this.id=b,this.dispatcher=d,this.on("source.load",function(){this._sourceLoaded=!0}),this.on("error",function(){this._sourceErrored=!0}),this.on("data",function(a){this._sourceLoaded&&"source"===a.dataType&&(this.reload(),this.transform&&this.update(this.transform))}),this._source=f.create(b,c,d,this),this._tiles={},this._cache=new j(0,this.unloadTile.bind(this)),this._isIdRenderable=this._isIdRenderable.bind(this)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.onAdd=function(a){this.map=a,this._source&&this._source.onAdd&&this._source.onAdd(a)},b.prototype.onRemove=function(a){this._source&&this._source.onRemove&&this._source.onRemove(a)},b.prototype.loaded=function(){var a=this;if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var b in this._tiles){var c=a._tiles[b];if("loaded"!==c.state&&"errored"!==c.state)return!1}return!0},b.prototype.getSource=function(){return this._source},b.prototype.loadTile=function(a,b){return this._source.loadTile(a,b)},b.prototype.unloadTile=function(a){return this._source.unloadTile?this._source.unloadTile(a):void 0},b.prototype.abortTile=function(a){return this._source.abortTile?this._source.abortTile(a):void 0},b.prototype.serialize=function(){return this._source.serialize()},b.prototype.prepare=function(){return this._sourceLoaded&&this._source.prepare?this._source.prepare():void 0},b.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(e)},b.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},b.prototype._isIdRenderable=function(a){return this._tiles[a].hasData()&&!this._coveredTiles[a]},b.prototype.reload=function(){var a=this;this._cache.reset();for(var b in this._tiles){var c=a._tiles[b];"loading"!==c.state&&(c.state="reloading"),a.loadTile(a._tiles[b],a._tileLoaded.bind(a,a._tiles[b]))}},b.prototype._tileLoaded=function(a,b){return b?(a.state="errored",void this._source.fire("error",{tile:a,error:b})):(a.sourceCache=this,a.timeAdded=(new Date).getTime(),this._source.fire("data",{tile:a,coord:a.coord,dataType:"tile"}),void(this.map&&(this.map.painter.tileExtentVAO.vao=null)))},b.prototype.getTile=function(a){return this.getTileByID(a.id)},b.prototype.getTileByID=function(a){return this._tiles[a]},b.prototype.getZoom=function(a){return a.zoom+a.scaleZoom(a.tileSize/this._source.tileSize)},b.prototype.findLoadedChildren=function(a,b,c){var d=this,e=!1;for(var f in this._tiles){var g=d._tiles[f];if(!(c[f]||!g.hasData()||g.coord.z<=a.z||g.coord.z>b)){var h=Math.pow(2,Math.min(g.coord.z,d._source.maxzoom)-Math.min(a.z,d._source.maxzoom));if(Math.floor(g.coord.x/h)===a.x&&Math.floor(g.coord.y/h)===a.y)for(c[f]=!0,e=!0;g&&g.coord.z-1>a.z;){var i=g.coord.parent(d._source.maxzoom).id;g=d._tiles[i],g&&g.hasData()&&(delete c[f],c[i]=!0)}}}return e},b.prototype.findLoadedParent=function(a,b,c){for(var d=this,e=a.z-1;e>=b;e--){a=a.parent(d._source.maxzoom);var f=d._tiles[a.id];if(f&&f.hasData())return c[a.id]=!0,f;if(d._cache.has(a.id))return c[a.id]=!0,d._cache.get(a.id)}},b.prototype.updateCacheSize=function(a){var b=Math.ceil(a.width/a.tileSize)+1,c=Math.ceil(a.height/a.tileSize)+1,d=b*c,e=5;this._cache.setMaxSize(Math.floor(d*e))},b.prototype.update=function(a){var c=this;if(this._sourceLoaded){var d,e,f,g;this.updateCacheSize(a);var h=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(a)),j=Math.max(h-b.maxOverzooming,this._source.minzoom),k=Math.max(h+b.maxUnderzooming,this._source.minzoom),m={};this._coveredTiles={};var n;for(n=this.used?this._source.coord?[this._source.coord]:a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}):[],d=0;d<n.length;d++)e=n[d],f=c.addTile(e),m[e.id]=!0,f.hasData()||c.findLoadedChildren(e,k,m)||(g=c.findLoadedParent(e,j,m),g&&c.addTile(g.coord));for(var o={},p=Object.keys(m),q=0;q<p.length;q++){var r=p[q];e=i.fromID(r),f=c._tiles[r],f&&f.fadeEndTime>=Date.now()&&(c.findLoadedChildren(e,k,m)&&(m[r]=!0),g=c.findLoadedParent(e,j,o),g&&c.addTile(g.coord))}var s;for(s in o)m[s]||(c._coveredTiles[s]=!0);for(s in o)m[s]=!0;var t=l.keysDifference(this._tiles,m);for(d=0;d<t.length;d++)c.removeTile(+t[d]);this.transform=a}},b.prototype.addTile=function(a){var b=this._tiles[a.id];if(b)return b;var c=a.wrapped();if(b=this._tiles[c.id],b||(b=this._cache.get(c.id),b&&b.redoPlacement(this._source)),!b){var d=a.z,e=d>this._source.maxzoom?Math.pow(2,d-this._source.maxzoom):1;b=new g(c,this._source.tileSize*e,this._source.maxzoom),this.loadTile(b,this._tileLoaded.bind(this,b))}return b.uses++,this._tiles[a.id]=b,this._source.fire("dataloading",{tile:b,coord:b.coord,dataType:"tile"}),b},b.prototype.removeTile=function(a){var b=this._tiles[a];b&&(b.uses--,delete this._tiles[a],this._source.fire("data",{tile:b,coord:b.coord,dataType:"tile"}),b.uses>0||(b.hasData()?this._cache.add(b.coord.wrapped().id,b):(b.aborted=!0,this.abortTile(b),this.unloadTile(b))))},b.prototype.clearTiles=function(){var a=this;for(var b in this._tiles)a.removeTile(b);this._cache.reset()},b.prototype.tilesIn=function(a){for(var b=this,c={},e=this.getIds(),f=1/0,g=1/0,h=-(1/0),j=-(1/0),l=a[0].zoom,n=0;n<a.length;n++){var o=a[n];f=Math.min(f,o.column),g=Math.min(g,o.row),h=Math.max(h,o.column),j=Math.max(j,o.row)}for(var p=0;p<e.length;p++){var q=b._tiles[e[p]],r=i.fromID(e[p]),s=[d(r,q.sourceMaxZoom,new k(f,g,l)),d(r,q.sourceMaxZoom,new k(h,j,l))];if(s[0].x<m&&s[0].y<m&&s[1].x>=0&&s[1].y>=0){for(var t=[],u=0;u<a.length;u++)t.push(d(r,q.sourceMaxZoom,a[u]));var v=c[q.coord.id];void 0===v&&(v=c[q.coord.id]={tile:q,coord:r,queryGeometry:[],scale:Math.pow(2,b.transform.zoom-q.coord.z)}),v.queryGeometry.push(t)}}var w=[];for(var x in c)w.push(c[x]);return w},b.prototype.redoPlacement=function(){for(var a=this,b=this.getIds(),c=0;c<b.length;c++){var d=a.getTileByID(b[c]);d.redoPlacement(a._source)}},b.prototype.getVisibleCoordinates=function(){for(var a=this,b=this.getRenderableIds().map(i.fromID),c=0,d=b;c<d.length;c+=1){var e=d[c];e.posMatrix=a.transform.calculatePosMatrix(e,a._source.maxzoom)}return b},b}(h);n.maxOverzooming=10,n.maxUnderzooming=3,b.exports=n},{"../data/extent":11,"../geo/coordinate":18,"../util/evented":116,"../util/lru_cache":122,"../util/util":127,"./source":48,"./tile":50,"./tile_coord":51}],50:[function(a,b,c){"use strict";var d=a("../util/util"),e=a("../data/bucket"),f=a("../data/feature_index"),g=a("vector-tile"),h=a("pbf"),i=a("../util/vectortile_to_geojson"),j=a("feature-filter"),k=a("../symbol/collision_tile"),l=a("../symbol/collision_box"),m=a("../symbol/symbol_instances"),n=a("../symbol/symbol_quads"),o=function(a,b,c){this.coord=a,this.uid=d.uniqueId(),this.uses=0,this.tileSize=b,this.sourceMaxZoom=c,this.buckets={},this.state="loading"};o.prototype.registerFadeDuration=function(a,b){var c=b+this.timeAdded;c<Date.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c,a.set(this.fadeEndTime-Date.now()))},o.prototype.loadVectorData=function(a,b){this.hasData()&&this.unloadVectorData(b),this.state="loaded",a&&(a.rawTileData&&(this.rawTileData=a.rawTileData),this.collisionBoxArray=new l(a.collisionBoxArray),this.collisionTile=new k(a.collisionTile,this.collisionBoxArray),this.symbolInstancesArray=new m(a.symbolInstancesArray),this.symbolQuadsArray=new n(a.symbolQuadsArray),this.featureIndex=new f(a.featureIndex,this.rawTileData,this.collisionTile),this.buckets=e.deserialize(a.buckets,b.style))},o.prototype.reloadSymbolData=function(a,b){var c=this;if("unloaded"!==this.state){this.collisionTile=new k(a.collisionTile,this.collisionBoxArray),this.featureIndex.setCollisionTile(this.collisionTile);for(var f in this.buckets){var g=c.buckets[f];"symbol"===g.type&&(g.destroy(),delete c.buckets[f])}d.extend(this.buckets,e.deserialize(a.buckets,b))}},o.prototype.unloadVectorData=function(){var a=this;for(var b in this.buckets)a.buckets[b].destroy();this.buckets={},this.collisionBoxArray=null,this.symbolQuadsArray=null,this.symbolInstancesArray=null,this.collisionTile=null,this.featureIndex=null,this.state="unloaded"},o.prototype.redoPlacement=function(a){function b(b,c){this.reloadSymbolData(c,a.map.style),a.fire("data",{tile:this,coord:this.coord,dataType:"tile"}),a.map&&(a.map.painter.tileExtentVAO.vao=null),this.state="loaded",this.redoWhenDone&&(this.redoPlacement(a),this.redoWhenDone=!1)}if("vector"===a.type||"geojson"===a.type){if("loaded"!==this.state||"reloading"===this.state)return void(this.redoWhenDone=!0);this.state="reloading",a.dispatcher.send("redoPlacement",{type:a.type,uid:this.uid,source:a.id,angle:a.map.transform.angle,pitch:a.map.transform.pitch,showCollisionBoxes:a.map.showCollisionBoxes},b.bind(this),this.workerID)}},o.prototype.getBucket=function(a){return this.buckets[a.id]},o.prototype.querySourceFeatures=function(a,b){var c=this;if(this.rawTileData){this.vtLayers||(this.vtLayers=new g.VectorTile(new h(this.rawTileData)).layers);var d=this.vtLayers._geojsonTileLayer||this.vtLayers[b.sourceLayer];if(d)for(var e=j(b&&b.filter),f={z:this.coord.z,x:this.coord.x,y:this.coord.y},k=0;k<d.length;k++){var l=d.feature(k);if(e(l)){var m=new i(l,c.coord.z,c.coord.x,c.coord.y);m.tile=f,a.push(m)}}}},o.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state},b.exports=o},{"../data/bucket":2,"../data/feature_index":12,"../symbol/collision_box":76,"../symbol/collision_tile":78,"../symbol/symbol_instances":87,"../symbol/symbol_quads":88,"../util/util":127,"../util/vectortile_to_geojson":128,"feature-filter":135,pbf:193,"vector-tile":204}],51:[function(a,b,c){"use strict";function d(a,b){if(a.row>b.row){var c=a;a=b,b=c}return{x0:a.column,y0:a.row,x1:b.column,y1:b.row,dx:b.column-a.column,dy:b.row-a.row}}function e(a,b,c,d,e){var f=Math.max(c,Math.floor(b.y0)),g=Math.min(d,Math.ceil(b.y1));if(a.x0===b.x0&&a.y0===b.y0?a.x0+b.dy/a.dy*a.dx<b.x1:a.x1-b.dy/a.dy*a.dx<b.x0){var h=a;a=b,b=h}for(var i=a.dx/a.dy,j=b.dx/b.dy,k=a.dx>0,l=b.dx<0,m=f;g>m;m++){var n=i*Math.max(0,Math.min(a.dy,m+k-a.y0))+a.x0,o=j*Math.max(0,Math.min(b.dy,m+l-b.y0))+b.x0;e(Math.floor(o),Math.ceil(n),m)}}function f(a,b,c,f,g,h){var i,j=d(a,b),k=d(b,c),l=d(c,a);j.dy>k.dy&&(i=j,j=k,k=i),j.dy>l.dy&&(i=j,j=l,l=i),k.dy>l.dy&&(i=k,k=l,l=i),j.dy&&e(l,j,f,g,h),k.dy&&e(l,k,f,g,h)}function g(a,b,c){for(var d,e="",f=a;f>0;f--)d=1<<f-1,e+=(b&d?1:0)+(c&d?2:0);return e}var h=a("whoots-js"),i=a("../geo/coordinate"),j=function(a,b,c,d){isNaN(d)&&(d=0),this.z=+a,this.x=+b,this.y=+c,this.w=+d,d*=2,0>d&&(d=-1*d-1);var e=1<<this.z;this.id=32*(e*e*d+e*this.y+this.x)+this.z,this.posMatrix=null};j.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y},j.prototype.toCoordinate=function(a){var b=Math.min(this.z,void 0===a?this.z:a),c=Math.pow(2,b),d=this.y,e=this.x+c*this.w;return new i(e,d,b)},j.prototype.url=function(a,b,c){var d=h.getTileBBox(this.x,this.y,this.z),e=g(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",Math.min(this.z,b||this.z)).replace("{x}",this.x).replace("{y}","tms"===c?Math.pow(2,this.z)-this.y-1:this.y).replace("{quadkey}",e).replace("{bbox-epsg-3857}",d)},j.prototype.parent=function(a){return 0===this.z?null:this.z>a?new j(this.z-1,this.x,this.y,this.w):new j(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)},j.prototype.wrapped=function(){return new j(this.z,this.x,this.y,0)},j.prototype.children=function(a){if(this.z>=a)return[new j(this.z+1,this.x,this.y,this.w)];var b=this.z+1,c=2*this.x,d=2*this.y;return[new j(b,c,d,this.w),new j(b,c+1,d,this.w),new j(b,c,d+1,this.w),new j(b,c+1,d+1,this.w)]},j.cover=function(a,b,c){function d(a,b,d){var f,h,i;if(d>=0&&e>=d)for(f=a;b>f;f++)h=(f%e+e)%e,i=new j(c,h,d,Math.floor(f/e)),g[i.id]=i}var e=1<<a,g={};return f(b[0],b[1],b[2],0,e,d),f(b[2],b[3],b[0],0,e,d),Object.keys(g).map(function(a){return g[a]})},j.fromID=function(a){var b=a%32,c=1<<b,d=(a-b)/32,e=d%c,f=(d-e)/c%c,g=Math.floor(d/(c*c));return g%2!==0&&(g=-1*g-1),g/=2,new j(b,e,f,g)},b.exports=j},{"../geo/coordinate":18,"whoots-js":213}],52:[function(a,b,c){"use strict";var d=a("../util/evented"),e=a("../util/util"),f=a("./load_tilejson"),g=a("../util/mapbox").normalizeTileURL,h=function(a){function b(b,c,d,f){if(a.call(this),this.id=b,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,e.extend(this,e.pick(c,["url","scheme","tileSize"])),this._options=e.extend({type:"vector"},c),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.load=function(){var a=this;this.fire("dataloading",{dataType:"source"}),f(this._options,function(b,c){return b?void a.fire("error",b):(e.extend(a,c),a.fire("data",{dataType:"source"}),void a.fire("source.load"))})},b.prototype.onAdd=function(a){this.load(),this.map=a},b.prototype.serialize=function(){return e.extend({},this._options)},b.prototype.loadTile=function(a,b){function c(c,d){if(!a.aborted){if(c)return b(c);a.loadVectorData(d,this.map.painter),a.redoWhenDone&&(a.redoWhenDone=!1,a.redoPlacement(this)),b(null),a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)}}var d=a.coord.z>this.maxzoom?Math.pow(2,a.coord.z-this.maxzoom):1,e={url:g(a.coord.url(this.tiles,this.maxzoom,this.scheme),this.url),uid:a.uid,coord:a.coord,zoom:a.coord.z,tileSize:this.tileSize*d,type:this.type,source:this.id,overscaling:d,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};a.workerID?"loading"===a.state?a.reloadCallback=b:this.dispatcher.send("reloadTile",e,c.bind(this),a.workerID):a.workerID=this.dispatcher.send("loadTile",e,c.bind(this))},b.prototype.abortTile=function(a){this.dispatcher.send("abortTile",{uid:a.uid,type:this.type,source:this.id},null,a.workerID)},b.prototype.unloadTile=function(a){a.unloadVectorData(),this.dispatcher.send("removeTile",{uid:a.uid,type:this.type,source:this.id},null,a.workerID)},b}(d);b.exports=h},{"../util/evented":116,"../util/mapbox":123,"../util/util":127,"./load_tilejson":44}],53:[function(a,b,c){"use strict";var d=a("../util/ajax"),e=a("vector-tile"),f=a("pbf"),g=a("./worker_tile"),h=a("../util/util"),i=function(a,b,c){this.actor=a,this.layerIndex=b,c&&(this.loadVectorData=c),this.loading={},this.loaded={}};i.prototype.loadTile=function(a,b){function c(a,c){return delete this.loading[d][e],a?b(a):c?(f.vectorTile=c,f.parse(c,this.layerIndex,this.actor,function(a,d,e){return a?b(a):void b(null,h.extend({rawTileData:c.rawData},d),e)}),this.loaded[d]=this.loaded[d]||{},void(this.loaded[d][e]=f)):b(null,null)}var d=a.source,e=a.uid;this.loading[d]||(this.loading[d]={});var f=this.loading[d][e]=new g(a);f.abort=this.loadVectorData(a,c.bind(this))},i.prototype.reloadTile=function(a,b){function c(a,c){if(this.reloadCallback){var d=this.reloadCallback;delete this.reloadCallback,this.parse(this.vectorTile,f.layerIndex,f.actor,d)}b(a,c)}var d=this.loaded[a.source],e=a.uid,f=this;if(d&&d[e]){var g=d[e];"parsing"===g.status?g.reloadCallback=b:"done"===g.status&&g.parse(g.vectorTile,this.layerIndex,this.actor,c.bind(g))}},i.prototype.abortTile=function(a){var b=this.loading[a.source],c=a.uid;b&&b[c]&&b[c].abort&&(b[c].abort(),delete b[c])},i.prototype.removeTile=function(a){var b=this.loaded[a.source],c=a.uid;b&&b[c]&&delete b[c]},i.prototype.loadVectorData=function(a,b){function c(a,c){if(a)return b(a);var d=new e.VectorTile(new f(c));d.rawData=c,b(a,d)}var g=d.getArrayBuffer(a.url,c.bind(this));return function(){g.abort()}},i.prototype.redoPlacement=function(a,b){var c=this.loaded[a.source],d=this.loading[a.source],e=a.uid;if(c&&c[e]){var f=c[e],g=f.redoPlacement(a.angle,a.pitch,a.showCollisionBoxes);g.result&&b(null,g.result,g.transferables)}else d&&d[e]&&(d[e].angle=a.angle)},b.exports=i},{"../util/ajax":107,"../util/util":127,"./worker_tile":56,pbf:193,"vector-tile":204}],54:[function(a,b,c){"use strict";var d=a("../util/ajax"),e=a("./image_source"),f=function(a){function b(b,c,d,e){a.call(this,b,c,d,e),this.roundZoom=!0,this.options=c}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.load=function(){var a=this,b=this.options;this.urls=b.urls,d.getVideo(b.urls,function(b,c){if(b)return a.fire("error",{error:b});a.video=c,a.video.loop=!0;var d;a.video.addEventListener("playing",function(){d=a.map.style.animationLoop.set(1/0),a.map._rerender()}),a.video.addEventListener("pause",function(){a.map.style.animationLoop.cancel(d)}),a.map&&a.video.play(),a._finishLoading()})},b.prototype.getVideo=function(){return this.video},b.prototype.onAdd=function(a){this.map||(this.load(),
this.map=a,this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},b.prototype.prepare=function(){!this.tile||this.video.readyState<2||this._prepareImage(this.map.painter.gl,this.video)},b.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},b}(e);b.exports=f},{"../util/ajax":107,"./image_source":43}],55:[function(a,b,c){"use strict";var d=a("../util/actor"),e=a("../style/style_layer_index"),f=a("./vector_tile_worker_source"),g=a("./geojson_worker_source"),h=function(a){var b=this;this.self=a,this.actor=new d(a,this),this.layerIndexes={},this.workerSourceTypes={vector:f,geojson:g},this.workerSources={},this.self.registerWorkerSource=function(a,c){if(b.workerSourceTypes[a])throw new Error('Worker source with name "'+a+'" already registered.');b.workerSourceTypes[a]=c}};h.prototype.setLayers=function(a,b){this.getLayerIndex(a).replace(b)},h.prototype.updateLayers=function(a,b){this.getLayerIndex(a).update(b.layers,b.removedIds,b.symbolOrder)},h.prototype.loadTile=function(a,b,c){this.getWorkerSource(a,b.type).loadTile(b,c)},h.prototype.reloadTile=function(a,b,c){this.getWorkerSource(a,b.type).reloadTile(b,c)},h.prototype.abortTile=function(a,b){this.getWorkerSource(a,b.type).abortTile(b)},h.prototype.removeTile=function(a,b){this.getWorkerSource(a,b.type).removeTile(b)},h.prototype.removeSource=function(a,b){var c=this.getWorkerSource(a,b.type);void 0!==c.removeSource&&c.removeSource(b)},h.prototype.redoPlacement=function(a,b,c){this.getWorkerSource(a,b.type).redoPlacement(b,c)},h.prototype.loadWorkerSource=function(a,b,c){try{this.self.importScripts(b.url),c()}catch(a){c(a)}},h.prototype.getLayerIndex=function(a){var b=this.layerIndexes[a];return b||(b=this.layerIndexes[a]=new e),b},h.prototype.getWorkerSource=function(a,b){var c=this;if(this.workerSources[a]||(this.workerSources[a]={}),!this.workerSources[a][b]){var d={send:function(b,d,e,f){c.actor.send(b,d,e,f,a)}};this.workerSources[a][b]=new this.workerSourceTypes[b](d,this.getLayerIndex(a))}return this.workerSources[a][b]},b.exports=function(a){return new h(a)}},{"../style/style_layer_index":69,"../util/actor":106,"./geojson_worker_source":41,"./vector_tile_worker_source":53}],56:[function(a,b,c){"use strict";function d(a,b){for(var c=0,d=a.layers;c<d.length;c+=1){var e=d[c];e.recalculate(b)}}function e(a,b){return a.filter(function(a){return!a.isEmpty()}).map(function(a){return a.serialize(b)})}var f=a("../data/feature_index"),g=a("../symbol/collision_tile"),h=a("../symbol/collision_box"),i=a("../util/dictionary_coder"),j=a("../util/util"),k=a("../symbol/symbol_instances"),l=a("../symbol/symbol_quads"),m=function(a){this.coord=a.coord,this.uid=a.uid,this.zoom=a.zoom,this.tileSize=a.tileSize,this.source=a.source,this.overscaling=a.overscaling,this.angle=a.angle,this.pitch=a.pitch,this.showCollisionBoxes=a.showCollisionBoxes};m.prototype.parse=function(a,b,c,m){var n=this;a.layers||(a={layers:{_geojsonTileLayer:a}}),this.status="parsing",this.data=a,this.collisionBoxArray=new h,this.symbolInstancesArray=new k,this.symbolQuadsArray=new l;var o=new i(Object.keys(a.layers).sort()),p=new f(this.coord,this.overscaling);p.bucketLayerIDs={};var q={},r=0,s={featureIndex:p,iconDependencies:{},glyphDependencies:{}},t=b.familiesBySource[this.source];for(var u in t){var v=a.layers[u];if(v){1===v.version&&j.warnOnce('Vector tile source "'+n.source+'" layer "'+u+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var w=o.encode(u),x=[],y=0;y<v.length;y++){var z=v.feature(y);z.index=y,z.sourceLayerIndex=w,x.push(z)}for(var A=0,B=t[u];A<B.length;A+=1){var C=B[A],D=C[0];if(!(D.minzoom&&n.zoom<D.minzoom||D.maxzoom&&n.zoom>=D.maxzoom||D.layout&&"none"===D.layout.visibility)){for(var E=0,F=C;E<F.length;E+=1){var G=F[E];G.recalculate(n.zoom)}var H=q[D.id]=D.createBucket({index:r,layers:C,zoom:n.zoom,overscaling:n.overscaling,collisionBoxArray:n.collisionBoxArray,symbolQuadsArray:n.symbolQuadsArray,symbolInstancesArray:n.symbolInstancesArray});H.populate(x,s),p.bucketLayerIDs[r]=C.map(function(a){return a.id}),r++}}}}var I=function(a){n.status="done";var b=[];m(null,{buckets:e(j.values(q),b),featureIndex:p.serialize(b),collisionTile:a.serialize(b),collisionBoxArray:n.collisionBoxArray.serialize(),symbolInstancesArray:n.symbolInstancesArray.serialize(),symbolQuadsArray:n.symbolQuadsArray.serialize()},b)};this.symbolBuckets=[];for(var J=b.symbolOrder.length-1;J>=0;J--){var K=q[b.symbolOrder[J]];K&&n.symbolBuckets.push(K)}if(0===this.symbolBuckets.length)return I(new g(this.angle,this.pitch,this.collisionBoxArray));var L=0,M=Object.keys(s.iconDependencies),N=j.mapObject(s.glyphDependencies,function(a){return Object.keys(a).map(Number)}),O=function(a){if(a)return m(a);if(L++,2===L){for(var b=new g(n.angle,n.pitch,n.collisionBoxArray),c=0,e=n.symbolBuckets;c<e.length;c+=1){var f=e[c];d(f,n.zoom),f.prepare(N,M),f.place(b,n.showCollisionBoxes)}I(b)}};Object.keys(N).length?c.send("getGlyphs",{uid:this.uid,stacks:N},function(a,b){N=b,O(a)}):O(),M.length?c.send("getIcons",{icons:M},function(a,b){M=b,O(a)}):O()},m.prototype.redoPlacement=function(a,b,c){var f=this;if(this.angle=a,this.pitch=b,"done"!==this.status)return{};for(var h=new g(this.angle,this.pitch,this.collisionBoxArray),i=0,j=this.symbolBuckets;i<j.length;i+=1){var k=j[i];d(k,f.zoom),k.place(h,c)}var l=[];return{result:{buckets:e(this.symbolBuckets,l),collisionTile:h.serialize(l)},transferables:l}},b.exports=m},{"../data/feature_index":12,"../symbol/collision_box":76,"../symbol/collision_tile":78,"../symbol/symbol_instances":87,"../symbol/symbol_quads":88,"../util/dictionary_coder":113,"../util/util":127}],57:[function(a,b,c){"use strict";var d=function(){this.n=0,this.times=[]};d.prototype.stopped=function(){return this.times=this.times.filter(function(a){return a.time>=(new Date).getTime()}),!this.times.length},d.prototype.set=function(a){return this.times.push({id:this.n,time:a+(new Date).getTime()}),this.n++},d.prototype.cancel=function(a){this.times=this.times.filter(function(b){return b.id!==a})},b.exports=d},{}],58:[function(a,b,c){"use strict";var d=a("../util/evented"),e=a("../util/ajax"),f=a("../util/browser"),g=a("../util/mapbox").normalizeSpriteURL,h=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.pixelRatio=1,this.sdf=!1},i=function(a){function b(b,c){var d=this;a.call(this),this.base=b,this.retina=f.devicePixelRatio>1,this.setEventedParent(c);var h=this.retina?"@2x":"";e.getJSON(g(b,h,".json"),function(a,b){return a?void d.fire("error",{error:a}):(d.data=b,void(d.imgData&&d.fire("data",{dataType:"style"})))}),e.getImage(g(b,h,".png"),function(a,b){if(a)return void d.fire("error",{error:a});d.imgData=f.getImageData(b);for(var c=0;c<d.imgData.length;c+=4){var e=d.imgData[c+3]/255;d.imgData[c+0]*=e,d.imgData[c+1]*=e,d.imgData[c+2]*=e}d.width=b.width,d.data&&d.fire("data",{dataType:"style"})})}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.toJSON=function(){return this.base},b.prototype.loaded=function(){return!(!this.data||!this.imgData)},b.prototype.resize=function(){var a=this;if(f.devicePixelRatio>1!==this.retina){var c=new b(this.base);c.on("data",function(){a.data=c.data,a.imgData=c.imgData,a.width=c.width,a.retina=c.retina})}},b.prototype.getSpritePosition=function(a){if(!this.loaded())return new h;var b=this.data&&this.data[a];return b&&this.imgData?b:new h},b}(d);b.exports=i},{"../util/ajax":107,"../util/browser":108,"../util/evented":116,"../util/mapbox":123}],59:[function(a,b,c){"use strict";var d=a("./style_spec"),e=a("../util/util"),f=a("../util/evented"),g=a("./validate_style"),h=a("./style_declaration"),i=a("./style_transition"),j="-transition",k=function(a){function b(b){a.call(this),this.properties=["anchor","color","position","intensity"],this._specifications=d.light,this.set(b)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.set=function(a){var b=this;if(!this._validate(g.light,a)){this._declarations={},this._transitions={},this._transitionOptions={},this.calculated={},a=e.extend({anchor:this._specifications.anchor["default"],color:this._specifications.color["default"],position:this._specifications.position["default"],intensity:this._specifications.intensity["default"]},a);for(var c=0,d=this.properties;c<d.length;c+=1){var f=d[c];b._declarations[f]=new h(b._specifications[f],a[f])}return this}},b.prototype.getLight=function(){return{anchor:this.getLightProperty("anchor"),color:this.getLightProperty("color"),position:this.getLightProperty("position"),intensity:this.getLightProperty("intensity")}},b.prototype.getLightProperty=function(a){return e.endsWith(a,j)?this._transitionOptions[a]:this._declarations[a]&&this._declarations[a].value},b.prototype.getLightValue=function(a,b){if("position"===a){var c=this._transitions[a].calculate(b),d=e.sphericalToCartesian(c);return{x:d[0],y:d[1],z:d[2]}}return this._transitions[a].calculate(b)},b.prototype.setLight=function(a){var b=this;if(!this._validate(g.light,a))for(var c in a){var d=a[c];e.endsWith(c,j)?b._transitionOptions[c]=d:null===d||void 0===d?delete b._declarations[c]:b._declarations[c]=new h(b._specifications[c],d)}},b.prototype.recalculate=function(a){var b=this;for(var c in this._declarations)b.calculated[c]=b.getLightValue(c,{zoom:a})},b.prototype._applyLightDeclaration=function(a,b,c,d,f){var g=c.transition?this._transitions[a]:void 0,k=this._specifications[a];if(null!==b&&void 0!==b||(b=new h(k,k["default"])),!g||g.declaration.json!==b.json){var l=e.extend({duration:300,delay:0},d,this.getLightProperty(a+j)),m=this._transitions[a]=new i(k,b,g,l);m.instant()||(m.loopID=f.set(m.endTime-Date.now())),g&&f.cancel(g.loopID)}},b.prototype.updateLightTransitions=function(a,b,c){var d,e=this;for(d in this._declarations)e._applyLightDeclaration(d,e._declarations[d],a,b,c)},b.prototype._validate=function(a,b){return g.emitErrors(this,a.call(g,e.extend({value:b,style:{glyphs:!0,sprite:!0},styleSpec:d})))},b}(f);b.exports=k},{"../util/evented":116,"../util/util":127,"./style_declaration":62,"./style_spec":70,"./style_transition":71,"./validate_style":72}],60:[function(a,b,c){"use strict";var d=a("csscolorparser").parseCSSColor,e=a("../util/util"),f=a("mapbox-gl-function"),g={};b.exports=function h(a){if(a&&f.isFunctionDefinition(a))return a.stops?e.extend({},a,{stops:a.stops.map(function(a){return[a[0],h(a[1])]})}):a;if("string"==typeof a){if(!g[a]){var b=d(a);if(!b)throw new Error("Invalid color "+a);g[a]=[b[0]/255*b[3],b[1]/255*b[3],b[2]/255*b[3],b[3]]}return g[a]}if(Array.isArray(a))return a;throw new Error("Invalid color "+a)}},{"../util/util":127,csscolorparser:132,"mapbox-gl-function":160}],61:[function(a,b,c){"use strict";var d=a("../util/evented"),e=a("./style_layer"),f=a("./image_sprite"),g=a("./light"),h=a("../symbol/glyph_source"),i=a("../symbol/sprite_atlas"),j=a("../render/line_atlas"),k=a("../util/util"),l=a("../util/ajax"),m=a("../util/mapbox"),n=a("../util/browser"),o=a("../util/dispatcher"),p=a("./animation_loop"),q=a("./validate_style"),r=a("../source/source"),s=a("../source/query_features"),t=a("../source/source_cache"),u=a("./style_spec"),v=a("mapbox-gl-function"),w=a("../global_worker_pool"),x=a("mapbox-gl-style-spec/lib/deref"),y=a("mapbox-gl-style-spec/lib/diff"),z=k.pick(y.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition"]),A=k.pick(y.operations,["setCenter","setZoom","setBearing","setPitch"]),B=function(a){function b(b,c,d){var e=this;a.call(this),this.map=c,this.animationLoop=c&&c.animationLoop||new p,this.dispatcher=new o(w(),this),this.spriteAtlas=new i(1024,1024),this.lineAtlas=new j(256,512),this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory={},this._loaded=!1,k.bindAll(["_redoPlacement"],this),this._resetUpdates(),d=k.extend({validate:"string"!=typeof b||!m.isMapboxURL(b)},d),this.setEventedParent(c),this.fire("dataloading",{dataType:"style"});var g=function(a,b){if(a)return void e.fire("error",{error:a});if(!d.validate||!q.emitErrors(e,q(b))){e._loaded=!0,e.stylesheet=b,e.updateClasses();for(var c in b.sources)e.addSource(c,b.sources[c],d);b.sprite&&(e.sprite=new f(b.sprite,e)),e.glyphSource=new h(b.glyphs),e._resolve(),e.fire("data",{dataType:"style"}),e.fire("style.load")}};"string"==typeof b?l.getJSON(m.normalizeStyleURL(b),g):n.frame(g.bind(this,null,b)),this.on("source.load",function(a){var b=e.sourceCaches[a.sourceId].getSource();if(b&&b.vectorLayerIds)for(var c in e._layers){var d=e._layers[c];d.source===b.id&&e._validateLayer(d)}})}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype._validateLayer=function(a){var b=this.sourceCaches[a.source];if(a.sourceLayer&&b){var c=b.getSource();("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(a.sourceLayer))&&this.fire("error",{error:new Error('Source layer "'+a.sourceLayer+'" does not exist on source "'+c.id+'" as specified by style layer "'+a.id+'"')})}},b.prototype.loaded=function(){var a=this;if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var b in this.sourceCaches)if(!a.sourceCaches[b].loaded())return!1;return!(this.sprite&&!this.sprite.loaded())},b.prototype._resolve=function(){var a=this,b=x(this.stylesheet.layers);this._order=b.map(function(a){return a.id}),this._layers={};for(var c=0,d=b;c<d.length;c+=1){var f=d[c];f=e.create(f),f.setEventedParent(a,{layer:{id:f.id}}),a._layers[f.id]=f}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new g(this.stylesheet.light)},b.prototype._serializeLayers=function(a){var b=this;return a.map(function(a){return b._layers[a].serialize()})},b.prototype._applyClasses=function(a,b){var c=this;if(this._loaded){a=a||[],b=b||{transition:!0};var d=this.stylesheet.transition||{},e=this._updatedAllPaintProps?this._layers:this._updatedPaintProps;for(var f in e){var g=c._layers[f],h=c._updatedPaintProps[f];if(c._updatedAllPaintProps||h.all)g.updatePaintTransitions(a,b,d,c.animationLoop,c.zoomHistory);else for(var i in h)c._layers[f].updatePaintTransition(i,a,b,d,c.animationLoop,c.zoomHistory)}this.light.updateLightTransitions(b,d,this.animationLoop)}},b.prototype._recalculate=function(a){var b=this;if(this._loaded){for(var c in this.sourceCaches)b.sourceCaches[c].used=!1;this._updateZoomHistory(a);for(var d=0,e=this._order;d<e.length;d+=1){var f=e[d],g=b._layers[f];g.recalculate(a),!g.isHidden(a)&&g.source&&(b.sourceCaches[g.source].used=!0)}this.light.recalculate(a);var h=300;Math.floor(this.z)!==Math.floor(a)&&this.animationLoop.set(h),this.z=a}},b.prototype._updateZoomHistory=function(a){var b=this.zoomHistory;void 0===b.lastIntegerZoom&&(b.lastIntegerZoom=Math.floor(a),b.lastIntegerZoomTime=0,b.lastZoom=a),Math.floor(b.lastZoom)<Math.floor(a)?(b.lastIntegerZoom=Math.floor(a),b.lastIntegerZoomTime=Date.now()):Math.floor(b.lastZoom)>Math.floor(a)&&(b.lastIntegerZoom=Math.floor(a+1),b.lastIntegerZoomTime=Date.now()),b.lastZoom=a},b.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},b.prototype.update=function(a,b){var c=this;if(this._changed){var d=Object.keys(this._updatedLayers),e=Object.keys(this._removedLayers);(d.length||e.length||this._updatedSymbolOrder)&&this._updateWorkerLayers(d,e);for(var f in this._updatedSources){var g=c._updatedSources[f];"reload"===g?c._reloadSource(f):"clear"===g&&c._clearSource(f)}this._applyClasses(a,b),this._resetUpdates(),this.fire("data",{dataType:"style"})}},b.prototype._updateWorkerLayers=function(a,b){var c=this,d=this._updatedSymbolOrder?this._order.filter(function(a){return"symbol"===c._layers[a].type}):null;this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:b,symbolOrder:d})},b.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSymbolOrder=!1,this._updatedSources={},this._updatedPaintProps={},this._updatedAllPaintProps=!1},b.prototype.setState=function(a){var b=this;if(this._checkLoaded(),q.emitErrors(this,q(a)))return!1;a=k.extend({},a),a.layers=x(a.layers);var c=y(this.serialize(),a).filter(function(a){return!(a.command in A)});if(0===c.length)return!1;var d=c.filter(function(a){return!(a.command in z)});if(d.length>0)throw new Error("Unimplemented: "+d.map(function(a){return a.command}).join(", ")+".");return c.forEach(function(a){"setTransition"!==a.command&&b[a.command].apply(b,a.args)}),this.stylesheet=a,!0},b.prototype.addSource=function(a,b,c){if(this._checkLoaded(),void 0!==this.sourceCaches[a])throw new Error("There is already a source with this ID");if(!b.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(b)+".");var d=["vector","raster","geojson","video","image"],e=d.indexOf(b.type)>=0;if(!e||!this._validate(q.source,"sources."+a,b,null,c)){var f=this.sourceCaches[a]=new t(a,b,this.dispatcher);f.style=this,f.setEventedParent(this,function(){return{isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:a}}),f.onAdd(this.map),this._changed=!0}},b.prototype.removeSource=function(a){if(this._checkLoaded(),void 0===this.sourceCaches[a])throw new Error("There is no source with this ID");var b=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],b.setEventedParent(null),b.clearTiles(),b.onRemove&&b.onRemove(this.map),this._changed=!0},b.prototype.getSource=function(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()},b.prototype.addLayer=function(a,b,c){this._checkLoaded();var d=a.id;if("object"==typeof a.source&&(this.addSource(d,a.source),a=k.extend(a,{source:d})),!this._validate(q.layer,"layers."+d,a,{arrayIndex:-1},c)){var f=e.create(a);this._validateLayer(f),f.setEventedParent(this,{layer:{id:d}});var g=b?this._order.indexOf(b):this._order.length;this._order.splice(g,0,d),this._layers[d]=f,this._removedLayers[d]&&(delete this._removedLayers[d],this._updatedSources[f.source]="clear"),this._updateLayer(f),"symbol"===f.type&&(this._updatedSymbolOrder=!0),this.updateClasses(d)}},b.prototype.moveLayer=function(a,b){this._checkLoaded(),this._changed=!0;var c=this._layers[a];if(!c)return void this.fire("error",{error:new Error("The layer '"+a+"' does not exist in the map's style and cannot be moved.")});var d=this._order.indexOf(a);this._order.splice(d,1);var e=b?this._order.indexOf(b):this._order.length;this._order.splice(e,0,a),"symbol"===c.type&&(this._updatedSymbolOrder=!0,c.source&&!this._updatedSources[c.source]&&(this._updatedSources[c.source]="reload"))},b.prototype.removeLayer=function(a){this._checkLoaded();var b=this._layers[a];if(!b)return void this.fire("error",{error:new Error("The layer '"+a+"' does not exist in the map's style and cannot be removed.")});b.setEventedParent(null);var c=this._order.indexOf(a);this._order.splice(c,1),"symbol"===b.type&&(this._updatedSymbolOrder=!0),this._changed=!0,this._removedLayers[a]=!0,delete this._layers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a]},b.prototype.getLayer=function(a){return this._layers[a]},b.prototype.setLayerZoomRange=function(a,b,c){this._checkLoaded();var d=this.getLayer(a);return d?void(d.minzoom===b&&d.maxzoom===c||(null!=b&&(d.minzoom=b),null!=c&&(d.maxzoom=c),this._updateLayer(d))):void this.fire("error",{error:new Error("The layer '"+a+"' does not exist in the map's style and cannot have zoom extent.")})},b.prototype.setFilter=function(a,b){this._checkLoaded();var c=this.getLayer(a);return c?void(null!==b&&void 0!==b&&this._validate(q.filter,"layers."+c.id+".filter",b)||k.deepEqual(c.filter,b)||(c.filter=k.clone(b),this._updateLayer(c))):void this.fire("error",{error:new Error("The layer '"+a+"' does not exist in the map's style and cannot be filtered.")})},b.prototype.getFilter=function(a){return k.clone(this.getLayer(a).filter)},b.prototype.setLayoutProperty=function(a,b,c){this._checkLoaded();var d=this.getLayer(a);return d?void(k.deepEqual(d.getLayoutProperty(b),c)||(d.setLayoutProperty(b,c),this._updateLayer(d))):void this.fire("error",{error:new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")})},b.prototype.getLayoutProperty=function(a,b){return this.getLayer(a).getLayoutProperty(b)},b.prototype.setPaintProperty=function(a,b,c,d){this._checkLoaded();var e=this.getLayer(a);if(!e)return void this.fire("error",{error:new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")});if(!k.deepEqual(e.getPaintProperty(b,d),c)){var f=e.isPaintValueFeatureConstant(b);e.setPaintProperty(b,c,d);var g=!(c&&v.isFunctionDefinition(c)&&"$zoom"!==c.property&&void 0!==c.property);g&&f||this._updateLayer(e),this.updateClasses(a,b)}},b.prototype.getPaintProperty=function(a,b,c){return this.getLayer(a).getPaintProperty(b,c)},b.prototype.getTransition=function(){return k.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},b.prototype.updateClasses=function(a,b){if(this._changed=!0,a){var c=this._updatedPaintProps;c[a]||(c[a]={}),c[a][b||"all"]=!0}else this._updatedAllPaintProps=!0},b.prototype.serialize=function(){var a=this;return k.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:k.mapObject(this.sourceCaches,function(a){return a.serialize()}),layers:this._order.map(function(b){return a._layers[b].serialize()})},function(a){return void 0!==a})},b.prototype._updateLayer=function(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&(this._updatedSources[a.source]="reload"),this._changed=!0},b.prototype._flattenRenderedFeatures=function(a){for(var b=this,c=[],d=this._order.length-1;d>=0;d--)for(var e=b._order[d],f=0,g=a;f<g.length;f+=1){var h=g[f],i=h[e];if(i)for(var j=0,k=i;j<k.length;j+=1){var l=k[j];c.push(l)}}return c},b.prototype.queryRenderedFeatures=function(a,b,c,d){var e=this;b&&b.filter&&this._validate(q.filter,"queryRenderedFeatures.filter",b.filter);var f={};if(b&&b.layers)for(var g=0,h=b.layers;g<h.length;g+=1){var i=h[g],j=e._layers[i];if(!j)return void e.fire("error",{error:"The layer '"+i+"' does not exist in the map's style and cannot be queried for features."});f[j.source]=!0}var k=[];for(var l in this.sourceCaches)if(!b.layers||f[l]){var m=s.rendered(e.sourceCaches[l],e._layers,a,b,c,d);k.push(m)}return this._flattenRenderedFeatures(k)},b.prototype.querySourceFeatures=function(a,b){b&&b.filter&&this._validate(q.filter,"querySourceFeatures.filter",b.filter);var c=this.sourceCaches[a];return c?s.source(c,b):[]},b.prototype.addSourceType=function(a,b,c){return r.getType(a)?c(new Error('A source type called "'+a+'" already exists.')):(r.setType(a,b),b.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:b.workerSourceURL},c):c(null,null))},b.prototype.getLight=function(){return this.light.getLight()},b.prototype.setLight=function(a,b){this._checkLoaded();var c=this.light.getLight(),d=!1;for(var e in a)if(!k.deepEqual(a[e],c[e])){d=!0;break}if(d){var f=this.stylesheet.transition||{};this.light.setLight(a),this.light.updateLightTransitions(b||{transition:!0},f,this.animationLoop)}},b.prototype._validate=function(a,b,c,d,e){return(!e||e.validate!==!1)&&q.emitErrors(this,a.call(q,k.extend({key:b,style:this.serialize(),value:c,styleSpec:u},d)))},b.prototype._remove=function(){var a=this;for(var b in this.sourceCaches)a.sourceCaches[b].clearTiles();this.dispatcher.remove()},b.prototype._clearSource=function(a){this.sourceCaches[a].clearTiles()},b.prototype._reloadSource=function(a){this.sourceCaches[a].reload()},b.prototype._updateSources=function(a){var b=this;for(var c in this.sourceCaches)b.sourceCaches[c].update(a)},b.prototype._redoPlacement=function(){var a=this;for(var b in this.sourceCaches)a.sourceCaches[b].redoPlacement()},b.prototype.getIcons=function(a,b,c){var d=this,e=function(){d.spriteAtlas.setSprite(d.sprite),d.spriteAtlas.addIcons(b.icons,c)};this.sprite.loaded()?e():this.sprite.on("data",e)},b.prototype.getGlyphs=function(a,b,c){function d(a,b,d){a&&console.error(a),h[d]=b,g--,0===g&&c(null,h)}var e=this,f=b.stacks,g=Object.keys(f).length,h={};for(var i in f)e.glyphSource.getSimpleGlyphs(i,f[i],b.uid,d)},b}(d);b.exports=B},{"../global_worker_pool":22,"../render/line_atlas":35,"../source/query_features":46,"../source/source":48,"../source/source_cache":49,"../symbol/glyph_source":81,"../symbol/sprite_atlas":86,"../util/ajax":107,"../util/browser":108,"../util/dispatcher":114,"../util/evented":116,"../util/mapbox":123,"../util/util":127,"./animation_loop":57,"./image_sprite":58,"./light":59,"./style_layer":63,"./style_spec":70,"./validate_style":72,"mapbox-gl-function":160,"mapbox-gl-style-spec/lib/deref":161,"mapbox-gl-style-spec/lib/diff":162}],62:[function(a,b,c){"use strict";var d=a("mapbox-gl-function"),e=a("./parse_color"),f=a("../util/util"),g=function(a,b){var c=this;this.value=f.clone(b),this.isFunction=d.isFunctionDefinition(b),this.json=JSON.stringify(this.value),this.minimum=a.minimum,this.isColor="color"===a.type;var g=this.isColor&&this.value?e(this.value):b,h=a["default"];if(h&&"color"===a.type&&(h=e(h)),this["function"]=d[a["function"]||"piecewise-constant"](g,h),this.isFeatureConstant=this["function"].isFeatureConstant,this.isZoomConstant=this["function"].isZoomConstant,!this.isFeatureConstant&&!this.isZoomConstant){this.stopZoomLevels=[];for(var i=[],j=0,k=this.value.stops;j<k.length;j+=1){var l=k[j],m=l[0].zoom;c.stopZoomLevels.indexOf(m)<0&&(c.stopZoomLevels.push(m),i.push([m,i.length]))}this.functionInterpolationT=d.interpolated({stops:i,base:b.base,colorSpace:b.colorSpace})}};g.prototype.calculate=function(a,b){var c=this["function"](a&&a.zoom,b||{});return this.isColor&&c?e(c):void 0!==this.minimum&&c<this.minimum?this.minimum:c},g.prototype.calculateInterpolationT=function(a,b){return this.functionInterpolationT(a&&a.zoom,b||{})},b.exports=g},{"../util/util":127,"./parse_color":60,"mapbox-gl-function":160}],63:[function(a,b,c){"use strict";function d(a){return a.value}var e=a("../util/util"),f=a("./style_transition"),g=a("./style_declaration"),h=a("./style_spec"),i=a("./validate_style"),j=a("./parse_color"),k=a("../util/evented"),l="-transition",m=function(a){function b(b){var c=this;a.call(this),this.id=b.id,this.metadata=b.metadata,this.type=b.type,this.source=b.source,this.sourceLayer=b["source-layer"],this.minzoom=b.minzoom,this.maxzoom=b.maxzoom,this.filter=b.filter,this.paint={},this.layout={},this._paintSpecifications=h["paint_"+this.type],this._layoutSpecifications=h["layout_"+this.type],this._paintTransitions={},this._paintTransitionOptions={},this._paintDeclarations={},this._layoutDeclarations={},this._layoutFunctions={};var d,e,f={validate:!1};for(var g in b){var i=g.match(/^paint(?:\.(.*))?$/);if(i){var j=i[1]||"";for(d in b[g])c.setPaintProperty(d,b[g][d],j,f)}}for(e in b.layout)c.setLayoutProperty(e,b.layout[e],f);for(d in this._paintSpecifications)c.paint[d]=c.getPaintValue(d);for(e in this._layoutSpecifications)c._updateLayoutValue(e)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.setLayoutProperty=function(a,b,c){if(null==b)delete this._layoutDeclarations[a];else{var d="layers."+this.id+".layout."+a;if(this._validate(i.layoutProperty,d,a,b,c))return;this._layoutDeclarations[a]=new g(this._layoutSpecifications[a],b)}this._updateLayoutValue(a)},b.prototype.getLayoutProperty=function(a){return this._layoutDeclarations[a]&&this._layoutDeclarations[a].value},b.prototype.getLayoutValue=function(a,b,c){var d=this._layoutSpecifications[a],e=this._layoutDeclarations[a];return e?e.calculate(b,c):d["default"]},b.prototype.setPaintProperty=function(a,b,c,d){var f="layers."+this.id+(c?'["paint.'+c+'"].':".paint.")+a;if(e.endsWith(a,l))if(this._paintTransitionOptions[c||""]||(this._paintTransitionOptions[c||""]={}),null===b||void 0===b)delete this._paintTransitionOptions[c||""][a];else{if(this._validate(i.paintProperty,f,a,b,d))return;this._paintTransitionOptions[c||""][a]=b}else if(this._paintDeclarations[c||""]||(this._paintDeclarations[c||""]={}),null===b||void 0===b)delete this._paintDeclarations[c||""][a];else{if(this._validate(i.paintProperty,f,a,b,d))return;this._paintDeclarations[c||""][a]=new g(this._paintSpecifications[a],b)}},b.prototype.getPaintProperty=function(a,b){return b=b||"",e.endsWith(a,l)?this._paintTransitionOptions[b]&&this._paintTransitionOptions[b][a]:this._paintDeclarations[b]&&this._paintDeclarations[b][a]&&this._paintDeclarations[b][a].value},b.prototype.getPaintValue=function(a,b,c){var d=this._paintSpecifications[a],e=this._paintTransitions[a];return e?e.calculate(b,c):"color"===d.type&&d["default"]?j(d["default"]):d["default"]},b.prototype.getPaintValueStopZoomLevels=function(a){var b=this._paintTransitions[a];return b?b.declaration.stopZoomLevels:[]},b.prototype.getPaintInterpolationT=function(a,b){var c=this._paintTransitions[a];return c.declaration.calculateInterpolationT(b)},b.prototype.isPaintValueFeatureConstant=function(a){var b=this._paintTransitions[a];return!b||b.declaration.isFeatureConstant},b.prototype.isLayoutValueFeatureConstant=function(a){var b=this._layoutDeclarations[a];return!b||b.isFeatureConstant},b.prototype.isPaintValueZoomConstant=function(a){var b=this._paintTransitions[a];return!b||b.declaration.isZoomConstant},b.prototype.isHidden=function(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||"none"===this.layout.visibility},b.prototype.updatePaintTransitions=function(a,b,c,d,f){for(var g=this,h=e.extend({},this._paintDeclarations[""]),i=0;i<a.length;i++)e.extend(h,g._paintDeclarations[a[i]]);var j;for(j in h)g._applyPaintDeclaration(j,h[j],b,c,d,f);for(j in this._paintTransitions)j in h||g._applyPaintDeclaration(j,null,b,c,d,f)},b.prototype.updatePaintTransition=function(a,b,c,d,e,f){for(var g=this,h=this._paintDeclarations[""][a],i=0;i<b.length;i++){var j=g._paintDeclarations[b[i]];j&&j[a]&&(h=j[a])}this._applyPaintDeclaration(a,h,c,d,e,f)},b.prototype.recalculate=function(a){var b=this;for(var c in this._paintTransitions)b.paint[c]=b.getPaintValue(c,{zoom:a});for(var d in this._layoutFunctions)b.layout[d]=b.getLayoutValue(d,{zoom:a})},b.prototype.serialize=function(){var a=this,b={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:e.mapObject(this._layoutDeclarations,d)};for(var c in this._paintDeclarations){var f=""===c?"paint":"paint."+c;b[f]=e.mapObject(a._paintDeclarations[c],d)}return e.filterObject(b,function(a,b){return void 0!==a&&!("layout"===b&&!Object.keys(a).length)})},b.prototype._applyPaintDeclaration=function(a,b,c,d,h,i){var j=c.transition?this._paintTransitions[a]:void 0,k=this._paintSpecifications[a];if(null!==b&&void 0!==b||(b=new g(k,k["default"])),!j||j.declaration.json!==b.json){var m=e.extend({duration:300,delay:0},d,this.getPaintProperty(a+l)),n=this._paintTransitions[a]=new f(k,b,j,m,i);n.instant()||(n.loopID=h.set(n.endTime-Date.now())),j&&h.cancel(j.loopID)}},b.prototype._updateLayoutValue=function(a){var b=this._layoutDeclarations[a];b&&b.isFunction?this._layoutFunctions[a]=!0:(delete this._layoutFunctions[a],this.layout[a]=this.getLayoutValue(a))},b.prototype._validate=function(a,b,c,d,e){return(!e||e.validate!==!1)&&i.emitErrors(this,a.call(i,{key:b,layerType:this.type,objectKey:c,value:d,styleSpec:h,style:{glyphs:!0,sprite:!0}}))},b}(k);b.exports=m;var n={circle:a("./style_layer/circle_style_layer"),
fill:a("./style_layer/fill_style_layer"),"fill-extrusion":a("./style_layer/fill_extrusion_style_layer"),line:a("./style_layer/line_style_layer"),symbol:a("./style_layer/symbol_style_layer")};m.create=function(a){var b=n[a.type]||m;return new b(a)}},{"../util/evented":116,"../util/util":127,"./parse_color":60,"./style_declaration":62,"./style_layer/circle_style_layer":64,"./style_layer/fill_extrusion_style_layer":65,"./style_layer/fill_style_layer":66,"./style_layer/line_style_layer":67,"./style_layer/symbol_style_layer":68,"./style_spec":70,"./style_transition":71,"./validate_style":72}],64:[function(a,b,c){"use strict";var d=a("../style_layer"),e=a("../../data/bucket/circle_bucket"),f=function(a){function b(){a.apply(this,arguments)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.createBucket=function(a){return new e(a)},b}(d);b.exports=f},{"../../data/bucket/circle_bucket":3,"../style_layer":63}],65:[function(a,b,c){"use strict";var d=a("../style_layer"),e=a("../../data/bucket/fill_extrusion_bucket"),f=function(a){function b(){a.apply(this,arguments)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.getPaintValue=function(b,c,d){var e=a.prototype.getPaintValue.call(this,b,c,d);return"fill-extrusion-color"===b&&e&&(e[3]=1),e},b.prototype.createBucket=function(a){return new e(a)},b}(d);b.exports=f},{"../../data/bucket/fill_extrusion_bucket":5,"../style_layer":63}],66:[function(a,b,c){"use strict";var d=a("../style_layer"),e=a("../../data/bucket/fill_bucket"),f=function(a){function b(){a.apply(this,arguments)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.getPaintValue=function(b,c,d){return"fill-outline-color"===b&&void 0===this.getPaintProperty("fill-outline-color")?a.prototype.getPaintValue.call(this,"fill-color",c,d):a.prototype.getPaintValue.call(this,b,c,d)},b.prototype.getPaintValueStopZoomLevels=function(b){return"fill-outline-color"===b&&void 0===this.getPaintProperty("fill-outline-color")?a.prototype.getPaintValueStopZoomLevels.call(this,"fill-color"):a.prototype.getPaintValueStopZoomLevels.call(this,b)},b.prototype.getPaintInterpolationT=function(b,c){return"fill-outline-color"===b&&void 0===this.getPaintProperty("fill-outline-color")?a.prototype.getPaintInterpolationT.call(this,"fill-color",c):a.prototype.getPaintInterpolationT.call(this,b,c)},b.prototype.isPaintValueFeatureConstant=function(b){return"fill-outline-color"===b&&void 0===this.getPaintProperty("fill-outline-color")?a.prototype.isPaintValueFeatureConstant.call(this,"fill-color"):a.prototype.isPaintValueFeatureConstant.call(this,b)},b.prototype.isPaintValueZoomConstant=function(b){return"fill-outline-color"===b&&void 0===this.getPaintProperty("fill-outline-color")?a.prototype.isPaintValueZoomConstant.call(this,"fill-color"):a.prototype.isPaintValueZoomConstant.call(this,b)},b.prototype.createBucket=function(a){return new e(a)},b}(d);b.exports=f},{"../../data/bucket/fill_bucket":4,"../style_layer":63}],67:[function(a,b,c){"use strict";var d=a("../style_layer"),e=a("../../data/bucket/line_bucket"),f=a("../../util/util"),g=function(a){function b(){a.apply(this,arguments)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.getPaintValue=function(b,c,d){var e=a.prototype.getPaintValue.call(this,b,c,d);if(e&&"line-dasharray"===b){var g=this.getPaintValue("line-width",f.extend({},c,{zoom:Math.floor(c.zoom)}),d);e.fromScale*=g,e.toScale*=g}return e},b.prototype.createBucket=function(a){return new e(a)},b}(d);b.exports=g},{"../../data/bucket/line_bucket":6,"../../util/util":127,"../style_layer":63}],68:[function(a,b,c){"use strict";var d=a("../style_layer"),e=a("../../data/bucket/symbol_bucket"),f=function(a){function b(){a.apply(this,arguments)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.getLayoutValue=function(b,c,d){var e=a.prototype.getLayoutValue.call(this,b,c,d);if("auto"!==e)return e;switch(b){case"text-rotation-alignment":case"icon-rotation-alignment":return"line"===this.getLayoutValue("symbol-placement",c,d)?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",c,d);default:return e}},b.prototype.createBucket=function(a){return new e(a)},b}(d);b.exports=f},{"../../data/bucket/symbol_bucket":7,"../style_layer":63}],69:[function(a,b,c){"use strict";var d=a("./style_layer"),e=a("../util/util"),f=a("feature-filter"),g=a("mapbox-gl-style-spec/lib/group_by_layout"),h=function(a){a&&this.replace(a)};h.prototype.replace=function(a){var b=this;this.symbolOrder=[];for(var c=0,d=a;c<d.length;c+=1){var e=d[c];"symbol"===e.type&&b.symbolOrder.push(e.id)}this._layerConfigs={},this._layers={},this.update(a,[])},h.prototype.update=function(a,b,c){for(var h=this,i=0,j=a;i<j.length;i+=1){var k=j[i];h._layerConfigs[k.id]=k;var l=h._layers[k.id]=d.create(k);l.updatePaintTransitions({},{transition:!1}),l.filter=f(l.filter)}for(var m=0,n=b;m<n.length;m+=1){var o=n[m];delete h._layerConfigs[o],delete h._layers[o]}c&&(this.symbolOrder=c),this.familiesBySource={};for(var p=g(e.values(this._layerConfigs)),q=0,r=p;q<r.length;q+=1){var s=r[q],t=s.map(function(a){return h._layers[a.id]}),u=t[0];if(!u.layout||"none"!==u.layout.visibility){var v=u.source||"",w=h.familiesBySource[v];w||(w=h.familiesBySource[v]={});var x=u.sourceLayer||"_geojsonTileLayer",y=w[x];y||(y=w[x]=[]),y.push(t)}}},b.exports=h},{"../util/util":127,"./style_layer":63,"feature-filter":135,"mapbox-gl-style-spec/lib/group_by_layout":164}],70:[function(a,b,c){"use strict";b.exports=a("mapbox-gl-style-spec/reference/latest.min")},{"mapbox-gl-style-spec/reference/latest.min":188}],71:[function(a,b,c){"use strict";function d(a,b,c){return void 0!==a&&void 0!==b?{from:a.to,fromScale:a.toScale,to:b.to,toScale:b.toScale,t:c}:void 0}var e=a("../util/util"),f=a("../util/interpolate"),g={lastIntegerZoom:0,lastIntegerZoomTime:0,lastZoom:0},h=function(a,b,c,e,h){this.declaration=b,this.startTime=this.endTime=(new Date).getTime(),this.oldTransition=c,this.duration=e.duration||0,this.delay=e.delay||0,this.zoomTransitioned="piecewise-constant"===a["function"]&&a.transition,this.interp=this.zoomTransitioned?d:f[a.type],this.zoomHistory=h||g,this.instant()||(this.endTime=this.startTime+this.duration+this.delay),c&&c.endTime<=this.startTime&&delete c.oldTransition};h.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},h.prototype.calculate=function(a,b,c){var d=this._calculateTargetValue(a,b);if(this.instant())return d;if(c=c||Date.now(),c>=this.endTime)return d;var f=this.oldTransition.calculate(a,b,this.startTime),g=e.easeCubicInOut((c-this.startTime-this.delay)/this.duration);return this.interp(f,d,g)},h.prototype._calculateTargetValue=function(a,b){if(!this.zoomTransitioned)return this.declaration.calculate(a,b);var c=a.zoom,d=this.zoomHistory.lastIntegerZoom,e=c>d?2:.5,g=this.declaration.calculate({zoom:c>d?c-1:c+1},b),h=this.declaration.calculate({zoom:c},b),i=Math.min((Date.now()-this.zoomHistory.lastIntegerZoomTime)/this.duration,1),j=Math.abs(c-d),k=f(i,1,j);return void 0!==g&&void 0!==h?{from:g,fromScale:e,to:h,toScale:1,t:k}:void 0},b.exports=h},{"../util/interpolate":119,"../util/util":127}],72:[function(a,b,c){"use strict";b.exports=a("mapbox-gl-style-spec/lib/validate_style.min"),b.exports.emitErrors=function(a,b){if(b&&b.length){for(var c=0;c<b.length;c++)a.fire("error",{error:new Error(b[c].message)});return!0}return!1}},{"mapbox-gl-style-spec/lib/validate_style.min":186}],73:[function(a,b,c){"use strict";var d=a("point-geometry"),e=function(a){function b(b,c,d,e){a.call(this,b,c),this.angle=d,void 0!==e&&(this.segment=e)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.clone=function(){return new b(this.x,this.y,this.angle,this.segment)},b}(d);b.exports=e},{"point-geometry":194}],74:[function(a,b,c){"use strict";function d(a,b,c,d,e){if(void 0===b.segment)return!0;for(var f=b,g=b.segment+1,h=0;h>-c/2;){if(g--,0>g)return!1;h-=a[g].dist(f),f=a[g]}h+=a[g].dist(a[g+1]),g++;for(var i=[],j=0;c/2>h;){var k=a[g-1],l=a[g],m=a[g+1];if(!m)return!1;var n=k.angleTo(l)-l.angleTo(m);for(n=Math.abs((n+3*Math.PI)%(2*Math.PI)-Math.PI),i.push({distance:h,angleDelta:n}),j+=n;h-i[0].distance>d;)j-=i.shift().angleDelta;if(j>e)return!1;g++,h+=l.dist(m)}return!0}b.exports=d},{}],75:[function(a,b,c){"use strict";function d(a,b,c,d,f){for(var g=[],h=0;h<a.length;h++)for(var i,j=a[h],k=0;k<j.length-1;k++){var l=j[k],m=j[k+1];l.x<b&&m.x<b||(l.x<b?l=new e(b,l.y+(m.y-l.y)*((b-l.x)/(m.x-l.x)))._round():m.x<b&&(m=new e(b,l.y+(m.y-l.y)*((b-l.x)/(m.x-l.x)))._round()),l.y<c&&m.y<c||(l.y<c?l=new e(l.x+(m.x-l.x)*((c-l.y)/(m.y-l.y)),c)._round():m.y<c&&(m=new e(l.x+(m.x-l.x)*((c-l.y)/(m.y-l.y)),c)._round()),l.x>=d&&m.x>=d||(l.x>=d?l=new e(d,l.y+(m.y-l.y)*((d-l.x)/(m.x-l.x)))._round():m.x>=d&&(m=new e(d,l.y+(m.y-l.y)*((d-l.x)/(m.x-l.x)))._round()),l.y>=f&&m.y>=f||(l.y>=f?l=new e(l.x+(m.x-l.x)*((f-l.y)/(m.y-l.y)),f)._round():m.y>=f&&(m=new e(l.x+(m.x-l.x)*((f-l.y)/(m.y-l.y)),f)._round()),i&&l.equals(i[i.length-1])||(i=[l],g.push(i)),i.push(m)))))}return g}var e=a("point-geometry");b.exports=d},{"point-geometry":194}],76:[function(a,b,c){"use strict";var d=a("../util/struct_array"),e=a("point-geometry"),f=d({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Float32",name:"maxScale"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"bbox0"},{type:"Int16",name:"bbox1"},{type:"Int16",name:"bbox2"},{type:"Int16",name:"bbox3"},{type:"Float32",name:"placementScale"}]});Object.defineProperty(f.prototype.StructType.prototype,"anchorPoint",{get:function(){return new e(this.anchorPointX,this.anchorPointY)}}),b.exports=f},{"../util/struct_array":125,"point-geometry":194}],77:[function(a,b,c){"use strict";var d=function(a,b,c,d,e,f,g,h,i,j,k){var l=g.top*h-i,m=g.bottom*h+i,n=g.left*h-i,o=g.right*h+i;if(this.boxStartIndex=a.length,j){var p=m-l,q=o-n;if(p>0)if(p=Math.max(10*h,p),k){var r=b[c.segment+1].sub(b[c.segment])._unit()._mult(q),s=[c.sub(r),c.add(r)];this._addLineCollisionBoxes(a,s,c,0,q,p,d,e,f)}else this._addLineCollisionBoxes(a,b,c,c.segment,q,p,d,e,f)}else a.emplaceBack(c.x,c.y,n,l,o,m,1/0,d,e,f,0,0,0,0,0);this.boxEndIndex=a.length};d.prototype._addLineCollisionBoxes=function(a,b,c,d,e,f,g,h,i){var j=f/2,k=Math.floor(e/j),l=-f/2,m=this.boxes,n=c,o=d+1,p=l;do{if(o--,0>o)return m;p-=b[o].dist(n),n=b[o]}while(p>-e/2);for(var q=b[o].dist(b[o+1]),r=0;k>r;r++){for(var s=-e/2+r*j;s>p+q;){if(p+=q,o++,o+1>=b.length)return m;q=b[o].dist(b[o+1])}var t=s-p,u=b[o],v=b[o+1],w=v.sub(u)._unit()._mult(t)._add(u)._round(),x=Math.max(Math.abs(s-l)-j/2,0),y=e/2/x;a.emplaceBack(w.x,w.y,-f/2,-f/2,f/2,f/2,y,g,h,i,0,0,0,0,0)}return m},b.exports=d},{}],78:[function(a,b,c){"use strict";var d=a("point-geometry"),e=a("../data/extent"),f=a("grid-index"),g=a("../util/intersection_tests"),h=function(a,b,c){if("object"==typeof a){var d=a;c=b,a=d.angle,b=d.pitch,this.grid=new f(d.grid),this.ignoredGrid=new f(d.ignoredGrid)}else this.grid=new f(e,12,6),this.ignoredGrid=new f(e,12,0);this.minScale=.5,this.maxScale=2,this.angle=a,this.pitch=b;var g=Math.sin(a),h=Math.cos(a);if(this.rotationMatrix=[h,-g,g,h],this.reverseRotationMatrix=[h,g,-g,h],this.yStretch=1/Math.cos(b/180*Math.PI),this.yStretch=Math.pow(this.yStretch,1.3),this.collisionBoxArray=c,0===c.length){c.emplaceBack();var i=32767;c.emplaceBack(0,0,0,-i,0,i,i,0,0,0,0,0,0,0,0,0),c.emplaceBack(e,0,0,-i,0,i,i,0,0,0,0,0,0,0,0,0),c.emplaceBack(0,0,-i,0,i,0,i,0,0,0,0,0,0,0,0,0),c.emplaceBack(0,e,-i,0,i,0,i,0,0,0,0,0,0,0,0,0)}this.tempCollisionBox=c.get(0),this.edges=[c.get(1),c.get(2),c.get(3),c.get(4)]};h.prototype.serialize=function(a){var b=this.grid.toArrayBuffer(),c=this.ignoredGrid.toArrayBuffer();return a&&(a.push(b),a.push(c)),{angle:this.angle,pitch:this.pitch,grid:b,ignoredGrid:c}},h.prototype.placeCollisionFeature=function(a,b,c){for(var e=this,f=this.collisionBoxArray,g=this.minScale,h=this.rotationMatrix,i=this.yStretch,j=a.boxStartIndex;j<a.boxEndIndex;j++){var k=f.get(j),l=k.anchorPoint._matMult(h),m=l.x,n=l.y,o=m+k.x1,p=n+k.y1*i,q=m+k.x2,r=n+k.y2*i;if(k.bbox0=o,k.bbox1=p,k.bbox2=q,k.bbox3=r,!b)for(var s=e.grid.query(o,p,q,r),t=0;t<s.length;t++){var u=f.get(s[t]),v=u.anchorPoint._matMult(h);if(g=e.getPlacementScale(g,l,k,v,u),g>=e.maxScale)return g}if(c){var w;if(e.angle){var x=e.reverseRotationMatrix,y=new d(k.x1,k.y1).matMult(x),z=new d(k.x2,k.y1).matMult(x),A=new d(k.x1,k.y2).matMult(x),B=new d(k.x2,k.y2).matMult(x);w=e.tempCollisionBox,w.anchorPointX=k.anchorPoint.x,w.anchorPointY=k.anchorPoint.y,w.x1=Math.min(y.x,z.x,A.x,B.x),w.y1=Math.min(y.y,z.x,A.x,B.x),w.x2=Math.max(y.x,z.x,A.x,B.x),w.y2=Math.max(y.y,z.x,A.x,B.x),w.maxScale=k.maxScale}else w=k;for(var C=0;C<this.edges.length;C++){var D=e.edges[C];if(g=e.getPlacementScale(g,k.anchorPoint,w,D.anchorPoint,D),g>=e.maxScale)return g}}}return g},h.prototype.queryRenderedSymbols=function(a,b){var c={},e=[];if(0===a.length||0===this.grid.length&&0===this.ignoredGrid.length)return e;for(var f=this.collisionBoxArray,h=this.rotationMatrix,i=this.yStretch,j=[],k=1/0,l=1/0,m=-(1/0),n=-(1/0),o=0;o<a.length;o++)for(var p=a[o],q=0;q<p.length;q++){var r=p[q].matMult(h);k=Math.min(k,r.x),l=Math.min(l,r.y),m=Math.max(m,r.x),n=Math.max(n,r.y),j.push(r)}for(var s=this.grid.query(k,l,m,n),t=this.ignoredGrid.query(k,l,m,n),u=0;u<t.length;u++)s.push(t[u]);for(var v=Math.pow(2,Math.ceil(Math.log(b)/Math.LN2*10)/10),w=0;w<s.length;w++){var x=f.get(s[w]),y=x.sourceLayerIndex,z=x.featureIndex;if(void 0===c[y]&&(c[y]={}),!c[y][z]&&!(v<x.placementScale||v>x.maxScale)){var A=x.anchorPoint.matMult(h),B=A.x+x.x1/b,C=A.y+x.y1/b*i,D=A.x+x.x2/b,E=A.y+x.y2/b*i,F=[new d(B,C),new d(D,C),new d(D,E),new d(B,E)];g.polygonIntersectsPolygon(j,F)&&(c[y][z]=!0,e.push(s[w]))}}return e},h.prototype.getPlacementScale=function(a,b,c,d,e){var f=b.x-d.x,g=b.y-d.y,h=(e.x1-c.x2)/f,i=(e.x2-c.x1)/f,j=(e.y1-c.y2)*this.yStretch/g,k=(e.y2-c.y1)*this.yStretch/g;(isNaN(h)||isNaN(i))&&(h=i=1),(isNaN(j)||isNaN(k))&&(j=k=1);var l=Math.min(Math.max(h,i),Math.max(j,k)),m=e.maxScale,n=c.maxScale;return l>m&&(l=m),l>n&&(l=n),l>a&&l>=e.placementScale&&(a=l),a},h.prototype.insertCollisionFeature=function(a,b,c){for(var d=this,e=c?this.ignoredGrid:this.grid,f=this.collisionBoxArray,g=a.boxStartIndex;g<a.boxEndIndex;g++){var h=f.get(g);h.placementScale=b,b<d.maxScale&&e.insert(g,h.bbox0,h.bbox1,h.bbox2,h.bbox3)}},b.exports=h},{"../data/extent":11,"../util/intersection_tests":120,"grid-index":146,"point-geometry":194}],79:[function(a,b,c){"use strict";function d(a,b,c,d,f,g,h,i,j){var k=d?.6*g*h:0,l=Math.max(d?d.right-d.left:0,f?f.right-f.left:0),m=0===a[0].x||a[0].x===j||0===a[0].y||a[0].y===j;b/4>b-l*h&&(b=l*h+b/4);var n=2*g,o=m?b/2*i%b:(l/2+n)*h*i%b;return e(a,o,b,k,c,l*h,m,!1,j)}function e(a,b,c,d,i,j,k,l,m){for(var n=j/2,o=0,p=0;p<a.length-1;p++)o+=a[p].dist(a[p+1]);for(var q=0,r=b-c,s=[],t=0;t<a.length-1;t++){for(var u=a[t],v=a[t+1],w=u.dist(v),x=v.angleTo(u);q+w>r+c;){r+=c;var y=(r-q)/w,z=f(u.x,v.x,y),A=f(u.y,v.y,y);if(z>=0&&m>z&&A>=0&&m>A&&r-n>=0&&o>=r+n){var B=new g(z,A,x,t)._round();d&&!h(a,B,j,d,i)||s.push(B)}}q+=w}return l||s.length||k||(s=e(a,q/2,c,d,i,j,k,!0,m)),s}var f=a("../util/interpolate"),g=a("../symbol/anchor"),h=a("./check_max_angle");b.exports=d},{"../symbol/anchor":73,"../util/interpolate":119,"./check_max_angle":74}],80:[function(a,b,c){"use strict";var d=a("shelf-pack"),e=a("../util/util"),f=4,g=128,h=2048,i=function(){this.width=g,this.height=g,this.bin=new d(this.width,this.height),this.index={},this.ids={},this.data=new Uint8Array(this.width*this.height)};i.prototype.getGlyphs=function(){var a,b,c,d={};for(var e in this.ids)a=e.split("#"),b=a[0],c=a[1],d[b]||(d[b]=[]),d[b].push(c);return d},i.prototype.getRects=function(){var a,b,c,d=this,e={};for(var f in this.ids)a=f.split("#"),b=a[0],c=a[1],e[b]||(e[b]={}),e[b][c]=d.index[f];return e},i.prototype.addGlyph=function(a,b,c,d){var f=this;if(!c)return null;var g=b+"#"+c.id;if(this.index[g])return this.ids[g].indexOf(a)<0&&this.ids[g].push(a),this.index[g];if(!c.bitmap)return null;var h=c.width+2*d,i=c.height+2*d,j=1,k=h+2*j,l=i+2*j;k+=4-k%4,l+=4-l%4;var m=this.bin.packOne(k,l);if(m||(this.resize(),m=this.bin.packOne(k,l)),!m)return e.warnOnce("glyph bitmap overflow"),null;this.index[g]=m,this.ids[g]=[a];for(var n=this.data,o=c.bitmap,p=0;i>p;p++)for(var q=f.width*(m.y+p+j)+m.x+j,r=h*p,s=0;h>s;s++)n[q+s]=o[r+s];return this.dirty=!0,m},i.prototype.resize=function(){var a=this,b=this.width,c=this.height;if(!(b>=h||c>=h)){this.texture&&(this.gl&&this.gl.deleteTexture(this.texture),this.texture=null),this.width*=f,this.height*=f,this.bin.resize(this.width,this.height);for(var d=new ArrayBuffer(this.width*this.height),e=0;c>e;e++){var g=new Uint8Array(a.data.buffer,c*e,b),i=new Uint8Array(d,c*e*f,b);i.set(g)}this.data=new Uint8Array(d)}},i.prototype.bind=function(a){this.gl=a,this.texture?a.bindTexture(a.TEXTURE_2D,this.texture):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,null))},i.prototype.updateTexture=function(a){this.bind(a),this.dirty&&(a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data),this.dirty=!1)},b.exports=i},{"../util/util":127,"shelf-pack":197}],81:[function(a,b,c){"use strict";function d(a,b,c,d){return d=d||"abc",c.replace("{s}",d[a.length%d.length]).replace("{fontstack}",a).replace("{range}",b)}var e=a("../util/mapbox").normalizeGlyphsURL,f=a("../util/ajax"),g=a("../util/verticalize_punctuation"),h=a("../util/glyphs"),i=a("../symbol/glyph_atlas"),j=a("pbf"),k=function(a,b,c){var d=1;this.advance=a.advance,this.left=a.left-c-d,this.top=a.top+c+d,this.rect=b},l=function(a){this.url=a&&e(a),this.atlases={},this.stacks={},this.loading={}};l.prototype.getSimpleGlyphs=function(a,b,c,d){var e=this;void 0===this.stacks[a]&&(this.stacks[a]={}),void 0===this.atlases[a]&&(this.atlases[a]=new i);for(var f={},h=this.stacks[a],j=this.atlases[a],l=3,m={},n=0,o=function(b){var d=Math.floor(b/256);if(h[d]){var e=h[d].glyphs[b],g=j.addGlyph(c,a,e,l);e&&(f[b]=new k(e,g,l))}else void 0===m[d]&&(m[d]=[],n++),m[d].push(b)},p=0;p<b.length;p++){var q=b[p],r=String.fromCharCode(q);o(q),g.lookup[r]&&o(g.lookup[r].charCodeAt(0))}n||d(void 0,f,a);var s=function(b,g,h){if(!b)for(var i=e.stacks[a][g]=h.stacks[0],o=0;o<m[g].length;o++){var p=m[g][o],q=i.glyphs[p],r=j.addGlyph(c,a,q,l);q&&(f[p]=new k(q,r,l))}n--,n||d(void 0,f,a)};for(var t in m)e.loadRange(a,t,s)},l.prototype.loadRange=function(a,b,c){if(256*b>65535)return c("glyphs > 65535 not supported");void 0===this.loading[a]&&(this.loading[a]={});var e=this.loading[a];if(e[b])e[b].push(c);else{e[b]=[c];var g=256*b+"-"+(256*b+255),i=d(a,g,this.url);f.getArrayBuffer(i,function(a,c){for(var d=!a&&new h(new j(c)),f=0;f<e[b].length;f++)e[b][f](a,b,d);delete e[b]})}},l.prototype.getGlyphAtlas=function(a){return this.atlases[a]},b.exports=l},{"../symbol/glyph_atlas":80,"../util/ajax":107,"../util/glyphs":118,"../util/mapbox":123,"../util/verticalize_punctuation":129,pbf:193}],82:[function(a,b,c){"use strict";b.exports=function(a){function b(b){h.push(a[b]),i++}function c(a,b,c){var d=g[a];return delete g[a],g[b]=d,h[d].geometry[0].pop(),h[d].geometry[0]=h[d].geometry[0].concat(c[0]),d}function d(a,b,c){var d=f[b];return delete f[b],f[a]=d,h[d].geometry[0].shift(),h[d].geometry[0]=c[0].concat(h[d].geometry[0]),d}function e(a,b,c){var d=c?b[0][b[0].length-1]:b[0][0];return a+":"+d.x+":"+d.y}for(var f={},g={},h=[],i=0,j=0;j<a.length;j++){var k=a[j],l=k.geometry,m=k.text;if(m){var n=e(m,l),o=e(m,l,!0);if(n in g&&o in f&&g[n]!==f[o]){var p=d(n,o,l),q=c(n,o,h[p].geometry);delete f[n],delete g[o],g[e(m,h[q].geometry,!0)]=q,h[p].geometry=null}else n in g?c(n,o,l):o in f?d(n,o,l):(b(j),f[n]=i-1,g[o]=i-1)}else b(j)}return h.filter(function(a){return a.geometry})}},{}],83:[function(a,b,c){"use strict";function d(a,b,c,d,e,f,g,h,i,j,k){this.anchorPoint=a,this.tl=b,this.tr=c,this.bl=d,this.br=e,this.tex=f,this.anchorAngle=g,this.glyphAngle=h,this.minScale=i,this.maxScale=j,this.writingMode=k}function e(a,b,c,e,f,g,j,k,l){var m,n,o,p,q=b.image.rect,r=f.layout,s=1,t=b.left-s,u=t+q.w/b.image.pixelRatio,v=b.top-s,w=v+q.h/b.image.pixelRatio;if("none"!==r["icon-text-fit"]&&j){var x=u-t,y=w-v,z=r["text-size"]/24,A=j.left*z,B=j.right*z,C=j.top*z,D=j.bottom*z,E=B-A,F=D-C,G=r["icon-text-fit-padding"][0],H=r["icon-text-fit-padding"][1],I=r["icon-text-fit-padding"][2],J=r["icon-text-fit-padding"][3],K="width"===r["icon-text-fit"]?.5*(F-y):0,L="height"===r["icon-text-fit"]?.5*(E-x):0,M="width"===r["icon-text-fit"]||"both"===r["icon-text-fit"]?E:x,N="height"===r["icon-text-fit"]||"both"===r["icon-text-fit"]?F:y;m=new h(A+L-J,C+K-G),n=new h(A+L+H+M,C+K-G),o=new h(A+L+H+M,C+K+I+N),p=new h(A+L-J,C+K+I+N)}else m=new h(t,v),n=new h(u,v),o=new h(u,w),p=new h(t,w);var O=f.getLayoutValue("icon-rotate",k,l)*Math.PI/180;if(g){var P=e[a.segment];if(a.y===P.y&&a.x===P.x&&a.segment+1<e.length){var Q=e[a.segment+1];O+=Math.atan2(a.y-Q.y,a.x-Q.x)+Math.PI}else O+=Math.atan2(a.y-P.y,a.x-P.x)}if(O){var R=Math.sin(O),S=Math.cos(O),T=[S,-R,R,S];m=m.matMult(T),n=n.matMult(T),p=p.matMult(T),o=o.matMult(T)}return[new d(new h(a.x,a.y),m,n,p,o,b.image.rect,0,0,i,1/0)]}function f(a,b,c,e,f,j){for(var k=f.layout["text-rotate"]*Math.PI/180,l=f.layout["text-keep-upright"],m=b.positionedGlyphs,n=[],o=0;o<m.length;o++){var p=m[o],q=p.glyph;if(q){var r=q.rect;if(r){var s,t=(p.x+q.advance/2)*c,u=i;j?(s=[],u=g(s,a,t,e,a.segment,!0),l&&(u=Math.min(u,g(s,a,t,e,a.segment,!1)))):s=[{anchorPoint:new h(a.x,a.y),offset:0,angle:0,maxScale:1/0,minScale:i}];var v=p.x+q.left,w=p.y-q.top,x=v+r.w,y=w+r.h,z=new h(p.x,q.advance/2),A=new h(v,w),B=new h(x,w),C=new h(v,y),D=new h(x,y);0!==p.angle&&(A._sub(z)._rotate(p.angle)._add(z),B._sub(z)._rotate(p.angle)._add(z),C._sub(z)._rotate(p.angle)._add(z),D._sub(z)._rotate(p.angle)._add(z));for(var E=0;E<s.length;E++){var F=s[E],G=A,H=B,I=C,J=D;if(k){var K=Math.sin(k),L=Math.cos(k),M=[L,-K,K,L];G=G.matMult(M),H=H.matMult(M),I=I.matMult(M),J=J.matMult(M)}var N=Math.max(F.minScale,u),O=(a.angle+F.offset+2*Math.PI)%(2*Math.PI),P=(F.angle+F.offset+2*Math.PI)%(2*Math.PI);n.push(new d(F.anchorPoint,G,H,I,J,r,O,P,N,F.maxScale,b.writingMode))}}}}return n}function g(a,b,c,d,e,f){var g=!f;0>c&&(f=!f),f&&e++;var j=new h(b.x,b.y),k=d[e],l=1/0;c=Math.abs(c);for(var m=i;;){var n=j.dist(k),o=c/n,p=Math.atan2(k.y-j.y,k.x-j.x);if(f||(p+=Math.PI),a.push({anchorPoint:j,offset:g?Math.PI:0,minScale:o,maxScale:l,angle:(p+2*Math.PI)%(2*Math.PI)}),m>=o)break;for(j=k;j.equals(k);)if(e+=f?1:-1,k=d[e],!k)return o;var q=k.sub(j)._unit();j=j.sub(q._mult(n)),l=o}return m}var h=a("point-geometry");b.exports={getIconQuads:e,getGlyphQuads:f,SymbolQuad:d};var i=.5},{"point-geometry":194}],84:[function(a,b,c){"use strict";var d=a("../util/token");b.exports=function(a,b){var c=d(a.properties,b["text-field"]);if(c){c=c.toString();var e=b["text-transform"];return"uppercase"===e?c=c.toLocaleUpperCase():"lowercase"===e&&(c=c.toLocaleLowerCase()),c}}},{"../util/token":126}],85:[function(a,b,c){"use strict";function d(a,b,c,d,e){this.codePoint=a,this.x=b,this.y=c,this.glyph=d||null,this.angle=e}function e(a,b,c,d,e,f,g){this.positionedGlyphs=a,this.text=b,this.top=c,this.bottom=d,this.left=e,this.right=f,this.writingMode=g}function f(a,b){for(var c=[],d=0,e=0,f=b;e<f.length;e+=1){var g=f[e];c.push(a.substring(d,g)),d=g}return d<a.length&&c.push(a.substring(d,a.length)),c}function g(a,b,c,d,g,h,i,j,k,l,o){a=a.trim(),o===u.vertical&&(a=t(a));var p=[],q=new e(p,a,k[1],k[1],k[0],k[0],o),r=o===u.horizontal&&c?f(a,m(a,j,c,b)):[a];return n(q,b,r,d,g,h,i,k,o,j,l),!!p.length&&q}function h(a,b,c,d){var e=0;for(var f in a){var g=d[a.charCodeAt(f)];g&&(e+=g.advance+b)}var h=Math.max(1,Math.ceil(e/c));return e/h}function i(a,b,c,d){var e=Math.pow(a-b,2);return d?b>a?e/2:2*e:e+Math.abs(c)*c}function j(a,b){var c=0;return 10===a&&(c-=1e4),40!==a&&65288!==a||(c+=50),41!==b&&65289!==b||(c+=50),c}function k(a,b,c,d,e,f){for(var g=null,h=i(b,c,e,f),j=0,k=d;j<k.length;j+=1){var l=k[j],m=b-l.x,n=i(m,c,e,f)+l.badness;h>=n&&(g=l,h=n)}return{index:a,x:b,priorBreak:g,badness:h}}function l(a){return a?l(a.priorBreak).concat(a.index):[]}function m(a,b,c,d){if(!c)return[];if(!a)return[];for(var e=[],f=h(a,b,c,d),g=0,i=0;i<a.length;i++){var m=a.charCodeAt(i),n=d[m];n&&!w[m]&&(g+=n.advance+b),i<a.length-1&&(x[m]||s.charAllowsIdeographicBreaking(m))&&e.push(k(i+1,g,f,e,j(m,a.charCodeAt(i+1)),!1))}return l(k(a.length,g,f,e,0,!0))}function n(a,b,c,e,f,g,h,i,j,k,l){var m=-17,n=0,q=m,r=0,t=a.positionedGlyphs;for(var v in c){var w=c[v].trim();if(w.length){for(var x=t.length,y=0;y<w.length;y++){var z=w.charCodeAt(y),A=b[z];A&&(s.charHasUprightVerticalOrientation(z)&&j!==u.horizontal?(t.push(new d(z,n,0,A,-Math.PI/2)),n+=l+k):(t.push(new d(z,n,q,A,0)),n+=A.advance+k))}if(t.length!==x){var B=n-k;r=Math.max(B,r),o(t,b,x,t.length-1,h)}n=0,q+=e}else q+=e}p(t,h,f,g,r,e,c.length,i);var C=c.length*e;a.top+=-g*C,a.bottom=a.top+C,a.left+=-f*r,a.right=a.left+r}function o(a,b,c,d,e){if(e)for(var f=b[a[d].codePoint].advance,g=(a[d].x+f)*e,h=c;d>=h;h++)a[h].x-=g}function p(a,b,c,d,e,f,g,h){for(var i=(b-c)*e+h[0],j=(-d*g+.5)*f+h[1],k=0;k<a.length;k++)a[k].x+=i,a[k].y+=j}function q(a,b){if(!a||!a.rect)return null;var c=b[0],d=b[1],e=c-a.width/2,f=e+a.width,g=d-a.height/2,h=g+a.height;return new r(a,g,h,e,f)}function r(a,b,c,d,e){this.image=a,this.top=b,this.bottom=c,this.left=d,this.right=e}var s=a("../util/script_detection"),t=a("../util/verticalize_punctuation"),u={horizontal:1,vertical:2};b.exports={shapeText:g,shapeIcon:q,WritingMode:u};var v=10,w={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},x={32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};x[v]=!0},{"../util/script_detection":124,"../util/verticalize_punctuation":129}],86:[function(a,b,c){"use strict";function d(a,b,c,d,e,f,g,h,i,j,k){var l,m,n=d*b+c,o=h*f+g;if(k)for(o-=f,m=-1;j>=m;m++,n=((m+j)%j+d)*b+c,o+=f)for(l=-1;i>=l;l++)e[o+l]=a[n+(l+i)%i];else for(m=0;j>m;m++,n+=b,o+=f)for(l=0;i>l;l++)e[o+l]=a[n+l]}var e=a("shelf-pack"),f=a("../util/browser"),g=a("../util/util"),h=function(a,b,c,d,e){this.rect=a,this.width=b,this.height=c,this.sdf=d,this.pixelRatio=e},i=function(a,b){this.width=a,this.height=b,this.bin=new e(a,b),this.images={},this.data=!1,this.texture=0,this.filter=0,this.pixelRatio=1,this.dirty=!0};i.prototype.allocateImage=function(a,b){a/=this.pixelRatio,b/=this.pixelRatio;var c=2,d=a+c+(4-(a+c)%4),e=b+c+(4-(b+c)%4),f=this.bin.packOne(d,e);return f?f:(g.warnOnce("SpriteAtlas out of space."),null)},i.prototype.getImage=function(a,b){if(this.images[a])return this.images[a];if(!this.sprite)return null;var c=this.sprite.getSpritePosition(a);if(!c.width||!c.height)return null;var d=this.allocateImage(c.width,c.height);if(!d)return null;var e=new h(d,c.width/c.pixelRatio,c.height/c.pixelRatio,c.sdf,c.pixelRatio/this.pixelRatio);return this.images[a]=e,this.copy(d,c,b),e},i.prototype.getPosition=function(a,b){var c=this.getImage(a,b),d=c&&c.rect;if(!d)return null;var e=c.width*c.pixelRatio,f=c.height*c.pixelRatio,g=1;return{size:[c.width,c.height],tl:[(d.x+g)/this.width,(d.y+g)/this.height],br:[(d.x+g+e)/this.width,(d.y+g+f)/this.height]}},i.prototype.allocate=function(){var a=this;if(!this.data){var b=Math.floor(this.width*this.pixelRatio),c=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(b*c);for(var d=0;d<this.data.length;d++)a.data[d]=0}},i.prototype.copy=function(a,b,c){if(this.sprite.imgData){var e=new Uint32Array(this.sprite.imgData.buffer);this.allocate();var f=this.data,g=1;d(e,this.sprite.width,b.x,b.y,f,this.width*this.pixelRatio,(a.x+g)*this.pixelRatio,(a.y+g)*this.pixelRatio,b.width,b.height,c),this.dirty=!0}},i.prototype.setSprite=function(a){a&&(this.pixelRatio=f.devicePixelRatio>1?2:1,this.canvas&&(this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio)),this.sprite=a},i.prototype.addIcons=function(a,b){for(var c=this,d=0;d<a.length;d++)c.getImage(a[d]);b(null,this.images)},i.prototype.bind=function(a,b){var c=!1;this.texture?a.bindTexture(a.TEXTURE_2D,this.texture):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),c=!0);var d=b?a.LINEAR:a.NEAREST;d!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d),this.filter=d),this.dirty&&(this.allocate(),c?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1)},b.exports=i},{"../util/browser":108,"../util/util":127,"shelf-pack":197}],87:[function(a,b,c){"use strict";var d=a("../util/struct_array"),e=a("point-geometry"),f=d({members:[{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"glyphQuadStartIndex"},{type:"Uint16",name:"glyphQuadEndIndex"},{type:"Uint16",name:"iconQuadStartIndex"},{type:"Uint16",name:"iconQuadEndIndex"},{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int8",name:"index"},{type:"Uint8",name:"writingModes"}]});Object.defineProperty(f.prototype.StructType.prototype,"anchorPoint",{get:function(){return new e(this.anchorPointX,this.anchorPointY)}}),b.exports=f},{"../util/struct_array":125,"point-geometry":194}],88:[function(a,b,c){"use strict";var d=a("../util/struct_array"),e=a("point-geometry"),f=a("./quads").SymbolQuad,g=d({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"tlX"},{type:"Float32",name:"tlY"},{type:"Float32",name:"trX"},{type:"Float32",name:"trY"},{type:"Float32",name:"blX"},{type:"Float32",name:"blY"},{type:"Float32",name:"brX"},{type:"Float32",name:"brY"},{type:"Int16",name:"texH"},{type:"Int16",name:"texW"},{type:"Int16",name:"texX"},{type:"Int16",name:"texY"},{type:"Float32",name:"anchorAngle"},{type:"Float32",name:"glyphAngle"},{type:"Float32",name:"maxScale"},{type:"Float32",name:"minScale"},{type:"Uint8",name:"writingMode"}]});Object.defineProperty(g.prototype.StructType.prototype,"anchorPoint",{get:function(){return new e(this.anchorPointX,this.anchorPointY)}}),Object.defineProperty(g.prototype.StructType.prototype,"SymbolQuad",{get:function(){return new f(this.anchorPoint,new e(this.tlX,this.tlY),new e(this.trX,this.trY),new e(this.blX,this.blY),new e(this.brX,this.brY),{x:this.texX,y:this.texY,h:this.texH,w:this.texW,height:this.texH,width:this.texW},this.anchorAngle,this.glyphAngle,this.minScale,this.maxScale,this.writingMode)}}),b.exports=g},{"../util/struct_array":125,"./quads":83,"point-geometry":194}],89:[function(a,b,c){"use strict";var d=a("../util/dom"),e=a("point-geometry"),f={scrollZoom:a("./handler/scroll_zoom"),boxZoom:a("./handler/box_zoom"),dragRotate:a("./handler/drag_rotate"),dragPan:a("./handler/drag_pan"),keyboard:a("./handler/keyboard"),
doubleClickZoom:a("./handler/dblclick_zoom"),touchZoomRotate:a("./handler/touch_zoom_rotate")};b.exports=function(a,b){function c(a){r("mouseout",a)}function g(b){a.stop(),w=d.mousePos(t,b),r("mousedown",b),v=!0}function h(b){var c=a.dragRotate&&a.dragRotate.isActive();u&&!c&&r("contextmenu",u),u=null,v=!1,r("mouseup",b)}function i(b){if(!(a.dragPan&&a.dragPan.isActive()||a.dragRotate&&a.dragRotate.isActive())){for(var c=b.toElement||b.target;c&&c!==t;)c=c.parentNode;c===t&&r("mousemove",b)}}function j(b){a.stop(),s("touchstart",b),!b.touches||b.touches.length>1||(x?(clearTimeout(x),x=null,r("dblclick",b)):x=setTimeout(n,300))}function k(a){s("touchmove",a)}function l(a){s("touchend",a)}function m(a){s("touchcancel",a)}function n(){x=null}function o(a){var b=d.mousePos(t,a);b.equals(w)&&r("click",a)}function p(a){r("dblclick",a),a.preventDefault()}function q(b){var c=a.dragRotate&&a.dragRotate.isActive();v||c?v&&(u=b):r("contextmenu",b),b.preventDefault()}function r(b,c){var e=d.mousePos(t,c);return a.fire(b,{lngLat:a.unproject(e),point:e,originalEvent:c})}function s(b,c){var f=d.touchPos(t,c),g=f.reduce(function(a,b,c,d){return a.add(b.div(d.length))},new e(0,0));return a.fire(b,{lngLat:a.unproject(g),point:g,lngLats:f.map(function(b){return a.unproject(b)},this),points:f,originalEvent:c})}var t=a.getCanvasContainer(),u=null,v=!1,w=null,x=null;for(var y in f)a[y]=new f[y](a,b),b.interactive&&b[y]&&a[y].enable();t.addEventListener("mouseout",c,!1),t.addEventListener("mousedown",g,!1),t.addEventListener("mouseup",h,!1),t.addEventListener("mousemove",i,!1),t.addEventListener("touchstart",j,!1),t.addEventListener("touchend",l,!1),t.addEventListener("touchmove",k,!1),t.addEventListener("touchcancel",m,!1),t.addEventListener("click",o,!1),t.addEventListener("dblclick",p,!1),t.addEventListener("contextmenu",q,!1)}},{"../util/dom":115,"./handler/box_zoom":95,"./handler/dblclick_zoom":96,"./handler/drag_pan":97,"./handler/drag_rotate":98,"./handler/keyboard":99,"./handler/scroll_zoom":100,"./handler/touch_zoom_rotate":101,"point-geometry":194}],90:[function(a,b,c){"use strict";var d=a("../util/util"),e=a("../util/interpolate"),f=a("../util/browser"),g=a("../geo/lng_lat"),h=a("../geo/lng_lat_bounds"),i=a("point-geometry"),j=a("../util/evented"),k=function(a){function b(b,c){a.call(this),this.transform=b,this._bearingSnap=c.bearingSnap}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.getCenter=function(){return this.transform.center},b.prototype.setCenter=function(a,b){return this.jumpTo({center:a},b),this},b.prototype.panBy=function(a,b,c){return this.panTo(this.transform.center,d.extend({offset:i.convert(a).mult(-1)},b),c),this},b.prototype.panTo=function(a,b,c){return this.easeTo(d.extend({center:a},b),c)},b.prototype.getZoom=function(){return this.transform.zoom},b.prototype.setZoom=function(a,b){return this.jumpTo({zoom:a},b),this},b.prototype.zoomTo=function(a,b,c){return this.easeTo(d.extend({zoom:a},b),c)},b.prototype.zoomIn=function(a,b){return this.zoomTo(this.getZoom()+1,a,b),this},b.prototype.zoomOut=function(a,b){return this.zoomTo(this.getZoom()-1,a,b),this},b.prototype.getBearing=function(){return this.transform.bearing},b.prototype.setBearing=function(a,b){return this.jumpTo({bearing:a},b),this},b.prototype.rotateTo=function(a,b,c){return this.easeTo(d.extend({bearing:a},b),c)},b.prototype.resetNorth=function(a,b){return this.rotateTo(0,d.extend({duration:1e3},a),b),this},b.prototype.snapToNorth=function(a,b){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,b):this},b.prototype.getPitch=function(){return this.transform.pitch},b.prototype.setPitch=function(a,b){return this.jumpTo({pitch:a},b),this},b.prototype.fitBounds=function(a,b,c){b=d.extend({padding:0,offset:[0,0],maxZoom:this.getMaxZoom()},b),a=h.convert(a);var e=i.convert(b.offset),f=this.transform,g=f.project(a.getNorthWest()),j=f.project(a.getSouthEast()),k=j.sub(g),l=(f.width-2*b.padding-2*Math.abs(e.x))/k.x,m=(f.height-2*b.padding-2*Math.abs(e.y))/k.y;return b.center=f.unproject(g.add(j).div(2)),b.zoom=Math.min(f.scaleZoom(f.scale*Math.min(l,m)),b.maxZoom),b.bearing=0,b.linear?this.easeTo(b,c):this.flyTo(b,c)},b.prototype.jumpTo=function(a,b){this.stop();var c=this.transform,d=!1,e=!1,f=!1;return"zoom"in a&&c.zoom!==+a.zoom&&(d=!0,c.zoom=+a.zoom),"center"in a&&(c.center=g.convert(a.center)),"bearing"in a&&c.bearing!==+a.bearing&&(e=!0,c.bearing=+a.bearing),"pitch"in a&&c.pitch!==+a.pitch&&(f=!0,c.pitch=+a.pitch),this.fire("movestart",b).fire("move",b),d&&this.fire("zoomstart",b).fire("zoom",b).fire("zoomend",b),e&&this.fire("rotate",b),f&&this.fire("pitch",b),this.fire("moveend",b)},b.prototype.easeTo=function(a,b){var c=this;this.stop(),a=d.extend({offset:[0,0],duration:500,easing:d.ease},a);var f,h,j=this.transform,k=i.convert(a.offset),l=this.getZoom(),m=this.getBearing(),n=this.getPitch(),o="zoom"in a?+a.zoom:l,p="bearing"in a?this._normalizeBearing(a.bearing,m):m,q="pitch"in a?+a.pitch:n;"center"in a?(f=g.convert(a.center),h=j.centerPoint.add(k)):"around"in a?(f=g.convert(a.around),h=j.locationPoint(f)):(h=j.centerPoint.add(k),f=j.pointLocation(h));var r=j.locationPoint(f);return a.animate===!1&&(a.duration=0),this.zooming=o!==l,this.rotating=m!==p,this.pitching=q!==n,a.smoothEasing&&0!==a.duration&&(a.easing=this._smoothOutEasing(a.duration)),a.noMoveStart||this.fire("movestart",b),this.zooming&&this.fire("zoomstart",b),clearTimeout(this._onEaseEnd),this._ease(function(a){this.zooming&&(j.zoom=e(l,o,a)),this.rotating&&(j.bearing=e(m,p,a)),this.pitching&&(j.pitch=e(n,q,a)),j.setLocationAtPoint(f,r.add(h.sub(r)._mult(a))),this.fire("move",b),this.zooming&&this.fire("zoom",b),this.rotating&&this.fire("rotate",b),this.pitching&&this.fire("pitch",b)},function(){a.delayEndEvents?c._onEaseEnd=setTimeout(c._easeToEnd.bind(c,b),a.delayEndEvents):c._easeToEnd(b)},a),this},b.prototype._easeToEnd=function(a){var b=this.zooming;this.zooming=!1,this.rotating=!1,this.pitching=!1,b&&this.fire("zoomend",a),this.fire("moveend",a)},b.prototype.flyTo=function(a,b){function c(a){var b=(y*y-x*x+(a?-1:1)*C*C*z*z)/(2*(a?y:x)*C*z);return Math.log(Math.sqrt(b*b+1)-b)}function f(a){return(Math.exp(a)-Math.exp(-a))/2}function h(a){return(Math.exp(a)+Math.exp(-a))/2}function j(a){return f(a)/h(a)}this.stop(),a=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},a);var k=this.transform,l=i.convert(a.offset),m=this.getZoom(),n=this.getBearing(),o=this.getPitch(),p="center"in a?g.convert(a.center):this.getCenter(),q="zoom"in a?+a.zoom:m,r="bearing"in a?this._normalizeBearing(a.bearing,n):n,s="pitch"in a?+a.pitch:o;Math.abs(k.center.lng)+Math.abs(p.lng)>180&&(k.center.lng>0&&p.lng<0?p.lng+=360:k.center.lng<0&&p.lng>0&&(p.lng-=360));var t=k.zoomScale(q-m),u=k.point,v="center"in a?k.project(p).sub(l.div(t)):u,w=a.curve,x=Math.max(k.width,k.height),y=x/t,z=v.sub(u).mag();if("minZoom"in a){var A=d.clamp(Math.min(a.minZoom,m,q),k.minZoom,k.maxZoom),B=x/k.zoomScale(A-m);w=Math.sqrt(B/z*2)}var C=w*w,D=c(0),E=function(a){return h(D)/h(D+w*a)},F=function(a){return x*((h(D)*j(D+w*a)-f(D))/C)/z},G=(c(1)-D)/w;if(Math.abs(z)<1e-6){if(Math.abs(x-y)<1e-6)return this.easeTo(a);var H=x>y?-1:1;G=Math.abs(Math.log(y/x))/w,F=function(){return 0},E=function(a){return Math.exp(H*w*a)}}if("duration"in a)a.duration=+a.duration;else{var I="screenSpeed"in a?+a.screenSpeed/w:+a.speed;a.duration=1e3*G/I}return this.zooming=!0,n!==r&&(this.rotating=!0),o!==s&&(this.pitching=!0),this.fire("movestart",b),this.fire("zoomstart",b),this._ease(function(a){var c=a*G,d=F(c),f=1/E(c);k.zoom=m+k.scaleZoom(f),k.center=k.unproject(u.add(v.sub(u).mult(d)).mult(f)),this.rotating&&(k.bearing=e(n,r,a)),this.pitching&&(k.pitch=e(o,s,a)),this.fire("move",b),this.fire("zoom",b),this.rotating&&this.fire("rotate",b),this.pitching&&this.fire("pitch",b)},function(){this.zooming=!1,this.rotating=!1,this.pitching=!1,this.fire("zoomend",b),this.fire("moveend",b)},a),this},b.prototype.isEasing=function(){return!!this._abortFn},b.prototype.stop=function(){return this._abortFn&&(this._abortFn(),this._finishEase()),this},b.prototype._ease=function(a,b,c){this._finishFn=b,this._abortFn=f.timed(function(b){a.call(this,c.easing(b)),1===b&&this._finishEase()},c.animate===!1?0:c.duration,this)},b.prototype._finishEase=function(){delete this._abortFn;var a=this._finishFn;delete this._finishFn,a.call(this)},b.prototype._normalizeBearing=function(a,b){a=d.wrap(a,-180,180);var c=Math.abs(a-b);return Math.abs(a-360-b)<c&&(a-=360),Math.abs(a+360-b)<c&&(a+=360),a},b.prototype._smoothOutEasing=function(a){var b=d.ease;if(this._prevEase){var c=this._prevEase,e=(Date.now()-c.start)/c.duration,f=c.easing(e+.01)-c.easing(e),g=.27/Math.sqrt(f*f+1e-4)*.01,h=Math.sqrt(.0729-g*g);b=d.bezier(g,h,.25,1)}return this._prevEase={start:(new Date).getTime(),duration:a,easing:b},b},b}(j);b.exports=k},{"../geo/lng_lat":19,"../geo/lng_lat_bounds":20,"../util/browser":108,"../util/evented":116,"../util/interpolate":119,"../util/util":127,"point-geometry":194}],91:[function(a,b,c){"use strict";var d=a("../../util/dom"),e=a("../../util/util"),f=function(a){this.options=a,e.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};f.prototype.getDefaultPosition=function(){return"bottom-right"},f.prototype.onAdd=function(a){var b=this.options&&this.options.compact;return this._map=a,this._container=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),b&&this._container.classList.add("compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("data",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===b&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},f.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("data",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},f.prototype._updateEditLink=function(){if(this._editLink||(this._editLink=this._container.querySelector(".mapbox-improve-map")),this._editLink){var a=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+a.lng+"/"+a.lat+"/"+Math.round(this._map.getZoom()+1)}},f.prototype._updateData=function(a){"source"===a.dataType&&(this._updateAttributions(),this._updateEditLink())},f.prototype._updateAttributions=function(){if(this._map.style){var a=[],b=this._map.style.sourceCaches;for(var c in b){var d=b[c].getSource();d.attribution&&a.indexOf(d.attribution)<0&&a.push(d.attribution)}a.sort(function(a,b){return a.length-b.length}),a=a.filter(function(b,c){for(var d=c+1;d<a.length;d++)if(a[d].indexOf(b)>=0)return!1;return!0}),this._container.innerHTML=a.join(" | "),this._editLink=null}},f.prototype._updateCompact=function(){var a=this._map.getCanvasContainer().offsetWidth<=640;this._container.classList[a?"add":"remove"]("compact")},b.exports=f},{"../../util/dom":115,"../../util/util":127}],92:[function(a,b,c){"use strict";function d(a){void 0!==e?a(e):void 0!==h.navigator.permissions?h.navigator.permissions.query({name:"geolocation"}).then(function(b){e="denied"!==b.state,a(e)}):(e=!!h.navigator.geolocation,a(e))}var e,f=a("../../util/evented"),g=a("../../util/dom"),h=a("../../util/window"),i=a("../../util/util"),j={enableHighAccuracy:!1,timeout:6e3},k="mapboxgl-ctrl",l=function(a){function b(b){a.call(this),this.options=b||{},i.bindAll(["_onSuccess","_onError","_finish","_setupUI"],this)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.onAdd=function(a){return this._map=a,this._container=g.create("div",k+" "+k+"-group"),d(this._setupUI),this._container},b.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=void 0},b.prototype._onSuccess=function(a){this._map.jumpTo({center:[a.coords.longitude,a.coords.latitude],zoom:17,bearing:0,pitch:0}),this.fire("geolocate",a),this._finish()},b.prototype._onError=function(a){this.fire("error",a),this._finish()},b.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},b.prototype._setupUI=function(a){a!==!1&&(this._container.addEventListener("contextmenu",function(a){return a.preventDefault()}),this._geolocateButton=g.create("button",k+"-icon "+k+"-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.watchPosition&&this._geolocateButton.setAttribute("aria-pressed",!1),this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this)))},b.prototype._onClickGeolocate=function(){var a=i.extend(j,this.options&&this.options.positionOptions||{});this.options.watchPosition?void 0!==this._geolocationWatchID?(this._geolocateButton.classList.remove("watching"),this._geolocateButton.setAttribute("aria-pressed",!1),h.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0):(this._geolocateButton.classList.add("watching"),this._geolocateButton.setAttribute("aria-pressed",!0),this._geolocationWatchID=h.navigator.geolocation.watchPosition(this._onSuccess,this._onError,a)):(h.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,a),this._timeoutId=setTimeout(this._finish,1e4))},b}(f);b.exports=l},{"../../util/dom":115,"../../util/evented":116,"../../util/util":127,"../../util/window":110}],93:[function(a,b,c){"use strict";function d(a){return new f.MouseEvent(a.type,{button:2,buttons:2,bubbles:!0,cancelable:!0,detail:a.detail,view:a.view,screenX:a.screenX,screenY:a.screenY,clientX:a.clientX,clientY:a.clientY,movementX:a.movementX,movementY:a.movementY,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,altKey:a.altKey,metaKey:a.metaKey})}var e=a("../../util/dom"),f=a("../../util/window"),g=a("../../util/util"),h="mapboxgl-ctrl",i=function(){g.bindAll(["_rotateCompassArrow"],this)};i.prototype._rotateCompassArrow=function(){var a="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=a},i.prototype.onAdd=function(a){return this._map=a,this._container=e.create("div",h+" "+h+"-group",a.getContainer()),this._container.addEventListener("contextmenu",this._onContextMenu.bind(this)),this._zoomInButton=this._createButton(h+"-icon "+h+"-zoom-in","Zoom In",a.zoomIn.bind(a)),this._zoomOutButton=this._createButton(h+"-icon "+h+"-zoom-out","Zoom Out",a.zoomOut.bind(a)),this._compass=this._createButton(h+"-icon "+h+"-compass","Reset North",a.resetNorth.bind(a)),this._compassArrow=e.create("span","arrow",this._compass),this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._container},i.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("rotate",this._rotateCompassArrow),this._map=void 0},i.prototype._onContextMenu=function(a){a.preventDefault()},i.prototype._onCompassDown=function(a){0===a.button&&(e.disableDrag(),f.document.addEventListener("mousemove",this._onCompassMove),f.document.addEventListener("mouseup",this._onCompassUp),this._map.getCanvasContainer().dispatchEvent(d(a)),a.stopPropagation())},i.prototype._onCompassMove=function(a){0===a.button&&(this._map.getCanvasContainer().dispatchEvent(d(a)),a.stopPropagation())},i.prototype._onCompassUp=function(a){0===a.button&&(f.document.removeEventListener("mousemove",this._onCompassMove),f.document.removeEventListener("mouseup",this._onCompassUp),e.enableDrag(),this._map.getCanvasContainer().dispatchEvent(d(a)),a.stopPropagation())},i.prototype._createButton=function(a,b,c){var d=e.create("button",a,this._container);return d.type="button",d.setAttribute("aria-label",b),d.addEventListener("click",function(){c()}),d},b.exports=i},{"../../util/dom":115,"../../util/util":127,"../../util/window":110}],94:[function(a,b,c){"use strict";function d(a,b,c){var d=c&&c.maxWidth||100,g=a._container.clientHeight/2,h=f(a.unproject([0,g]),a.unproject([d,g]));if(c&&"imperial"===c.unit){var i=3.2808*h;if(i>5280){var j=i/5280;e(b,d,j,"mi")}else e(b,d,i,"ft")}else e(b,d,h,"m")}function e(a,b,c,d){var e=g(c),f=e/c;"m"===d&&e>=1e3&&(e/=1e3,d="km"),a.style.width=b*f+"px",a.innerHTML=e+d}function f(a,b){var c=6371e3,d=Math.PI/180,e=a.lat*d,f=b.lat*d,g=Math.sin(e)*Math.sin(f)+Math.cos(e)*Math.cos(f)*Math.cos((b.lng-a.lng)*d),h=c*Math.acos(Math.min(g,1));return h}function g(a){var b=Math.pow(10,(""+Math.floor(a)).length-1),c=a/b;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:1,b*c}var h=a("../../util/dom"),i=a("../../util/util"),j=function(a){this.options=a,i.bindAll(["_onMove"],this)};j.prototype.getDefaultPosition=function(){return"bottom-left"},j.prototype._onMove=function(){d(this._map,this._container,this.options)},j.prototype.onAdd=function(a){return this._map=a,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",a.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},j.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("move",this._onMove),this._map=void 0},b.exports=j},{"../../util/dom":115,"../../util/util":127}],95:[function(a,b,c){"use strict";var d=a("../../util/dom"),e=a("../../geo/lng_lat_bounds"),f=a("../../util/util"),g=a("../../util/window"),h=function(a){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),f.bindAll(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};h.prototype.isEnabled=function(){return!!this._enabled},h.prototype.isActive=function(){return!!this._active},h.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onMouseDown,!1),this._enabled=!0)},h.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onMouseDown),this._enabled=!1)},h.prototype._onMouseDown=function(a){a.shiftKey&&0===a.button&&(g.document.addEventListener("mousemove",this._onMouseMove,!1),g.document.addEventListener("keydown",this._onKeyDown,!1),g.document.addEventListener("mouseup",this._onMouseUp,!1),d.disableDrag(),this._startPos=d.mousePos(this._el,a),this._active=!0)},h.prototype._onMouseMove=function(a){var b=this._startPos,c=d.mousePos(this._el,a);this._box||(this._box=d.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));var e=Math.min(b.x,c.x),f=Math.max(b.x,c.x),g=Math.min(b.y,c.y),h=Math.max(b.y,c.y);d.setTransform(this._box,"translate("+e+"px,"+g+"px)"),this._box.style.width=f-e+"px",this._box.style.height=h-g+"px"},h.prototype._onMouseUp=function(a){if(0===a.button){var b=this._startPos,c=d.mousePos(this._el,a),f=(new e).extend(this._map.unproject(b)).extend(this._map.unproject(c));this._finish(),b.x===c.x&&b.y===c.y?this._fireEvent("boxzoomcancel",a):this._map.fitBounds(f,{linear:!0}).fire("boxzoomend",{originalEvent:a,boxZoomBounds:f})}},h.prototype._onKeyDown=function(a){27===a.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",a))},h.prototype._finish=function(){this._active=!1,g.document.removeEventListener("mousemove",this._onMouseMove,!1),g.document.removeEventListener("keydown",this._onKeyDown,!1),g.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.parentNode.removeChild(this._box),this._box=null),d.enableDrag()},h.prototype._fireEvent=function(a,b){return this._map.fire(a,{originalEvent:b})},b.exports=h},{"../../geo/lng_lat_bounds":20,"../../util/dom":115,"../../util/util":127,"../../util/window":110}],96:[function(a,b,c){"use strict";var d=function(a){this._map=a,this._onDblClick=this._onDblClick.bind(this)};d.prototype.isEnabled=function(){return!!this._enabled},d.prototype.enable=function(){this.isEnabled()||(this._map.on("dblclick",this._onDblClick),this._enabled=!0)},d.prototype.disable=function(){this.isEnabled()&&(this._map.off("dblclick",this._onDblClick),this._enabled=!1)},d.prototype._onDblClick=function(a){this._map.zoomTo(this._map.getZoom()+(a.originalEvent.shiftKey?-1:1),{around:a.lngLat},a)},b.exports=d},{}],97:[function(a,b,c){"use strict";var d=a("../../util/dom"),e=a("../../util/util"),f=a("../../util/window"),g=.3,h=e.bezier(0,0,g,1),i=1400,j=2500,k=function(a){this._map=a,this._el=a.getCanvasContainer(),e.bindAll(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp"],this)};k.prototype.isEnabled=function(){return!!this._enabled},k.prototype.isActive=function(){return!!this._active},k.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._el.addEventListener("touchstart",this._onDown),this._enabled=!0)},k.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown),this._enabled=!1)},k.prototype._onDown=function(a){this._ignoreEvent(a)||this.isActive()||(a.touches?(f.document.addEventListener("touchmove",this._onMove),f.document.addEventListener("touchend",this._onTouchEnd)):(f.document.addEventListener("mousemove",this._onMove),f.document.addEventListener("mouseup",this._onMouseUp)),this._active=!1,this._startPos=this._pos=d.mousePos(this._el,a),this._inertia=[[Date.now(),this._pos]])},k.prototype._onMove=function(a){if(!this._ignoreEvent(a)){this.isActive()||(this._active=!0,this._fireEvent("dragstart",a),this._fireEvent("movestart",a));var b=d.mousePos(this._el,a),c=this._map;c.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),b]),c.transform.setLocationAtPoint(c.transform.pointLocation(this._pos),b),this._fireEvent("drag",a),this._fireEvent("move",a),this._pos=b,a.preventDefault()}},k.prototype._onUp=function(a){var b=this;if(this.isActive()){this._active=!1,this._fireEvent("dragend",a),this._drainInertiaBuffer();var c=function(){return b._fireEvent("moveend",a)},d=this._inertia;if(d.length<2)return void c();var e=d[d.length-1],f=d[0],k=e[1].sub(f[1]),l=(e[0]-f[0])/1e3;if(0===l||e[1].equals(f[1]))return void c();var m=k.mult(g/l),n=m.mag();n>i&&(n=i,m._unit()._mult(n));var o=n/(j*g),p=m.mult(-o/2);this._map.panBy(p,{duration:1e3*o,easing:h,noMoveStart:!0},{originalEvent:a})}},k.prototype._onMouseUp=function(a){this._ignoreEvent(a)||(this._onUp(a),f.document.removeEventListener("mousemove",this._onMove),f.document.removeEventListener("mouseup",this._onMouseUp))},k.prototype._onTouchEnd=function(a){this._ignoreEvent(a)||(this._onUp(a),f.document.removeEventListener("touchmove",this._onMove),f.document.removeEventListener("touchend",this._onTouchEnd))},k.prototype._fireEvent=function(a,b){return this._map.fire(a,{originalEvent:b})},k.prototype._ignoreEvent=function(a){var b=this._map;if(b.boxZoom&&b.boxZoom.isActive())return!0;if(b.dragRotate&&b.dragRotate.isActive())return!0;if(a.touches)return a.touches.length>1;if(a.ctrlKey)return!0;var c=1,d=0;return"mousemove"===a.type?a.buttons&0===c:a.button!==d},k.prototype._drainInertiaBuffer=function(){for(var a=this._inertia,b=Date.now(),c=160;a.length>0&&b-a[0][0]>c;)a.shift()},b.exports=k},{"../../util/dom":115,"../../util/util":127,"../../util/window":110}],98:[function(a,b,c){"use strict";var d=a("../../util/dom"),e=a("../../util/util"),f=a("../../util/window"),g=.25,h=e.bezier(0,0,g,1),i=180,j=720,k=function(a,b){this._map=a,this._el=a.getCanvasContainer(),this._bearingSnap=b.bearingSnap,this._pitchWithRotate=b.pitchWithRotate!==!1,e.bindAll(["_onDown","_onMove","_onUp"],this)};k.prototype.isEnabled=function(){return!!this._enabled},k.prototype.isActive=function(){return!!this._active},k.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._enabled=!0)},k.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._enabled=!1)},k.prototype._onDown=function(a){this._ignoreEvent(a)||this.isActive()||(f.document.addEventListener("mousemove",this._onMove),f.document.addEventListener("mouseup",this._onUp),this._active=!1,this._inertia=[[Date.now(),this._map.getBearing()]],this._startPos=this._pos=d.mousePos(this._el,a),this._center=this._map.transform.centerPoint,a.preventDefault())},k.prototype._onMove=function(a){if(!this._ignoreEvent(a)){this.isActive()||(this._active=!0,this._fireEvent("rotatestart",a),this._fireEvent("movestart",a));var b=this._map;b.stop();var c=this._pos,e=d.mousePos(this._el,a),f=.8*(c.x-e.x),g=(c.y-e.y)*-.5,h=b.getBearing()-f,i=b.getPitch()-g,j=this._inertia,k=j[j.length-1];this._drainInertiaBuffer(),j.push([Date.now(),b._normalizeBearing(h,k[1])]),b.transform.bearing=h,this._pitchWithRotate&&(b.transform.pitch=i),this._fireEvent("rotate",a),this._fireEvent("move",a),this._pos=e}},k.prototype._onUp=function(a){var b=this;if(!this._ignoreEvent(a)&&(f.document.removeEventListener("mousemove",this._onMove),f.document.removeEventListener("mouseup",this._onUp),this.isActive())){this._active=!1,this._fireEvent("rotateend",a),this._drainInertiaBuffer();var c=this._map,d=c.getBearing(),e=this._inertia,k=function(){Math.abs(d)<b._bearingSnap?c.resetNorth({noMoveStart:!0},{originalEvent:a}):b._fireEvent("moveend",a)};if(e.length<2)return void k();var l=e[0],m=e[e.length-1],n=e[e.length-2],o=c._normalizeBearing(d,n[1]),p=m[1]-l[1],q=0>p?-1:1,r=(m[0]-l[0])/1e3;if(0===p||0===r)return void k();var s=Math.abs(p*(g/r));s>i&&(s=i);var t=s/(j*g),u=q*s*(t/2);o+=u,Math.abs(c._normalizeBearing(o,0))<this._bearingSnap&&(o=c._normalizeBearing(0,o)),c.rotateTo(o,{duration:1e3*t,easing:h,noMoveStart:!0},{originalEvent:a})}},k.prototype._fireEvent=function(a,b){return this._map.fire(a,{originalEvent:b})},k.prototype._ignoreEvent=function(a){var b=this._map;if(b.boxZoom&&b.boxZoom.isActive())return!0;if(b.dragPan&&b.dragPan.isActive())return!0;if(a.touches)return a.touches.length>1;var c=a.ctrlKey?1:2,d=a.ctrlKey?0:2,e=a.button;return"undefined"!=typeof InstallTrigger&&2===a.button&&a.ctrlKey&&f.navigator.platform.toUpperCase().indexOf("MAC")>=0&&(e=0),"mousemove"===a.type?a.buttons&0===c:e!==d},k.prototype._drainInertiaBuffer=function(){for(var a=this._inertia,b=Date.now(),c=160;a.length>0&&b-a[0][0]>c;)a.shift()},b.exports=k},{"../../util/dom":115,"../../util/util":127,"../../util/window":110}],99:[function(a,b,c){"use strict";function d(a){return a*(2-a)}var e=100,f=15,g=10,h=function(a){this._map=a,this._el=a.getCanvasContainer(),this._onKeyDown=this._onKeyDown.bind(this)};h.prototype.isEnabled=function(){return!!this._enabled},h.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},h.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},h.prototype._onKeyDown=function(a){if(!(a.altKey||a.ctrlKey||a.metaKey)){var b=0,c=0,h=0,i=0,j=0;switch(a.keyCode){case 61:case 107:case 171:case 187:b=1;break;case 189:case 109:case 173:b=-1;break;case 37:a.shiftKey?c=-1:(a.preventDefault(),i=-1);break;case 39:a.shiftKey?c=1:(a.preventDefault(),i=1);break;case 38:a.shiftKey?h=1:(a.preventDefault(),j=-1);break;case 40:a.shiftKey?h=-1:(j=1,a.preventDefault())}var k=this._map,l=k.getZoom(),m={duration:300,delayEndEvents:500,easing:d,zoom:b?Math.round(l)+b*(a.shiftKey?2:1):l,bearing:k.getBearing()+c*f,pitch:k.getPitch()+h*g,offset:[-i*e,-j*e],center:k.getCenter()};k.easeTo(m,{originalEvent:a})}},b.exports=h},{}],100:[function(a,b,c){"use strict";var d=a("../../util/dom"),e=a("../../util/util"),f=a("../../util/browser"),g=a("../../util/window"),h=g.navigator.userAgent.toLowerCase(),i=-1!==h.indexOf("firefox"),j=-1!==h.indexOf("safari")&&-1===h.indexOf("chrom"),k=function(a){this._map=a,this._el=a.getCanvasContainer(),e.bindAll(["_onWheel","_onTimeout"],this)};k.prototype.isEnabled=function(){return!!this._enabled},k.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1),this._enabled=!0)},k.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel),this._enabled=!1)},k.prototype._onWheel=function(a){var b;"wheel"===a.type?(b=a.deltaY,i&&a.deltaMode===g.WheelEvent.DOM_DELTA_PIXEL&&(b/=f.devicePixelRatio),a.deltaMode===g.WheelEvent.DOM_DELTA_LINE&&(b*=40)):"mousewheel"===a.type&&(b=-a.wheelDeltaY,j&&(b/=3));var c=f.now(),e=c-(this._time||0);this._pos=d.mousePos(this._el,a),this._time=c,0!==b&&b%4.000244140625===0?this._type="wheel":0!==b&&Math.abs(b)<4?this._type="trackpad":e>400?(this._type=null,this._lastValue=b,this._timeout=setTimeout(this._onTimeout,40)):this._type||(this._type=Math.abs(e*b)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,b+=this._lastValue)),a.shiftKey&&b&&(b/=4),this._type&&this._zoom(-b,a),a.preventDefault()},k.prototype._onTimeout=function(){this._type="wheel",this._zoom(-this._lastValue)},k.prototype._zoom=function(a,b){if(0!==a){var c=this._map,d=2/(1+Math.exp(-Math.abs(a/100)));0>a&&0!==d&&(d=1/d);var e=c.ease?c.ease.to:c.transform.scale,f=c.transform.scaleZoom(e*d);c.zoomTo(f,{duration:"wheel"===this._type?200:0,around:c.unproject(this._pos),delayEndEvents:200,smoothEasing:!0},{originalEvent:b})}},b.exports=k},{"../../util/browser":108,"../../util/dom":115,"../../util/util":127,"../../util/window":110}],101:[function(a,b,c){"use strict";var d=a("../../util/dom"),e=a("../../util/util"),f=a("../../util/window"),g=.15,h=e.bezier(0,0,g,1),i=12,j=2.5,k=.15,l=4,m=function(a){this._map=a,this._el=a.getCanvasContainer(),e.bindAll(["_onStart","_onMove","_onEnd"],this)};m.prototype.isEnabled=function(){return!!this._enabled},m.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("touchstart",this._onStart,!1),this._enabled=!0)},m.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("touchstart",this._onStart),this._enabled=!1)},m.prototype.disableRotation=function(){this._rotationDisabled=!0},m.prototype.enableRotation=function(){this._rotationDisabled=!1},m.prototype._onStart=function(a){if(2===a.touches.length){var b=d.mousePos(this._el,a.touches[0]),c=d.mousePos(this._el,a.touches[1]);this._startVec=b.sub(c),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,this._gestureIntent=void 0,this._inertia=[],f.document.addEventListener("touchmove",this._onMove,!1),f.document.addEventListener("touchend",this._onEnd,!1)}},m.prototype._onMove=function(a){if(2===a.touches.length){var b=d.mousePos(this._el,a.touches[0]),c=d.mousePos(this._el,a.touches[1]),e=b.add(c).div(2),f=b.sub(c),g=f.mag()/this._startVec.mag(),h=this._rotationDisabled?0:180*f.angleWith(this._startVec)/Math.PI,i=this._map;if(this._gestureIntent){var j={duration:0,around:i.unproject(e)};"rotate"===this._gestureIntent&&(j.bearing=this._startBearing+h),"zoom"!==this._gestureIntent&&"rotate"!==this._gestureIntent||(j.zoom=i.transform.scaleZoom(this._startScale*g)),i.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),g,e]),i.easeTo(j,{originalEvent:a})}else{var m=Math.abs(1-g)>k,n=Math.abs(h)>l;n?this._gestureIntent="rotate":m&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._startVec=f,this._startScale=i.transform.scale,this._startBearing=i.transform.bearing)}a.preventDefault()}},m.prototype._onEnd=function(a){f.document.removeEventListener("touchmove",this._onMove),f.document.removeEventListener("touchend",this._onEnd),this._drainInertiaBuffer();var b=this._inertia,c=this._map;if(b.length<2)return void c.snapToNorth({},{originalEvent:a});var d=b[b.length-1],e=b[0],k=c.transform.scaleZoom(this._startScale*d[1]),l=c.transform.scaleZoom(this._startScale*e[1]),m=k-l,n=(d[0]-e[0])/1e3,o=d[2];if(0===n||k===l)return void c.snapToNorth({},{originalEvent:a
});var p=m*g/n;Math.abs(p)>j&&(p=p>0?j:-j);var q=1e3*Math.abs(p/(i*g)),r=k+p*q/2e3;0>r&&(r=0),c.easeTo({zoom:r,duration:q,easing:h,around:c.unproject(o)},{originalEvent:a})},m.prototype._drainInertiaBuffer=function(){for(var a=this._inertia,b=Date.now(),c=160;a.length>2&&b-a[0][0]>c;)a.shift()},b.exports=m},{"../../util/dom":115,"../../util/util":127,"../../util/window":110}],102:[function(a,b,c){"use strict";var d=a("../util/util"),e=a("../util/window"),f=function(){d.bindAll(["_onHashChange","_updateHash"],this)};f.prototype.addTo=function(a){return this._map=a,e.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},f.prototype.remove=function(){return e.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},f.prototype._onHashChange=function(){var a=e.location.hash.replace("#","").split("/");return a.length>=3&&(this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:+(a[3]||0),pitch:+(a[4]||0)}),!0)},f.prototype._updateHash=function(){var a=this._map.getCenter(),b=this._map.getZoom(),c=this._map.getBearing(),d=this._map.getPitch(),f=Math.max(0,Math.ceil(Math.log(b)/Math.LN2)),g="#"+Math.round(100*b)/100+"/"+a.lat.toFixed(f)+"/"+a.lng.toFixed(f);(c||d)&&(g+="/"+Math.round(10*c)/10),d&&(g+="/"+Math.round(d)),e.history.replaceState("","",g)},b.exports=f},{"../util/util":127,"../util/window":110}],103:[function(a,b,c){"use strict";function d(a){a.parentNode&&a.parentNode.removeChild(a)}var e=a("../util/util"),f=a("../util/browser"),g=a("../util/window"),h=a("../util/dom"),i=a("../style/style"),j=a("../style/animation_loop"),k=a("../render/painter"),l=a("../geo/transform"),m=a("./hash"),n=a("./bind_handlers"),o=a("./camera"),p=a("../geo/lng_lat"),q=a("../geo/lng_lat_bounds"),r=a("point-geometry"),s=a("./control/attribution_control"),t=a("mapbox-gl-supported"),u=0,v=20,w={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:u,maxZoom:v,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0},x=function(a){function b(b){var c=this;b=e.extend({},w,b);var d=new l(b.minZoom,b.maxZoom);if(a.call(this,d,b),this._interactive=b.interactive,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,"string"==typeof b.container){if(this._container=g.document.getElementById(b.container),!this._container)throw new Error("Container '"+b.container+"' not found.")}else this._container=b.container;this.animationLoop=new j,b.maxBounds&&this.setMaxBounds(b.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),this.on("moveend",function(){c.animationLoop.set(300),c._rerender()}),"undefined"!=typeof g&&(g.addEventListener("online",this._onWindowOnline,!1),g.addEventListener("resize",this._onWindowResize,!1)),n(this,b),this._hash=b.hash&&(new m).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}),this._classes=[],this.resize(),b.classes&&this.setClasses(b.classes),b.style&&this.setStyle(b.style),b.attributionControl&&this.addControl(new s),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this.style.update(this._classes,{transition:!1})}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading)}a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b;var c={showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};return b.prototype.addControl=function(a,b){void 0===b&&a.getDefaultPosition&&(b=a.getDefaultPosition()),void 0===b&&(b="top-right");var c=a.onAdd(this),d=this._controlPositions[b];return-1!==b.indexOf("bottom")?d.insertBefore(c,d.firstChild):d.appendChild(c),this},b.prototype.removeControl=function(a){return a.onRemove(this),this},b.prototype.addClass=function(a,b){return this._classes.indexOf(a)>=0||""===a?this:(this._classes.push(a),this._classOptions=b,this.style&&this.style.updateClasses(),this._update(!0))},b.prototype.removeClass=function(a,b){var c=this._classes.indexOf(a);return 0>c||""===a?this:(this._classes.splice(c,1),this._classOptions=b,this.style&&this.style.updateClasses(),this._update(!0))},b.prototype.setClasses=function(a,b){for(var c={},d=0;d<a.length;d++)""!==a[d]&&(c[a[d]]=!0);return this._classes=Object.keys(c),this._classOptions=b,this.style&&this.style.updateClasses(),this._update(!0)},b.prototype.hasClass=function(a){return this._classes.indexOf(a)>=0},b.prototype.getClasses=function(){return this._classes},b.prototype.resize=function(){var a=this._containerDimensions(),b=a[0],c=a[1];return this._resizeCanvas(b,c),this.transform.resize(b,c),this.painter.resize(b,c),this.fire("movestart").fire("move").fire("resize").fire("moveend")},b.prototype.getBounds=function(){var a=new q(this.transform.pointLocation(new r(0,this.transform.height)),this.transform.pointLocation(new r(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(a.extend(this.transform.pointLocation(new r(this.transform.size.x,0))),a.extend(this.transform.pointLocation(new r(0,this.transform.size.y)))),a},b.prototype.setMaxBounds=function(a){if(a){var b=q.convert(a);this.transform.lngRange=[b.getWest(),b.getEast()],this.transform.latRange=[b.getSouth(),b.getNorth()],this.transform._constrain(),this._update()}else null!==a&&void 0!==a||(this.transform.lngRange=[],this.transform.latRange=[],this._update());return this},b.prototype.setMinZoom=function(a){if(a=null===a||void 0===a?u:a,a>=u&&a<=this.transform.maxZoom)return this.transform.minZoom=a,this._update(),this.getZoom()<a&&this.setZoom(a),this;throw new Error("minZoom must be between "+u+" and the current maxZoom, inclusive")},b.prototype.getMinZoom=function(){return this.transform.minZoom},b.prototype.setMaxZoom=function(a){if(a=null===a||void 0===a?v:a,a>=this.transform.minZoom)return this.transform.maxZoom=a,this._update(),this.getZoom()>a&&this.setZoom(a),this;throw new Error("maxZoom must be greater than the current minZoom")},b.prototype.getMaxZoom=function(){return this.transform.maxZoom},b.prototype.project=function(a){return this.transform.locationPoint(p.convert(a))},b.prototype.unproject=function(a){return this.transform.pointLocation(r.convert(a))},b.prototype.queryRenderedFeatures=function(){function a(a){return a instanceof r||Array.isArray(a)}var b,c={};return 2===arguments.length?(b=arguments[0],c=arguments[1]):1===arguments.length&&a(arguments[0])?b=arguments[0]:1===arguments.length&&(c=arguments[0]),this.style.queryRenderedFeatures(this._makeQueryGeometry(b),c,this.transform.zoom,this.transform.angle)},b.prototype._makeQueryGeometry=function(a){var b=this;void 0===a&&(a=[r.convert([0,0]),r.convert([this.transform.width,this.transform.height])]);var c,d=a instanceof r||"number"==typeof a[0];if(d){var e=r.convert(a);c=[e]}else{var f=[r.convert(a[0]),r.convert(a[1])];c=[f[0],new r(f[1].x,f[0].y),f[1],new r(f[0].x,f[1].y),f[0]]}return c=c.map(function(a){return b.transform.pointCoordinate(a)})},b.prototype.querySourceFeatures=function(a,b){return this.style.querySourceFeatures(a,b)},b.prototype.setStyle=function(a,b){var c=(!b||b.diff!==!1)&&this.style&&a&&!(a instanceof i)&&"string"!=typeof a;if(c)try{return this.style.setState(a)&&this._update(!0),this}catch(a){e.warnOnce("Unable to perform style diff: "+(a.message||a.error||a)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.off("rotate",this.style._redoPlacement),this.off("pitch",this.style._redoPlacement)),a?(a instanceof i?this.style=a:this.style=new i(a,this),this.style.setEventedParent(this,{style:this.style}),this.on("rotate",this.style._redoPlacement),this.on("pitch",this.style._redoPlacement),this):(this.style=null,this)},b.prototype.getStyle=function(){return this.style?this.style.serialize():void 0},b.prototype.addSource=function(a,b){return this.style.addSource(a,b),this._update(!0),this},b.prototype.addSourceType=function(a,b,c){return this.style.addSourceType(a,b,c)},b.prototype.removeSource=function(a){return this.style.removeSource(a),this._update(!0),this},b.prototype.getSource=function(a){return this.style.getSource(a)},b.prototype.addLayer=function(a,b){return this.style.addLayer(a,b),this._update(!0),this},b.prototype.moveLayer=function(a,b){return this.style.moveLayer(a,b),this._update(!0),this},b.prototype.removeLayer=function(a){return this.style.removeLayer(a),this._update(!0),this},b.prototype.getLayer=function(a){return this.style.getLayer(a)},b.prototype.setFilter=function(a,b){return this.style.setFilter(a,b),this._update(!0),this},b.prototype.setLayerZoomRange=function(a,b,c){return this.style.setLayerZoomRange(a,b,c),this._update(!0),this},b.prototype.getFilter=function(a){return this.style.getFilter(a)},b.prototype.setPaintProperty=function(a,b,c,d){return this.style.setPaintProperty(a,b,c,d),this._update(!0),this},b.prototype.getPaintProperty=function(a,b,c){return this.style.getPaintProperty(a,b,c)},b.prototype.setLayoutProperty=function(a,b,c){return this.style.setLayoutProperty(a,b,c),this._update(!0),this},b.prototype.getLayoutProperty=function(a,b){return this.style.getLayoutProperty(a,b)},b.prototype.setLight=function(a){return this.style.setLight(a),this._update(!0),this},b.prototype.getLight=function(){return this.style.getLight()},b.prototype.getContainer=function(){return this._container},b.prototype.getCanvasContainer=function(){return this._canvasContainer},b.prototype.getCanvas=function(){return this._canvas},b.prototype._containerDimensions=function(){var a=0,b=0;return this._container&&(a=this._container.offsetWidth||400,b=this._container.offsetHeight||300),[a,b]},b.prototype._setupContainer=function(){var a=this._container;a.classList.add("mapboxgl-map");var b=this._canvasContainer=h.create("div","mapboxgl-canvas-container",a);this._interactive&&b.classList.add("mapboxgl-interactive"),this._canvas=h.create("canvas","mapboxgl-canvas",b),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",0),this._canvas.setAttribute("aria-label","Map");var c=this._containerDimensions();this._resizeCanvas(c[0],c[1]);var d=this._controlContainer=h.create("div","mapboxgl-control-container",a),e=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(a){e[a]=h.create("div","mapboxgl-ctrl-"+a,d)})},b.prototype._resizeCanvas=function(a,b){var c=g.devicePixelRatio||1;this._canvas.width=c*a,this._canvas.height=c*b,this._canvas.style.width=a+"px",this._canvas.style.height=b+"px"},b.prototype._setupPainter=function(){var a=e.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},t.webGLContextAttributes),b=this._canvas.getContext("webgl",a)||this._canvas.getContext("experimental-webgl",a);if(!b)return void this.fire("error",{error:new Error("Failed to initialize WebGL")});var c=b.getParameter(b.MAX_RENDERBUFFER_SIZE)/2;if(this._canvas.width>c||this._canvas.height>c)throw new Error("Map canvas ("+this._canvas.width+"x"+this._canvas.height+") is larger than half of gl.MAX_RENDERBUFFER_SIZE ("+c+")");this.painter=new k(b,this.transform)},b.prototype._contextLost=function(a){a.preventDefault(),this._frameId&&f.cancelFrame(this._frameId),this.fire("webglcontextlost",{originalEvent:a})},b.prototype._contextRestored=function(a){this._setupPainter(),this.resize(),this._update(),this.fire("webglcontextrestored",{originalEvent:a})},b.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},b.prototype._update=function(a){return this.style?(this._styleDirty=this._styleDirty||a,this._sourcesDirty=!0,this._rerender(),this):this},b.prototype._render=function(){return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style.update(this._classes,this._classOptions),this._classOptions=null,this.style._recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty)&&this._rerender(),this},b.prototype.remove=function(){this._hash&&this._hash.remove(),f.cancelFrame(this._frameId),this.setStyle(null),"undefined"!=typeof g&&g.removeEventListener("resize",this._onWindowResize,!1);var a=this.painter.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),d(this._canvasContainer),d(this._controlContainer),this._container.classList.remove("mapboxgl-map"),this.fire("remove")},b.prototype._rerender=function(){this.style&&!this._frameId&&(this._frameId=f.frame(this._render))},b.prototype._onWindowOnline=function(){this._update()},b.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(a){this._showTileBoundaries!==a&&(this._showTileBoundaries=a,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(a){this._showCollisionBoxes!==a&&(this._showCollisionBoxes=a,this.style._redoPlacement())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(a){this._showOverdrawInspector!==a&&(this._showOverdrawInspector=a,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(a){this._repaint=a,this._update()},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(a){this._vertices=a,this._update()},b.prototype._onData=function(a){this._update("style"===a.dataType),this.fire(a.dataType+"data",a)},b.prototype._onDataLoading=function(a){this.fire(a.dataType+"dataloading",a)},Object.defineProperties(b.prototype,c),b}(o);b.exports=x},{"../geo/lng_lat":19,"../geo/lng_lat_bounds":20,"../geo/transform":21,"../render/painter":36,"../style/animation_loop":57,"../style/style":61,"../util/browser":108,"../util/dom":115,"../util/util":127,"../util/window":110,"./bind_handlers":89,"./camera":90,"./control/attribution_control":91,"./hash":102,"mapbox-gl-supported":190,"point-geometry":194}],104:[function(a,b,c){"use strict";var d=a("../util/dom"),e=a("../geo/lng_lat"),f=a("point-geometry"),g=function(a,b){this._offset=f.convert(b&&b.offset||[0,0]),this._update=this._update.bind(this),this._onMapClick=this._onMapClick.bind(this),a||(a=d.create("div")),a.classList.add("mapboxgl-marker"),this._element=a,this._popup=null};g.prototype.addTo=function(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),this},g.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map=null),d.remove(this._element),this._popup&&this._popup.remove(),this},g.prototype.getLngLat=function(){return this._lngLat},g.prototype.setLngLat=function(a){return this._lngLat=e.convert(a),this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},g.prototype.getElement=function(){return this._element},g.prototype.setPopup=function(a){return this._popup&&(this._popup.remove(),this._popup=null),a&&(this._popup=a,this._popup.setLngLat(this._lngLat)),this},g.prototype._onMapClick=function(a){var b=a.originalEvent.target,c=this._element;this._popup&&(b===c||c.contains(b))&&this.togglePopup()},g.prototype.getPopup=function(){return this._popup},g.prototype.togglePopup=function(){var a=this._popup;a&&(a.isOpen()?a.remove():a.addTo(this._map))},g.prototype._update=function(a){if(this._map){var b=this._map.project(this._lngLat)._add(this._offset);a&&"moveend"!==a.type||(b=b.round()),d.setTransform(this._element,"translate("+b.x+"px, "+b.y+"px)")}},b.exports=g},{"../geo/lng_lat":19,"../util/dom":115,"point-geometry":194}],105:[function(a,b,c){"use strict";function d(a){if(a){if("number"==typeof a){var b=Math.round(Math.sqrt(.5*Math.pow(a,2)));return{top:new j(0,a),"top-left":new j(b,b),"top-right":new j(-b,b),bottom:new j(0,-a),"bottom-left":new j(b,-b),"bottom-right":new j(-b,-b),left:new j(a,0),right:new j(-a,0)}}if(e(a)){var c=j.convert(a);return{top:c,"top-left":c,"top-right":c,bottom:c,"bottom-left":c,"bottom-right":c,left:c,right:c}}return{top:j.convert(a.top||[0,0]),"top-left":j.convert(a["top-left"]||[0,0]),"top-right":j.convert(a["top-right"]||[0,0]),bottom:j.convert(a.bottom||[0,0]),"bottom-left":j.convert(a["bottom-left"]||[0,0]),"bottom-right":j.convert(a["bottom-right"]||[0,0]),left:j.convert(a.left||[0,0]),right:j.convert(a.right||[0,0])}}return d(new j(0,0))}function e(a){return a instanceof j||Array.isArray(a)}var f=a("../util/util"),g=a("../util/evented"),h=a("../util/dom"),i=a("../geo/lng_lat"),j=a("point-geometry"),k=a("../util/window"),l={closeButton:!0,closeOnClick:!0},m=function(a){function b(b){a.call(this),this.options=f.extend(Object.create(l),b),f.bindAll(["_update","_onClickClose"],this)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.addTo=function(a){return this._map=a,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},b.prototype.isOpen=function(){return!!this._map},b.prototype.remove=function(){return this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._container&&(this._container.parentNode.removeChild(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire("close"),this},b.prototype.getLngLat=function(){return this._lngLat},b.prototype.setLngLat=function(a){return this._lngLat=i.convert(a),this._update(),this},b.prototype.setText=function(a){return this.setDOMContent(k.document.createTextNode(a))},b.prototype.setHTML=function(a){var b,c=k.document.createDocumentFragment(),d=k.document.createElement("body");for(d.innerHTML=a;b=d.firstChild,b;)c.appendChild(b);return this.setDOMContent(c)},b.prototype.setDOMContent=function(a){return this._createContent(),this._content.appendChild(a),this._update(),this},b.prototype._createContent=function(){this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._content=h.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=h.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},b.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=h.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=h.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content));var a=this.options.anchor,b=d(this.options.offset),c=this._map.project(this._lngLat).round();if(!a){var e=this._container.offsetWidth,f=this._container.offsetHeight;a=c.y+b.bottom.y<f?["top"]:c.y>this._map.transform.height-f?["bottom"]:[],c.x<e/2?a.push("left"):c.x>this._map.transform.width-e/2&&a.push("right"),a=0===a.length?"bottom":a.join("-")}var g=c.add(b[a]),i={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},j=this._container.classList;for(var k in i)j.remove("mapboxgl-popup-anchor-"+k);j.add("mapboxgl-popup-anchor-"+a),h.setTransform(this._container,i[a]+" translate("+g.x+"px,"+g.y+"px)")}},b.prototype._onClickClose=function(){this.remove()},b}(g);b.exports=m},{"../geo/lng_lat":19,"../util/dom":115,"../util/evented":116,"../util/util":127,"../util/window":110,"point-geometry":194}],106:[function(a,b,c){"use strict";var d=function(a,b,c){this.target=a,this.parent=b,this.mapId=c,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)};d.prototype.send=function(a,b,c,d,e){var f=c?this.mapId+":"+this.callbackID++:null;c&&(this.callbacks[f]=c),this.target.postMessage({targetMapId:e,sourceMapId:this.mapId,type:a,id:String(f),data:b},d)},d.prototype.receive=function(a){var b,c=this,d=a.data,e=d.id;if(!d.targetMapId||this.mapId===d.targetMapId){var f=function(a,b,d){c.target.postMessage({sourceMapId:c.mapId,type:"<response>",id:String(e),error:a?String(a):null,data:b},d)};if("<response>"===d.type)b=this.callbacks[d.id],delete this.callbacks[d.id],b&&b(d.error||null,d.data);else if("undefined"!=typeof d.id&&this.parent[d.type])this.parent[d.type](d.sourceMapId,d.data,f);else if("undefined"!=typeof d.id&&this.parent.getWorkerSource){var g=d.type.split("."),h=this.parent.getWorkerSource(d.sourceMapId,g[0]);h[g[1]](d.data,f)}else this.parent[d.type](d.data)}},d.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)},b.exports=d},{}],107:[function(a,b,c){"use strict";function d(a){var b=e.document.createElement("a");return b.href=a,b.protocol===e.document.location.protocol&&b.host===e.document.location.host}var e=a("./window");c.getJSON=function(a,b){var c=new e.XMLHttpRequest;return c.open("GET",a,!0),c.setRequestHeader("Accept","application/json"),c.onerror=function(a){b(a)},c.onload=function(){if(c.status>=200&&c.status<300&&c.response){var a;try{a=JSON.parse(c.response)}catch(a){return b(a)}b(null,a)}else b(new Error(c.statusText))},c.send(),c},c.getArrayBuffer=function(a,b){var c=new e.XMLHttpRequest;return c.open("GET",a,!0),c.responseType="arraybuffer",c.onerror=function(a){b(a)},c.onload=function(){return 0===c.response.byteLength&&200===c.status?b(new Error("http status 200 returned without content.")):void(c.status>=200&&c.status<300&&c.response?b(null,c.response):b(new Error(c.statusText)))},c.send(),c};var f="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";c.getImage=function(a,b){return c.getArrayBuffer(a,function(a,c){if(a)return b(a);var d=new e.Image,g=e.URL||e.webkitURL;d.onload=function(){b(null,d),g.revokeObjectURL(d.src)};var h=new e.Blob([new Uint8Array(c)],{type:"image/png"});d.src=c.byteLength?g.createObjectURL(h):f})},c.getVideo=function(a,b){var c=e.document.createElement("video");c.onloadstart=function(){b(null,c)};for(var f=0;f<a.length;f++){var g=e.document.createElement("source");d(a[f])||(c.crossOrigin="Anonymous"),g.src=a[f],c.appendChild(g)}return c}},{"./window":110}],108:[function(a,b,c){"use strict";var d=a("./window");b.exports.now=function(){return d.performance&&d.performance.now?d.performance.now.bind(d.performance):Date.now.bind(Date)}();var e=d.requestAnimationFrame||d.mozRequestAnimationFrame||d.webkitRequestAnimationFrame||d.msRequestAnimationFrame;c.frame=function(a){return e(a)};var f=d.cancelAnimationFrame||d.mozCancelAnimationFrame||d.webkitCancelAnimationFrame||d.msCancelAnimationFrame;c.cancelFrame=function(a){f(a)},c.timed=function(a,d,e){function f(i){g||(i=b.exports.now(),i>=h+d?a.call(e,1):(a.call(e,(i-h)/d),c.frame(f)))}if(!d)return a.call(e,1),null;var g=!1,h=b.exports.now();return c.frame(f),function(){g=!0}},c.getImageData=function(a){var b=d.document.createElement("canvas"),c=b.getContext("2d");return b.width=a.width,b.height=a.height,c.drawImage(a,0,0),c.getImageData(0,0,a.width,a.height).data},c.supported=a("mapbox-gl-supported"),c.hardwareConcurrency=d.navigator.hardwareConcurrency||4,Object.defineProperty(c,"devicePixelRatio",{get:function(){return d.devicePixelRatio}}),c.supportsWebp=!1;var g=d.document.createElement("img");g.onload=function(){c.supportsWebp=!0},g.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="},{"./window":110,"mapbox-gl-supported":190}],109:[function(a,b,c){"use strict";var d=a("webworkify"),e=a("../window"),f=e.URL.createObjectURL(new d(a("../../source/worker"),{bare:!0}));b.exports=function(){return new e.Worker(f)}},{"../../source/worker":55,"../window":110,webworkify:211}],110:[function(a,b,c){"use strict";b.exports=self},{}],111:[function(a,b,c){"use strict";function d(a,b){return b.area-a.area}var e=a("quickselect"),f=a("./util").calculateSignedArea;b.exports=function(a,b){var c=a.length;if(1>=c)return[a];for(var g,h,i=[],j=0;c>j;j++){var k=f(a[j]);0!==k&&(a[j].area=Math.abs(k),void 0===h&&(h=0>k),h===0>k?(g&&i.push(g),g=[a[j]]):g.push(a[j]))}if(g&&i.push(g),b>1)for(var l=0;l<i.length;l++)i[l].length<=b||(e(i[l],b,1,i[l].length-1,d),i[l]=i[l].slice(0,b));return i}},{"./util":127,quickselect:196}],112:[function(a,b,c){"use strict";var d={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null};b.exports=d},{}],113:[function(a,b,c){"use strict";var d=function(a){var b=this;this._stringToNumber={},this._numberToString=[];for(var c=0;c<a.length;c++){var d=a[c];b._stringToNumber[d]=c,b._numberToString[c]=d}};d.prototype.encode=function(a){return this._stringToNumber[a]},d.prototype.decode=function(a){return this._numberToString[a]},b.exports=d},{}],114:[function(a,b,c){"use strict";var d=a("./util"),e=a("./actor"),f=function(a,b){var c=this;this.workerPool=a,this.actors=[],this.currentActor=0,this.id=d.uniqueId();for(var f=this.workerPool.acquire(this.id),g=0;g<f.length;g++){var h=f[g],i=new e(h,b,c.id);i.name="Worker "+g,c.actors.push(i)}};f.prototype.broadcast=function(a,b,c){c=c||function(){},d.asyncAll(this.actors,function(c,d){c.send(a,b,d)},c)},f.prototype.send=function(a,b,c,d,e){return("number"!=typeof d||isNaN(d))&&(d=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[d].send(a,b,c,e),d},f.prototype.remove=function(){this.actors.forEach(function(a){a.remove()}),this.actors=[],this.workerPool.release(this.id)},b.exports=f},{"./actor":106,"./util":127}],115:[function(a,b,c){"use strict";function d(a){for(var b=0;b<a.length;b++)if(a[b]in i)return a[b];return a[0]}function e(a){a.preventDefault(),a.stopPropagation(),g.removeEventListener("click",e,!0)}var f=a("point-geometry"),g=a("./window");c.create=function(a,b,c){var d=g.document.createElement(a);return b&&(d.className=b),c&&c.appendChild(d),d};var h,i=g.document.documentElement.style,j=d(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);c.disableDrag=function(){j&&(h=i[j],i[j]="none")},c.enableDrag=function(){j&&(i[j]=h)};var k=d(["transform","WebkitTransform"]);c.setTransform=function(a,b){a.style[k]=b},c.suppressClick=function(){g.addEventListener("click",e,!0),g.setTimeout(function(){g.removeEventListener("click",e,!0)},0)},c.mousePos=function(a,b){var c=a.getBoundingClientRect();return b=b.touches?b.touches[0]:b,new f(b.clientX-c.left-a.clientLeft,b.clientY-c.top-a.clientTop)},c.touchPos=function(a,b){for(var c=a.getBoundingClientRect(),d=[],e="touchend"===b.type?b.changedTouches:b.touches,g=0;g<e.length;g++)d.push(new f(e[g].clientX-c.left-a.clientLeft,e[g].clientY-c.top-a.clientTop));return d},c.remove=function(a){a.parentNode&&a.parentNode.removeChild(a)}},{"./window":110,"point-geometry":194}],116:[function(a,b,c){"use strict";var d=a("./util"),e=function(){};e.prototype.on=function(a,b){return this._listeners=this._listeners||{},this._listeners[a]=this._listeners[a]||[],this._listeners[a].push(b),this},e.prototype.off=function(a,b){if(this._listeners&&this._listeners[a]){var c=this._listeners[a].indexOf(b);-1!==c&&this._listeners[a].splice(c,1)}return this},e.prototype.once=function(a,b){var c=this,d=function(e){c.off(a,d),b.call(c,e)};return this.on(a,d),this},e.prototype.fire=function(a,b){var c=this;if(this.listens(a)){b=d.extend({},b,{type:a,target:this});for(var e=this._listeners&&this._listeners[a]?this._listeners[a].slice():[],f=0;f<e.length;f++)e[f].call(c,b);this._eventedParent&&this._eventedParent.fire(a,d.extend({},b,this._eventedParentData))}else d.endsWith(a,"error")&&console.error(b&&b.error||b||"Empty error event");return this},e.prototype.listens=function(a){return this._listeners&&this._listeners[a]||this._eventedParent&&this._eventedParent.listens(a)},e.prototype.setEventedParent=function(a,b){return this._eventedParent=a,this._eventedParentData="function"==typeof b?b():b,this},b.exports=e},{"./util":127}],117:[function(a,b,c){"use strict";function d(a,b){return b.max-a.max}function e(a,b,c,d){this.p=new i(a,b),this.h=c,this.d=f(this.p,d),this.max=this.d+this.h*Math.SQRT2}function f(a,b){for(var c=!1,d=1/0,e=0;e<b.length;e++)for(var f=b[e],g=0,h=f.length,i=h-1;h>g;i=g++){var k=f[g],l=f[i];k.y>a.y!=l.y>a.y&&a.x<(l.x-k.x)*(a.y-k.y)/(l.y-k.y)+k.x&&(c=!c),d=Math.min(d,j(a,k,l))}return(c?1:-1)*Math.sqrt(d)}function g(a){for(var b=0,c=0,d=0,f=a[0],g=0,h=f.length,i=h-1;h>g;i=g++){var j=f[g],k=f[i],l=j.x*k.y-k.x*j.y;c+=(j.x+k.x)*l,d+=(j.y+k.y)*l,b+=3*l}return new e(c/b,d/b,0,a)}var h=a("tinyqueue"),i=a("point-geometry"),j=a("./intersection_tests").distToSegmentSquared;b.exports=function(a,b,c){b=b||1;for(var f,i,j,k,l=a[0],m=0;m<l.length;m++){var n=l[m];(!m||n.x<f)&&(f=n.x),(!m||n.y<i)&&(i=n.y),(!m||n.x>j)&&(j=n.x),(!m||n.y>k)&&(k=n.y)}for(var o=j-f,p=k-i,q=Math.min(o,p),r=q/2,s=new h(null,d),t=f;j>t;t+=q)for(var u=i;k>u;u+=q)s.push(new e(t+r,u+r,r,a));for(var v=g(a),w=s.length;s.length;){var x=s.pop();x.d>v.d&&(v=x,c&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,w)),x.max-v.d<=b||(r=x.h/2,s.push(new e(x.p.x-r,x.p.y-r,r,a)),s.push(new e(x.p.x+r,x.p.y-r,r,a)),s.push(new e(x.p.x-r,x.p.y+r,r,a)),s.push(new e(x.p.x+r,x.p.y+r,r,a)),w+=4)}return c&&(console.log("num probes: "+w),console.log("best distance: "+v.d)),v.p}},{"./intersection_tests":120,"point-geometry":194,tinyqueue:199}],118:[function(a,b,c){"use strict";function d(a,b){this.stacks=a.readFields(e,[],b)}function e(a,b,c){if(1===a){var d=c.readMessage(f,{glyphs:{}});b.push(d)}}function f(a,b,c){if(1===a)b.name=c.readString();else if(2===a)b.range=c.readString();else if(3===a){var d=c.readMessage(g,{});b.glyphs[d.id]=d}}function g(a,b,c){1===a?b.id=c.readVarint():2===a?b.bitmap=c.readBytes():3===a?b.width=c.readVarint():4===a?b.height=c.readVarint():5===a?b.left=c.readSVarint():6===a?b.top=c.readSVarint():7===a&&(b.advance=c.readVarint())}b.exports=d},{}],119:[function(a,b,c){"use strict";function d(a,b,c){return a*(1-c)+b*c}b.exports=d,d.number=d,d.vec2=function(a,b,c){return[d(a[0],b[0],c),d(a[1],b[1],c)]},d.color=function(a,b,c){return[d(a[0],b[0],c),d(a[1],b[1],c),d(a[2],b[2],c),d(a[3],b[3],c)]},d.array=function(a,b,c){return a.map(function(a,e){return d(a,b[e],c)})}},{}],120:[function(a,b,c){"use strict";function d(a,b){for(var c=0;c<a.length;c++)if(n(b,a[c]))return!0;for(var d=0;d<b.length;d++)if(n(a,b[d]))return!0;return!!i(a,b)}function e(a,b,c){for(var d=0;d<a.length;d++)for(var e=a[d],f=0;f<b.length;f++)for(var g=b[f],h=0;h<g.length;h++){var i=g[h];if(n(e,i))return!0;if(k(i,e,c))return!0}return!1}function f(a,b){if(1===a.length&&1===a[0].length)return m(b,a[0][0]);
for(var c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.length;e++)if(m(a,d[e]))return!0;for(var f=0;f<a.length;f++){for(var g=a[f],h=0;h<g.length;h++)if(m(b,g[h]))return!0;for(var j=0;j<b.length;j++)if(i(g,b[j]))return!0}return!1}function g(a,b,c){for(var d=0;d<b.length;d++)for(var e=b[d],f=0;f<a.length;f++){var g=a[f];if(g.length>=3)for(var i=0;i<e.length;i++)if(n(g,e[i]))return!0;if(h(g,e,c))return!0}return!1}function h(a,b,c){if(a.length>1){if(i(a,b))return!0;for(var d=0;d<b.length;d++)if(k(b[d],a,c))return!0}for(var e=0;e<a.length;e++)if(k(a[e],b,c))return!0;return!1}function i(a,b){if(0===a.length||0===b.length)return!1;for(var c=0;c<a.length-1;c++)for(var d=a[c],e=a[c+1],f=0;f<b.length-1;f++){var g=b[f],h=b[f+1];if(j(d,e,g,h))return!0}return!1}function j(a,b,c,d){return o(a,c,d)!==o(b,c,d)&&o(a,b,c)!==o(a,b,d)}function k(a,b,c){var d=c*c;if(1===b.length)return a.distSqr(b[0])<d;for(var e=1;e<b.length;e++){var f=b[e-1],g=b[e];if(l(a,f,g)<d)return!0}return!1}function l(a,b,c){var d=b.distSqr(c);if(0===d)return a.distSqr(b);var e=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/d;return 0>e?a.distSqr(b):e>1?a.distSqr(c):a.distSqr(c.sub(b)._mult(e)._add(b))}function m(a,b){for(var c,d,e,f=!1,g=0;g<a.length;g++){c=a[g];for(var h=0,i=c.length-1;h<c.length;i=h++)d=c[h],e=c[i],d.y>b.y!=e.y>b.y&&b.x<(e.x-d.x)*(b.y-d.y)/(e.y-d.y)+d.x&&(f=!f)}return f}function n(a,b){for(var c=!1,d=0,e=a.length-1;d<a.length;e=d++){var f=a[d],g=a[e];f.y>b.y!=g.y>b.y&&b.x<(g.x-f.x)*(b.y-f.y)/(g.y-f.y)+f.x&&(c=!c)}return c}var o=a("./util").isCounterClockwise;b.exports={multiPolygonIntersectsBufferedMultiPoint:e,multiPolygonIntersectsMultiPolygon:f,multiPolygonIntersectsBufferedMultiLine:g,polygonIntersectsPolygon:d,distToSegmentSquared:l}},{"./util":127}],121:[function(a,b,c){"use strict";var d={"Latin-1 Supplement":function(a){return a>=128&&255>=a},"Hangul Jamo":function(a){return a>=4352&&4607>=a},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&5759>=a},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&6399>=a},"General Punctuation":function(a){return a>=8192&&8303>=a},"Letterlike Symbols":function(a){return a>=8448&&8527>=a},"Number Forms":function(a){return a>=8528&&8591>=a},"Miscellaneous Technical":function(a){return a>=8960&&9215>=a},"Control Pictures":function(a){return a>=9216&&9279>=a},"Optical Character Recognition":function(a){return a>=9280&&9311>=a},"Enclosed Alphanumerics":function(a){return a>=9312&&9471>=a},"Geometric Shapes":function(a){return a>=9632&&9727>=a},"Miscellaneous Symbols":function(a){return a>=9728&&9983>=a},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&11263>=a},"CJK Radicals Supplement":function(a){return a>=11904&&12031>=a},"Kangxi Radicals":function(a){return a>=12032&&12255>=a},"Ideographic Description Characters":function(a){return a>=12272&&12287>=a},"CJK Symbols and Punctuation":function(a){return a>=12288&&12351>=a},Hiragana:function(a){return a>=12352&&12447>=a},Katakana:function(a){return a>=12448&&12543>=a},Bopomofo:function(a){return a>=12544&&12591>=a},"Hangul Compatibility Jamo":function(a){return a>=12592&&12687>=a},Kanbun:function(a){return a>=12688&&12703>=a},"Bopomofo Extended":function(a){return a>=12704&&12735>=a},"CJK Strokes":function(a){return a>=12736&&12783>=a},"Katakana Phonetic Extensions":function(a){return a>=12784&&12799>=a},"Enclosed CJK Letters and Months":function(a){return a>=12800&&13055>=a},"CJK Compatibility":function(a){return a>=13056&&13311>=a},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&19903>=a},"Yijing Hexagram Symbols":function(a){return a>=19904&&19967>=a},"CJK Unified Ideographs":function(a){return a>=19968&&40959>=a},"Yi Syllables":function(a){return a>=40960&&42127>=a},"Yi Radicals":function(a){return a>=42128&&42191>=a},"Hangul Jamo Extended-A":function(a){return a>=43360&&43391>=a},"Hangul Syllables":function(a){return a>=44032&&55215>=a},"Hangul Jamo Extended-B":function(a){return a>=55216&&55295>=a},"Private Use Area":function(a){return a>=57344&&63743>=a},"CJK Compatibility Ideographs":function(a){return a>=63744&&64255>=a},"Vertical Forms":function(a){return a>=65040&&65055>=a},"CJK Compatibility Forms":function(a){return a>=65072&&65103>=a},"Small Form Variants":function(a){return a>=65104&&65135>=a},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&65519>=a}};b.exports=d},{}],122:[function(a,b,c){"use strict";var d=function(a,b){this.max=a,this.onRemove=b,this.reset()};d.prototype.reset=function(){var a=this;for(var b in this.data)a.onRemove(a.data[b]);return this.data={},this.order=[],this},d.prototype.add=function(a,b){if(this.has(a))this.order.splice(this.order.indexOf(a),1),this.data[a]=b,this.order.push(a);else if(this.data[a]=b,this.order.push(a),this.order.length>this.max){var c=this.get(this.order[0]);c&&this.onRemove(c)}return this},d.prototype.has=function(a){return a in this.data},d.prototype.keys=function(){return this.order},d.prototype.get=function(a){if(!this.has(a))return null;var b=this.data[a];return delete this.data[a],this.order.splice(this.order.indexOf(a),1),b},d.prototype.setMaxSize=function(a){var b=this;for(this.max=a;this.order.length>this.max;){var c=b.get(b.order[0]);c&&b.onRemove(c)}return this},b.exports=d},{}],123:[function(a,b,c){"use strict";function d(a,b){var c=g(i.API_URL);if(a.protocol=c.protocol,a.authority=c.authority,!i.REQUIRE_ACCESS_TOKEN)return h(a);if(b=b||i.ACCESS_TOKEN,!b)throw new Error("An API access token is required to use Mapbox GL. "+k);if("s"===b[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+k);return a.params.push("access_token="+b),h(a)}function e(a){return 0===a.indexOf("mapbox:")}function f(a){for(var b=0;b<a.length;b++)0===a[b].indexOf("access_token=tk.")&&(a[b]="access_token="+(i.ACCESS_TOKEN||""))}function g(a){var b=a.match(m);if(!b)throw new Error("Unable to parse URL object");return{protocol:b[1],authority:b[2],path:b[3]||"/",params:b[4]?b[4].split("&"):[]}}function h(a){var b=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+b}var i=a("./config"),j=a("./browser"),k="See https://www.mapbox.com/developers/api/#access-tokens";c.isMapboxURL=e,c.normalizeStyleURL=function(a,b){if(!e(a))return a;var c=g(a);return c.path="/styles/v1"+c.path,d(c,b)},c.normalizeGlyphsURL=function(a,b){if(!e(a))return a;var c=g(a);return c.path="/fonts/v1"+c.path,d(c,b)},c.normalizeSourceURL=function(a,b){if(!e(a))return a;var c=g(a);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),d(c,b)},c.normalizeSpriteURL=function(a,b,c,f){var i=g(a);return e(a)?(i.path="/styles/v1"+i.path+"/sprite"+b+c,d(i,f)):(i.path+=""+b+c,h(i))};var l=/(\.(png|jpg)\d*)(?=$)/;c.normalizeTileURL=function(a,b,c){if(!b||!e(b))return a;var d=g(a),i=j.devicePixelRatio>=2||512===c?"@2x":"",k=j.supportsWebp?".webp":"$1";return d.path=d.path.replace(l,""+i+k),f(d.params),h(d)};var m=/^(\w+):\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/},{"./browser":108,"./config":112}],124:[function(a,b,c){"use strict";var d=a("./is_char_in_unicode_block");b.exports.allowsIdeographicBreaking=function(a){for(var b=0,d=a;b<d.length;b+=1){var e=d[b];if(!c.charAllowsIdeographicBreaking(e.charCodeAt(0)))return!1}return!0},b.exports.allowsVerticalWritingMode=function(a){for(var b=0,d=a;b<d.length;b+=1){var e=d[b];if(c.charHasUprightVerticalOrientation(e.charCodeAt(0)))return!0}return!1},b.exports.charAllowsIdeographicBreaking=function(a){return!!(!(11904>a)&&(d["Bopomofo Extended"](a)||d.Bopomofo(a)||d["CJK Compatibility Forms"](a)||d["CJK Compatibility Ideographs"](a)||d["CJK Compatibility"](a)||d["CJK Radicals Supplement"](a)||d["CJK Strokes"](a)||d["CJK Symbols and Punctuation"](a)||d["CJK Unified Ideographs Extension A"](a)||d["CJK Unified Ideographs"](a)||d["Enclosed CJK Letters and Months"](a)||d["Halfwidth and Fullwidth Forms"](a)||d.Hiragana(a)||d["Ideographic Description Characters"](a)||d["Kangxi Radicals"](a)||d["Katakana Phonetic Extensions"](a)||d.Katakana(a)||d["Vertical Forms"](a)||d["Yi Radicals"](a)||d["Yi Syllables"](a)))},c.charHasUprightVerticalOrientation=function(a){return!!(746===a||747===a||!(4352>a)&&(d["Bopomofo Extended"](a)||d.Bopomofo(a)||d["CJK Compatibility Forms"](a)&&!(a>=65097&&65103>=a)||d["CJK Compatibility Ideographs"](a)||d["CJK Compatibility"](a)||d["CJK Radicals Supplement"](a)||d["CJK Strokes"](a)||!(!d["CJK Symbols and Punctuation"](a)||a>=12296&&12305>=a||a>=12308&&12319>=a||12336===a)||d["CJK Unified Ideographs Extension A"](a)||d["CJK Unified Ideographs"](a)||d["Enclosed CJK Letters and Months"](a)||d["Hangul Compatibility Jamo"](a)||d["Hangul Jamo Extended-A"](a)||d["Hangul Jamo Extended-B"](a)||d["Hangul Jamo"](a)||d["Hangul Syllables"](a)||d.Hiragana(a)||d["Ideographic Description Characters"](a)||d.Kanbun(a)||d["Kangxi Radicals"](a)||d["Katakana Phonetic Extensions"](a)||d.Katakana(a)&&12540!==a||!(!d["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&65310>=a||65339===a||65341===a||65343===a||a>=65371&&65503>=a||65507===a||a>=65512&&65519>=a)||!(!d["Small Form Variants"](a)||a>=65112&&65118>=a||a>=65123&&65126>=a)||d["Unified Canadian Aboriginal Syllabics"](a)||d["Unified Canadian Aboriginal Syllabics Extended"](a)||d["Vertical Forms"](a)||d["Yijing Hexagram Symbols"](a)||d["Yi Syllables"](a)||d["Yi Radicals"](a)))},c.charHasNeutralVerticalOrientation=function(a){return!!(d["Latin-1 Supplement"](a)&&(167===a||169===a||174===a||177===a||188===a||189===a||190===a||215===a||247===a)||d["General Punctuation"](a)&&(8214===a||8224===a||8225===a||8240===a||8241===a||8251===a||8252===a||8258===a||8263===a||8264===a||8265===a||8273===a)||d["Letterlike Symbols"](a)||d["Number Forms"](a)||d["Miscellaneous Technical"](a)&&(a>=8960&&8967>=a||a>=8972&&8991>=a||a>=8996&&9e3>=a||9003===a||a>=9085&&9114>=a||a>=9150&&9165>=a||9167===a||a>=9169&&9179>=a||a>=9186&&9215>=a)||d["Control Pictures"](a)&&9251!==a||d["Optical Character Recognition"](a)||d["Enclosed Alphanumerics"](a)||d["Geometric Shapes"](a)||d["Miscellaneous Symbols"](a)&&!(a>=9754&&9759>=a)||d["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&11055>=a||a>=11088&&11097>=a||a>=11192&&11243>=a)||d["CJK Symbols and Punctuation"](a)||d.Katakana(a)||d["Private Use Area"](a)||d["CJK Compatibility Forms"](a)||d["Small Form Variants"](a)||d["Halfwidth and Fullwidth Forms"](a)||8734===a||8756===a||8757===a||a>=9984&&10087>=a||a>=10102&&10131>=a||65532===a||65533===a)},c.charHasRotatedVerticalOrientation=function(a){return!(c.charHasUprightVerticalOrientation(a)||c.charHasNeutralVerticalOrientation(a))}},{"./is_char_in_unicode_block":121}],125:[function(a,b,c){"use strict";function d(a){var b=JSON.stringify(a);if(q[b])return q[b];var c=void 0===a.alignment?1:a.alignment,d=0,g=0,i=["Uint8"],l=a.members.map(function(a){i.indexOf(a.type)<0&&i.push(a.type);var b=f(a.type),h=d=e(d,Math.max(c,b)),j=a.components||1;return g=Math.max(g,b),d+=b*j,{name:a.name,type:a.type,components:j,offset:h}}),n=e(d,Math.max(g,c)),o=function(a){function b(){a.apply(this,arguments)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b}(m);o.prototype.alignment=c,o.prototype.size=n;for(var r=0,s=l;r<s.length;r+=1)for(var t=s[r],u=0;u<t.components;u++){var v=t.name+(1===t.components?"":u);Object.defineProperty(o.prototype,v,{get:j(t,u),set:k(t,u)})}var w=function(a){function b(){a.apply(this,arguments)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b}(p);return w.prototype.members=l,w.prototype.StructType=o,w.prototype.bytesPerElement=n,w.prototype.emplaceBack=h(l,n),w.prototype._usedTypes=i,q[b]=w,w}function e(a,b){return Math.ceil(a/b)*b}function f(a){return l[a].BYTES_PER_ELEMENT}function g(a){return a.toLowerCase()}function h(a,b){for(var c=[],d=[],e="var i = this.length;\nthis.resize(this.length + 1);\n",h=0,i=a;h<i.length;h+=1){var j=i[h],k=f(j.type);c.indexOf(k)<0&&(c.push(k),e+="var o"+k.toFixed(0)+" = i * "+(b/k).toFixed(0)+";\n");for(var l=0;l<j.components;l++){var m="v"+d.length,n="o"+k.toFixed(0)+" + "+(j.offset/k+l).toFixed(0);e+="this."+g(j.type)+"["+n+"] = "+m+";\n",d.push(m)}}return e+="return i;",new Function(d.toString(),e)}function i(a,b){var c="this._pos"+f(a.type).toFixed(0),d=(a.offset/f(a.type)+b).toFixed(0),e=c+" + "+d;return"this._structArray."+g(a.type)+"["+e+"]"}function j(a,b){return new Function("return "+i(a,b)+";")}function k(a,b){return new Function("x",i(a,b)+" = x;")}b.exports=d;var l={Int8:Int8Array,Uint8:Uint8Array,Uint8Clamped:Uint8ClampedArray,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array,Float64:Float64Array},m=function(a,b){this._structArray=a,this._pos1=b*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},n=128,o=5,p=function(a){this.isTransferred=!1,void 0!==a?(this.arrayBuffer=a.arrayBuffer,this.length=a.length,this.capacity=this.arrayBuffer.byteLength/this.bytesPerElement,this._refreshViews()):(this.capacity=-1,this.resize(0))};p.serialize=function(){return{members:this.prototype.members,alignment:this.prototype.StructType.prototype.alignment,bytesPerElement:this.prototype.bytesPerElement}},p.prototype.serialize=function(a){return this._trim(),a&&(this.isTransferred=!0,a.push(this.arrayBuffer)),{length:this.length,arrayBuffer:this.arrayBuffer}},p.prototype.get=function(a){return new this.StructType(this,a)},p.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},p.prototype.resize=function(a){if(this.length=a,a>this.capacity){this.capacity=Math.max(a,Math.floor(this.capacity*o),n),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var b=this.uint8;this._refreshViews(),b&&this.uint8.set(b)}},p.prototype._refreshViews=function(){for(var a=this,b=0,c=this._usedTypes;b<c.length;b+=1){var d=c[b];a[g(d)]=new l[d](a.arrayBuffer)}},p.prototype.toArray=function(a,b){for(var c=this,d=[],e=a;b>e;e++){var f=c.get(e);d.push(f)}return d};var q={}},{}],126:[function(a,b,c){"use strict";function d(a,b){return b.replace(/{([^{}]+)}/g,function(b,c){return c in a?a[c]:""})}b.exports=d},{}],127:[function(a,b,c){"use strict";var d=a("unitbezier"),e=a("../geo/coordinate");a("point-geometry");c.easeCubicInOut=function(a){if(0>=a)return 0;if(a>=1)return 1;var b=a*a,c=b*a;return 4*(.5>a?c:3*(a-b)+c-.75)},c.bezier=function(a,b,c,e){var f=new d(a,b,c,e);return function(a){return f.solve(a)}},c.ease=c.bezier(.25,.1,.25,1),c.clamp=function(a,b,c){return Math.min(c,Math.max(b,a))},c.wrap=function(a,b,c){var d=c-b,e=((a-b)%d+d)%d+b;return e===b?c:e},c.asyncAll=function(a,b,c){if(!a.length)return c(null,[]);var d=a.length,e=new Array(a.length),f=null;a.forEach(function(a,g){b(a,function(a,b){a&&(f=a),e[g]=b,0===--d&&c(f,e)})})},c.values=function(a){var b=[];for(var c in a)b.push(a[c]);return b},c.keysDifference=function(a,b){var c=[];for(var d in a)d in b||c.push(d);return c},c.extend=function(a,b,c,d){for(var e=arguments,f=1;f<arguments.length;f++){var g=e[f];for(var h in g)a[h]=g[h]}return a},c.pick=function(a,b){for(var c={},d=0;d<b.length;d++){var e=b[d];e in a&&(c[e]=a[e])}return c};var f=1;c.uniqueId=function(){return f++},c.bindAll=function(a,b){a.forEach(function(a){b[a]&&(b[a]=b[a].bind(b))})},c.getCoordinatesCenter=function(a){for(var b=1/0,c=1/0,d=-(1/0),f=-(1/0),g=0;g<a.length;g++)b=Math.min(b,a[g].column),c=Math.min(c,a[g].row),d=Math.max(d,a[g].column),f=Math.max(f,a[g].row);var h=d-b,i=f-c,j=Math.max(h,i);return new e((b+d)/2,(c+f)/2,0).zoomTo(Math.floor(-Math.log(j)/Math.LN2))},c.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)},c.mapObject=function(a,b,c){var d=this,e={};for(var f in a)e[f]=b.call(c||d,a[f],f,a);return e},c.filterObject=function(a,b,c){var d=this,e={};for(var f in a)b.call(c||d,a[f],f,a)&&(e[f]=a[f]);return e},c.deepEqual=function(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!==b.length)return!1;for(var d=0;d<a.length;d++)if(!c.deepEqual(a[d],b[d]))return!1;return!0}if("object"==typeof a&&null!==a&&null!==b){if("object"!=typeof b)return!1;var e=Object.keys(a);if(e.length!==Object.keys(b).length)return!1;for(var f in a)if(!c.deepEqual(a[f],b[f]))return!1;return!0}return a===b},c.clone=function(a){return Array.isArray(a)?a.map(c.clone):"object"==typeof a&&a?c.mapObject(a,c.clone):a},c.arraysIntersect=function(a,b){for(var c=0;c<a.length;c++)if(b.indexOf(a[c])>=0)return!0;return!1};var g={};c.warnOnce=function(a){g[a]||("undefined"!=typeof console&&console.warn(a),g[a]=!0)},c.isCounterClockwise=function(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)},c.calculateSignedArea=function(a){for(var b,c,d=0,e=0,f=a.length,g=f-1;f>e;g=e++)b=a[e],c=a[g],d+=(c.x-b.x)*(b.y+c.y);return d},c.isClosedPolygon=function(a){if(a.length<4)return!1;var b=a[0],d=a[a.length-1];return!(Math.abs(b.x-d.x)>0||Math.abs(b.y-d.y)>0)&&Math.abs(c.calculateSignedArea(a))>.01},c.sphericalToCartesian=function(a){var b=a[0],c=a[1],d=a[2];return c+=90,c*=Math.PI/180,d*=Math.PI/180,[b*Math.cos(c)*Math.sin(d),b*Math.sin(c)*Math.sin(d),b*Math.cos(d)]}},{"../geo/coordinate":18,"point-geometry":194,unitbezier:200}],128:[function(a,b,c){"use strict";var d=function(a,b,c,d){this.type="Feature",this._vectorTileFeature=a,a._z=b,a._x=c,a._y=d,this.properties=a.properties,null!=a.id&&(this.id=a.id)},e={geometry:{}};e.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},e.geometry.set=function(a){this._geometry=a},d.prototype.toJSON=function(){var a=this,b={geometry:this.geometry};for(var c in this)"_geometry"!==c&&"_vectorTileFeature"!==c&&(b[c]=a[c]);return b},Object.defineProperties(d.prototype,e),b.exports=d},{}],129:[function(a,b,c){"use strict";var d=a("./script_detection");b.exports=function(a){for(var c="",e=0;e<a.length;e++){var f=a.charCodeAt(e+1)||null,g=a.charCodeAt(e-1)||null,h=(!f||!d.charHasRotatedVerticalOrientation(f)||b.exports.lookup[a[e+1]])&&(!g||!d.charHasRotatedVerticalOrientation(g)||b.exports.lookup[a[e-1]]);c+=h&&b.exports.lookup[a[e]]?b.exports.lookup[a[e]]:a[e]}return c},b.exports.lookup={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"}},{"./script_detection":124}],130:[function(a,b,c){"use strict";var d=a("./web_worker"),e=function(){this.active={}};e.prototype.acquire=function(b){var c=this;if(!this.workers){var e=a("../mapbox-gl").workerCount;for(this.workers=[];this.workers.length<e;)c.workers.push(new d)}return this.active[b]=!0,this.workers.slice()},e.prototype.release=function(a){delete this.active[a],0===Object.keys(this.active).length&&(this.workers.forEach(function(a){a.terminate()}),this.workers=null)},b.exports=e},{"../mapbox-gl":24,"./web_worker":109}],131:[function(b,c,d){!function(b,e){"object"==typeof d&&"undefined"!=typeof c?c.exports=e():"function"==typeof a&&a.amd?a(e):b.glMatrix=e()}(this,function(){"use strict";function a(){var a=new Float32Array(3);return a[0]=0,a[1]=0,a[2]=0,a}function b(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a}function c(){var a=new Float32Array(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a}function d(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a}function e(){var a=new Float32Array(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a}function f(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+f*h,a[1]=e*i+g*h,a[2]=d*-h+f*i,a[3]=e*-h+g*i,a}function g(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*h,a[2]=f*i,a[3]=g*i,a}function h(){var a=new Float32Array(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a}function i(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a}function j(){var a=new Float32Array(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function k(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function l(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null}function m(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a}function n(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a}function o(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a}function p(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a}function q(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a}function r(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a}function s(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a}var t=(a(),c(),{vec3:{transformMat3:b},vec4:{transformMat4:d},mat2:{create:e,rotate:f,scale:g},mat3:{create:h,fromRotation:i},mat4:{create:j,identity:k,translate:n,scale:o,multiply:m,perspective:r,rotateX:p,rotateZ:q,invert:l,ortho:s}});return t})},{}],132:[function(a,b,c){function d(a){return a=Math.round(a),0>a?0:a>255?255:a}function e(a){return 0>a?0:a>1?1:a}function f(a){return d("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function g(a){return e("%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))}function h(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a}function i(a){var b=a.replace(/ /g,"").toLowerCase();if(b in j)return j[b].slice();if("#"===b[0]){if(4===b.length){var c=parseInt(b.substr(1),16);return c>=0&&4095>=c?[(3840&c)>>4|(3840&c)>>8,240&c|(240&c)>>4,15&c|(15&c)<<4,1]:null}if(7===b.length){var c=parseInt(b.substr(1),16);return c>=0&&16777215>=c?[(16711680&c)>>16,(65280&c)>>8,255&c,1]:null}return null}var e=b.indexOf("("),i=b.indexOf(")");if(-1!==e&&i+1===b.length){var k=b.substr(0,e),l=b.substr(e+1,i-(e+1)).split(","),m=1;switch(k){case"rgba":if(4!==l.length)return null;m=g(l.pop());case"rgb":return 3!==l.length?null:[f(l[0]),f(l[1]),f(l[2]),m];case"hsla":if(4!==l.length)return null;m=g(l.pop());case"hsl":if(3!==l.length)return null;var n=(parseFloat(l[0])%360+360)%360/360,o=g(l[1]),p=g(l[2]),q=.5>=p?p*(o+1):p+o-p*o,r=2*p-q;return[d(255*h(r,q,n+1/3)),d(255*h(r,q,n)),d(255*h(r,q,n-1/3)),m];default:return null}}return null}var j={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{c.parseCSSColor=i}catch(k){}},{}],133:[function(a,b,c){"use strict";function d(a,b,c){c=c||2;var d=b&&b.length,f=d?b[0]*c:a.length,h=e(a,0,f,c,!0),i=[];if(!h)return i;var j,k,m,n,o,p,q;if(d&&(h=l(a,b,h,c)),a.length>80*c){j=m=a[0],k=n=a[1];for(var r=c;f>r;r+=c)o=a[r],p=a[r+1],j>o&&(j=o),k>p&&(k=p),o>m&&(m=o),p>n&&(n=p);q=Math.max(m-j,n-k)}return g(h,i,c,j,k,q),i}function e(a,b,c,d,e){var f,g;if(e===F(a,b,c,d)>0)for(f=b;c>f;f+=d)g=C(f,a[f],a[f+1],g);else for(f=c-d;f>=b;f-=d)g=C(f,a[f],a[f+1],g);return g&&w(g,g.next)&&(D(g),g=g.next),g}function f(a,b){if(!a)return a;b||(b=a);var c,d=a;do if(c=!1,d.steiner||!w(d,d.next)&&0!==v(d.prev,d,d.next))d=d.next;else{if(D(d),d=b=d.prev,d===d.next)return null;c=!0}while(c||d!==b);return b}function g(a,b,c,d,e,l,m){if(a){!m&&l&&p(a,d,e,l);for(var n,o,q=a;a.prev!==a.next;)if(n=a.prev,o=a.next,l?i(a,d,e,l):h(a))b.push(n.i/c),b.push(a.i/c),b.push(o.i/c),D(a),a=o.next,q=o.next;else if(a=o,a===q){m?1===m?(a=j(a,b,c),g(a,b,c,d,e,l,2)):2===m&&k(a,b,c,d,e,l):g(f(a),b,c,d,e,l,1);break}}}function h(a){var b=a.prev,c=a,d=a.next;if(v(b,c,d)>=0)return!1;for(var e=a.next.next;e!==a.prev;){if(t(b.x,b.y,c.x,c.y,d.x,d.y,e.x,e.y)&&v(e.prev,e,e.next)>=0)return!1;e=e.next}return!0}function i(a,b,c,d){var e=a.prev,f=a,g=a.next;if(v(e,f,g)>=0)return!1;for(var h=e.x<f.x?e.x<g.x?e.x:g.x:f.x<g.x?f.x:g.x,i=e.y<f.y?e.y<g.y?e.y:g.y:f.y<g.y?f.y:g.y,j=e.x>f.x?e.x>g.x?e.x:g.x:f.x>g.x?f.x:g.x,k=e.y>f.y?e.y>g.y?e.y:g.y:f.y>g.y?f.y:g.y,l=r(h,i,b,c,d),m=r(j,k,b,c,d),n=a.nextZ;n&&n.z<=m;){if(n!==a.prev&&n!==a.next&&t(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&v(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(n=a.prevZ;n&&n.z>=l;){if(n!==a.prev&&n!==a.next&&t(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&v(n.prev,n,n.next)>=0)return!1;n=n.prevZ}return!0}function j(a,b,c){var d=a;do{var e=d.prev,f=d.next.next;!w(e,f)&&x(e,d,d.next,f)&&z(e,f)&&z(f,e)&&(b.push(e.i/c),b.push(d.i/c),b.push(f.i/c),D(d),D(d.next),d=a=f),d=d.next}while(d!==a);return d}function k(a,b,c,d,e,h){var i=a;do{for(var j=i.next.next;j!==i.prev;){if(i.i!==j.i&&u(i,j)){var k=B(i,j);return i=f(i,i.next),k=f(k,k.next),g(i,b,c,d,e,h),void g(k,b,c,d,e,h)}j=j.next}i=i.next}while(i!==a)}function l(a,b,c,d){var g,h,i,j,k,l=[];for(g=0,h=b.length;h>g;g++)i=b[g]*d,j=h-1>g?b[g+1]*d:a.length,k=e(a,i,j,d,!1),k===k.next&&(k.steiner=!0),l.push(s(k));for(l.sort(m),g=0;g<l.length;g++)n(l[g],c),c=f(c,c.next);return c}function m(a,b){return a.x-b.x}function n(a,b){if(b=o(a,b)){var c=B(b,a);f(c,c.next)}}function o(a,b){var c,d=b,e=a.x,f=a.y,g=-(1/0);do{if(f<=d.y&&f>=d.next.y){var h=d.x+(f-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(e>=h&&h>g){if(g=h,h===e){if(f===d.y)return d;if(f===d.next.y)return d.next;
}c=d.x<d.next.x?d:d.next}}d=d.next}while(d!==b);if(!c)return null;if(e===g)return c.prev;var i,j=c,k=c.x,l=c.y,m=1/0;for(d=c.next;d!==j;)e>=d.x&&d.x>=k&&t(l>f?e:g,f,k,l,l>f?g:e,f,d.x,d.y)&&(i=Math.abs(f-d.y)/(e-d.x),(m>i||i===m&&d.x>c.x)&&z(d,a)&&(c=d,m=i)),d=d.next;return c}function p(a,b,c,d){var e=a;do null===e.z&&(e.z=r(e.x,e.y,b,c,d)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==a);e.prevZ.nextZ=null,e.prevZ=null,q(e)}function q(a){var b,c,d,e,f,g,h,i,j=1;do{for(c=a,a=null,f=null,g=0;c;){for(g++,d=c,h=0,b=0;j>b&&(h++,d=d.nextZ);b++);for(i=j;h>0||i>0&&d;)0===h?(e=d,d=d.nextZ,i--):0!==i&&d?c.z<=d.z?(e=c,c=c.nextZ,h--):(e=d,d=d.nextZ,i--):(e=c,c=c.nextZ,h--),f?f.nextZ=e:a=e,e.prevZ=f,f=e;c=d}f.nextZ=null,j*=2}while(g>1);return a}function r(a,b,c,d,e){return a=32767*(a-c)/e,b=32767*(b-d)/e,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),a|b<<1}function s(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function t(a,b,c,d,e,f,g,h){return(e-g)*(b-h)-(a-g)*(f-h)>=0&&(a-g)*(d-h)-(c-g)*(b-h)>=0&&(c-g)*(f-h)-(e-g)*(d-h)>=0}function u(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!y(a,b)&&z(a,b)&&z(b,a)&&A(a,b)}function v(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function w(a,b){return a.x===b.x&&a.y===b.y}function x(a,b,c,d){return!!(w(a,b)&&w(c,d)||w(a,d)&&w(c,b))||v(a,b,c)>0!=v(a,b,d)>0&&v(c,d,a)>0!=v(c,d,b)>0}function y(a,b){var c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&x(c,c.next,a,b))return!0;c=c.next}while(c!==a);return!1}function z(a,b){return v(a.prev,a,a.next)<0?v(a,b,a.next)>=0&&v(a,a.prev,b)>=0:v(a,b,a.prev)<0||v(a,a.next,b)<0}function A(a,b){var c=a,d=!1,e=(a.x+b.x)/2,f=(a.y+b.y)/2;do c.y>f!=c.next.y>f&&e<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==a);return d}function B(a,b){var c=new E(a.i,a.x,a.y),d=new E(b.i,b.x,b.y),e=a.next,f=b.prev;return a.next=b,b.prev=a,c.next=e,e.prev=c,d.next=c,c.prev=d,f.next=d,d.prev=f,d}function C(a,b,c,d){var e=new E(a,b,c);return d?(e.next=d.next,e.prev=d,d.next.prev=e,d.next=e):(e.prev=e,e.next=e),e}function D(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function E(a,b,c){this.i=a,this.x=b,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function F(a,b,c,d){for(var e=0,f=b,g=c-d;c>f;f+=d)e+=(a[g]-a[f])*(a[f+1]+a[g+1]),g=f;return e}b.exports=d,d.deviation=function(a,b,c,d){var e=b&&b.length,f=e?b[0]*c:a.length,g=Math.abs(F(a,0,f,c));if(e)for(var h=0,i=b.length;i>h;h++){var j=b[h]*c,k=i-1>h?b[h+1]*c:a.length;g-=Math.abs(F(a,j,k,c))}var l=0;for(h=0;h<d.length;h+=3){var m=d[h]*c,n=d[h+1]*c,o=d[h+2]*c;l+=Math.abs((a[m]-a[o])*(a[n+1]-a[m+1])-(a[m]-a[n])*(a[o+1]-a[m+1]))}return 0===g&&0===l?0:Math.abs((l-g)/g)},d.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var f=0;f<a[e].length;f++)for(var g=0;b>g;g++)c.vertices.push(a[e][f][g]);e>0&&(d+=a[e-1].length,c.holes.push(d))}return c}},{}],134:[function(a,b,c){function d(a){var b,c,e,j,k,l;switch(typeof a){case"object":if(null===a)return null;if(f(a)){for(e="[",c=a.length-1,b=0;c>b;b++)e+=d(a[b])+",";return c>-1&&(e+=d(a[b])),e+"]"}for(j=g(a).sort(),c=j.length,e="{",k=j[b=0],l=c>0&&void 0!==a[k];c>b;)l?(e+='"'+k.replace(h,i)+'":'+d(a[k]),k=j[++b],l=c>b&&void 0!==a[k],l&&(e+=",")):(k=j[++b],l=c>b&&void 0!==a[k]);return e+"}";case"undefined":return null;case"string":return'"'+a.replace(h,i)+'"';default:return a}}var e={}.toString,f=Array.isArray||function(a){return"[object Array]"===e.call(a)},g=Object.keys||function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},h=/[\u0000-\u001f"\\]/g,i=function(a){var b=a.charCodeAt(0);switch(b){case 34:return'\\"';case 92:return"\\\\";case 12:return"\\f";case 10:return"\\n";case 13:return"\\r";case 9:return"\\t";case 8:return"\\b";default:return b>15?"\\u00"+b.toString(16):"\\u000"+b.toString(16)}};b.exports=function(a){return void 0!==a?""+d(a):void 0},b.exports.stringSearch=h,b.exports.stringReplace=i},{}],135:[function(a,b,c){"use strict";function d(a){return new Function("f","var p = (f && f.properties || {}); return "+e(a))}function e(a){if(!a)return"true";var b=a[0];if(a.length<=1)return"any"===b?"false":"true";var c="=="===b?g(a[1],a[2],"===",!1):"!="===b?g(a[1],a[2],"!==",!1):"<"===b||">"===b||"<="===b||">="===b?g(a[1],a[2],b,!0):"any"===b?h(a.slice(1),"||"):"all"===b?h(a.slice(1),"&&"):"none"===b?k(h(a.slice(1),"||")):"in"===b?i(a[1],a.slice(2)):"!in"===b?k(i(a[1],a.slice(2))):"has"===b?j(a[1]):"!has"===b?k(j([a[1]])):"true";return"("+c+")"}function f(a){return"$type"===a?"f.type":"$id"===a?"f.id":"p["+JSON.stringify(a)+"]"}function g(a,b,c,d){var e=f(a),g="$type"===a?m.indexOf(b):JSON.stringify(b);return(d?"typeof "+e+"=== typeof "+g+"&&":"")+e+c+g}function h(a,b){return a.map(e).join(b)}function i(a,b){"$type"===a&&(b=b.map(function(a){return m.indexOf(a)}));var c=JSON.stringify(b.sort(l)),d=f(a);return b.length<=200?c+".indexOf("+d+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+d+", "+c+",0,"+(b.length-1)+")"}function j(a){return JSON.stringify(a)+" in p"}function k(a){return"!("+a+")"}function l(a,b){return b>a?-1:a>b?1:0}b.exports=d;var m=["Unknown","Point","LineString","Polygon"]},{}],136:[function(a,b,c){function d(a){if("Polygon"===a.type)return e(a.coordinates);if("MultiPolygon"===a.type){for(var b=0,c=0;c<a.coordinates.length;c++)b+=e(a.coordinates[c]);return b}return null}function e(a){var b=0;if(a&&a.length>0){b+=Math.abs(f(a[0]));for(var c=1;c<a.length;c++)b-=Math.abs(f(a[c]))}return b}function f(a){var b=0;if(a.length>2){for(var c,d,e=0;e<a.length-1;e++)c=a[e],d=a[e+1],b+=g(d[0]-c[0])*(2+Math.sin(g(c[1]))+Math.sin(g(d[1])));b=b*h.RADIUS*h.RADIUS/2}return b}function g(a){return a*Math.PI/180}var h=a("wgs84");b.exports.geometry=d,b.exports.ring=f},{wgs84:212}],137:[function(a,b,c){function d(a,b){switch(a&&a.type||null){case"FeatureCollection":return a.features=a.features.map(e(d,b)),a;case"Feature":return a.geometry=d(a.geometry,b),a;case"Polygon":case"MultiPolygon":return f(a,b);default:return a}}function e(a,b){return function(c){return a(c,b)}}function f(a,b){return"Polygon"===a.type?a.coordinates=g(a.coordinates,b):"MultiPolygon"===a.type&&(a.coordinates=a.coordinates.map(e(g,b))),a}function g(a,b){b=!!b,a[0]=h(a[0],!b);for(var c=1;c<a.length;c++)a[c]=h(a[c],b);return a}function h(a,b){return i(a)===b?a:a.reverse()}function i(a){return j.ring(a)>=0}var j=a("geojson-area");b.exports=d},{"geojson-area":136}],138:[function(a,b,c){"use strict";function d(a,b,c,d,g,i,j,k){if(c/=b,d/=b,j>=c&&d>=k)return a;if(j>d||c>k)return null;for(var l=[],m=0;m<a.length;m++){var n,o,p=a[m],q=p.geometry,r=p.type;if(n=p.min[g],o=p.max[g],n>=c&&d>=o)l.push(p);else if(!(n>d||c>o)){var s=1===r?e(q,c,d,g):f(q,c,d,g,i,3===r);s.length&&l.push(h(p.tags,r,s,p.id))}}return l.length?l:null}function e(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=g[d];h>=b&&c>=h&&e.push(g)}return e}function f(a,b,c,d,e,f){for(var h=[],i=0;i<a.length;i++){var j,k,l,m=0,n=0,o=null,p=a[i],q=p.area,r=p.dist,s=p.outer,t=p.length,u=[];for(k=0;t-1>k;k++)j=o||p[k],o=p[k+1],m=n||j[d],n=o[d],b>m?n>c?(u.push(e(j,o,b),e(j,o,c)),f||(u=g(h,u,q,r,s))):n>=b&&u.push(e(j,o,b)):m>c?b>n?(u.push(e(j,o,c),e(j,o,b)),f||(u=g(h,u,q,r,s))):c>=n&&u.push(e(j,o,c)):(u.push(j),b>n?(u.push(e(j,o,b)),f||(u=g(h,u,q,r,s))):n>c&&(u.push(e(j,o,c)),f||(u=g(h,u,q,r,s))));j=p[t-1],m=j[d],m>=b&&c>=m&&u.push(j),l=u[u.length-1],f&&l&&(u[0][0]!==l[0]||u[0][1]!==l[1])&&u.push(u[0]),g(h,u,q,r,s)}return h}function g(a,b,c,d,e){return b.length&&(b.area=c,b.dist=d,void 0!==e&&(b.outer=e),a.push(b)),[]}b.exports=d;var h=a("./feature")},{"./feature":140}],139:[function(a,b,c){"use strict";function d(a,b){var c=[];if("FeatureCollection"===a.type)for(var d=0;d<a.features.length;d++)e(c,a.features[d],b);else"Feature"===a.type?e(c,a,b):e(c,{geometry:a},b);return c}function e(a,b,c){if(null!==b.geometry){var d,h,i,k,l=b.geometry,m=l.type,n=l.coordinates,o=b.properties,p=b.id;if("Point"===m)a.push(j(o,1,[g(n)],p));else if("MultiPoint"===m)a.push(j(o,1,f(n),p));else if("LineString"===m)a.push(j(o,2,[f(n,c)],p));else if("MultiLineString"===m||"Polygon"===m){for(i=[],d=0;d<n.length;d++)k=f(n[d],c),"Polygon"===m&&(k.outer=0===d),i.push(k);a.push(j(o,"Polygon"===m?3:2,i,p))}else if("MultiPolygon"===m){for(i=[],d=0;d<n.length;d++)for(h=0;h<n[d].length;h++)k=f(n[d][h],c),k.outer=0===h,i.push(k);a.push(j(o,3,i,p))}else{if("GeometryCollection"!==m)throw new Error("Input data is not a valid GeoJSON object.");for(d=0;d<l.geometries.length;d++)e(a,{geometry:l.geometries[d],properties:o},c)}}}function f(a,b){for(var c=[],d=0;d<a.length;d++)c.push(g(a[d]));return b&&(i(c,b),h(c)),c}function g(a){var b=Math.sin(a[1]*Math.PI/180),c=a[0]/360+.5,d=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return d=0>d?0:d>1?1:d,[c,d,0]}function h(a){for(var b,c,d=0,e=0,f=0;f<a.length-1;f++)b=c||a[f],c=a[f+1],d+=b[0]*c[1]-c[0]*b[1],e+=Math.abs(c[0]-b[0])+Math.abs(c[1]-b[1]);a.area=Math.abs(d/2),a.dist=e}b.exports=d;var i=a("./simplify"),j=a("./feature")},{"./feature":140,"./simplify":142}],140:[function(a,b,c){"use strict";function d(a,b,c,d){var f={id:d||null,type:b,geometry:c,tags:a||null,min:[1/0,1/0],max:[-(1/0),-(1/0)]};return e(f),f}function e(a){var b=a.geometry,c=a.min,d=a.max;if(1===a.type)f(c,d,b);else for(var e=0;e<b.length;e++)f(c,d,b[e]);return a}function f(a,b,c){for(var d,e=0;e<c.length;e++)d=c[e],a[0]=Math.min(d[0],a[0]),b[0]=Math.max(d[0],b[0]),a[1]=Math.min(d[1],a[1]),b[1]=Math.max(d[1],b[1])}b.exports=d},{}],141:[function(a,b,c){"use strict";function d(a,b){return new e(a,b)}function e(a,b){b=this.options=i(Object.create(this.options),b);var c=b.debug;c&&console.time("preprocess data");var d=1<<b.maxZoom,e=k(a,b.tolerance/(d*b.extent));this.tiles={},this.tileCoords=[],c&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",b.indexMaxZoom,b.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),e=n(e,b.buffer/b.extent,g),e.length&&this.splitTile(e,0,0,0),c&&(e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function f(a,b,c){return 32*((1<<a)*c+b)+a}function g(a,b,c){return[c,(c-a[0])*(b[1]-a[1])/(b[0]-a[0])+a[1],1]}function h(a,b,c){return[(c-a[1])*(b[0]-a[0])/(b[1]-a[1])+a[0],c,1]}function i(a,b){for(var c in b)a[c]=b[c];return a}function j(a,b,c){var d=a.source;if(1!==d.length)return!1;var e=d[0];if(3!==e.type||e.geometry.length>1)return!1;var f=e.geometry[0].length;if(5!==f)return!1;for(var g=0;f>g;g++){var h=l.point(e.geometry[0][g],b,a.z2,a.x,a.y);if(h[0]!==-c&&h[0]!==b+c||h[1]!==-c&&h[1]!==b+c)return!1}return!0}b.exports=d;var k=a("./convert"),l=a("./transform"),m=a("./clip"),n=a("./wrap"),o=a("./tile");e.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},e.prototype.splitTile=function(a,b,c,d,e,i,k){for(var l=[a,b,c,d],n=this.options,p=n.debug,q=null;l.length;){d=l.pop(),c=l.pop(),b=l.pop(),a=l.pop();var r=1<<b,s=f(b,c,d),t=this.tiles[s],u=b===n.maxZoom?0:n.tolerance/(r*n.extent);if(!t&&(p>1&&console.time("creation"),t=this.tiles[s]=o(a,r,c,d,u,b===n.maxZoom),this.tileCoords.push({z:b,x:c,y:d}),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",b,c,d,t.numFeatures,t.numPoints,t.numSimplified),console.timeEnd("creation"));var v="z"+b;this.stats[v]=(this.stats[v]||0)+1,this.total++}if(t.source=a,e){if(b===n.maxZoom||b===e)continue;var w=1<<e-b;if(c!==Math.floor(i/w)||d!==Math.floor(k/w))continue}else if(b===n.indexMaxZoom||t.numPoints<=n.indexMaxPoints)continue;if(n.solidChildren||!j(t,n.extent,n.buffer)){t.source=null,p>1&&console.time("clipping");var x,y,z,A,B,C,D=.5*n.buffer/n.extent,E=.5-D,F=.5+D,G=1+D;x=y=z=A=null,B=m(a,r,c-D,c+F,0,g,t.min[0],t.max[0]),C=m(a,r,c+E,c+G,0,g,t.min[0],t.max[0]),B&&(x=m(B,r,d-D,d+F,1,h,t.min[1],t.max[1]),y=m(B,r,d+E,d+G,1,h,t.min[1],t.max[1])),C&&(z=m(C,r,d-D,d+F,1,h,t.min[1],t.max[1]),A=m(C,r,d+E,d+G,1,h,t.min[1],t.max[1])),p>1&&console.timeEnd("clipping"),a.length&&(l.push(x||[],b+1,2*c,2*d),l.push(y||[],b+1,2*c,2*d+1),l.push(z||[],b+1,2*c+1,2*d),l.push(A||[],b+1,2*c+1,2*d+1))}else e&&(q=b)}return q},e.prototype.getTile=function(a,b,c){var d=this.options,e=d.extent,g=d.debug,h=1<<a;b=(b%h+h)%h;var i=f(a,b,c);if(this.tiles[i])return l.tile(this.tiles[i],e);g>1&&console.log("drilling down to z%d-%d-%d",a,b,c);for(var k,m=a,n=b,o=c;!k&&m>0;)m--,n=Math.floor(n/2),o=Math.floor(o/2),k=this.tiles[f(m,n,o)];if(!k||!k.source)return null;if(g>1&&console.log("found parent tile z%d-%d-%d",m,n,o),j(k,e,d.buffer))return l.tile(k,e);g>1&&console.time("drilling down");var p=this.splitTile(k.source,m,n,o,a,b,c);if(g>1&&console.timeEnd("drilling down"),null!==p){var q=1<<a-p;i=f(p,Math.floor(b/q),Math.floor(c/q))}return this.tiles[i]?l.tile(this.tiles[i],e):null}},{"./clip":138,"./convert":139,"./tile":143,"./transform":144,"./wrap":145}],142:[function(a,b,c){"use strict";function d(a,b){var c,d,f,g,h=b*b,i=a.length,j=0,k=i-1,l=[];for(a[j][2]=1,a[k][2]=1;k;){for(d=0,c=j+1;k>c;c++)f=e(a[c],a[j],a[k]),f>d&&(g=c,d=f);d>h?(a[g][2]=d,l.push(j),l.push(g),j=g):(k=l.pop(),j=l.pop())}}function e(a,b,c){var d=b[0],e=b[1],f=c[0],g=c[1],h=a[0],i=a[1],j=f-d,k=g-e;if(0!==j||0!==k){var l=((h-d)*j+(i-e)*k)/(j*j+k*k);l>1?(d=f,e=g):l>0&&(d+=j*l,e+=k*l)}return j=h-d,k=i-e,j*j+k*k}b.exports=d},{}],143:[function(a,b,c){"use strict";function d(a,b,c,d,f,g){for(var h={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:c,y:d,z2:b,transformed:!1,min:[2,1],max:[-1,0]},i=0;i<a.length;i++){h.numFeatures++,e(h,a[i],f,g);var j=a[i].min,k=a[i].max;j[0]<h.min[0]&&(h.min[0]=j[0]),j[1]<h.min[1]&&(h.min[1]=j[1]),k[0]>h.max[0]&&(h.max[0]=k[0]),k[1]>h.max[1]&&(h.max[1]=k[1])}return h}function e(a,b,c,d){var e,g,h,i,j=b.geometry,k=b.type,l=[],m=c*c;if(1===k)for(e=0;e<j.length;e++)l.push(j[e]),a.numPoints++,a.numSimplified++;else for(e=0;e<j.length;e++)if(h=j[e],d||!(2===k&&h.dist<c||3===k&&h.area<m)){var n=[];for(g=0;g<h.length;g++)i=h[g],(d||i[2]>m)&&(n.push(i),a.numSimplified++),a.numPoints++;3===k&&f(n,h.outer),l.push(n)}else a.numPoints+=h.length;if(l.length){var o={geometry:l,type:k,tags:b.tags||null};null!==b.id&&(o.id=b.id),a.features.push(o)}}function f(a,b){var c=g(a);0>c===b&&a.reverse()}function g(a){for(var b,c,d=0,e=0,f=a.length,g=f-1;f>e;g=e++)b=a[e],c=a[g],d+=(c[0]-b[0])*(b[1]+c[1]);return d}b.exports=d},{}],144:[function(a,b,c){"use strict";function d(a,b){if(a.transformed)return a;var c,d,f,g=a.z2,h=a.x,i=a.y;for(c=0;c<a.features.length;c++){var j=a.features[c],k=j.geometry,l=j.type;if(1===l)for(d=0;d<k.length;d++)k[d]=e(k[d],b,g,h,i);else for(d=0;d<k.length;d++){var m=k[d];for(f=0;f<m.length;f++)m[f]=e(m[f],b,g,h,i)}}return a.transformed=!0,a}function e(a,b,c,d,e){var f=Math.round(b*(a[0]*c-d)),g=Math.round(b*(a[1]*c-e));return[f,g]}c.tile=d,c.point=e},{}],145:[function(a,b,c){"use strict";function d(a,b,c){var d=a,f=g(a,1,-1-b,b,0,c,-1,2),h=g(a,1,1-b,2+b,0,c,-1,2);return(f||h)&&(d=g(a,1,-b,1+b,0,c,-1,2)||[],f&&(d=e(f,1).concat(d)),h&&(d=d.concat(e(h,-1)))),d}function e(a,b){for(var c=[],d=0;d<a.length;d++){var e,g=a[d],i=g.type;if(1===i)e=f(g.geometry,b);else{e=[];for(var j=0;j<g.geometry.length;j++)e.push(f(g.geometry[j],b))}c.push(h(g.tags,i,e,g.id))}return c}function f(a,b){var c=[];c.area=a.area,c.dist=a.dist;for(var d=0;d<a.length;d++)c.push([a[d][0]+b,a[d][1],a[d][2]]);return c}var g=a("./clip"),h=a("./feature");b.exports=d},{"./clip":138,"./feature":140}],146:[function(a,b,c){"use strict";function d(a,b,c){var d=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],b=f[1],c=f[2],this.d=b+2*c;for(var g=0;g<this.d*this.d;g++){var h=f[e+g],i=f[e+g+1];d.push(h===i?null:f.subarray(h,i))}var j=f[e+d.length],k=f[e+d.length+1];this.keys=f.subarray(j,k),this.bboxes=f.subarray(k),this.insert=this._insertReadonly}else{this.d=b+2*c;for(var l=0;l<this.d*this.d;l++)d.push([]);this.keys=[],this.bboxes=[]}this.n=b,this.extent=a,this.padding=c,this.scale=b/a,this.uid=0;var m=c/b*a;this.min=-m,this.max=a+m}b.exports=d;var e=3;d.prototype.insert=function(a,b,c,d,e){this._forEachCell(b,c,d,e,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(b),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(e)},d.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},d.prototype._insertCell=function(a,b,c,d,e,f){this.cells[e].push(f)},d.prototype.query=function(a,b,c,d){var e=this.min,f=this.max;if(e>=a&&e>=b&&c>=f&&d>=f)return Array.prototype.slice.call(this.keys);var g=[],h={};return this._forEachCell(a,b,c,d,this._queryCell,g,h),g},d.prototype._queryCell=function(a,b,c,d,e,f,g){var h=this.cells[e];if(null!==h)for(var i=this.keys,j=this.bboxes,k=0;k<h.length;k++){var l=h[k];if(void 0===g[l]){var m=4*l;a<=j[m+2]&&b<=j[m+3]&&c>=j[m+0]&&d>=j[m+1]?(g[l]=!0,f.push(i[l])):g[l]=!1}}},d.prototype._forEachCell=function(a,b,c,d,e,f,g){for(var h=this._convertToCellCoord(a),i=this._convertToCellCoord(b),j=this._convertToCellCoord(c),k=this._convertToCellCoord(d),l=h;j>=l;l++)for(var m=i;k>=m;m++){var n=this.d*m+l;if(e.call(this,a,b,c,d,n,f,g))return}},d.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},d.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,b=e+this.cells.length+1+1,c=0,d=0;d<this.cells.length;d++)c+=this.cells[d].length;var f=new Int32Array(b+c+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=b,h=0;h<a.length;h++){var i=a[h];f[e+h]=g,f.set(i,g),g+=i.length}return f[e+a.length]=g,f.set(this.keys,g),g+=this.keys.length,f[e+a.length+1]=g,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer}},{}],147:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],148:[function(a,b,c){"use strict";function d(a,b,c,d,f){return new e(a,b,c,d,f)}function e(a,b,c,d,e){b=b||f,c=c||g,e=e||Array,this.nodeSize=d||64,this.points=a,this.ids=new e(a.length),this.coords=new e(2*a.length);for(var i=0;i<a.length;i++)this.ids[i]=i,this.coords[2*i]=b(a[i]),this.coords[2*i+1]=c(a[i]);h(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function f(a){return a[0]}function g(a){return a[1]}var h=a("./sort"),i=a("./range"),j=a("./within");b.exports=d,e.prototype={range:function(a,b,c,d){return i(this.ids,this.coords,a,b,c,d,this.nodeSize)},within:function(a,b,c){return j(this.ids,this.coords,a,b,c,this.nodeSize)}}},{"./range":149,"./sort":150,"./within":151}],149:[function(a,b,c){"use strict";function d(a,b,c,d,e,f,g){for(var h,i,j=[0,a.length-1,0],k=[];j.length;){var l=j.pop(),m=j.pop(),n=j.pop();if(g>=m-n)for(var o=n;m>=o;o++)h=b[2*o],i=b[2*o+1],h>=c&&e>=h&&i>=d&&f>=i&&k.push(a[o]);else{var p=Math.floor((n+m)/2);h=b[2*p],i=b[2*p+1],h>=c&&e>=h&&i>=d&&f>=i&&k.push(a[p]);var q=(l+1)%2;(0===l?h>=c:i>=d)&&(j.push(n),j.push(p-1),j.push(q)),(0===l?e>=h:f>=i)&&(j.push(p+1),j.push(m),j.push(q))}}return k}b.exports=d},{}],150:[function(a,b,c){"use strict";function d(a,b,c,f,g,h){if(!(c>=g-f)){var i=Math.floor((f+g)/2);e(a,b,i,f,g,h%2),d(a,b,c,f,i-1,h+1),d(a,b,c,i+1,g,h+1)}}function e(a,b,c,d,g,h){for(;g>d;){if(g-d>600){var i=g-d+1,j=c-d+1,k=Math.log(i),l=.5*Math.exp(2*k/3),m=.5*Math.sqrt(k*l*(i-l)/i)*(0>j-i/2?-1:1),n=Math.max(d,Math.floor(c-j*l/i+m)),o=Math.min(g,Math.floor(c+(i-j)*l/i+m));e(a,b,c,n,o,h)}var p=b[2*c+h],q=d,r=g;for(f(a,b,d,c),b[2*g+h]>p&&f(a,b,d,g);r>q;){for(f(a,b,q,r),q++,r--;b[2*q+h]<p;)q++;for(;b[2*r+h]>p;)r--}b[2*d+h]===p?f(a,b,d,r):(r++,f(a,b,r,g)),c>=r&&(d=r+1),r>=c&&(g=r-1)}}function f(a,b,c,d){g(a,c,d),g(b,2*c,2*d),g(b,2*c+1,2*d+1)}function g(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}b.exports=d},{}],151:[function(a,b,c){"use strict";function d(a,b,c,d,f,g){for(var h=[0,a.length-1,0],i=[],j=f*f;h.length;){var k=h.pop(),l=h.pop(),m=h.pop();if(g>=l-m)for(var n=m;l>=n;n++)e(b[2*n],b[2*n+1],c,d)<=j&&i.push(a[n]);else{var o=Math.floor((m+l)/2),p=b[2*o],q=b[2*o+1];e(p,q,c,d)<=j&&i.push(a[o]);var r=(k+1)%2;(0===k?p>=c-f:q>=d-f)&&(h.push(m),h.push(o-1),h.push(r)),(0===k?c+f>=p:d+f>=q)&&(h.push(o+1),h.push(l),h.push(r))}}return i}function e(a,b,c,d){var e=a-c,f=b-d;return e*e+f*f}b.exports=d},{}],152:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function f(a,b,c,e,h,i){return a===b||(null==a||null==b||!k(a)&&!d(b)?a!==a&&b!==b:g(a,b,f,c,e,h,i))}function g(a,b,c,d,e,f,g){var k=l(a),n=l(b),q=p,r=p;k||(q=z.call(a),q==o?q=u:q!=u&&(k=m(a))),n||(r=z.call(b),r==o?r=u:r!=u&&(n=m(b)));var s=q==u,t=r==u,v=q==r;if(v&&!k&&!s)return i(a,b,q);if(!e){var w=s&&y.call(a,"__wrapped__"),x=t&&y.call(b,"__wrapped__");if(w||x)return c(w?a.value():a,x?b.value():b,d,e,f,g)}if(!v)return!1;f||(f=[]),g||(g=[]);for(var A=f.length;A--;)if(f[A]==a)return g[A]==b;f.push(a),g.push(b);var B=(k?h:j)(a,b,c,d,e,f,g);return f.pop(),g.pop(),B}function h(a,b,c,d,f,g,h){var i=-1,j=a.length,k=b.length;if(j!=k&&!(f&&k>j))return!1;for(;++i<j;){var l=a[i],m=b[i],n=d?d(f?m:l,f?l:m,i):void 0;if(void 0!==n){if(n)continue;return!1}if(f){if(!e(b,function(a){return l===a||c(l,a,d,f,g,h)}))return!1}else if(l!==m&&!c(l,m,d,f,g,h))return!1}return!0}function i(a,b,c){switch(c){case q:case r:return+a==+b;case s:return a.name==b.name&&a.message==b.message;case t:return a!=+a?b!=+b:a==+b;case v:case w:return a==b+""}return!1}function j(a,b,c,d,e,f,g){var h=n(a),i=h.length,j=n(b),k=j.length;if(i!=k&&!e)return!1;for(var l=i;l--;){var m=h[l];if(!(e?m in b:y.call(b,m)))return!1}for(var o=e;++l<i;){m=h[l];var p=a[m],q=b[m],r=d?d(e?q:p,e?p:q,m):void 0;if(!(void 0===r?c(p,q,d,e,f,g):r))return!1;o||(o="constructor"==m)}if(!o){var s=a.constructor,t=b.constructor;if(s!=t&&"constructor"in a&&"constructor"in b&&!("function"==typeof s&&s instanceof s&&"function"==typeof t&&t instanceof t))return!1}return!0}function k(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}var l=a("lodash.isarray"),m=a("lodash.istypedarray"),n=a("lodash.keys"),o="[object Arguments]",p="[object Array]",q="[object Boolean]",r="[object Date]",s="[object Error]",t="[object Number]",u="[object Object]",v="[object RegExp]",w="[object String]",x=Object.prototype,y=x.hasOwnProperty,z=x.toString;b.exports=f},{"lodash.isarray":156,"lodash.istypedarray":157,"lodash.keys":158}],153:[function(a,b,c){function d(a,b,c){if("function"!=typeof a)return e;if(void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}function e(a){return a}b.exports=d},{}],154:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a,b){var c=null==a?void 0:a[b];return h(c)?c:void 0}function f(a){return g(a)&&n.call(a)==i}function g(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function h(a){return null!=a&&(f(a)?o.test(l.call(a)):d(a)&&j.test(a))}var i="[object Function]",j=/^\[object .+?Constructor\]$/,k=Object.prototype,l=Function.prototype.toString,m=k.hasOwnProperty,n=k.toString,o=RegExp("^"+l.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");b.exports=e},{}],155:[function(a,b,c){function d(a){return f(a)&&p.call(a,"callee")&&(!r.call(a,"callee")||q.call(a)==l)}function e(a){return null!=a&&h(a.length)&&!g(a)}function f(a){return j(a)&&e(a)}function g(a){var b=i(a)?q.call(a):"";return b==m||b==n}function h(a){return"number"==typeof a&&a>-1&&a%1==0&&k>=a}function i(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function j(a){return!!a&&"object"==typeof a}var k=9007199254740991,l="[object Arguments]",m="[object Function]",n="[object GeneratorFunction]",o=Object.prototype,p=o.hasOwnProperty,q=o.toString,r=o.propertyIsEnumerable;b.exports=d},{}],156:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a,b){var c=null==a?void 0:a[b];return i(c)?c:void 0}function f(a){return"number"==typeof a&&a>-1&&a%1==0&&s>=a}function g(a){return h(a)&&p.call(a)==k}function h(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function i(a){return null!=a&&(g(a)?q.test(n.call(a)):d(a)&&l.test(a))}var j="[object Array]",k="[object Function]",l=/^\[object .+?Constructor\]$/,m=Object.prototype,n=Function.prototype.toString,o=m.hasOwnProperty,p=m.toString,q=RegExp("^"+n.call(o).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),r=e(Array,"isArray"),s=9007199254740991,t=r||function(a){return d(a)&&f(a.length)&&p.call(a)==j};b.exports=t},{}],157:[function(a,b,c){function d(a){return"number"==typeof a&&a>-1&&a%1==0&&g>=a}function e(a){return!!a&&"object"==typeof a}function f(a){return e(a)&&d(a.length)&&!!F[H.call(a)]}var g=9007199254740991,h="[object Arguments]",i="[object Array]",j="[object Boolean]",k="[object Date]",l="[object Error]",m="[object Function]",n="[object Map]",o="[object Number]",p="[object Object]",q="[object RegExp]",r="[object Set]",s="[object String]",t="[object WeakMap]",u="[object ArrayBuffer]",v="[object DataView]",w="[object Float32Array]",x="[object Float64Array]",y="[object Int8Array]",z="[object Int16Array]",A="[object Int32Array]",B="[object Uint8Array]",C="[object Uint8ClampedArray]",D="[object Uint16Array]",E="[object Uint32Array]",F={};F[w]=F[x]=F[y]=F[z]=F[A]=F[B]=F[C]=F[D]=F[E]=!0,F[h]=F[i]=F[u]=F[j]=F[v]=F[k]=F[l]=F[m]=F[n]=F[o]=F[p]=F[q]=F[r]=F[s]=F[t]=!1;var G=Object.prototype,H=G.toString;b.exports=f},{}],158:[function(a,b,c){function d(a){return function(b){return null==b?void 0:b[a]}}function e(a){return null!=a&&g(s(a))}function f(a,b){return a="number"==typeof a||n.test(a)?+a:-1,b=null==b?r:b,a>-1&&a%1==0&&b>a}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&r>=a}function h(a){for(var b=j(a),c=b.length,d=c&&a.length,e=!!d&&g(d)&&(m(a)||l(a)),h=-1,i=[];++h<c;){var k=b[h];(e&&f(k,d)||p.call(a,k))&&i.push(k)}return i}function i(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function j(a){if(null==a)return[];i(a)||(a=Object(a));var b=a.length;b=b&&g(b)&&(m(a)||l(a))&&b||0;for(var c=a.constructor,d=-1,e="function"==typeof c&&c.prototype===a,h=Array(b),j=b>0;++d<b;)h[d]=d+"";for(var k in a)j&&f(k,b)||"constructor"==k&&(e||!p.call(a,k))||h.push(k);return h}var k=a("lodash._getnative"),l=a("lodash.isarguments"),m=a("lodash.isarray"),n=/^\d+$/,o=Object.prototype,p=o.hasOwnProperty,q=k(Object,"keys"),r=9007199254740991,s=d("length"),t=q?function(a){var b=null==a?void 0:a.constructor;return"function"==typeof b&&b.prototype===a||"function"!=typeof a&&e(a)?h(a):i(a)?q(a):[]}:h;b.exports=t},{"lodash._getnative":154,"lodash.isarguments":155,"lodash.isarray":156}],159:[function(a,b,c){function d(a){return a>r?Math.pow(a,1/3):a/q+o}function e(a){return a>p?a*a*a:q*(a-o)}function f(a){return 255*(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function g(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function h(a){var b=g(a[0]),c=g(a[1]),e=g(a[2]),f=d((.4124564*b+.3575761*c+.1804375*e)/l),h=d((.2126729*b+.7151522*c+.072175*e)/m),i=d((.0193339*b+.119192*c+.9503041*e)/n);return[116*h-16,500*(f-h),200*(h-i),a[3]]}function i(a){var b=(a[0]+16)/116,c=isNaN(a[1])?b:b+a[1]/500,d=isNaN(a[2])?b:b-a[2]/200;return b=m*e(b),c=l*e(c),d=n*e(d),[f(3.2404542*c-1.5371385*b-.4985314*d),f(-.969266*c+1.8760108*b+.041556*d),f(.0556434*c-.2040259*b+1.0572252*d),a[3]]}function j(a){var b=h(a),c=b[0],d=b[1],e=b[2],f=Math.atan2(e,d)*t;return[0>f?f+360:f,Math.sqrt(d*d+e*e),c,a[3]]}function k(a){var b=a[0]*s,c=a[1],d=a[2];return i([d,Math.cos(b)*c,Math.sin(b)*c,a[3]])}var l=.95047,m=1,n=1.08883,o=4/29,p=6/29,q=3*p*p,r=p*p*p,s=Math.PI/180,t=180/Math.PI;b.exports={lab:{forward:h,reverse:i},hcl:{forward:j,reverse:k}}},{}],160:[function(a,b,c){"use strict";function d(a){return a}function e(a,b){var c;if(n(a)){var j,k=a.stops&&"object"==typeof a.stops[0][0],l=k||void 0!==a.property,m=k||!l,p=a.stops&&typeof(k?a.stops[0][0].property:a.stops[0][0]),q=a.type||b||("string"===p?"categorical":"exponential");if("exponential"===q)j=h;else if("interval"===q)j=g;else if("categorical"===q)j=f;else{if("identity"!==q)throw new Error('Unknown function type "'+q+'"');j=i}var r;if(a.colorSpace&&"rgb"!==a.colorSpace){if(!o[a.colorSpace])throw new Error("Unknown color space: "+a.colorSpace);var s=o[a.colorSpace];a=JSON.parse(JSON.stringify(a));for(var t=0;t<a.stops.length;t++)a.stops[t]=[a.stops[t][0],s.forward(a.stops[t][1])];r=s.reverse}else r=d;if(j===f)for(var u=Object.create(null),v=0;v<a.stops.length;v++)u[a.stops[v][0]]=a.stops[v][1];if(k){var w={},x=[];for(t=0;t<a.stops.length;t++){var y=a.stops[t];void 0===w[y[0].zoom]&&(w[y[0].zoom]={zoom:y[0].zoom,type:a.type,property:a.property,stops:[]}),w[y[0].zoom].stops.push([y[0].value,y[1]])}for(var z in w)x.push([w[z].zoom,e(w[z])]);c=function(b,c){return r(h({stops:x,base:a.base},b)(b,c))},c.isFeatureConstant=!1,c.isZoomConstant=!1}else m?(c=function(b){return r(j===f?j(a,b,u):j(a,b))},c.isFeatureConstant=!0,c.isZoomConstant=!1):(c=function(b,c){return r(j===f?j(a,c[a.property],u):j(a,c[a.property]))},c.isFeatureConstant=!1,c.isZoomConstant=!0)}else c=function(){return a},c.isFeatureConstant=!0,c.isZoomConstant=!0;return c}function f(a,b,c){var d=c[b];return void 0===d?a.stops[0][1]:d}function g(a,b){var c=a.stops.length;if(1===c)return a.stops[0][1];if(void 0===b||null===b)return a.stops[c-1][1];if(b<=a.stops[0][0])return a.stops[0][1];if(b>=a.stops[c-1][0])return a.stops[c-1][1];var d=j(a.stops,b);return a.stops[d][1]}function h(a,b){var c=void 0!==a.base?a.base:1,d=a.stops.length;if(1===d)return a.stops[0][1];if(void 0===b||null===b)return a.stops[d-1][1];if(b<=a.stops[0][0])return a.stops[0][1];if(b>=a.stops[d-1][0])return a.stops[d-1][1];var e=j(a.stops,b);return k(b,c,a.stops[e][0],a.stops[e+1][0],a.stops[e][1],a.stops[e+1][1])}function i(a,b){return b}function j(a,b){for(var c,d,e=a.length,f=0,g=e-1,h=0;g>=f;){if(h=Math.floor((f+g)/2),c=a[h][0],d=a[h+1][0],b>=c&&d>b)return h;b>c?f=h+1:c>b&&(g=h-1)}return Math.max(h-1,0)}function k(a,b,c,d,e,f){return"function"==typeof e?function(){var g=e.apply(void 0,arguments),h=f.apply(void 0,arguments);return k(a,b,c,d,g,h)}:e.length?m(a,b,c,d,e,f):l(a,b,c,d,e,f)}function l(a,b,c,d,e,f){var g,h=d-c,i=a-c;return g=1===b?i/h:(Math.pow(b,i)-1)/(Math.pow(b,h)-1),e*(1-g)+f*g}function m(a,b,c,d,e,f){for(var g=[],h=0;h<e.length;h++)g[h]=l(a,b,c,d,e[h],f[h]);return g}function n(a){return"object"==typeof a&&(a.stops||"identity"===a.type)}var o=a("./color_spaces");b.exports.isFunctionDefinition=n,b.exports.interpolated=function(a){
return e(a,"exponential")},b.exports["piecewise-constant"]=function(a){return e(a,"interval")}},{"./color_spaces":159}],161:[function(a,b,c){"use strict";function d(a,b){var c={};for(var d in a)"ref"!==d&&(c[d]=a[d]);return f.forEach(function(a){a in b&&(c[a]=b[a])}),c}function e(a){a=a.slice();var b,c=Object.create(null);for(b=0;b<a.length;b++)c[a[b].id]=a[b];for(b=0;b<a.length;b++)"ref"in a[b]&&(a[b]=d(a[b],c[a[b].ref]));return a}var f=a("./util/ref_properties");b.exports=e},{"./util/ref_properties":167}],162:[function(a,b,c){"use strict";function d(a,b,c,d){a=a||{},b=b||{};var e;for(e in a)a.hasOwnProperty(e)&&(b.hasOwnProperty(e)||(c.push({command:k.removeSource,args:[e]}),d[e]=!0));for(e in b)b.hasOwnProperty(e)&&(a.hasOwnProperty(e)?j(a[e],b[e])||(c.push({command:k.removeSource,args:[e]}),c.push({command:k.addSource,args:[e,b[e]]}),d[e]=!0):c.push({command:k.addSource,args:[e,b[e]]}))}function e(a,b,c,d,e,f){a=a||{},b=b||{};var g;for(g in a)a.hasOwnProperty(g)&&(j(a[g],b[g])||c.push({command:f,args:[d,g,b[g],e]}));for(g in b)b.hasOwnProperty(g)&&!a.hasOwnProperty(g)&&(j(a[g],b[g])||c.push({command:f,args:[d,g,b[g],e]}))}function f(a){return a.id}function g(a,b){return a[b.id]=b,a}function h(a,b,c){a=a||[],b=b||[];var d,h,i,l,m,n,o,p=a.map(f),q=b.map(f),r=a.reduce(g,{}),s=b.reduce(g,{}),t=p.slice(),u=Object.create(null);for(d=0,h=0;d<p.length;d++)i=p[d],s.hasOwnProperty(i)?h++:(c.push({command:k.removeLayer,args:[i]}),t.splice(t.indexOf(i,h),1));for(d=0,h=0;d<q.length;d++)i=q[q.length-1-d],t[t.length-1-d]!==i&&(r.hasOwnProperty(i)?(c.push({command:k.removeLayer,args:[i]}),t.splice(t.lastIndexOf(i,t.length-h),1)):h++,n=t[t.length-d],c.push({command:k.addLayer,args:[s[i],n]}),t.splice(t.length-d,0,i),u[i]=!0);for(d=0;d<q.length;d++)if(i=q[d],l=r[i],m=s[i],!u[i]&&!j(l,m))if(j(l.source,m.source)&&j(l["source-layer"],m["source-layer"])&&j(l.type,m.type)){e(l.layout,m.layout,c,i,null,k.setLayoutProperty),e(l.paint,m.paint,c,i,null,k.setPaintProperty),j(l.filter,m.filter)||c.push({command:k.setFilter,args:[i,m.filter]}),j(l.minzoom,m.minzoom)&&j(l.maxzoom,m.maxzoom)||c.push({command:k.setLayerZoomRange,args:[i,m.minzoom,m.maxzoom]});for(o in l)l.hasOwnProperty(o)&&"layout"!==o&&"paint"!==o&&"filter"!==o&&"metadata"!==o&&"minzoom"!==o&&"maxzoom"!==o&&(0===o.indexOf("paint.")?e(l[o],m[o],c,i,o.slice(6),k.setPaintProperty):j(l[o],m[o])||c.push({command:k.setLayerProperty,args:[i,o,m[o]]}));for(o in m)m.hasOwnProperty(o)&&!l.hasOwnProperty(o)&&"layout"!==o&&"paint"!==o&&"filter"!==o&&"metadata"!==o&&"minzoom"!==o&&"maxzoom"!==o&&(0===o.indexOf("paint.")?e(l[o],m[o],c,i,o.slice(6),k.setPaintProperty):j(l[o],m[o])||c.push({command:k.setLayerProperty,args:[i,o,m[o]]}))}else c.push({command:k.removeLayer,args:[i]}),n=t[t.lastIndexOf(i)+1],c.push({command:k.addLayer,args:[m,n]})}function i(a,b){if(!a)return[{command:k.setStyle,args:[b]}];var c=[];try{if(!j(a.version,b.version))return[{command:k.setStyle,args:[b]}];j(a.center,b.center)||c.push({command:k.setCenter,args:[b.center]}),j(a.zoom,b.zoom)||c.push({command:k.setZoom,args:[b.zoom]}),j(a.bearing,b.bearing)||c.push({command:k.setBearing,args:[b.bearing]}),j(a.pitch,b.pitch)||c.push({command:k.setPitch,args:[b.pitch]}),j(a.sprite,b.sprite)||c.push({command:k.setSprite,args:[b.sprite]}),j(a.glyphs,b.glyphs)||c.push({command:k.setGlyphs,args:[b.glyphs]}),j(a.transition,b.transition)||c.push({command:k.setTransition,args:[b.transition]}),j(a.light,b.light)||c.push({command:k.setLight,args:[b.light]});var e={},f=[];d(a.sources,b.sources,f,e);var g=[];a.layers&&a.layers.forEach(function(a){e[a.source]?c.push({command:k.removeLayer,args:[a.id]}):g.push(a)}),c=c.concat(f),h(g,b.layers,c)}catch(a){console.warn("Unable to compute style diff:",a),c=[{command:k.setStyle,args:[b]}]}return c}var j=a("lodash.isequal"),k={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};b.exports=i,b.exports.operations=k},{"lodash.isequal":187}],163:[function(a,b,c){"use strict";function d(a,b){this.message=(a?a+": ":"")+e.apply(e,Array.prototype.slice.call(arguments,2)),null!==b&&void 0!==b&&b.__line__&&(this.line=b.__line__)}var e=a("util").format;b.exports=d},{util:203}],164:[function(a,b,c){"use strict";function d(a){return g(f.map(function(b){return a[b]}))}function e(a){var b,c,e={};for(b=0;b<a.length;b++){c=d(a[b]);var f=e[c];f||(f=e[c]=[]),f.push(a[b])}var g=[];for(c in e)g.push(e[c]);return g}var f=a("./util/ref_properties"),g=a("fast-stable-stringify");b.exports=e},{"./util/ref_properties":167,"fast-stable-stringify":134}],165:[function(a,b,c){"use strict";b.exports=function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}},{}],166:[function(a,b,c){"use strict";b.exports=function(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}},{}],167:[function(a,b,c){"use strict";b.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"]},{}],168:[function(a,b,c){"use strict";b.exports=function(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}},{}],169:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("../util/get_type"),f=a("../util/extend");b.exports=function(b){var c=a("./validate_function"),g=a("./validate_object"),h={"*":function(){return[]},array:a("./validate_array"),"boolean":a("./validate_boolean"),number:a("./validate_number"),color:a("./validate_color"),constants:a("./validate_constants"),"enum":a("./validate_enum"),filter:a("./validate_filter"),"function":a("./validate_function"),layer:a("./validate_layer"),object:a("./validate_object"),source:a("./validate_source"),light:a("./validate_light"),string:a("./validate_string")},i=b.value,j=b.valueSpec,k=b.key,l=b.styleSpec,m=b.style;if("string"===e(i)&&"@"===i[0]){if(l.$version>7)return[new d(k,i,"constants have been deprecated as of v8")];if(!(i in m.constants))return[new d(k,i,'constant "%s" not found',i)];b=f({},b,{value:m.constants[i]})}return j["function"]&&"object"===e(i)?c(b):j.type&&h[j.type]?h[j.type](b):g(f({},b,{valueSpec:j.type?l[j.type]:j}))}},{"../error/validation_error":163,"../util/extend":165,"../util/get_type":166,"./validate_array":170,"./validate_boolean":171,"./validate_color":172,"./validate_constants":173,"./validate_enum":174,"./validate_filter":175,"./validate_function":176,"./validate_layer":178,"./validate_light":180,"./validate_number":181,"./validate_object":182,"./validate_source":184,"./validate_string":185}],170:[function(a,b,c){"use strict";var d=a("../util/get_type"),e=a("./validate"),f=a("../error/validation_error");b.exports=function(a){var b=a.value,c=a.valueSpec,g=a.style,h=a.styleSpec,i=a.key,j=a.arrayElementValidator||e;if("array"!==d(b))return[new f(i,b,"array expected, %s found",d(b))];if(c.length&&b.length!==c.length)return[new f(i,b,"array length %d expected, length %d found",c.length,b.length)];if(c["min-length"]&&b.length<c["min-length"])return[new f(i,b,"array length at least %d expected, length %d found",c["min-length"],b.length)];var k={type:c.value};h.$version<7&&(k["function"]=c["function"]),"object"===d(c.value)&&(k=c.value);for(var l=[],m=0;m<b.length;m++)l=l.concat(j({array:b,arrayIndex:m,value:b[m],valueSpec:k,style:g,styleSpec:h,key:i+"["+m+"]"}));return l}},{"../error/validation_error":163,"../util/get_type":166,"./validate":169}],171:[function(a,b,c){"use strict";var d=a("../util/get_type"),e=a("../error/validation_error");b.exports=function(a){var b=a.value,c=a.key,f=d(b);return"boolean"!==f?[new e(c,b,"boolean expected, %s found",f)]:[]}},{"../error/validation_error":163,"../util/get_type":166}],172:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("../util/get_type"),f=a("csscolorparser").parseCSSColor;b.exports=function(a){var b=a.key,c=a.value,g=e(c);return"string"!==g?[new d(b,c,"color expected, %s found",g)]:null===f(c)?[new d(b,c,'color expected, "%s" found',c)]:[]}},{"../error/validation_error":163,"../util/get_type":166,csscolorparser:132}],173:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("../util/get_type");b.exports=function(a){var b=a.key,c=a.value,f=a.styleSpec;if(f.$version>7)return c?[new d(b,c,"constants have been deprecated as of v8")]:[];var g=e(c);if("object"!==g)return[new d(b,c,"object expected, %s found",g)];var h=[];for(var i in c)"@"!==i[0]&&h.push(new d(b+"."+i,c[i],'constants must start with "@"'));return h}},{"../error/validation_error":163,"../util/get_type":166}],174:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("../util/unbundle_jsonlint");b.exports=function(a){var b=a.key,c=a.value,f=a.valueSpec,g=[];return Array.isArray(f.values)?-1===f.values.indexOf(e(c))&&g.push(new d(b,c,"expected one of [%s], %s found",f.values.join(", "),c)):-1===Object.keys(f.values).indexOf(e(c))&&g.push(new d(b,c,"expected one of [%s], %s found",Object.keys(f.values).join(", "),c)),g}},{"../error/validation_error":163,"../util/unbundle_jsonlint":168}],175:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("./validate_enum"),f=a("../util/get_type"),g=a("../util/unbundle_jsonlint");b.exports=function h(a){var b,c=a.value,i=a.key,j=a.styleSpec,k=[];if("array"!==f(c))return[new d(i,c,"array expected, %s found",f(c))];if(c.length<1)return[new d(i,c,"filter array must have at least 1 element")];switch(k=k.concat(e({key:i+"[0]",value:c[0],valueSpec:j.filter_operator,style:a.style,styleSpec:a.styleSpec})),g(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&"$type"==c[1]&&k.push(new d(i,c,'"$type" cannot be use with operator "%s"',c[0]));case"==":case"!=":3!=c.length&&k.push(new d(i,c,'filter array for operator "%s" must have 3 elements',c[0]));case"in":case"!in":c.length>=2&&(b=f(c[1]),"string"!==b?k.push(new d(i+"[1]",c[1],"string expected, %s found",b)):"@"===c[1][0]&&k.push(new d(i+"[1]",c[1],"filter key cannot be a constant")));for(var l=2;l<c.length;l++)b=f(c[l]),"$type"==c[1]?k=k.concat(e({key:i+"["+l+"]",value:c[l],valueSpec:j.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"===b&&"@"===c[l][0]?k.push(new d(i+"["+l+"]",c[l],"filter value cannot be a constant")):"string"!==b&&"number"!==b&&"boolean"!==b&&k.push(new d(i+"["+l+"]",c[l],"string, number, or boolean expected, %s found",b));break;case"any":case"all":case"none":for(l=1;l<c.length;l++)k=k.concat(h({key:i+"["+l+"]",value:c[l],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":b=f(c[1]),2!==c.length?k.push(new d(i,c,'filter array for "%s" operator must have 2 elements',c[0])):"string"!==b?k.push(new d(i+"[1]",c[1],"string expected, %s found",b)):"@"===c[1][0]&&k.push(new d(i+"[1]",c[1],"filter key cannot be a constant"))}return k}},{"../error/validation_error":163,"../util/get_type":166,"../util/unbundle_jsonlint":168,"./validate_enum":174}],176:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("../util/get_type"),f=a("./validate"),g=a("./validate_object"),h=a("./validate_array"),i=a("./validate_number"),j=a("../util/unbundle_jsonlint");b.exports=function(a){function b(a){if("identity"===n)return[new d(a.key,a.value,'identity function may not have a "stops" property')];var b=[],f=a.value;return b=b.concat(h({key:a.key,value:f,valueSpec:a.valueSpec,style:a.style,styleSpec:a.styleSpec,arrayElementValidator:c})),"array"===e(f)&&0===f.length&&b.push(new d(a.key,f,"array must have at least one stop")),b}function c(a){var b=[],c=a.value,h=a.key;if("array"!==e(c))return[new d(h,c,"array expected, %s found",e(c))];if(2!==c.length)return[new d(h,c,"array length %d expected, length %d found",2,c.length)];if(q){if("object"!==e(c[0]))return[new d(h,c,"object expected, %s found",e(c[0]))];if(void 0===c[0].zoom)return[new d(h,c,"object stop key must have zoom")];if(void 0===c[0].value)return[new d(h,c,"object stop key must have value")];b=b.concat(g({key:h+"[0]",value:c[0],valueSpec:{zoom:{}},style:a.style,styleSpec:a.styleSpec,objectElementValidators:{zoom:i,value:k}}))}else b=b.concat((o?i:k)({key:h+"[0]",value:c[0],valueSpec:{},style:a.style,styleSpec:a.styleSpec}));return b=b.concat(f({key:h+"[1]",value:c[1],valueSpec:m,style:a.style,styleSpec:a.styleSpec})),"number"===e(c[0])&&("piecewise-constant"===m["function"]&&c[0]%1!==0&&b.push(new d(h+"[0]",c[0],"zoom level for piecewise-constant functions must be an integer")),0!==a.arrayIndex&&c[0]<a.array[a.arrayIndex-1][0]&&b.push(new d(h+"[0]",c[0],"array stops must appear in ascending order"))),b}function k(a){var b=e(a.value);if(l){if(b!==l)return[new d(a.key,a.value,"%s stop domain type must match previous stop domain type %s",b,l)]}else l=b,n||"string"!==b||(n="categorical");return"number"!==b&&"string"!==b?[new d(a.key,a.value,"property value must be a number or string")]:"number"!==b&&"categorical"!==n?[new d(a.key,a.value,"number expected, %s found",b)]:[]}var l,m=a.valueSpec,n=j(a.value.type),o=void 0===a.value.property,p=void 0!==a.value.property,q="array"===e(a.value.stops)&&"array"===e(a.value.stops[0])&&"object"===e(a.value.stops[0][0]),r=g({key:a.key,value:a.value,valueSpec:a.styleSpec["function"],style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:b}});return"identity"===n||a.value.stops||r.push(new d(a.key,a.value,'missing required property "stops"')),a.styleSpec.$version>=8&&(p&&!a.valueSpec["property-function"]?r.push(new d(a.key,a.value,"property functions not supported")):o&&!a.valueSpec["zoom-function"]&&r.push(new d(a.key,a.value,"zoom functions not supported"))),r}},{"../error/validation_error":163,"../util/get_type":166,"../util/unbundle_jsonlint":168,"./validate":169,"./validate_array":170,"./validate_number":181,"./validate_object":182}],177:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("./validate_string");b.exports=function(a){var b=a.value,c=a.key,f=e(a);return f.length?f:(-1===b.indexOf("{fontstack}")&&f.push(new d(c,b,'"glyphs" url must include a "{fontstack}" token')),-1===b.indexOf("{range}")&&f.push(new d(c,b,'"glyphs" url must include a "{range}" token')),f)}},{"../error/validation_error":163,"./validate_string":185}],178:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("../util/unbundle_jsonlint"),f=a("./validate_object"),g=a("./validate_filter"),h=a("./validate_paint_property"),i=a("./validate_layout_property"),j=a("../util/extend");b.exports=function(a){var b=[],c=a.value,k=a.key,l=a.style,m=a.styleSpec;c.type||c.ref||b.push(new d(k,c,'either "type" or "ref" is required'));var n=e(c.type),o=e(c.ref);if(c.id)for(var p=0;p<a.arrayIndex;p++){var q=l.layers[p];e(q.id)===e(c.id)&&b.push(new d(k,c.id,'duplicate layer id "%s", previously used at line %d',c.id,q.id.__line__))}if("ref"in c){["type","source","source-layer","filter","layout"].forEach(function(a){a in c&&b.push(new d(k,c[a],'"%s" is prohibited for ref layers',a))});var r;l.layers.forEach(function(a){a.id==o&&(r=a)}),r?r.ref?b.push(new d(k,c.ref,"ref cannot reference another ref layer")):n=e(r.type):b.push(new d(k,c.ref,'ref layer "%s" not found',o))}else if("background"!==n)if(c.source){var s=l.sources&&l.sources[c.source];s?"vector"==s.type&&"raster"==n?b.push(new d(k,c.source,'layer "%s" requires a raster source',c.id)):"raster"==s.type&&"raster"!=n?b.push(new d(k,c.source,'layer "%s" requires a vector source',c.id)):"vector"!=s.type||c["source-layer"]||b.push(new d(k,c,'layer "%s" must specify a "source-layer"',c.id)):b.push(new d(k,c.source,'source "%s" not found',c.source))}else b.push(new d(k,c,'missing required property "source"'));return b=b.concat(f({key:k,value:c,valueSpec:m.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},filter:g,layout:function(a){return f({layer:c,key:a.key,value:a.value,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(a){return i(j({layerType:n},a))}}})},paint:function(a){return f({layer:c,key:a.key,value:a.value,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(a){return h(j({layerType:n},a))}}})}}}))}},{"../error/validation_error":163,"../util/extend":165,"../util/unbundle_jsonlint":168,"./validate_filter":175,"./validate_layout_property":179,"./validate_object":182,"./validate_paint_property":183}],179:[function(a,b,c){"use strict";var d=a("./validate"),e=a("../error/validation_error");b.exports=function(a){var b=a.key,c=a.style,f=a.styleSpec,g=a.value,h=a.objectKey,i=f["layout_"+a.layerType];if(!i)return[];if(a.valueSpec||i[h]){var j=[];return"symbol"===a.layerType&&("icon-image"===h&&c&&!c.sprite?j.push(new e(b,g,'use of "icon-image" requires a style "sprite" property')):"text-field"===h&&c&&!c.glyphs&&j.push(new e(b,g,'use of "text-field" requires a style "glyphs" property'))),j.concat(d({key:a.key,value:g,valueSpec:a.valueSpec||i[h],style:c,styleSpec:f}))}return[new e(b,g,'unknown property "%s"',h)]}},{"../error/validation_error":163,"./validate":169}],180:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("../util/get_type"),f=a("./validate");b.exports=function(a){var b=a.value,c=a.styleSpec,g=c.light,h=a.style,i=[],j=e(b);if(void 0===b)return i;if("object"!==j)return i=i.concat([new d("light",b,"object expected, %s found",j)]);for(var k in b){var l=k.match(/^(.*)-transition$/);i=l&&g[l[1]]&&g[l[1]].transition?i.concat(f({key:k,value:b[k],valueSpec:c.transition,style:h,styleSpec:c})):g[k]?i.concat(f({key:k,value:b[k],valueSpec:g[k],style:h,styleSpec:c})):i.concat([new d(k,b[k],'unknown property "%s"',k)])}return i}},{"../error/validation_error":163,"../util/get_type":166,"./validate":169}],181:[function(a,b,c){"use strict";var d=a("../util/get_type"),e=a("../error/validation_error");b.exports=function(a){var b=a.key,c=a.value,f=a.valueSpec,g=d(c);return"number"!==g?[new e(b,c,"number expected, %s found",g)]:"minimum"in f&&c<f.minimum?[new e(b,c,"%s is less than the minimum value %s",c,f.minimum)]:"maximum"in f&&c>f.maximum?[new e(b,c,"%s is greater than the maximum value %s",c,f.maximum)]:[]}},{"../error/validation_error":163,"../util/get_type":166}],182:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("../util/get_type"),f=a("./validate");b.exports=function(a){var b=a.key,c=a.value,g=a.valueSpec||{},h=a.objectElementValidators||{},i=a.style,j=a.styleSpec,k=[],l=e(c);if("object"!==l)return[new d(b,c,"object expected, %s found",l)];for(var m in c){var n,o=m.split(".")[0],p=g[o]||g["*"];if(h[o])n=h[o];else if(g[o])n=f;else if(h["*"])n=h["*"];else{if(!g["*"]){k.push(new d(b,c[m],'unknown property "%s"',m));continue}n=f}k=k.concat(n({key:(b?b+".":b)+m,value:c[m],valueSpec:p,style:i,styleSpec:j,object:c,objectKey:m}))}for(o in g)g[o].required&&void 0===g[o]["default"]&&void 0===c[o]&&k.push(new d(b,c,'missing required property "%s"',o));return k}},{"../error/validation_error":163,"../util/get_type":166,"./validate":169}],183:[function(a,b,c){"use strict";var d=a("./validate"),e=a("../error/validation_error");b.exports=function(a){var b=a.key,c=a.style,f=a.styleSpec,g=a.value,h=a.objectKey,i=f["paint_"+a.layerType];if(!i)return[];var j=h.match(/^(.*)-transition$/);return j&&i[j[1]]&&i[j[1]].transition?d({key:b,value:g,valueSpec:f.transition,style:c,styleSpec:f}):a.valueSpec||i[h]?d({key:a.key,value:g,valueSpec:a.valueSpec||i[h],style:c,styleSpec:f}):[new e(b,g,'unknown property "%s"',h)]}},{"../error/validation_error":163,"./validate":169}],184:[function(a,b,c){"use strict";var d=a("../error/validation_error"),e=a("../util/unbundle_jsonlint"),f=a("./validate_object"),g=a("./validate_enum");b.exports=function(a){var b=a.value,c=a.key,h=a.styleSpec,i=a.style;if(!b.type)return[new d(c,b,'"type" is required')];var j=e(b.type);switch(j){case"vector":case"raster":var k=[];if(k=k.concat(f({key:c,value:b,valueSpec:h.source_tile,style:a.style,styleSpec:h})),"url"in b)for(var l in b)["type","url","tileSize"].indexOf(l)<0&&k.push(new d(c+"."+l,b[l],'a source with a "url" property may not include a "%s" property',l));return k;case"geojson":return f({key:c,value:b,valueSpec:h.source_geojson,style:i,styleSpec:h});case"video":return f({key:c,value:b,valueSpec:h.source_video,style:i,styleSpec:h});case"image":return f({key:c,value:b,valueSpec:h.source_image,style:i,styleSpec:h});default:return g({key:c+".type",value:b.type,valueSpec:{values:["vector","raster","geojson","video","image"]},style:i,styleSpec:h})}}},{"../error/validation_error":163,"../util/unbundle_jsonlint":168,"./validate_enum":174,"./validate_object":182}],185:[function(a,b,c){"use strict";var d=a("../util/get_type"),e=a("../error/validation_error");b.exports=function(a){var b=a.value,c=a.key,f=d(b);return"string"!==f?[new e(c,b,"string expected, %s found",f)]:[]}},{"../error/validation_error":163,"../util/get_type":166}],186:[function(a,b,c){"use strict";function d(a,b){b=b||i;var c=[];return c=c.concat(h({key:"",value:a,valueSpec:b.$root,styleSpec:b,style:a,objectElementValidators:{glyphs:j,"*":function(){return[]}}})),b.$version>7&&a.constants&&(c=c.concat(g({key:"constants",value:a.constants,style:a,styleSpec:b}))),e(c)}function e(a){return[].concat(a).sort(function(a,b){return a.line-b.line})}function f(a){return function(){return e(a.apply(this,arguments))}}var g=a("./validate/validate_constants"),h=a("./validate/validate"),i=a("../reference/latest.min"),j=a("./validate/validate_glyphs_url");d.source=f(a("./validate/validate_source")),d.light=f(a("./validate/validate_light")),d.layer=f(a("./validate/validate_layer")),d.filter=f(a("./validate/validate_filter")),d.paintProperty=f(a("./validate/validate_paint_property")),d.layoutProperty=f(a("./validate/validate_layout_property")),b.exports=d},{"../reference/latest.min":188,"./validate/validate":169,"./validate/validate_constants":173,"./validate/validate_filter":175,"./validate/validate_glyphs_url":177,"./validate/validate_layer":178,"./validate/validate_layout_property":179,"./validate/validate_light":180,"./validate/validate_paint_property":183,"./validate/validate_source":184}],187:[function(a,b,c){function d(a,b,c,d){c="function"==typeof c?f(c,d,3):void 0;var g=c?c(a,b):void 0;return void 0===g?e(a,b,c):!!g}var e=a("lodash._baseisequal"),f=a("lodash._bindcallback");b.exports=d},{"lodash._baseisequal":152,"lodash._bindcallback":153}],188:[function(a,b,c){b.exports=a("./v8.min.json")},{"./v8.min.json":189}],189:[function(a,b,c){b.exports={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number","default":0,period:360,units:"degrees"},pitch:{type:"number","default":0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_tile","source_geojson","source_video","source_image"],source_tile:{type:{required:!0,type:"enum",values:{vector:{},raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},minzoom:{type:"number","default":0},maxzoom:{type:"number","default":22},tileSize:{type:"number","default":512,units:"pixels"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number","default":18},buffer:{type:"number","default":128,maximum:512,minimum:0},tolerance:{type:"number","default":.375},cluster:{type:"boolean","default":!1},clusterRadius:{type:"number","default":50,minimum:0},clusterMaxZoom:{type:"number"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},"fill-extrusion":{},raster:{},background:{}}},metadata:{type:"*"},ref:{type:"string"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"},"paint.*":{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_fill-extrusion","layout_symbol","layout_raster","layout_background"],layout_background:{visibility:{type:"enum","function":"piecewise-constant","zoom-function":!0,values:{visible:{},none:{}},"default":"visible"}},layout_fill:{visibility:{type:"enum","function":"piecewise-constant","zoom-function":!0,values:{visible:{},none:{}},"default":"visible"}},layout_circle:{visibility:{type:"enum","function":"piecewise-constant","zoom-function":!0,values:{visible:{},none:{}},"default":"visible"}},"layout_fill-extrusion":{visibility:{type:"enum","function":"piecewise-constant","zoom-function":!0,values:{visible:{},none:{}},"default":"visible"}},layout_line:{"line-cap":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{butt:{},round:{},square:{}},"default":"butt"},"line-join":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{bevel:{},round:{},miter:{}},"default":"miter"},"line-miter-limit":{type:"number","default":2,"function":"interpolated","zoom-function":!0,"property-function":!0,requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number","default":1.05,"function":"interpolated","zoom-function":!0,"property-function":!0,requires:[{"line-join":"round"}]},visibility:{type:"enum","function":"piecewise-constant","zoom-function":!0,values:{visible:{},none:{}},"default":"visible"}},layout_symbol:{"symbol-placement":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{point:{},line:{}},"default":"point"},"symbol-spacing":{type:"number","default":250,minimum:1,"function":"interpolated","zoom-function":!0,"property-function":!0,units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":!1},"icon-allow-overlap":{type:"boolean","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":!1,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":!1,requires:["icon-image"]},"icon-optional":{type:"boolean","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":!1,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{map:{},viewport:{},auto:{}},"default":"auto",requires:["icon-image"]},"icon-size":{type:"number","default":1,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,requires:["icon-image"]},"icon-text-fit":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!1,values:{none:{},width:{},height:{},both:{}},"default":"none",requires:["icon-image","text-field"]},"icon-text-fit-padding":{type:"array",value:"number",length:4,"default":[0,0,0,0],units:"pixels","function":"interpolated","zoom-function":!0,"property-function":!0,requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{type:"string","function":"piecewise-constant","zoom-function":!0,"property-function":!0,tokens:!0},"icon-rotate":{type:"number","default":0,period:360,"function":"interpolated","zoom-function":!0,"property-function":!0,units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number","default":2,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":!0,"property-function":!0,requires:["icon-image"]},"text-pitch-alignment":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{map:{},viewport:{},auto:{}},"default":"auto",requires:["text-field"]},"text-rotation-alignment":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{map:{},viewport:{},auto:{}},"default":"auto",requires:["text-field"]},"text-field":{type:"string","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":"",tokens:!0},"text-font":{type:"array",value:"string","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number","default":16,minimum:0,units:"pixels","function":"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-max-width":{type:"number","default":10,minimum:0,units:"ems","function":"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-line-height":{type:"number","default":1.2,units:"ems","function":"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-letter-spacing":{type:"number","default":0,units:"ems","function":"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-justify":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{left:{},center:{},right:{}},"default":"center",requires:["text-field"]},"text-anchor":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center",requires:["text-field"]},"text-max-angle":{type:"number","default":45,units:"degrees","function":"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number","default":0,period:360,units:"degrees","function":"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-padding":{type:"number","default":2,minimum:0,units:"pixels","function":"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-keep-upright":{type:"boolean","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{none:{},uppercase:{},lowercase:{}},"default":"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems","function":"interpolated","zoom-function":!0,"property-function":!0,length:2,"default":[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":!1,requires:["text-field"]},"text-ignore-placement":{type:"boolean","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":!1,requires:["text-field"]},"text-optional":{type:"boolean","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":!1,
requires:["text-field","icon-image"]},visibility:{type:"enum","function":"piecewise-constant","zoom-function":!0,values:{visible:{},none:{}},"default":"visible"}},layout_raster:{visibility:{type:"enum","function":"piecewise-constant","zoom-function":!0,values:{visible:{},none:{}},"default":"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},"function":{stops:{type:"array",value:"function_stop"},base:{type:"number","default":1,minimum:0},property:{type:"string","default":"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},"default":"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},"default":"rgb"}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},light:{anchor:{type:"enum","default":"viewport",values:{map:{},viewport:{}},transition:!1},position:{type:"array","default":[1.15,210,30],length:3,value:"number",transition:!0,"function":"interpolated","zoom-function":!0,"property-function":!1},color:{type:"color","default":"#ffffff","function":"interpolated","zoom-function":!0,"property-function":!1,transition:!0},intensity:{type:"number","default":.5,minimum:0,maximum:1,"function":"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_fill-extrusion","paint_symbol","paint_raster","paint_background"],paint_fill:{"fill-antialias":{type:"boolean","function":"piecewise-constant","zoom-function":!0,"property-function":!0,"default":!0},"fill-opacity":{type:"number","function":"interpolated","zoom-function":!0,"property-function":!0,"default":1,minimum:0,maximum:1,transition:!0},"fill-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color","function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"fill-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{map:{},viewport:{}},"default":"map",requires:["fill-translate"]},"fill-pattern":{type:"string","function":"piecewise-constant","zoom-function":!0,"property-function":!0,transition:!0}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number","function":"interpolated","zoom-function":!0,"property-function":!1,"default":1,minimum:0,maximum:1,transition:!0},"fill-extrusion-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"}]},"fill-extrusion-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":!0,"property-function":!1,transition:!0,units:"pixels"},"fill-extrusion-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!1,values:{map:{},viewport:{}},"default":"map",requires:["fill-extrusion-translate"]},"fill-extrusion-pattern":{type:"string","function":"piecewise-constant","zoom-function":!0,"property-function":!1,transition:!0},"fill-extrusion-height":{type:"number","function":"interpolated","zoom-function":!0,"property-function":!0,"default":0,minimum:0,units:"meters",transition:!0},"fill-extrusion-base":{type:"number","function":"interpolated","zoom-function":!0,"property-function":!0,"default":0,minimum:0,units:"meters",transition:!0,requires:[{"<=":"fill-extrusion-height"}]}},paint_line:{"line-opacity":{type:"number","function":"interpolated","zoom-function":!0,"property-function":!0,"default":1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{map:{},viewport:{}},"default":"map",requires:["line-translate"]},"line-width":{type:"number","default":1,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-gap-width":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-offset":{type:"number","default":0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-blur":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-dasharray":{type:"array",value:"number","function":"piecewise-constant","zoom-function":!0,"property-function":!0,minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string","function":"piecewise-constant","zoom-function":!0,"property-function":!0,transition:!0}},paint_circle:{"circle-radius":{type:"number","default":5,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-blur":{type:"number","default":0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{map:{},viewport:{}},"default":"map",requires:["circle-translate"]},"circle-pitch-scale":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{map:{},viewport:{}},"default":"map"},"circle-stroke-width":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-stroke-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-stroke-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0}},paint_symbol:{"icon-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-color":{type:"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-width":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{map:{},viewport:{}},"default":"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-color":{type:"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-width":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":!0,"property-function":!0,values:{map:{},viewport:{}},"default":"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":!0,transition:!0},"raster-hue-rotate":{type:"number","default":0,period:360,"function":"interpolated","zoom-function":!0,transition:!0,units:"degrees"},"raster-brightness-min":{type:"number","function":"interpolated","zoom-function":!0,"default":0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number","function":"interpolated","zoom-function":!0,"default":1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number","default":0,minimum:-1,maximum:1,"function":"interpolated","zoom-function":!0,transition:!0},"raster-contrast":{type:"number","default":0,minimum:-1,maximum:1,"function":"interpolated","zoom-function":!0,transition:!0},"raster-fade-duration":{type:"number","default":300,minimum:0,"function":"interpolated","zoom-function":!0,transition:!0,units:"milliseconds"}},paint_background:{"background-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":!0,transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string","function":"piecewise-constant","zoom-function":!0,transition:!0},"background-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":!0,transition:!0}},transition:{duration:{type:"number","default":300,minimum:0,units:"milliseconds"},delay:{type:"number","default":0,minimum:0,units:"milliseconds"}}}},{}],190:[function(a,b,c){"use strict";function d(a){return!!(e()&&f()&&g()&&h()&&i()&&j()&&k()&&l(a&&a.failIfMajorPerformanceCaveat))}function e(){return"undefined"!=typeof window&&"undefined"!=typeof document}function f(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function g(){return Function.prototype&&Function.prototype.bind}function h(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function i(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function j(){return"Worker"in window}function k(){return"Uint8ClampedArray"in window}function l(a){return void 0===n[a]&&(n[a]=m(a)),n[a]}function m(a){var b=document.createElement("canvas"),c=Object.create(d.webGLContextAttributes);return c.failIfMajorPerformanceCaveat=a,b.probablySupportsContext?b.probablySupportsContext("webgl",c)||b.probablySupportsContext("experimental-webgl",c):b.supportsContext?b.supportsContext("webgl",c)||b.supportsContext("experimental-webgl",c):b.getContext("webgl",c)||b.getContext("experimental-webgl",c)}"undefined"!=typeof b&&b.exports?b.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d);var n={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}},{}],191:[function(a,b,c){(function(a){function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a,b){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return 0>b&&(b=a.length+b),a.substr(b,c)}}).call(this,a("_process"))},{_process:195}],192:[function(a,b,c){"use strict";function d(a){var b;a&&a.length&&(b=a,a=b.length);var c=new Uint8Array(a||0);return b&&c.set(b),c.readUInt32LE=f.readUInt32LE,c.writeUInt32LE=f.writeUInt32LE,c.readInt32LE=f.readInt32LE,c.writeInt32LE=f.writeInt32LE,c.readFloatLE=f.readFloatLE,c.writeFloatLE=f.writeFloatLE,c.readDoubleLE=f.readDoubleLE,c.writeDoubleLE=f.writeDoubleLE,c.toString=f.toString,c.write=f.write,c.slice=f.slice,c.copy=f.copy,c._isBuffer=!0,c}function e(a){for(var b,c,d=a.length,e=[],f=0;d>f;f++){if(b=a.charCodeAt(f),b>55295&&57344>b){if(!c){b>56319||f+1===d?e.push(239,191,189):c=b;continue}if(56320>b){e.push(239,191,189),c=b;continue}b=c-55296<<10|b-56320|65536,c=null}else c&&(e.push(239,191,189),c=null);128>b?e.push(b):2048>b?e.push(b>>6|192,63&b|128):65536>b?e.push(b>>12|224,b>>6&63|128,63&b|128):e.push(b>>18|240,b>>12&63|128,b>>6&63|128,63&b|128)}return e}b.exports=d;var f,g,h,i=a("ieee754");f={readUInt32LE:function(a){return(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},writeUInt32LE:function(a,b){this[b]=a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24},readInt32LE:function(a){return(this[a]|this[a+1]<<8|this[a+2]<<16)+(this[a+3]<<24)},readFloatLE:function(a){return i.read(this,a,!0,23,4)},readDoubleLE:function(a){return i.read(this,a,!0,52,8)},writeFloatLE:function(a,b){return i.write(this,a,b,!0,23,4)},writeDoubleLE:function(a,b){return i.write(this,a,b,!0,52,8)},toString:function(a,b,c){var d="",e="";b=b||0,c=Math.min(this.length,c||this.length);for(var f=b;c>f;f++){var g=this[f];127>=g?(d+=decodeURIComponent(e)+String.fromCharCode(g),e=""):e+="%"+g.toString(16)}return d+=decodeURIComponent(e)},write:function(a,b){for(var c=a===g?h:e(a),d=0;d<c.length;d++)this[b+d]=c[d]},slice:function(a,b){return this.subarray(a,b)},copy:function(a,b){b=b||0;for(var c=0;c<this.length;c++)a[b+c]=this[c]}},f.writeInt32LE=f.writeUInt32LE,d.byteLength=function(a){return g=a,h=e(a),h.length},d.isBuffer=function(a){return!(!a||!a._isBuffer)}},{ieee754:147}],193:[function(a,b,c){(function(c){"use strict";function d(a){this.buf=q.isBuffer(a)?a:new q(a||0),this.pos=0,this.length=this.buf.length}function e(a,b){var c,d=b.buf;if(c=d[b.pos++],a+=268435456*(127&c),128>c)return a;if(c=d[b.pos++],a+=34359738368*(127&c),128>c)return a;if(c=d[b.pos++],a+=4398046511104*(127&c),128>c)return a;if(c=d[b.pos++],a+=562949953421312*(127&c),128>c)return a;if(c=d[b.pos++],a+=72057594037927940*(127&c),128>c)return a;if(c=d[b.pos++],a+=0x8000000000000000*(127&c),128>c)return a;throw new Error("Expected varint not more than 10 bytes")}function f(a,b){b.realloc(10);for(var c=b.pos+10;a>=1;){if(b.pos>=c)throw new Error("Given varint doesn't fit into 10 bytes");var d=255&a;b.buf[b.pos++]=d|(a>=128?128:0),a/=128}}function g(a,b,c){var d=16383>=b?1:2097151>=b?2:268435455>=b?3:Math.ceil(Math.log(b)/(7*Math.LN2));c.realloc(d);for(var e=c.pos-1;e>=a;e--)c.buf[e+d]=c.buf[e]}function h(a,b){for(var c=0;c<a.length;c++)b.writeVarint(a[c])}function i(a,b){for(var c=0;c<a.length;c++)b.writeSVarint(a[c])}function j(a,b){for(var c=0;c<a.length;c++)b.writeFloat(a[c])}function k(a,b){for(var c=0;c<a.length;c++)b.writeDouble(a[c])}function l(a,b){for(var c=0;c<a.length;c++)b.writeBoolean(a[c])}function m(a,b){for(var c=0;c<a.length;c++)b.writeFixed32(a[c])}function n(a,b){for(var c=0;c<a.length;c++)b.writeSFixed32(a[c])}function o(a,b){for(var c=0;c<a.length;c++)b.writeFixed64(a[c])}function p(a,b){for(var c=0;c<a.length;c++)b.writeSFixed64(a[c])}b.exports=d;var q=c.Buffer||a("./buffer");d.Varint=0,d.Fixed64=1,d.Bytes=2,d.Fixed32=5;var r=4294967296,s=1/r,t=Math.pow(2,63);d.prototype={destroy:function(){this.buf=null},readFields:function(a,b,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),e=d>>3,f=this.pos;a(e,b,this),this.pos===f&&this.skip(d)}return b},readMessage:function(a,b){return this.readFields(a,b,this.readVarint()+this.pos)},readFixed32:function(){var a=this.buf.readUInt32LE(this.pos);return this.pos+=4,a},readSFixed32:function(){var a=this.buf.readInt32LE(this.pos);return this.pos+=4,a},readFixed64:function(){var a=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*r;return this.pos+=8,a},readSFixed64:function(){var a=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*r;return this.pos+=8,a},readFloat:function(){var a=this.buf.readFloatLE(this.pos);return this.pos+=4,a},readDouble:function(){var a=this.buf.readDoubleLE(this.pos);return this.pos+=8,a},readVarint:function(){var a,b,c=this.buf;return b=c[this.pos++],a=127&b,128>b?a:(b=c[this.pos++],a|=(127&b)<<7,128>b?a:(b=c[this.pos++],a|=(127&b)<<14,128>b?a:(b=c[this.pos++],a|=(127&b)<<21,128>b?a:e(a,this))))},readVarint64:function(){var a=this.pos,b=this.readVarint();if(t>b)return b;for(var c=this.pos-2;255===this.buf[c];)c--;a>c&&(c=a),b=0;for(var d=0;c-a+1>d;d++){var e=127&~this.buf[a+d];b+=4>d?e<<7*d:e*Math.pow(2,7*d)}return-b-1},readSVarint:function(){var a=this.readVarint();return a%2===1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,b=this.buf.toString("utf8",this.pos,a);return this.pos=a,b},readBytes:function(){var a=this.readVarint()+this.pos,b=this.buf.slice(this.pos,a);return this.pos=a,b},readPackedVarint:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readVarint());return b},readPackedSVarint:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readSVarint());return b},readPackedBoolean:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readBoolean());return b},readPackedFloat:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readFloat());return b},readPackedDouble:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readDouble());return b},readPackedFixed32:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readFixed32());return b},readPackedSFixed32:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readSFixed32());return b},readPackedFixed64:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readFixed64());return b},readPackedSFixed64:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readSFixed64());return b},skip:function(a){var b=7&a;if(b===d.Varint)for(;this.buf[this.pos++]>127;);else if(b===d.Bytes)this.pos=this.readVarint()+this.pos;else if(b===d.Fixed32)this.pos+=4;else{if(b!==d.Fixed64)throw new Error("Unimplemented type: "+b);this.pos+=8}},writeTag:function(a,b){this.writeVarint(a<<3|b)},realloc:function(a){for(var b=this.length||16;b<this.pos+a;)b*=2;if(b!==this.length){var c=new q(b);this.buf.copy(c),this.buf=c,this.length=b}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(a){this.realloc(4),this.buf.writeUInt32LE(a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),this.buf.writeInt32LE(a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),this.buf.writeInt32LE(-1&a,this.pos),this.buf.writeUInt32LE(Math.floor(a*s),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),this.buf.writeInt32LE(-1&a,this.pos),this.buf.writeInt32LE(Math.floor(a*s),this.pos+4),this.pos+=8},writeVarint:function(a){return a=+a,a>268435455?void f(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),void(127>=a||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),127>=a||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),127>=a||(this.buf[this.pos++]=a>>>7&127)))))},writeSVarint:function(a){this.writeVarint(0>a?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a);var b=q.byteLength(a);this.writeVarint(b),this.realloc(b),this.buf.write(a,this.pos),this.pos+=b},writeFloat:function(a){this.realloc(4),this.buf.writeFloatLE(a,this.pos),this.pos+=4},writeDouble:function(a){this.realloc(8),this.buf.writeDoubleLE(a,this.pos),this.pos+=8},writeBytes:function(a){var b=a.length;this.writeVarint(b),this.realloc(b);for(var c=0;b>c;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,b){this.pos++;var c=this.pos;a(b,this);var d=this.pos-c;d>=128&&g(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,b,c){this.writeTag(a,d.Bytes),this.writeRawMessage(b,c)},writePackedVarint:function(a,b){this.writeMessage(a,h,b)},writePackedSVarint:function(a,b){this.writeMessage(a,i,b)},writePackedBoolean:function(a,b){this.writeMessage(a,l,b)},writePackedFloat:function(a,b){this.writeMessage(a,j,b)},writePackedDouble:function(a,b){this.writeMessage(a,k,b)},writePackedFixed32:function(a,b){this.writeMessage(a,m,b)},writePackedSFixed32:function(a,b){this.writeMessage(a,n,b)},writePackedFixed64:function(a,b){this.writeMessage(a,o,b)},writePackedSFixed64:function(a,b){this.writeMessage(a,p,b)},writeBytesField:function(a,b){this.writeTag(a,d.Bytes),this.writeBytes(b)},writeFixed32Field:function(a,b){this.writeTag(a,d.Fixed32),this.writeFixed32(b)},writeSFixed32Field:function(a,b){this.writeTag(a,d.Fixed32),this.writeSFixed32(b)},writeFixed64Field:function(a,b){this.writeTag(a,d.Fixed64),this.writeFixed64(b)},writeSFixed64Field:function(a,b){this.writeTag(a,d.Fixed64),this.writeSFixed64(b)},writeVarintField:function(a,b){this.writeTag(a,d.Varint),this.writeVarint(b)},writeSVarintField:function(a,b){this.writeTag(a,d.Varint),this.writeSVarint(b)},writeStringField:function(a,b){this.writeTag(a,d.Bytes),this.writeString(b)},writeFloatField:function(a,b){this.writeTag(a,d.Fixed32),this.writeFloat(b)},writeDoubleField:function(a,b){this.writeTag(a,d.Fixed64),this.writeDouble(b)},writeBooleanField:function(a,b){this.writeVarintField(a,Boolean(b))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":192}],194:[function(a,b,c){"use strict";function d(a,b){this.x=a,this.y=b}b.exports=d,d.prototype={clone:function(){return new d(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var b=a.x-this.x,c=a.y-this.y;return b*b+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,b){return Math.atan2(this.x*b-this.y*a,this.x*a+this.y*b)},_matMult:function(a){var b=a[0]*this.x+a[1]*this.y,c=a[2]*this.x+a[3]*this.y;return this.x=b,this.y=c,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=b*this.x-c*this.y,e=c*this.x+b*this.y;return this.x=d,this.y=e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},d.convert=function(a){return a instanceof d?a:Array.isArray(a)?new d(a[0],a[1]):a}},{}],195:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],196:[function(a,b,c){"use strict";function d(a,b,c,g,h){for(c=c||0,g=g||a.length-1,h=h||f;g>c;){if(g-c>600){var i=g-c+1,j=b-c+1,k=Math.log(i),l=.5*Math.exp(2*k/3),m=.5*Math.sqrt(k*l*(i-l)/i)*(0>j-i/2?-1:1),n=Math.max(c,Math.floor(b-j*l/i+m)),o=Math.min(g,Math.floor(b+(i-j)*l/i+m));d(a,b,n,o,h)}var p=a[b],q=c,r=g;for(e(a,c,b),h(a[g],p)>0&&e(a,c,g);r>q;){for(e(a,q,r),q++,r--;h(a[q],p)<0;)q++;for(;h(a[r],p)>0;)r--}0===h(a[c],p)?e(a,c,r):(r++,e(a,r,g)),b>=r&&(c=r+1),r>=b&&(g=r-1)}}function e(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function f(a,b){return b>a?-1:a>b?1:0}b.exports=d},{}],197:[function(b,c,d){!function(b,e){"object"==typeof d&&"undefined"!=typeof c?c.exports=e():"function"==typeof a&&a.amd?a(e):b.ShelfPack=e()}(this,function(){function a(a,b,c){c=c||{},this.w=a||64,this.h=b||64,this.autoResize=!!c.autoResize,this.shelves=[],this.stats={},this.count=function(a){this.stats[a]=(0|this.stats[a])+1}}function b(a,b,c){this.x=0,this.y=a,this.w=this.free=b,this.h=c}return a.prototype.pack=function(a,b){a=[].concat(a),b=b||{};for(var c,d,e,f=[],g=0;g<a.length;g++)if(c=a[g].w||a[g].width,d=a[g].h||a[g].height,c&&d){if(e=this.packOne(c,d),!e)continue;b.inPlace&&(a[g].x=e.x,a[g].y=e.y),f.push(e)}if(this.shelves.length>0){for(var h=0,i=0,j=0;j<this.shelves.length;j++){var k=this.shelves[j];i+=k.h,h=Math.max(k.w-k.free,h)}this.resize(h,i)}return f},a.prototype.packOne=function(a,c){for(var d,e,f=0,g={shelf:-1,waste:1/0},h=0;h<this.shelves.length;h++){if(d=this.shelves[h],f+=d.h,c===d.h&&a<=d.free)return this.count(c),d.alloc(a,c);c>d.h||a>d.free||c<d.h&&a<=d.free&&(e=d.h-c,e<g.waste&&(g.waste=e,g.shelf=h))}if(-1!==g.shelf)return d=this.shelves[g.shelf],this.count(c),d.alloc(a,c);if(c<=this.h-f&&a<=this.w)return d=new b(f,this.w,c),this.shelves.push(d),this.count(c),d.alloc(a,c);if(this.autoResize){var i,j,k,l;return i=j=this.h,k=l=this.w,(i>=k||a>k)&&(l=2*Math.max(a,k)),(k>i||c>i)&&(j=2*Math.max(c,i)),this.resize(l,j),this.packOne(a,c)}return null},a.prototype.clear=function(){this.shelves=[],this.stats={}},a.prototype.resize=function(a,b){this.w=a,this.h=b;for(var c=0;c<this.shelves.length;c++)this.shelves[c].resize(a);return!0},b.prototype.alloc=function(a,b){if(a>this.free||b>this.h)return null;var c=this.x;return this.x+=a,this.free-=a,{x:c,y:this.y,w:a,h:b,width:a,height:b}},b.prototype.resize=function(a){return this.free+=a-this.w,this.w=a,!0},a})},{}],198:[function(a,b,c){"use strict";function d(a){return new e(a)}function e(a){this.options=n(Object.create(this.options),a),this.trees=new Array(this.options.maxZoom+1)}function f(a,b,c,d){return{x:a,y:b,zoom:1/0,id:d,numPoints:c}}function g(a,b){var c=a.geometry.coordinates;return f(j(c[0]),k(c[1]),1,b)}function h(a){return{type:"Feature",properties:i(a),geometry:{type:"Point",coordinates:[l(a.x),m(a.y)]}}}function i(a){var b=a.numPoints,c=b>=1e4?Math.round(b/1e3)+"k":b>=1e3?Math.round(b/100)/10+"k":b;return{cluster:!0,point_count:b,point_count_abbreviated:c}}function j(a){return a/360+.5}function k(a){var b=Math.sin(a*Math.PI/180),c=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return 0>c?0:c>1?1:c}function l(a){return 360*(a-.5)}function m(a){var b=(180-360*a)*Math.PI/180;return 360*Math.atan(Math.exp(b))/Math.PI-90}function n(a,b){for(var c in b)a[c]=b[c];return a}function o(a){return a.x}function p(a){return a.y}var q=a("kdbush");b.exports=d,e.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1},load:function(a){var b=this.options.log;b&&console.time("total time");var c="prepare "+a.length+" points";b&&console.time(c),this.points=a;var d=a.map(g);b&&console.timeEnd(c);for(var e=this.options.maxZoom;e>=this.options.minZoom;e--){var f=+Date.now();this.trees[e+1]=q(d,o,p,this.options.nodeSize,Float32Array),d=this._cluster(d,e),b&&console.log("z%d: %d clusters in %dms",e,d.length,+Date.now()-f)}return this.trees[this.options.minZoom]=q(d,o,p,this.options.nodeSize,Float32Array),b&&console.timeEnd("total time"),this},getClusters:function(a,b){for(var c=this.trees[this._limitZoom(b)],d=c.range(j(a[0]),k(a[3]),j(a[2]),k(a[1])),e=[],f=0;f<d.length;f++){
var g=c.points[d[f]];e.push(-1!==g.id?this.points[g.id]:h(g))}return e},getTile:function(a,b,c){var d=this.trees[this._limitZoom(a)],e=Math.pow(2,a),f=this.options.extent,g=this.options.radius,h=g/f,i=(c-h)/e,j=(c+1+h)/e,k={features:[]};return this._addTileFeatures(d.range((b-h)/e,i,(b+1+h)/e,j),d.points,b,c,e,k),0===b&&this._addTileFeatures(d.range(1-h/e,i,1,j),d.points,e,c,e,k),b===e-1&&this._addTileFeatures(d.range(0,i,h/e,j),d.points,-1,c,e,k),k.features.length?k:null},_addTileFeatures:function(a,b,c,d,e,f){for(var g=0;g<a.length;g++){var h=b[a[g]];f.features.push({type:1,geometry:[[Math.round(this.options.extent*(h.x*e-c)),Math.round(this.options.extent*(h.y*e-d))]],tags:-1!==h.id?this.points[h.id].properties:i(h)})}},_limitZoom:function(a){return Math.max(this.options.minZoom,Math.min(a,this.options.maxZoom+1))},_cluster:function(a,b){for(var c=[],d=this.options.radius/(this.options.extent*Math.pow(2,b)),e=0;e<a.length;e++){var g=a[e];if(!(g.zoom<=b)){g.zoom=b;for(var h=this.trees[b+1],i=h.within(g.x,g.y,d),j=!1,k=g.numPoints,l=g.x*k,m=g.y*k,n=0;n<i.length;n++){var o=h.points[i[n]];b<o.zoom&&(j=!0,o.zoom=b,l+=o.x*o.numPoints,m+=o.y*o.numPoints,k+=o.numPoints)}c.push(j?f(l/k,m/k,k,-1):g)}}return c}}},{kdbush:148}],199:[function(a,b,c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);if(this.data=a||[],this.length=this.data.length,this.compare=b||e,a)for(var c=Math.floor(this.length/2);c>=0;c--)this._down(c)}function e(a,b){return b>a?-1:a>b?1:0}function f(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}b.exports=d,d.prototype={push:function(a){this.data.push(a),this.length++,this._up(this.length-1)},pop:function(){var a=this.data[0];return this.data[0]=this.data[this.length-1],this.length--,this.data.pop(),this._down(0),a},peek:function(){return this.data[0]},_up:function(a){for(var b=this.data,c=this.compare;a>0;){var d=Math.floor((a-1)/2);if(!(c(b[a],b[d])<0))break;f(b,d,a),a=d}},_down:function(a){for(var b=this.data,c=this.compare,d=this.length;;){var e=2*a+1,g=e+1,h=a;if(d>e&&c(b[e],b[h])<0&&(h=e),d>g&&c(b[g],b[h])<0&&(h=g),h===a)return;f(b,h,a),a=h}}}},{}],200:[function(a,b,c){function d(a,b,c,d){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*b,this.by=3*(d-b)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=d,this.p2x=c,this.p2y=d}b.exports=d,d.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},d.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},d.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},d.prototype.solveCurveX=function(a,b){"undefined"==typeof b&&(b=1e-6);var c,d,e,f,g;for(e=a,g=0;8>g;g++){if(f=this.sampleCurveX(e)-a,Math.abs(f)<b)return e;var h=this.sampleCurveDerivativeX(e);if(Math.abs(h)<1e-6)break;e-=f/h}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=this.sampleCurveX(e),Math.abs(f-a)<b)return e;a>f?c=e:d=e,e=.5*(d-c)+c}return e},d.prototype.solve=function(a,b){return this.sampleCurveY(this.solveCurveX(a,b))}},{}],201:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],202:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],203:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(a){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":202,_process:195,inherits:201}],204:[function(a,b,c){b.exports.VectorTile=a("./lib/vectortile.js"),b.exports.VectorTileFeature=a("./lib/vectortilefeature.js"),b.exports.VectorTileLayer=a("./lib/vectortilelayer.js")},{"./lib/vectortile.js":205,"./lib/vectortilefeature.js":206,"./lib/vectortilelayer.js":207}],205:[function(a,b,c){"use strict";function d(a,b){this.layers=a.readFields(e,{},b)}function e(a,b,c){if(3===a){var d=new f(c,c.readVarint()+c.pos);d.length&&(b[d.name]=d)}}var f=a("./vectortilelayer");b.exports=d},{"./vectortilelayer":207}],206:[function(a,b,c){"use strict";function d(a,b,c,d,f){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=f,a.readFields(e,this,b)}function e(a,b,c){1==a?b.id=c.readVarint():2==a?f(c,b):3==a?b.type=c.readVarint():4==a&&(b._geometry=c.pos)}function f(a,b){for(var c=a.readVarint()+a.pos;a.pos<c;){var d=b._keys[a.readVarint()],e=b._values[a.readVarint()];b.properties[d]=e}}function g(a){var b=a.length;if(1>=b)return[a];for(var c,d,e=[],f=0;b>f;f++){var g=h(a[f]);0!==g&&(void 0===d&&(d=0>g),d===0>g?(c&&e.push(c),c=[a[f]]):c.push(a[f]))}return c&&e.push(c),e}function h(a){for(var b,c,d=0,e=0,f=a.length,g=f-1;f>e;g=e++)b=a[e],c=a[g],d+=(c.x-b.x)*(b.y+c.y);return d}var i=a("point-geometry");b.exports=d,d.types=["Unknown","Point","LineString","Polygon"],d.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var b,c=a.readVarint()+a.pos,d=1,e=0,f=0,g=0,h=[];a.pos<c;){if(!e){var j=a.readVarint();d=7&j,e=j>>3}if(e--,1===d||2===d)f+=a.readSVarint(),g+=a.readSVarint(),1===d&&(b&&h.push(b),b=[]),b.push(new i(f,g));else{if(7!==d)throw new Error("unknown command "+d);b&&b.push(b[0].clone())}}return b&&h.push(b),h},d.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var b=a.readVarint()+a.pos,c=1,d=0,e=0,f=0,g=1/0,h=-(1/0),i=1/0,j=-(1/0);a.pos<b;){if(!d){var k=a.readVarint();c=7&k,d=k>>3}if(d--,1===c||2===c)e+=a.readSVarint(),f+=a.readSVarint(),g>e&&(g=e),e>h&&(h=e),i>f&&(i=f),f>j&&(j=f);else if(7!==c)throw new Error("unknown command "+c)}return[g,i,h,j]},d.prototype.toGeoJSON=function(a,b,c){function e(a){for(var b=0;b<a.length;b++){var c=a[b],d=180-360*(c.y+k)/i;a[b]=[360*(c.x+j)/i-180,360/Math.PI*Math.atan(Math.exp(d*Math.PI/180))-90]}}var f,h,i=this.extent*Math.pow(2,c),j=this.extent*a,k=this.extent*b,l=this.loadGeometry(),m=d.types[this.type];switch(this.type){case 1:var n=[];for(f=0;f<l.length;f++)n[f]=l[f][0];l=n,e(l);break;case 2:for(f=0;f<l.length;f++)e(l[f]);break;case 3:for(l=g(l),f=0;f<l.length;f++)for(h=0;h<l[f].length;h++)e(l[f][h])}1===l.length?l=l[0]:m="Multi"+m;var o={type:"Feature",geometry:{type:m,coordinates:l},properties:this.properties};return"id"in this&&(o.id=this.id),o}},{"point-geometry":194}],207:[function(a,b,c){"use strict";function d(a,b){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(e,this,b),this.length=this._features.length}function e(a,b,c){15===a?b.version=c.readVarint():1===a?b.name=c.readString():5===a?b.extent=c.readVarint():2===a?b._features.push(c.pos):3===a?b._keys.push(c.readString()):4===a&&b._values.push(f(c))}function f(a){for(var b=null,c=a.readVarint()+a.pos;a.pos<c;){var d=a.readVarint()>>3;b=1===d?a.readString():2===d?a.readFloat():3===d?a.readDouble():4===d?a.readVarint64():5===d?a.readVarint():6===d?a.readSVarint():7===d?a.readBoolean():null}return b}var g=a("./vectortilefeature.js");b.exports=d,d.prototype.feature=function(a){if(0>a||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var b=this._pbf.readVarint()+this._pbf.pos;return new g(this._pbf,b,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":206}],208:[function(a,b,c){function d(a){var b=[];for(var c in a.layers)b.push(f(a.layers[c]));var d=new k;return l.tile.write({layers:b},d),d.finish()}function e(a){var b={};for(var c in a)b[c]=new m(a[c].features),b[c].name=c;return d({layers:b})}function f(a){for(var b={name:a.name||"",version:a.version||1,extent:a.extent||4096,keys:[],values:[],features:[]},c={},d={},e=0;e<a.length;e++){var f=a.feature(e);f.geometry=i(f.loadGeometry());var g=[];for(var h in f.properties){var k=c[h];"undefined"==typeof k&&(b.keys.push(h),k=b.keys.length-1,c[h]=k);var l=j(f.properties[h]),m=d[l.key];"undefined"==typeof m&&(b.values.push(l),m=b.values.length-1,d[l.key]=m),g.push(k),g.push(m)}f.tags=g,b.features.push(f)}return b}function g(a,b){return(b<<3)+(7&a)}function h(a){return a<<1^a>>31}function i(a){for(var b=[],c=0,d=0,e=a.length,f=0;e>f;f++){var i=a[f];b.push(g(1,1));for(var j=0;j<i.length;j++){1===j&&b.push(g(2,i.length-1));var k=i[j].x-c,l=i[j].y-d;b.push(h(k),h(l)),c+=k,d+=l}}return b}function j(a){var b,c=typeof a;return"string"===c?b={string_value:a}:"boolean"===c?b={bool_value:a}:"number"===c?b=a%1!==0?{double_value:a}:0>a?{sint_value:a}:{uint_value:a}:(a=JSON.stringify(a),b={string_value:a}),b.key=c+":"+a,b}var k=a("pbf"),l=a("./vector-tile-pb"),m=a("./lib/geojson_wrapper");b.exports=d,b.exports.fromVectorTileJs=d,b.exports.fromGeojsonVt=e,b.exports.GeoJSONWrapper=m},{"./lib/geojson_wrapper":209,"./vector-tile-pb":210,pbf:193}],209:[function(a,b,c){"use strict";function d(a){this.features=a,this.length=a.length}function e(a){this.id="number"==typeof a.id?a.id:void 0,this.type=a.type,this.rawGeometry=1===a.type?[a.geometry]:a.geometry,this.properties=a.tags,this.extent=4096}var f=a("point-geometry"),g=a("vector-tile").VectorTileFeature;b.exports=d,d.prototype.feature=function(a){return new e(this.features[a])},e.prototype.loadGeometry=function(){var a=this.rawGeometry;this.geometry=[];for(var b=0;b<a.length;b++){for(var c=a[b],d=[],e=0;e<c.length;e++)d.push(new f(c[e][0],c[e][1]));this.geometry.push(d)}return this.geometry},e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var a=this.geometry,b=1/0,c=-(1/0),d=1/0,e=-(1/0),f=0;f<a.length;f++)for(var g=a[f],h=0;h<g.length;h++){var i=g[h];b=Math.min(b,i.x),c=Math.max(c,i.x),d=Math.min(d,i.y),e=Math.max(e,i.y)}return[b,d,c,e]},e.prototype.toGeoJSON=g.prototype.toGeoJSON},{"point-geometry":194,"vector-tile":204}],210:[function(a,b,c){"use strict";function d(a,b){return a.readFields(e,{layers:[]},b)}function e(a,b,c){3===a&&b.layers.push(m(c,c.readVarint()+c.pos))}function f(a,b){var c;if(void 0!==a.layers)for(c=0;c<a.layers.length;c++)b.writeMessage(3,o,a.layers[c])}function g(a,b){return a.readFields(h,{},b)}function h(a,b,c){1===a?b.string_value=c.readString():2===a?b.float_value=c.readFloat():3===a?b.double_value=c.readDouble():4===a?b.int_value=c.readVarint():5===a?b.uint_value=c.readVarint():6===a?b.sint_value=c.readSVarint():7===a&&(b.bool_value=c.readBoolean())}function i(a,b){void 0!==a.string_value&&b.writeStringField(1,a.string_value),void 0!==a.float_value&&b.writeFloatField(2,a.float_value),void 0!==a.double_value&&b.writeDoubleField(3,a.double_value),void 0!==a.int_value&&b.writeVarintField(4,a.int_value),void 0!==a.uint_value&&b.writeVarintField(5,a.uint_value),void 0!==a.sint_value&&b.writeSVarintField(6,a.sint_value),void 0!==a.bool_value&&b.writeBooleanField(7,a.bool_value)}function j(a,b){var c=a.readFields(k,{},b);return void 0===c.type&&(c.type="Unknown"),c}function k(a,b,c){1===a?b.id=c.readVarint():2===a?b.tags=c.readPackedVarint():3===a?b.type=c.readVarint():4===a&&(b.geometry=c.readPackedVarint())}function l(a,b){void 0!==a.id&&b.writeVarintField(1,a.id),void 0!==a.tags&&b.writePackedVarint(2,a.tags),void 0!==a.type&&b.writeVarintField(3,a.type),void 0!==a.geometry&&b.writePackedVarint(4,a.geometry)}function m(a,b){return a.readFields(n,{features:[],keys:[],values:[]},b)}function n(a,b,c){15===a?b.version=c.readVarint():1===a?b.name=c.readString():2===a?b.features.push(j(c,c.readVarint()+c.pos)):3===a?b.keys.push(c.readString()):4===a?b.values.push(g(c,c.readVarint()+c.pos)):5===a&&(b.extent=c.readVarint())}function o(a,b){void 0!==a.version&&b.writeVarintField(15,a.version),void 0!==a.name&&b.writeStringField(1,a.name);var c;if(void 0!==a.features)for(c=0;c<a.features.length;c++)b.writeMessage(2,l,a.features[c]);if(void 0!==a.keys)for(c=0;c<a.keys.length;c++)b.writeStringField(3,a.keys[c]);if(void 0!==a.values)for(c=0;c<a.values.length;c++)b.writeMessage(4,i,a.values[c]);void 0!==a.extent&&b.writeVarintField(5,a.extent)}var p=c.tile={read:d,write:f};p.GeomType={Unknown:0,Point:1,LineString:2,Polygon:3},p.value={read:g,write:i},p.feature={read:j,write:l},p.layer={read:m,write:o}},{}],211:[function(a,b,c){var d=arguments[3],e=arguments[4],f=arguments[5],g=JSON.stringify;b.exports=function(a,b){function c(a){q[a]=!0;for(var b in e[a][1]){var d=e[a][1][b];q[d]||c(d)}}for(var h,i=Object.keys(f),j=0,k=i.length;k>j;j++){var l=i[j],m=f[l].exports;if(m===a||m&&m["default"]===a){h=l;break}}if(!h){h=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var n={},j=0,k=i.length;k>j;j++){var l=i[j];n[l]=l}e[h]=[Function(["require","module","exports"],"("+a+")(self)"),n]}var o=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[h]=h,e[o]=[Function(["require"],"var f = require("+g(h)+");(f.default ? f.default : f)(self);"),p];var q={};c(o);var r="("+d+")({"+Object.keys(q).map(function(a){return g(a)+":["+e[a][0]+","+g(e[a][1])+"]"}).join(",")+"},{},["+g(o)+"])",s=window.URL||window.webkitURL||window.mozURL||window.msURL,t=new Blob([r],{type:"text/javascript"});if(b&&b.bare)return t;var u=s.createObjectURL(t),v=new Worker(u);return v.objectURL=u,v}},{}],212:[function(a,b,c){b.exports.RADIUS=6378137,b.exports.FLATTENING=1/298.257223563,b.exports.POLAR_RADIUS=6356752.3142},{}],213:[function(b,c,d){!function(b,e){"object"==typeof d&&"undefined"!=typeof c?e(d):"function"==typeof a&&a.amd?a(["exports"],e):e(b.WhooTS=b.WhooTS||{})}(this,function(a){function b(a,b,d,e,f,g){g=g||{};var h=a+"?"+["bbox="+c(d,e,f),"format="+(g.format||"image/png"),"service="+(g.service||"WMS"),"version="+(g.version||"1.1.1"),"request="+(g.request||"GetMap"),"srs="+(g.srs||"EPSG:3857"),"width="+(g.width||256),"height="+(g.height||256),"layers="+b].join("&");return h}function c(a,b,c){b=Math.pow(2,c)-b-1;var e=d(256*a,256*b,c),f=d(256*(a+1),256*(b+1),c);return e[0]+","+e[1]+","+f[0]+","+f[1]}function d(a,b,c){var d=2*Math.PI*6378137/256/Math.pow(2,c),e=a*d-2*Math.PI*6378137/2,f=b*d-2*Math.PI*6378137/2;return[e,f]}a.getURL=b,a.getTileBBox=c,a.getMercCoords=d,Object.defineProperty(a,"__esModule",{value:!0})})},{}],214:[function(a,b,c){b.exports={version:"0.30.0"}},{}]},{},[24])(24)}),angular.module("travelmapUiApp",["ngCookies","ngResource","ngRoute","ngSanitize"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]);var appConfig={MAP_TOKEN:"pk.eyJ1IjoiZWRvc3BhZG9uaSIsImEiOiJjaXhseHJ3Y24wMDNsMnFxb3k2ZTE2ZDloIn0.fbZFX4aydJuG3KeAblJqMg",MAP_CENTER:[20.9027835,44.4963655],MAP_STYLE:"mapbox://styles/mapbox/dark-v9",MAP_API_SOURCE:"https://travellingmap.herokuapp.com"};angular.module("travelmapUiApp").controller("MainCtrl",["$scope","$q","MapService","CityService","CountryService",function(a,b,c,d,e){a.totalCountries=195,a.visitedCountries=0;var f=c.initMap(appConfig.MAP_TOKEN,appConfig.MAP_STYLE,appConfig.MAP_CENTER);f.on("load",function(){e.getAllCountries().then(function(d){var g={};a.visitedCountries=d.length;for(var h in d){var i=d[h];g[i.country_code]=e.getGeoJSONCountryCoordinates(i.country_code)}b.all(g).then(function(a){var b=[];for(var d in a)b.push({type:"Feature",geometry:a[d]});c.addSource(f,"countries",b),c.addLayer(f,"countries","fill",{},{"fill-color":"#fff","fill-opacity":.2})})},function(a){console.error(a)}),d.getAllCities().then(function(a){var b=[];for(var e in a){var g=a[e];b.push({type:"Feature",geometry:{type:"Point",coordinates:[g.lng,g.lat]},properties:d.getCityPointProperties(g)})}c.addSource(f,"cities",b),c.addLayer(f,"cities","symbol",{"icon-image":"{icon}-15","icon-allow-overlap":!0},{})})}),f.on("click",function(a){var b=c.retrieveFeatures(f,a,"cities");b.length&&c.addPopup(f,b[0])}),f.on("mousemove",function(a){var b=c.retrieveFeatures(f,a,"cities");b.length&&c.changeCursor(f,b,"pointer")})}]),angular.module("travelmapUiApp").service("RestService",["$q","$http",function(a,b){this.get=function(c){return a(function(a,d){b.get(appConfig.MAP_API_SOURCE+c).then(function(b){a(b.data)},function(a){d(a)})})}}]),angular.module("travelmapUiApp").service("CityService",["$q","RestService",function(a,b){this.getAllCities=function(){return a(function(a,c){b.get("/city").then(function(b){a(b)},function(a){c(a)})})},this.getCityPointProperties=function(a){return{icon:"circle",description:["<strong>"+a.name+"</strong>","<p>"+a.formatted_address+"</p>",'<span class="flag-icon flag-icon-'+a.country_code.toLowerCase()+'"></span>'].join("")}}}]),angular.module("travelmapUiApp").service("CountryService",["$q","RestService",function(a,b){this.getAllCountries=function(){return a(function(a,c){b.get("/country").then(function(b){a(b)},function(a){c(a)})})},this.getGeoJSONCountryCoordinates=function(c){return a(function(a,d){b.get("/country/"+c+"/geojson").then(function(b){a(b)},function(a){d(a)})})}}]),angular.module("travelmapUiApp").service("MapService",function(){this.initMap=function(a,b,c){return mapboxgl.accessToken=a,new mapboxgl.Map({container:"map",style:b,zoom:2,minZoom:2,maxZoom:7,center:c})},this.addSource=function(a,b,c){a.addSource(b,{type:"geojson",data:{type:"FeatureCollection",features:c}})},this.addLayer=function(a,b,c,d,e){a.addLayer({id:b,type:c,source:b,layout:d,paint:e})},this.retrieveFeatures=function(a,b,c){return a.queryRenderedFeatures(b.point,{layers:[c]})},this.changeCursor=function(a,b,c){a.getCanvas().style.cursor=b.length?c:""},this.addPopup=function(a,b){return(new mapboxgl.Popup).setLngLat(b.geometry.coordinates).setHTML(b.properties.description).addTo(a)}}),angular.module("travelmapUiApp").run(["$templateCache",function(a){"use strict";a.put("views/main.html",'<p id="statistics">Countries visited: {{visitedCountries}} of {{totalCountries}}</p> <div id="map"></div>')}]);